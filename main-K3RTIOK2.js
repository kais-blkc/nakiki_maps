import{$ as MT,$a as UT,A as Bg,Aa as mh,Ab as Ml,B as _f,Ba as xa,Bb as Gg,C as TT,Ca as Ef,Cb as QT,D as lo,Da as zd,Db as XT,E as Vv,Ea as Bd,Eb as YT,F as eu,Fa as RT,Fb as Zs,G as uh,Ga as PT,Gb as Dr,H as yf,Ha as kT,Hb as qg,I as jv,Ia as OT,Ib as $g,J as es,Ja as LT,Jb as KT,K as vf,Ka as FT,Kb as Hv,L as bf,La as zT,Lb as Qv,M as hh,Ma as Gs,Mb as Ms,N as tu,Na as If,Nb as JT,O as Uv,Oa as ho,Ob as io,P as ET,Pa as zt,Pb as Cl,Q as IT,Qa as Sf,Qb as Vd,R as ST,Ra as BT,Rb as eE,S as Ng,Sa as jg,Sb as tE,T as iu,Ta as Ug,Tb as zn,U as ba,Ua as NT,Ub as Wg,V as co,Va as _n,Vb as iE,W as Cr,Wa as Zv,Wb as Xv,X as mr,Xa as VT,Xb as nE,Y as dh,Ya as wa,Yb as rE,Z as Ti,Za as Ta,Zb as Yv,_ as gr,_a as jT,_b as oE,a as Vt,aa as en,ab as GT,b as fr,ba as Gv,bb as tl,bc as sE,c as Ov,ca as Jt,cb as qs,cc as Kv,d as bT,da as ti,db as gh,e as cn,ea as xf,eb as _h,ec as Jv,f as uR,fa as An,fb as po,fc as e0,g as Lv,ga as Ar,gb as nu,gc as t0,h as hR,ha as _r,hb as il,i as kd,ia as uo,ib as qT,j as xT,ja as wf,jb as $T,k as Od,ka as CT,kb as WT,l as Fv,la as Tf,lb as rr,m as zv,ma as ph,mb as ar,n as ir,na as Ld,nb as Qn,o as Is,oa as El,ob as Nd,p as Jc,pa as Il,pb as ZT,q as Ss,qa as Fd,qb as ts,r as _i,ra as qv,rb as HT,s as ch,sa as $v,sb as Sl,t as Bv,ta as fh,tb as $s,u as wT,ua as nr,ub as to,v as qi,va as Or,vb as yh,w as gf,wa as Wv,wb as Ws,x as va,xa as AT,xb as fo,y as zg,ya as Vg,yb as mo,z as Nv,za as DT,zb as Mf}from"./chunk-H6WDOWZB.js";var SI=cn((hb,db)=>{"use strict";(function(p,d){typeof hb=="object"&&typeof db<"u"?db.exports=d():typeof define=="function"&&define.amd?define(d):(p=typeof globalThis<"u"?globalThis:p||self).MapboxDraw=d()})(hb,function(){"use strict";var p=function(A,z){var K={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},fe={on:function(we,Ae,dt){if(K[we]===void 0)throw new Error("Invalid event type: "+we);K[we].push({selector:Ae,fn:dt})},render:function(we){z.store.featureChanged(we)}},ve=function(we,Ae){for(var dt=K[we],wt=dt.length;wt--;){var Lt=dt[wt];if(Lt.selector(Ae)){Lt.fn.call(fe,Ae)||z.store.render(),z.ui.updateMapClasses();break}}};return A.start.call(fe),{render:A.render,stop:function(){A.stop&&A.stop()},trash:function(){A.trash&&(A.trash(),z.store.render())},combineFeatures:function(){A.combineFeatures&&A.combineFeatures()},uncombineFeatures:function(){A.uncombineFeatures&&A.uncombineFeatures()},drag:function(we){ve("drag",we)},click:function(we){ve("click",we)},mousemove:function(we){ve("mousemove",we)},mousedown:function(we){ve("mousedown",we)},mouseup:function(we){ve("mouseup",we)},mouseout:function(we){ve("mouseout",we)},keydown:function(we){ve("keydown",we)},keyup:function(we){ve("keyup",we)},touchstart:function(we){ve("touchstart",we)},touchmove:function(we){ve("touchmove",we)},touchend:function(we){ve("touchend",we)},tap:function(we){ve("tap",we)}}};function d(A){return A&&A.__esModule&&Object.prototype.hasOwnProperty.call(A,"default")?A.default:A}function T(A){if(A.__esModule)return A;var z=A.default;if(typeof z=="function"){var K=function fe(){if(this instanceof fe){var ve=[null];ve.push.apply(ve,arguments);var we=Function.bind.apply(z,ve);return new we}return z.apply(this,arguments)};K.prototype=z.prototype}else K={};return Object.defineProperty(K,"__esModule",{value:!0}),Object.keys(A).forEach(function(fe){var ve=Object.getOwnPropertyDescriptor(A,fe);Object.defineProperty(K,fe,ve.get?ve:{enumerable:!0,get:function(){return A[fe]}})}),K}var f={},v={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},r=v;function k(A){var z=0;if(A&&A.length>0){z+=Math.abs(W(A[0]));for(var K=1;K<A.length;K++)z-=Math.abs(W(A[K]))}return z}function W(A){var z,K,fe,ve,we,Ae,dt=0,wt=A.length;if(wt>2){for(Ae=0;Ae<wt;Ae++)Ae===wt-2?(fe=wt-2,ve=wt-1,we=0):Ae===wt-1?(fe=wt-1,ve=0,we=1):(fe=Ae,ve=Ae+1,we=Ae+2),z=A[fe],K=A[ve],dt+=(ee(A[we][0])-ee(z[0]))*Math.sin(ee(K[1]));dt=dt*r.RADIUS*r.RADIUS/2}return dt}function ee(A){return A*Math.PI/180}f.geometry=function A(z){var K,fe=0;switch(z.type){case"Polygon":return k(z.coordinates);case"MultiPolygon":for(K=0;K<z.coordinates.length;K++)fe+=k(z.coordinates[K]);return fe;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(K=0;K<z.geometries.length;K++)fe+=A(z.geometries[K]);return fe}},f.ring=W;var de={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},Ie={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},Ne={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},lt={POLYGON:"polygon",LINE:"line_string",POINT:"point"},it={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},Gt={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},Ei={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},sn={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},Xt={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},ni={ACTIVE:"true",INACTIVE:"false"},Io=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],In=-85,rs=Object.freeze({__proto__:null,classes:de,sources:Ie,cursors:Ne,types:lt,geojsonTypes:it,modes:Gt,events:Ei,updateActions:sn,meta:Xt,activeStates:ni,interactions:Io,LAT_MIN:-90,LAT_RENDERED_MIN:In,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),jn={Point:0,LineString:1,MultiLineString:1,Polygon:2};function Ni(A,z){var K=jn[A.geometry.type]-jn[z.geometry.type];return K===0&&A.geometry.type===it.POLYGON?A.area-z.area:K}function _o(A){return A.map(function(z){return z.geometry.type===it.POLYGON&&(z.area=f.geometry({type:it.FEATURE,property:{},geometry:z.geometry})),z}).sort(Ni).map(function(z){return delete z.area,z})}function Rr(A,z){return z===void 0&&(z=0),[[A.point.x-z,A.point.y-z],[A.point.x+z,A.point.y+z]]}function Gr(A){if(this._items={},this._nums={},this._length=A?A.length:0,A)for(var z=0,K=A.length;z<K;z++)this.add(A[z]),A[z]!==void 0&&(typeof A[z]=="string"?this._items[A[z]]=z:this._nums[A[z]]=z)}Gr.prototype.add=function(A){return this.has(A)||(this._length++,typeof A=="string"?this._items[A]=this._length:this._nums[A]=this._length),this},Gr.prototype.delete=function(A){return this.has(A)===!1||(this._length--,delete this._items[A],delete this._nums[A]),this},Gr.prototype.has=function(A){return(typeof A=="string"||typeof A=="number")&&(this._items[A]!==void 0||this._nums[A]!==void 0)},Gr.prototype.values=function(){var A=this,z=[];return Object.keys(this._items).forEach(function(K){z.push({k:K,v:A._items[K]})}),Object.keys(this._nums).forEach(function(K){z.push({k:JSON.parse(K),v:A._nums[K]})}),z.sort(function(K,fe){return K.v-fe.v}).map(function(K){return K.k})},Gr.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var Rl=[Xt.FEATURE,Xt.MIDPOINT,Xt.VERTEX],Xn={click:function(A,z,K){return un(A,z,K,K.options.clickBuffer)},touch:function(A,z,K){return un(A,z,K,K.options.touchBuffer)}};function un(A,z,K,fe){if(K.map===null)return[];var ve=A?Rr(A,fe):z,we={};K.options.styles&&(we.layers=K.options.styles.map(function(Lt){return Lt.id}).filter(function(Lt){return K.map.getLayer(Lt)!=null}));var Ae=K.map.queryRenderedFeatures(ve,we).filter(function(Lt){return Rl.indexOf(Lt.properties.meta)!==-1}),dt=new Gr,wt=[];return Ae.forEach(function(Lt){var Ft=Lt.properties.id;dt.has(Ft)||(dt.add(Ft),wt.push(Lt))}),_o(wt)}function As(A,z){var K=Xn.click(A,null,z),fe={mouse:Ne.NONE};return K[0]&&(fe.mouse=K[0].properties.active===ni.ACTIVE?Ne.MOVE:Ne.POINTER,fe.feature=K[0].properties.meta),z.events.currentModeName().indexOf("draw")!==-1&&(fe.mouse=Ne.ADD),z.ui.queueMapClasses(fe),z.ui.updateMapClasses(),K[0]}function qr(A,z){var K=A.x-z.x,fe=A.y-z.y;return Math.sqrt(K*K+fe*fe)}function no(A,z,K){K===void 0&&(K={});var fe=K.fineTolerance!=null?K.fineTolerance:4,ve=K.grossTolerance!=null?K.grossTolerance:12,we=K.interval!=null?K.interval:500;A.point=A.point||z.point,A.time=A.time||z.time;var Ae=qr(A.point,z.point);return Ae<fe||Ae<ve&&z.time-A.time<we}function Ys(A,z,K){K===void 0&&(K={});var fe=K.tolerance!=null?K.tolerance:25,ve=K.interval!=null?K.interval:250;return A.point=A.point||z.point,A.time=A.time||z.time,qr(A.point,z.point)<fe&&z.time-A.time<ve}var Ks={exports:{}},Pi=Ks.exports=function(A,z){if(z||(z=16),A===void 0&&(A=128),A<=0)return"0";for(var K=Math.log(Math.pow(2,A))/Math.log(z),fe=2;K===1/0;fe*=2)K=Math.log(Math.pow(2,A/fe))/Math.log(z)*fe;var ve=K-Math.floor(K),we="";for(fe=0;fe<Math.floor(K);fe++)we=Math.floor(Math.random()*z).toString(z)+we;if(ve){var Ae=Math.pow(z,ve);we=Math.floor(Math.random()*Ae).toString(z)+we}var dt=parseInt(we,z);return dt!==1/0&&dt>=Math.pow(2,A)?Pi(A,z):we};Pi.rack=function(A,z,K){var fe=function(we){var Ae=0;do{if(Ae++>10){if(!K)throw new Error("too many ID collisions, use more bits");A+=K}var dt=Pi(A,z)}while(Object.hasOwnProperty.call(ve,dt));return ve[dt]=we,dt},ve=fe.hats={};return fe.get=function(we){return fe.hats[we]},fe.set=function(we,Ae){return fe.hats[we]=Ae,fe},fe.bits=A||128,fe.base=z||16,fe};var Js=d(Ks.exports),xn=function(A,z){this.ctx=A,this.properties=z.properties||{},this.coordinates=z.geometry.coordinates,this.id=z.id||Js(),this.type=z.geometry.type};xn.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},xn.prototype.incomingCoords=function(A){this.setCoordinates(A)},xn.prototype.setCoordinates=function(A){this.coordinates=A,this.changed()},xn.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},xn.prototype.setProperty=function(A,z){this.properties[A]=z},xn.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:it.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},xn.prototype.internal=function(A){var z={id:this.id,meta:Xt.FEATURE,"meta:type":this.type,active:ni.INACTIVE,mode:A};if(this.ctx.options.userProperties)for(var K in this.properties)z["user_"+K]=this.properties[K];return{type:it.FEATURE,properties:z,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var So=function(A,z){xn.call(this,A,z)};(So.prototype=Object.create(xn.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},So.prototype.updateCoordinate=function(A,z,K){this.coordinates=arguments.length===3?[z,K]:[A,z],this.changed()},So.prototype.getCoordinate=function(){return this.getCoordinates()};var $r=function(A,z){xn.call(this,A,z)};($r.prototype=Object.create(xn.prototype)).isValid=function(){return this.coordinates.length>1},$r.prototype.addCoordinate=function(A,z,K){this.changed();var fe=parseInt(A,10);this.coordinates.splice(fe,0,[z,K])},$r.prototype.getCoordinate=function(A){var z=parseInt(A,10);return JSON.parse(JSON.stringify(this.coordinates[z]))},$r.prototype.removeCoordinate=function(A){this.changed(),this.coordinates.splice(parseInt(A,10),1)},$r.prototype.updateCoordinate=function(A,z,K){var fe=parseInt(A,10);this.coordinates[fe]=[z,K],this.changed()};var Wn=function(A,z){xn.call(this,A,z),this.coordinates=this.coordinates.map(function(K){return K.slice(0,-1)})};(Wn.prototype=Object.create(xn.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(A){return A.length>2})},Wn.prototype.incomingCoords=function(A){this.coordinates=A.map(function(z){return z.slice(0,-1)}),this.changed()},Wn.prototype.setCoordinates=function(A){this.coordinates=A,this.changed()},Wn.prototype.addCoordinate=function(A,z,K){this.changed();var fe=A.split(".").map(function(ve){return parseInt(ve,10)});this.coordinates[fe[0]].splice(fe[1],0,[z,K])},Wn.prototype.removeCoordinate=function(A){this.changed();var z=A.split(".").map(function(fe){return parseInt(fe,10)}),K=this.coordinates[z[0]];K&&(K.splice(z[1],1),K.length<3&&this.coordinates.splice(z[0],1))},Wn.prototype.getCoordinate=function(A){var z=A.split(".").map(function(fe){return parseInt(fe,10)}),K=this.coordinates[z[0]];return JSON.parse(JSON.stringify(K[z[1]]))},Wn.prototype.getCoordinates=function(){return this.coordinates.map(function(A){return A.concat([A[0]])})},Wn.prototype.updateCoordinate=function(A,z,K){this.changed();var fe=A.split("."),ve=parseInt(fe[0],10),we=parseInt(fe[1],10);this.coordinates[ve]===void 0&&(this.coordinates[ve]=[]),this.coordinates[ve][we]=[z,K]};var jt={MultiPoint:So,MultiLineString:$r,MultiPolygon:Wn},os=function(A,z,K,fe,ve){var we=K.split("."),Ae=parseInt(we[0],10),dt=we[1]?we.slice(1).join("."):null;return A[Ae][z](dt,fe,ve)},ki=function(A,z){if(xn.call(this,A,z),delete this.coordinates,this.model=jt[z.geometry.type],this.model===void 0)throw new TypeError(z.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(z.geometry.coordinates)};function Oi(A){this.map=A.map,this.drawConfig=JSON.parse(JSON.stringify(A.options||{})),this._ctx=A}(ki.prototype=Object.create(xn.prototype))._coordinatesToFeatures=function(A){var z=this,K=this.model.bind(this);return A.map(function(fe){return new K(z.ctx,{id:Js(),type:it.FEATURE,properties:{},geometry:{coordinates:fe,type:z.type.replace("Multi","")}})})},ki.prototype.isValid=function(){return this.features.every(function(A){return A.isValid()})},ki.prototype.setCoordinates=function(A){this.features=this._coordinatesToFeatures(A),this.changed()},ki.prototype.getCoordinate=function(A){return os(this.features,"getCoordinate",A)},ki.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(A){return A.type===it.POLYGON?A.getCoordinates():A.coordinates})))},ki.prototype.updateCoordinate=function(A,z,K){os(this.features,"updateCoordinate",A,z,K),this.changed()},ki.prototype.addCoordinate=function(A,z,K){os(this.features,"addCoordinate",A,z,K),this.changed()},ki.prototype.removeCoordinate=function(A){os(this.features,"removeCoordinate",A),this.changed()},ki.prototype.getFeatures=function(){return this.features},Oi.prototype.setSelected=function(A){return this._ctx.store.setSelected(A)},Oi.prototype.setSelectedCoordinates=function(A){var z=this;this._ctx.store.setSelectedCoordinates(A),A.reduce(function(K,fe){return K[fe.feature_id]===void 0&&(K[fe.feature_id]=!0,z._ctx.store.get(fe.feature_id).changed()),K},{})},Oi.prototype.getSelected=function(){return this._ctx.store.getSelected()},Oi.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Oi.prototype.isSelected=function(A){return this._ctx.store.isSelected(A)},Oi.prototype.getFeature=function(A){return this._ctx.store.get(A)},Oi.prototype.select=function(A){return this._ctx.store.select(A)},Oi.prototype.deselect=function(A){return this._ctx.store.deselect(A)},Oi.prototype.deleteFeature=function(A,z){return z===void 0&&(z={}),this._ctx.store.delete(A,z)},Oi.prototype.addFeature=function(A){return this._ctx.store.add(A)},Oi.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Oi.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Oi.prototype.setActionableState=function(A){A===void 0&&(A={});var z={trash:A.trash||!1,combineFeatures:A.combineFeatures||!1,uncombineFeatures:A.uncombineFeatures||!1};return this._ctx.events.actionable(z)},Oi.prototype.changeMode=function(A,z,K){return z===void 0&&(z={}),K===void 0&&(K={}),this._ctx.events.changeMode(A,z,K)},Oi.prototype.updateUIClasses=function(A){return this._ctx.ui.queueMapClasses(A)},Oi.prototype.activateUIButton=function(A){return this._ctx.ui.setActiveButton(A)},Oi.prototype.featuresAt=function(A,z,K){if(K===void 0&&(K="click"),K!=="click"&&K!=="touch")throw new Error("invalid buffer type");return Xn[K](A,z,this._ctx)},Oi.prototype.newFeature=function(A){var z=A.geometry.type;return z===it.POINT?new So(this._ctx,A):z===it.LINE_STRING?new $r(this._ctx,A):z===it.POLYGON?new Wn(this._ctx,A):new ki(this._ctx,A)},Oi.prototype.isInstanceOf=function(A,z){if(A===it.POINT)return z instanceof So;if(A===it.LINE_STRING)return z instanceof $r;if(A===it.POLYGON)return z instanceof Wn;if(A==="MultiFeature")return z instanceof ki;throw new Error("Unknown feature class: "+A)},Oi.prototype.doRender=function(A){return this._ctx.store.featureChanged(A)},Oi.prototype.onSetup=function(){},Oi.prototype.onDrag=function(){},Oi.prototype.onClick=function(){},Oi.prototype.onMouseMove=function(){},Oi.prototype.onMouseDown=function(){},Oi.prototype.onMouseUp=function(){},Oi.prototype.onMouseOut=function(){},Oi.prototype.onKeyUp=function(){},Oi.prototype.onKeyDown=function(){},Oi.prototype.onTouchStart=function(){},Oi.prototype.onTouchMove=function(){},Oi.prototype.onTouchEnd=function(){},Oi.prototype.onTap=function(){},Oi.prototype.onStop=function(){},Oi.prototype.onTrash=function(){},Oi.prototype.onCombineFeature=function(){},Oi.prototype.onUncombineFeature=function(){},Oi.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Ia={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},ea=Object.keys(Ia);function ta(A){var z=Object.keys(A);return function(K,fe){fe===void 0&&(fe={});var ve={},we=z.reduce(function(Ae,dt){return Ae[dt]=A[dt],Ae},new Oi(K));return{start:function(){var Ae=this;ve=we.onSetup(fe),ea.forEach(function(dt){var wt,Lt=Ia[dt],Ft=function(){return!1};A[Lt]&&(Ft=function(){return!0}),Ae.on(dt,Ft,(wt=Lt,function(ze){return we[wt](ve,ze)}))})},stop:function(){we.onStop(ve)},trash:function(){we.onTrash(ve)},combineFeatures:function(){we.onCombineFeatures(ve)},uncombineFeatures:function(){we.onUncombineFeatures(ve)},render:function(Ae,dt){we.toDisplayFeatures(ve,Ae,dt)}}}}function Ds(A){return[].concat(A).filter(function(z){return z!==void 0})}function rl(){var A=this;if(!(A.ctx.map&&A.ctx.map.getSource(Ie.HOT)!==void 0))return wt();var z=A.ctx.events.currentModeName();A.ctx.ui.queueMapClasses({mode:z});var K=[],fe=[];A.isDirty?fe=A.getAllIds():(K=A.getChangedIds().filter(function(Lt){return A.get(Lt)!==void 0}),fe=A.sources.hot.filter(function(Lt){return Lt.properties.id&&K.indexOf(Lt.properties.id)===-1&&A.get(Lt.properties.id)!==void 0}).map(function(Lt){return Lt.properties.id})),A.sources.hot=[];var ve=A.sources.cold.length;A.sources.cold=A.isDirty?[]:A.sources.cold.filter(function(Lt){var Ft=Lt.properties.id||Lt.properties.parent;return K.indexOf(Ft)===-1});var we=ve!==A.sources.cold.length||fe.length>0;function Ae(Lt,Ft){var ze=A.get(Lt).internal(z);A.ctx.events.currentModeRender(ze,function(fi){A.sources[Ft].push(fi)})}if(K.forEach(function(Lt){return Ae(Lt,"hot")}),fe.forEach(function(Lt){return Ae(Lt,"cold")}),we&&A.ctx.map.getSource(Ie.COLD).setData({type:it.FEATURE_COLLECTION,features:A.sources.cold}),A.ctx.map.getSource(Ie.HOT).setData({type:it.FEATURE_COLLECTION,features:A.sources.hot}),A._emitSelectionChange&&(A.ctx.map.fire(Ei.SELECTION_CHANGE,{features:A.getSelected().map(function(Lt){return Lt.toGeoJSON()}),points:A.getSelectedCoordinates().map(function(Lt){return{type:it.FEATURE,properties:{},geometry:{type:it.POINT,coordinates:Lt.coordinates}}})}),A._emitSelectionChange=!1),A._deletedFeaturesToEmit.length){var dt=A._deletedFeaturesToEmit.map(function(Lt){return Lt.toGeoJSON()});A._deletedFeaturesToEmit=[],A.ctx.map.fire(Ei.DELETE,{features:dt})}function wt(){A.isDirty=!1,A.clearChangedIds()}wt(),A.ctx.map.fire(Ei.RENDER,{})}function Ii(A){var z,K=this;this._features={},this._featureIds=new Gr,this._selectedFeatureIds=new Gr,this._selectedCoordinates=[],this._changedFeatureIds=new Gr,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=A,this.sources={hot:[],cold:[]},this.render=function(){z||(z=requestAnimationFrame(function(){z=null,rl.call(K)}))},this.isDirty=!1}function Pl(A,z){var K=A._selectedCoordinates.filter(function(fe){return A._selectedFeatureIds.has(fe.feature_id)});A._selectedCoordinates.length===K.length||z.silent||(A._emitSelectionChange=!0),A._selectedCoordinates=K}Ii.prototype.createRenderBatch=function(){var A=this,z=this.render,K=0;return this.render=function(){K++},function(){A.render=z,K>0&&A.render()}},Ii.prototype.setDirty=function(){return this.isDirty=!0,this},Ii.prototype.featureChanged=function(A){return this._changedFeatureIds.add(A),this},Ii.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Ii.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Ii.prototype.getAllIds=function(){return this._featureIds.values()},Ii.prototype.add=function(A){return this.featureChanged(A.id),this._features[A.id]=A,this._featureIds.add(A.id),this},Ii.prototype.delete=function(A,z){var K=this;return z===void 0&&(z={}),Ds(A).forEach(function(fe){K._featureIds.has(fe)&&(K._featureIds.delete(fe),K._selectedFeatureIds.delete(fe),z.silent||K._deletedFeaturesToEmit.indexOf(K._features[fe])===-1&&K._deletedFeaturesToEmit.push(K._features[fe]),delete K._features[fe],K.isDirty=!0)}),Pl(this,z),this},Ii.prototype.get=function(A){return this._features[A]},Ii.prototype.getAll=function(){var A=this;return Object.keys(this._features).map(function(z){return A._features[z]})},Ii.prototype.select=function(A,z){var K=this;return z===void 0&&(z={}),Ds(A).forEach(function(fe){K._selectedFeatureIds.has(fe)||(K._selectedFeatureIds.add(fe),K._changedFeatureIds.add(fe),z.silent||(K._emitSelectionChange=!0))}),this},Ii.prototype.deselect=function(A,z){var K=this;return z===void 0&&(z={}),Ds(A).forEach(function(fe){K._selectedFeatureIds.has(fe)&&(K._selectedFeatureIds.delete(fe),K._changedFeatureIds.add(fe),z.silent||(K._emitSelectionChange=!0))}),Pl(this,z),this},Ii.prototype.clearSelected=function(A){return A===void 0&&(A={}),this.deselect(this._selectedFeatureIds.values(),{silent:A.silent}),this},Ii.prototype.setSelected=function(A,z){var K=this;return z===void 0&&(z={}),A=Ds(A),this.deselect(this._selectedFeatureIds.values().filter(function(fe){return A.indexOf(fe)===-1}),{silent:z.silent}),this.select(A.filter(function(fe){return!K._selectedFeatureIds.has(fe)}),{silent:z.silent}),this},Ii.prototype.setSelectedCoordinates=function(A){return this._selectedCoordinates=A,this._emitSelectionChange=!0,this},Ii.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},Ii.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Ii.prototype.getSelected=function(){var A=this;return this._selectedFeatureIds.values().map(function(z){return A.get(z)})},Ii.prototype.getSelectedCoordinates=function(){var A=this;return this._selectedCoordinates.map(function(z){return{coordinates:A.get(z.feature_id).getCoordinate(z.coord_path)}})},Ii.prototype.isSelected=function(A){return this._selectedFeatureIds.has(A)},Ii.prototype.setFeatureProperty=function(A,z,K){this.get(A).setProperty(z,K),this.featureChanged(A)},Ii.prototype.storeMapConfig=function(){var A=this;Io.forEach(function(z){A.ctx.map[z]&&(A._mapInitialConfig[z]=A.ctx.map[z].isEnabled())})},Ii.prototype.restoreMapConfig=function(){var A=this;Object.keys(this._mapInitialConfig).forEach(function(z){A._mapInitialConfig[z]?A.ctx.map[z].enable():A.ctx.map[z].disable()})},Ii.prototype.getInitialConfigValue=function(A){return this._mapInitialConfig[A]===void 0||this._mapInitialConfig[A]};var Yt=function(){for(var A=arguments,z={},K=0;K<arguments.length;K++){var fe=A[K];for(var ve in fe)Wt.call(fe,ve)&&(z[ve]=fe[ve])}return z},Wt=Object.prototype.hasOwnProperty,Mo=d(Yt),Co=["mode","feature","mouse"];function et(A){var z=null,K=null,fe={onRemove:function(){return A.map.off("load",fe.connect),clearInterval(K),fe.removeLayers(),A.store.restoreMapConfig(),A.ui.removeButtons(),A.events.removeEventListeners(),A.ui.clearMapClasses(),A.boxZoomInitial&&A.map.boxZoom.enable(),A.map=null,A.container=null,A.store=null,z&&z.parentNode&&z.parentNode.removeChild(z),z=null,this},connect:function(){A.map.off("load",fe.connect),clearInterval(K),fe.addLayers(),A.store.storeMapConfig(),A.events.addEventListeners()},onAdd:function(ve){var we=ve.fire;return ve.fire=function(Ae,dt){var wt=arguments;return we.length===1&&arguments.length!==1&&(wt=[Mo({},{type:Ae},dt)]),we.apply(ve,wt)},A.map=ve,A.events=function(Ae){var dt=Object.keys(Ae.options.modes).reduce(function(ot,Zt){return ot[Zt]=ta(Ae.options.modes[Zt]),ot},{}),wt={},Lt={},Ft={},ze=null,fi=null;Ft.drag=function(ot,Zt){Zt({point:ot.point,time:new Date().getTime()})?(Ae.ui.queueMapClasses({mouse:Ne.DRAG}),fi.drag(ot)):ot.originalEvent.stopPropagation()},Ft.mousedrag=function(ot){Ft.drag(ot,function(Zt){return!no(wt,Zt)})},Ft.touchdrag=function(ot){Ft.drag(ot,function(Zt){return!Ys(Lt,Zt)})},Ft.mousemove=function(ot){if((ot.originalEvent.buttons!==void 0?ot.originalEvent.buttons:ot.originalEvent.which)===1)return Ft.mousedrag(ot);var Zt=As(ot,Ae);ot.featureTarget=Zt,fi.mousemove(ot)},Ft.mousedown=function(ot){wt={time:new Date().getTime(),point:ot.point};var Zt=As(ot,Ae);ot.featureTarget=Zt,fi.mousedown(ot)},Ft.mouseup=function(ot){var Zt=As(ot,Ae);ot.featureTarget=Zt,no(wt,{point:ot.point,time:new Date().getTime()})?fi.click(ot):fi.mouseup(ot)},Ft.mouseout=function(ot){fi.mouseout(ot)},Ft.touchstart=function(ot){if(Ae.options.touchEnabled){Lt={time:new Date().getTime(),point:ot.point};var Zt=Xn.touch(ot,null,Ae)[0];ot.featureTarget=Zt,fi.touchstart(ot)}},Ft.touchmove=function(ot){if(Ae.options.touchEnabled)return fi.touchmove(ot),Ft.touchdrag(ot)},Ft.touchend=function(ot){if(ot.originalEvent.preventDefault(),Ae.options.touchEnabled){var Zt=Xn.touch(ot,null,Ae)[0];ot.featureTarget=Zt,Ys(Lt,{time:new Date().getTime(),point:ot.point})?fi.tap(ot):fi.touchend(ot)}};var kt=function(ot){return!(ot===8||ot===46||ot>=48&&ot<=57)};function bi(ot,Zt,Tt){Tt===void 0&&(Tt={}),fi.stop();var Pn=dt[ot];if(Pn===void 0)throw new Error(ot+" is not valid");ze=ot;var cr=Pn(Ae,Zt);fi=p(cr,Ae),Tt.silent||Ae.map.fire(Ei.MODE_CHANGE,{mode:ot}),Ae.store.setDirty(),Ae.store.render()}Ft.keydown=function(ot){(ot.srcElement||ot.target).classList.contains("mapboxgl-canvas")&&(ot.keyCode!==8&&ot.keyCode!==46||!Ae.options.controls.trash?kt(ot.keyCode)?fi.keydown(ot):ot.keyCode===49&&Ae.options.controls.point?bi(Gt.DRAW_POINT):ot.keyCode===50&&Ae.options.controls.line_string?bi(Gt.DRAW_LINE_STRING):ot.keyCode===51&&Ae.options.controls.polygon&&bi(Gt.DRAW_POLYGON):(ot.preventDefault(),fi.trash()))},Ft.keyup=function(ot){kt(ot.keyCode)&&fi.keyup(ot)},Ft.zoomend=function(){Ae.store.changeZoom()},Ft.data=function(ot){if(ot.dataType==="style"){var Zt=Ae.setup,Tt=Ae.map,Pn=Ae.options,cr=Ae.store;Pn.styles.some(function(Ps){return Tt.getLayer(Ps.id)})||(Zt.addLayers(),cr.setDirty(),cr.render())}};var qt={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){ze=Ae.options.defaultMode,fi=p(dt[ze](Ae),Ae)},changeMode:bi,actionable:function(ot){var Zt=!1;Object.keys(ot).forEach(function(Tt){if(qt[Tt]===void 0)throw new Error("Invalid action type");qt[Tt]!==ot[Tt]&&(Zt=!0),qt[Tt]=ot[Tt]}),Zt&&Ae.map.fire(Ei.ACTIONABLE,{actions:qt})},currentModeName:function(){return ze},currentModeRender:function(ot,Zt){return fi.render(ot,Zt)},fire:function(ot,Zt){Ft[ot]&&Ft[ot](Zt)},addEventListeners:function(){Ae.map.on("mousemove",Ft.mousemove),Ae.map.on("mousedown",Ft.mousedown),Ae.map.on("mouseup",Ft.mouseup),Ae.map.on("data",Ft.data),Ae.map.on("touchmove",Ft.touchmove),Ae.map.on("touchstart",Ft.touchstart),Ae.map.on("touchend",Ft.touchend),Ae.container.addEventListener("mouseout",Ft.mouseout),Ae.options.keybindings&&(Ae.container.addEventListener("keydown",Ft.keydown),Ae.container.addEventListener("keyup",Ft.keyup))},removeEventListeners:function(){Ae.map.off("mousemove",Ft.mousemove),Ae.map.off("mousedown",Ft.mousedown),Ae.map.off("mouseup",Ft.mouseup),Ae.map.off("data",Ft.data),Ae.map.off("touchmove",Ft.touchmove),Ae.map.off("touchstart",Ft.touchstart),Ae.map.off("touchend",Ft.touchend),Ae.container.removeEventListener("mouseout",Ft.mouseout),Ae.options.keybindings&&(Ae.container.removeEventListener("keydown",Ft.keydown),Ae.container.removeEventListener("keyup",Ft.keyup))},trash:function(ot){fi.trash(ot)},combineFeatures:function(){fi.combineFeatures()},uncombineFeatures:function(){fi.uncombineFeatures()},getMode:function(){return ze}}}(A),A.ui=function(Ae){var dt={},wt=null,Lt={mode:null,feature:null,mouse:null},Ft={mode:null,feature:null,mouse:null};function ze(ot){Ft=Mo(Ft,ot)}function fi(){var ot,Zt;if(Ae.container){var Tt=[],Pn=[];Co.forEach(function(cr){Ft[cr]!==Lt[cr]&&(Tt.push(cr+"-"+Lt[cr]),Ft[cr]!==null&&Pn.push(cr+"-"+Ft[cr]))}),Tt.length>0&&(ot=Ae.container.classList).remove.apply(ot,Tt),Pn.length>0&&(Zt=Ae.container.classList).add.apply(Zt,Pn),Lt=Mo(Lt,Ft)}}function kt(ot,Zt){Zt===void 0&&(Zt={});var Tt=document.createElement("button");return Tt.className=de.CONTROL_BUTTON+" "+Zt.className,Tt.setAttribute("title",Zt.title),Zt.container.appendChild(Tt),Tt.addEventListener("click",function(Pn){if(Pn.preventDefault(),Pn.stopPropagation(),Pn.target===wt)return bi(),void Zt.onDeactivate();qt(ot),Zt.onActivate()},!0),Tt}function bi(){wt&&(wt.classList.remove(de.ACTIVE_BUTTON),wt=null)}function qt(ot){bi();var Zt=dt[ot];Zt&&Zt&&ot!=="trash"&&(Zt.classList.add(de.ACTIVE_BUTTON),wt=Zt)}return{setActiveButton:qt,queueMapClasses:ze,updateMapClasses:fi,clearMapClasses:function(){ze({mode:null,feature:null,mouse:null}),fi()},addButtons:function(){var ot=Ae.options.controls,Zt=document.createElement("div");return Zt.className=de.CONTROL_GROUP+" "+de.CONTROL_BASE,ot&&(ot[lt.LINE]&&(dt[lt.LINE]=kt(lt.LINE,{container:Zt,className:de.CONTROL_BUTTON_LINE,title:"LineString tool "+(Ae.options.keybindings?"(l)":""),onActivate:function(){return Ae.events.changeMode(Gt.DRAW_LINE_STRING)},onDeactivate:function(){return Ae.events.trash()}})),ot[lt.POLYGON]&&(dt[lt.POLYGON]=kt(lt.POLYGON,{container:Zt,className:de.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(Ae.options.keybindings?"(p)":""),onActivate:function(){return Ae.events.changeMode(Gt.DRAW_POLYGON)},onDeactivate:function(){return Ae.events.trash()}})),ot[lt.POINT]&&(dt[lt.POINT]=kt(lt.POINT,{container:Zt,className:de.CONTROL_BUTTON_POINT,title:"Marker tool "+(Ae.options.keybindings?"(m)":""),onActivate:function(){return Ae.events.changeMode(Gt.DRAW_POINT)},onDeactivate:function(){return Ae.events.trash()}})),ot.trash&&(dt.trash=kt("trash",{container:Zt,className:de.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){Ae.events.trash()}})),ot.combine_features&&(dt.combine_features=kt("combineFeatures",{container:Zt,className:de.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){Ae.events.combineFeatures()}})),ot.uncombine_features&&(dt.uncombine_features=kt("uncombineFeatures",{container:Zt,className:de.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){Ae.events.uncombineFeatures()}}))),Zt},removeButtons:function(){Object.keys(dt).forEach(function(ot){var Zt=dt[ot];Zt.parentNode&&Zt.parentNode.removeChild(Zt),delete dt[ot]})}}}(A),A.container=ve.getContainer(),A.store=new Ii(A),z=A.ui.addButtons(),A.options.boxSelect&&(A.boxZoomInitial=ve.boxZoom.isEnabled(),ve.boxZoom.disable(),ve.dragPan.disable(),ve.dragPan.enable()),ve.loaded()?fe.connect():(ve.on("load",fe.connect),K=setInterval(function(){ve.loaded()&&fe.connect()},16)),A.events.start(),z},addLayers:function(){A.map.addSource(Ie.COLD,{data:{type:it.FEATURE_COLLECTION,features:[]},type:"geojson"}),A.map.addSource(Ie.HOT,{data:{type:it.FEATURE_COLLECTION,features:[]},type:"geojson"}),A.options.styles.forEach(function(ve){A.map.addLayer(ve)}),A.store.setDirty(!0),A.store.render()},removeLayers:function(){A.options.styles.forEach(function(ve){A.map.getLayer(ve.id)&&A.map.removeLayer(ve.id)}),A.map.getSource(Ie.COLD)&&A.map.removeSource(Ie.COLD),A.map.getSource(Ie.HOT)&&A.map.removeSource(Ie.HOT)}};return A.setup=fe,fe}var J=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function se(A){return function(z){var K=z.featureTarget;return!!K&&!!K.properties&&K.properties.meta===A}}function _e(A){return!!A.originalEvent&&!!A.originalEvent.shiftKey&&A.originalEvent.button===0}function Ge(A){return!!A.featureTarget&&!!A.featureTarget.properties&&A.featureTarget.properties.active===ni.ACTIVE&&A.featureTarget.properties.meta===Xt.FEATURE}function Ze(A){return!!A.featureTarget&&!!A.featureTarget.properties&&A.featureTarget.properties.active===ni.INACTIVE&&A.featureTarget.properties.meta===Xt.FEATURE}function nt(A){return A.featureTarget===void 0}function Mt(A){return!!A.featureTarget&&!!A.featureTarget.properties&&A.featureTarget.properties.meta===Xt.FEATURE}function Ve(A){var z=A.featureTarget;return!!z&&!!z.properties&&z.properties.meta===Xt.VERTEX}function _t(A){return!!A.originalEvent&&A.originalEvent.shiftKey===!0}function xt(A){return A.keyCode===27}function Dt(A){return A.keyCode===13}var mt=Object.freeze({__proto__:null,isOfMetaType:se,isShiftMousedown:_e,isActiveFeature:Ge,isInactiveFeature:Ze,noTarget:nt,isFeature:Mt,isVertex:Ve,isShiftDown:_t,isEscapeKey:xt,isEnterKey:Dt,isTrue:function(){return!0}}),tn=Mi;function Mi(A,z){this.x=A,this.y=z}Mi.prototype={clone:function(){return new Mi(this.x,this.y)},add:function(A){return this.clone()._add(A)},sub:function(A){return this.clone()._sub(A)},multByPoint:function(A){return this.clone()._multByPoint(A)},divByPoint:function(A){return this.clone()._divByPoint(A)},mult:function(A){return this.clone()._mult(A)},div:function(A){return this.clone()._div(A)},rotate:function(A){return this.clone()._rotate(A)},rotateAround:function(A,z){return this.clone()._rotateAround(A,z)},matMult:function(A){return this.clone()._matMult(A)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(A){return this.x===A.x&&this.y===A.y},dist:function(A){return Math.sqrt(this.distSqr(A))},distSqr:function(A){var z=A.x-this.x,K=A.y-this.y;return z*z+K*K},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(A){return Math.atan2(this.y-A.y,this.x-A.x)},angleWith:function(A){return this.angleWithSep(A.x,A.y)},angleWithSep:function(A,z){return Math.atan2(this.x*z-this.y*A,this.x*A+this.y*z)},_matMult:function(A){var z=A[0]*this.x+A[1]*this.y,K=A[2]*this.x+A[3]*this.y;return this.x=z,this.y=K,this},_add:function(A){return this.x+=A.x,this.y+=A.y,this},_sub:function(A){return this.x-=A.x,this.y-=A.y,this},_mult:function(A){return this.x*=A,this.y*=A,this},_div:function(A){return this.x/=A,this.y/=A,this},_multByPoint:function(A){return this.x*=A.x,this.y*=A.y,this},_divByPoint:function(A){return this.x/=A.x,this.y/=A.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var A=this.y;return this.y=this.x,this.x=-A,this},_rotate:function(A){var z=Math.cos(A),K=Math.sin(A),fe=z*this.x-K*this.y,ve=K*this.x+z*this.y;return this.x=fe,this.y=ve,this},_rotateAround:function(A,z){var K=Math.cos(A),fe=Math.sin(A),ve=z.x+K*(this.x-z.x)-fe*(this.y-z.y),we=z.y+fe*(this.x-z.x)+K*(this.y-z.y);return this.x=ve,this.y=we,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Mi.convert=function(A){return A instanceof Mi?A:Array.isArray(A)?new Mi(A[0],A[1]):A};var Ki=d(tn);function Fi(A,z){var K=z.getBoundingClientRect();return new Ki(A.clientX-K.left-(z.clientLeft||0),A.clientY-K.top-(z.clientTop||0))}function Ci(A,z,K,fe){return{type:it.FEATURE,properties:{meta:Xt.VERTEX,parent:A,coord_path:K,active:fe?ni.ACTIVE:ni.INACTIVE},geometry:{type:it.POINT,coordinates:z}}}function Ji(A,z,K){var fe=z.geometry.coordinates,ve=K.geometry.coordinates;if(fe[1]>85||fe[1]<In||ve[1]>85||ve[1]<In)return null;var we={lng:(fe[0]+ve[0])/2,lat:(fe[1]+ve[1])/2};return{type:it.FEATURE,properties:{meta:Xt.MIDPOINT,parent:A,lng:we.lng,lat:we.lat,coord_path:K.properties.coord_path},geometry:{type:it.POINT,coordinates:[we.lng,we.lat]}}}function yn(A,z,K){z===void 0&&(z={}),K===void 0&&(K=null);var fe,ve=A.geometry,we=ve.type,Ae=ve.coordinates,dt=A.properties&&A.properties.id,wt=[];function Lt(ze,fi){var kt="",bi=null;ze.forEach(function(qt,ot){var Zt=fi!=null?fi+"."+ot:String(ot),Tt=Ci(dt,qt,Zt,Ft(Zt));if(z.midpoints&&bi){var Pn=Ji(dt,bi,Tt);Pn&&wt.push(Pn)}bi=Tt;var cr=JSON.stringify(qt);kt!==cr&&wt.push(Tt),ot===0&&(kt=cr)})}function Ft(ze){return!!z.selectedPaths&&z.selectedPaths.indexOf(ze)!==-1}return we===it.POINT?wt.push(Ci(dt,Ae,K,Ft(K))):we===it.POLYGON?Ae.forEach(function(ze,fi){Lt(ze,K!==null?K+"."+fi:String(fi))}):we===it.LINE_STRING?Lt(Ae,K):we.indexOf(it.MULTI_PREFIX)===0&&(fe=we.replace(it.MULTI_PREFIX,""),Ae.forEach(function(ze,fi){var kt={type:it.FEATURE,properties:A.properties,geometry:{type:fe,coordinates:ze}};wt=wt.concat(yn(kt,z,fi))})),wt}var En={enable:function(A){setTimeout(function(){A.map&&A.map.doubleClickZoom&&A._ctx&&A._ctx.store&&A._ctx.store.getInitialConfigValue&&A._ctx.store.getInitialConfigValue("doubleClickZoom")&&A.map.doubleClickZoom.enable()},0)},disable:function(A){setTimeout(function(){A.map&&A.map.doubleClickZoom&&A.map.doubleClickZoom.disable()},0)}},an={exports:{}},Lr=function(A){if(!A||!A.type)return null;var z=Fr[A.type];if(!z)return null;if(z==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:A}]};if(z==="feature")return{type:"FeatureCollection",features:[A]};if(z==="featurecollection")return A},Fr={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Uo=d(Lr),Yn=Object.freeze({__proto__:null,default:function A(z){switch(z&&z.type||null){case"FeatureCollection":return z.features=z.features.reduce(function(K,fe){return K.concat(A(fe))},[]),z;case"Feature":return z.geometry?A(z.geometry).map(function(K){var fe={type:"Feature",properties:JSON.parse(JSON.stringify(z.properties)),geometry:K};return z.id!==void 0&&(fe.id=z.id),fe}):[z];case"MultiPoint":return z.coordinates.map(function(K){return{type:"Point",coordinates:K}});case"MultiPolygon":return z.coordinates.map(function(K){return{type:"Polygon",coordinates:K}});case"MultiLineString":return z.coordinates.map(function(K){return{type:"LineString",coordinates:K}});case"GeometryCollection":return z.geometries.map(A).reduce(function(K,fe){return K.concat(fe)},[]);case"Point":case"Polygon":case"LineString":return[z]}}}),Dn=Lr,Be=T(Yn),je=function(A){return function z(K){return Array.isArray(K)&&K.length&&typeof K[0]=="number"?[K]:K.reduce(function(fe,ve){return Array.isArray(ve)&&Array.isArray(ve[0])?fe.concat(z(ve)):(fe.push(ve),fe)},[])}(A)};Be instanceof Function||(Be=Be.default);var Ye={exports:{}},st=Ye.exports=function(A){return new tt(A)};function tt(A){this.value=A}function ut(A,z,K){var fe=[],ve=[],we=!0;return function Ae(dt){var wt=K?ht(dt):dt,Lt={},Ft=!0,ze={node:wt,node_:dt,path:[].concat(fe),parent:ve[ve.length-1],parents:ve,key:fe.slice(-1)[0],isRoot:fe.length===0,level:fe.length,circular:null,update:function(bi,qt){ze.isRoot||(ze.parent.node[ze.key]=bi),ze.node=bi,qt&&(Ft=!1)},delete:function(bi){delete ze.parent.node[ze.key],bi&&(Ft=!1)},remove:function(bi){at(ze.parent.node)?ze.parent.node.splice(ze.key,1):delete ze.parent.node[ze.key],bi&&(Ft=!1)},keys:null,before:function(bi){Lt.before=bi},after:function(bi){Lt.after=bi},pre:function(bi){Lt.pre=bi},post:function(bi){Lt.post=bi},stop:function(){we=!1},block:function(){Ft=!1}};if(!we)return ze;function fi(){if(typeof ze.node=="object"&&ze.node!==null){ze.keys&&ze.node_===ze.node||(ze.keys=rt(ze.node)),ze.isLeaf=ze.keys.length==0;for(var bi=0;bi<ve.length;bi++)if(ve[bi].node_===dt){ze.circular=ve[bi];break}}else ze.isLeaf=!0,ze.keys=null;ze.notLeaf=!ze.isLeaf,ze.notRoot=!ze.isRoot}fi();var kt=z.call(ze,ze.node);return kt!==void 0&&ze.update&&ze.update(kt),Lt.before&&Lt.before.call(ze,ze.node),Ft&&(typeof ze.node!="object"||ze.node===null||ze.circular||(ve.push(ze),fi(),Ht(ze.keys,function(bi,qt){fe.push(bi),Lt.pre&&Lt.pre.call(ze,ze.node[bi],bi);var ot=Ae(ze.node[bi]);K&&mi.call(ze.node,bi)&&(ze.node[bi]=ot.node),ot.isLast=qt==ze.keys.length-1,ot.isFirst=qt==0,Lt.post&&Lt.post.call(ze,ot),fe.pop()}),ve.pop()),Lt.after&&Lt.after.call(ze,ze.node)),ze}(A).node}function ht(A){if(typeof A=="object"&&A!==null){var z;if(at(A))z=[];else if(ft(A)==="[object Date]")z=new Date(A.getTime?A.getTime():A);else if(function(ve){return ft(ve)==="[object RegExp]"}(A))z=new RegExp(A);else if(function(ve){return ft(ve)==="[object Error]"}(A))z={message:A.message};else if(function(ve){return ft(ve)==="[object Boolean]"}(A))z=new Boolean(A);else if(function(ve){return ft(ve)==="[object Number]"}(A))z=new Number(A);else if(function(ve){return ft(ve)==="[object String]"}(A))z=new String(A);else if(Object.create&&Object.getPrototypeOf)z=Object.create(Object.getPrototypeOf(A));else if(A.constructor===Object)z={};else{var K=A.constructor&&A.constructor.prototype||A.__proto__||{},fe=function(){};fe.prototype=K,z=new fe}return Ht(rt(A),function(ve){z[ve]=A[ve]}),z}return A}tt.prototype.get=function(A){for(var z=this.value,K=0;K<A.length;K++){var fe=A[K];if(!z||!mi.call(z,fe)){z=void 0;break}z=z[fe]}return z},tt.prototype.has=function(A){for(var z=this.value,K=0;K<A.length;K++){var fe=A[K];if(!z||!mi.call(z,fe))return!1;z=z[fe]}return!0},tt.prototype.set=function(A,z){for(var K=this.value,fe=0;fe<A.length-1;fe++){var ve=A[fe];mi.call(K,ve)||(K[ve]={}),K=K[ve]}return K[A[fe]]=z,z},tt.prototype.map=function(A){return ut(this.value,A,!0)},tt.prototype.forEach=function(A){return this.value=ut(this.value,A,!1),this.value},tt.prototype.reduce=function(A,z){var K=arguments.length===1,fe=K?this.value:z;return this.forEach(function(ve){this.isRoot&&K||(fe=A.call(this,fe,ve))}),fe},tt.prototype.paths=function(){var A=[];return this.forEach(function(z){A.push(this.path)}),A},tt.prototype.nodes=function(){var A=[];return this.forEach(function(z){A.push(this.node)}),A},tt.prototype.clone=function(){var A=[],z=[];return function K(fe){for(var ve=0;ve<A.length;ve++)if(A[ve]===fe)return z[ve];if(typeof fe=="object"&&fe!==null){var we=ht(fe);return A.push(fe),z.push(we),Ht(rt(fe),function(Ae){we[Ae]=K(fe[Ae])}),A.pop(),z.pop(),we}return fe}(this.value)};var rt=Object.keys||function(A){var z=[];for(var K in A)z.push(K);return z};function ft(A){return Object.prototype.toString.call(A)}var at=Array.isArray||function(A){return Object.prototype.toString.call(A)==="[object Array]"},Ht=function(A,z){if(A.forEach)return A.forEach(z);for(var K=0;K<A.length;K++)z(A[K],K,A)};Ht(rt(tt.prototype),function(A){st[A]=function(z){var K=[].slice.call(arguments,1),fe=new tt(z);return fe[A].apply(fe,K)}});var mi=Object.hasOwnProperty||function(A,z){return z in A},Rt=Ye.exports,nn=Vi;function Vi(A){if(!(this instanceof Vi))return new Vi(A);this._bbox=A||[1/0,1/0,-1/0,-1/0],this._valid=!!A}Vi.prototype.include=function(A){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],A[0]),this._bbox[1]=Math.min(this._bbox[1],A[1]),this._bbox[2]=Math.max(this._bbox[2],A[0]),this._bbox[3]=Math.max(this._bbox[3],A[1]),this},Vi.prototype.equals=function(A){var z;return z=A instanceof Vi?A.bbox():A,this._bbox[0]==z[0]&&this._bbox[1]==z[1]&&this._bbox[2]==z[2]&&this._bbox[3]==z[3]},Vi.prototype.center=function(A){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Vi.prototype.union=function(A){var z;return this._valid=!0,z=A instanceof Vi?A.bbox():A,this._bbox[0]=Math.min(this._bbox[0],z[0]),this._bbox[1]=Math.min(this._bbox[1],z[1]),this._bbox[2]=Math.max(this._bbox[2],z[2]),this._bbox[3]=Math.max(this._bbox[3],z[3]),this},Vi.prototype.bbox=function(){return this._valid?this._bbox:null},Vi.prototype.contains=function(A){if(!A)return this._fastContains();if(!this._valid)return null;var z=A[0],K=A[1];return this._bbox[0]<=z&&this._bbox[1]<=K&&this._bbox[2]>=z&&this._bbox[3]>=K},Vi.prototype.intersect=function(A){return this._valid?(z=A instanceof Vi?A.bbox():A,!(this._bbox[0]>z[2]||this._bbox[2]<z[0]||this._bbox[3]<z[1]||this._bbox[1]>z[3])):null;var z},Vi.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var A="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",A)},Vi.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Rn=function(A){if(!A)return[];var z=Be(Dn(A)),K=[];return z.features.forEach(function(fe){fe.geometry&&(K=K.concat(je(fe.geometry.coordinates)))}),K},qn=Rt,Bn=nn,Ai={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},yo=Object.keys(Ai);function vo(A){for(var z=Bn(),K=Rn(A),fe=0;fe<K.length;fe++)z.include(K[fe]);return z}an.exports=function(A){return vo(A).bbox()},an.exports.polygon=function(A){return vo(A).polygon()},an.exports.bboxify=function(A){return qn(A).map(function(z){z&&yo.some(function(K){return!!z[K]&&Ai[K].indexOf(z.type)!==-1})&&(z.bbox=vo(z).bbox(),this.update(z))})};var br=d(an.exports),ss=-90;function Sa(A,z){var K=ss,fe=90,ve=ss,we=90,Ae=270,dt=-270;A.forEach(function(Lt){var Ft=br(Lt),ze=Ft[1],fi=Ft[3],kt=Ft[0],bi=Ft[2];ze>K&&(K=ze),fi<fe&&(fe=fi),fi>ve&&(ve=fi),ze<we&&(we=ze),kt<Ae&&(Ae=kt),bi>dt&&(dt=bi)});var wt=z;return K+wt.lat>85&&(wt.lat=85-K),ve+wt.lat>90&&(wt.lat=90-ve),fe+wt.lat<-85&&(wt.lat=-85-fe),we+wt.lat<ss&&(wt.lat=ss-we),Ae+wt.lng<=-270&&(wt.lng+=360*Math.ceil(Math.abs(wt.lng)/360)),dt+wt.lng>=270&&(wt.lng-=360*Math.ceil(Math.abs(wt.lng)/360)),wt}function Pr(A,z){var K=Sa(A.map(function(fe){return fe.toGeoJSON()}),z);A.forEach(function(fe){var ve,we=fe.getCoordinates(),Ae=function(wt){var Lt={lng:wt[0]+K.lng,lat:wt[1]+K.lat};return[Lt.lng,Lt.lat]},dt=function(wt){return wt.map(function(Lt){return Ae(Lt)})};fe.type===it.POINT?ve=Ae(we):fe.type===it.LINE_STRING||fe.type===it.MULTI_POINT?ve=we.map(Ae):fe.type===it.POLYGON||fe.type===it.MULTI_LINE_STRING?ve=we.map(dt):fe.type===it.MULTI_POLYGON&&(ve=we.map(function(wt){return wt.map(function(Lt){return dt(Lt)})})),fe.incomingCoords(ve)})}var yr={onSetup:function(A){var z=this,K={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:A.featureIds||[]};return this.setSelected(K.initiallySelectedFeatureIds.filter(function(fe){return z.getFeature(fe)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),K},fireUpdate:function(){this.map.fire(Ei.UPDATE,{action:sn.MOVE,features:this.getSelected().map(function(A){return A.toGeoJSON()})})},fireActionable:function(){var A=this,z=this.getSelected(),K=z.filter(function(dt){return A.isInstanceOf("MultiFeature",dt)}),fe=!1;if(z.length>1){fe=!0;var ve=z[0].type.replace("Multi","");z.forEach(function(dt){dt.type.replace("Multi","")!==ve&&(fe=!1)})}var we=K.length>0,Ae=z.length>0;this.setActionableState({combineFeatures:fe,uncombineFeatures:we,trash:Ae})},getUniqueIds:function(A){return A.length?A.map(function(z){return z.properties.id}).filter(function(z){return z!==void 0}).reduce(function(z,K){return z.add(K),z},new Gr).values():[]},stopExtendedInteractions:function(A){A.boxSelectElement&&(A.boxSelectElement.parentNode&&A.boxSelectElement.parentNode.removeChild(A.boxSelectElement),A.boxSelectElement=null),this.map.dragPan.enable(),A.boxSelecting=!1,A.canBoxSelect=!1,A.dragMoving=!1,A.canDragMove=!1},onStop:function(){En.enable(this)},onMouseMove:function(A,z){return Mt(z)&&A.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(A),!0},onMouseOut:function(A){return!A.dragMoving||this.fireUpdate()}};yr.onTap=yr.onClick=function(A,z){return nt(z)?this.clickAnywhere(A,z):se(Xt.VERTEX)(z)?this.clickOnVertex(A,z):Mt(z)?this.clickOnFeature(A,z):void 0},yr.clickAnywhere=function(A){var z=this,K=this.getSelectedIds();K.length&&(this.clearSelectedFeatures(),K.forEach(function(fe){return z.doRender(fe)})),En.enable(this),this.stopExtendedInteractions(A)},yr.clickOnVertex=function(A,z){this.changeMode(Gt.DIRECT_SELECT,{featureId:z.featureTarget.properties.parent,coordPath:z.featureTarget.properties.coord_path,startPos:z.lngLat}),this.updateUIClasses({mouse:Ne.MOVE})},yr.startOnActiveFeature=function(A,z){this.stopExtendedInteractions(A),this.map.dragPan.disable(),this.doRender(z.featureTarget.properties.id),A.canDragMove=!0,A.dragMoveLocation=z.lngLat},yr.clickOnFeature=function(A,z){var K=this;En.disable(this),this.stopExtendedInteractions(A);var fe=_t(z),ve=this.getSelectedIds(),we=z.featureTarget.properties.id,Ae=this.isSelected(we);if(!fe&&Ae&&this.getFeature(we).type!==it.POINT)return this.changeMode(Gt.DIRECT_SELECT,{featureId:we});Ae&&fe?(this.deselect(we),this.updateUIClasses({mouse:Ne.POINTER}),ve.length===1&&En.enable(this)):!Ae&&fe?(this.select(we),this.updateUIClasses({mouse:Ne.MOVE})):Ae||fe||(ve.forEach(function(dt){return K.doRender(dt)}),this.setSelected(we),this.updateUIClasses({mouse:Ne.MOVE})),this.doRender(we)},yr.onMouseDown=function(A,z){return Ge(z)?this.startOnActiveFeature(A,z):this.drawConfig.boxSelect&&_e(z)?this.startBoxSelect(A,z):void 0},yr.startBoxSelect=function(A,z){this.stopExtendedInteractions(A),this.map.dragPan.disable(),A.boxSelectStartLocation=Fi(z.originalEvent,this.map.getContainer()),A.canBoxSelect=!0},yr.onTouchStart=function(A,z){if(Ge(z))return this.startOnActiveFeature(A,z)},yr.onDrag=function(A,z){return A.canDragMove?this.dragMove(A,z):this.drawConfig.boxSelect&&A.canBoxSelect?this.whileBoxSelect(A,z):void 0},yr.whileBoxSelect=function(A,z){A.boxSelecting=!0,this.updateUIClasses({mouse:Ne.ADD}),A.boxSelectElement||(A.boxSelectElement=document.createElement("div"),A.boxSelectElement.classList.add(de.BOX_SELECT),this.map.getContainer().appendChild(A.boxSelectElement));var K=Fi(z.originalEvent,this.map.getContainer()),fe=Math.min(A.boxSelectStartLocation.x,K.x),ve=Math.max(A.boxSelectStartLocation.x,K.x),we=Math.min(A.boxSelectStartLocation.y,K.y),Ae=Math.max(A.boxSelectStartLocation.y,K.y),dt="translate("+fe+"px, "+we+"px)";A.boxSelectElement.style.transform=dt,A.boxSelectElement.style.WebkitTransform=dt,A.boxSelectElement.style.width=ve-fe+"px",A.boxSelectElement.style.height=Ae-we+"px"},yr.dragMove=function(A,z){A.dragMoving=!0,z.originalEvent.stopPropagation();var K={lng:z.lngLat.lng-A.dragMoveLocation.lng,lat:z.lngLat.lat-A.dragMoveLocation.lat};Pr(this.getSelected(),K),A.dragMoveLocation=z.lngLat},yr.onTouchEnd=yr.onMouseUp=function(A,z){var K=this;if(A.dragMoving)this.fireUpdate();else if(A.boxSelecting){var fe=[A.boxSelectStartLocation,Fi(z.originalEvent,this.map.getContainer())],ve=this.featuresAt(null,fe,"click"),we=this.getUniqueIds(ve).filter(function(Ae){return!K.isSelected(Ae)});we.length&&(this.select(we),we.forEach(function(Ae){return K.doRender(Ae)}),this.updateUIClasses({mouse:Ne.MOVE}))}this.stopExtendedInteractions(A)},yr.toDisplayFeatures=function(A,z,K){z.properties.active=this.isSelected(z.properties.id)?ni.ACTIVE:ni.INACTIVE,K(z),this.fireActionable(),z.properties.active===ni.ACTIVE&&z.geometry.type!==it.POINT&&yn(z).forEach(K)},yr.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},yr.onCombineFeatures=function(){var A=this.getSelected();if(!(A.length===0||A.length<2)){for(var z=[],K=[],fe=A[0].type.replace("Multi",""),ve=0;ve<A.length;ve++){var we=A[ve];if(we.type.replace("Multi","")!==fe)return;we.type.includes("Multi")?we.getCoordinates().forEach(function(dt){z.push(dt)}):z.push(we.getCoordinates()),K.push(we.toGeoJSON())}if(K.length>1){var Ae=this.newFeature({type:it.FEATURE,properties:K[0].properties,geometry:{type:"Multi"+fe,coordinates:z}});this.addFeature(Ae),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([Ae.id]),this.map.fire(Ei.COMBINE_FEATURES,{createdFeatures:[Ae.toGeoJSON()],deletedFeatures:K})}this.fireActionable()}},yr.onUncombineFeatures=function(){var A=this,z=this.getSelected();if(z.length!==0){for(var K=[],fe=[],ve=function(Ae){var dt=z[Ae];A.isInstanceOf("MultiFeature",dt)&&(dt.getFeatures().forEach(function(wt){A.addFeature(wt),wt.properties=dt.properties,K.push(wt.toGeoJSON()),A.select([wt.id])}),A.deleteFeature(dt.id,{silent:!0}),fe.push(dt.toGeoJSON()))},we=0;we<z.length;we++)ve(we);K.length>1&&this.map.fire(Ei.UNCOMBINE_FEATURES,{createdFeatures:K,deletedFeatures:fe}),this.fireActionable()}};var pi=se(Xt.VERTEX),cc=se(Xt.MIDPOINT),Kn={fireUpdate:function(){this.map.fire(Ei.UPDATE,{action:sn.CHANGE_COORDINATES,features:this.getSelected().map(function(A){return A.toGeoJSON()})})},fireActionable:function(A){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:A.selectedCoordPaths.length>0})},startDragging:function(A,z){this.map.dragPan.disable(),A.canDragMove=!0,A.dragMoveLocation=z.lngLat},stopDragging:function(A){this.map.dragPan.enable(),A.dragMoving=!1,A.canDragMove=!1,A.dragMoveLocation=null},onVertex:function(A,z){this.startDragging(A,z);var K=z.featureTarget.properties,fe=A.selectedCoordPaths.indexOf(K.coord_path);_t(z)||fe!==-1?_t(z)&&fe===-1&&A.selectedCoordPaths.push(K.coord_path):A.selectedCoordPaths=[K.coord_path];var ve=this.pathsToCoordinates(A.featureId,A.selectedCoordPaths);this.setSelectedCoordinates(ve)},onMidpoint:function(A,z){this.startDragging(A,z);var K=z.featureTarget.properties;A.feature.addCoordinate(K.coord_path,K.lng,K.lat),this.fireUpdate(),A.selectedCoordPaths=[K.coord_path]},pathsToCoordinates:function(A,z){return z.map(function(K){return{feature_id:A,coord_path:K}})},onFeature:function(A,z){A.selectedCoordPaths.length===0?this.startDragging(A,z):this.stopDragging(A)},dragFeature:function(A,z,K){Pr(this.getSelected(),K),A.dragMoveLocation=z.lngLat},dragVertex:function(A,z,K){for(var fe=A.selectedCoordPaths.map(function(dt){return A.feature.getCoordinate(dt)}),ve=Sa(fe.map(function(dt){return{type:it.FEATURE,properties:{},geometry:{type:it.POINT,coordinates:dt}}}),K),we=0;we<fe.length;we++){var Ae=fe[we];A.feature.updateCoordinate(A.selectedCoordPaths[we],Ae[0]+ve.lng,Ae[1]+ve.lat)}},clickNoTarget:function(){this.changeMode(Gt.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(Gt.SIMPLE_SELECT)},clickActiveFeature:function(A){A.selectedCoordPaths=[],this.clearSelectedCoordinates(),A.feature.changed()},onSetup:function(A){var z=A.featureId,K=this.getFeature(z);if(!K)throw new Error("You must provide a featureId to enter direct_select mode");if(K.type===it.POINT)throw new TypeError("direct_select mode doesn't handle point features");var fe={featureId:z,feature:K,dragMoveLocation:A.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:A.coordPath?[A.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(z,fe.selectedCoordPaths)),this.setSelected(z),En.disable(this),this.setActionableState({trash:!0}),fe},onStop:function(){En.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(A,z,K){A.featureId===z.properties.id?(z.properties.active=ni.ACTIVE,K(z),yn(z,{map:this.map,midpoints:!0,selectedPaths:A.selectedCoordPaths}).forEach(K)):(z.properties.active=ni.INACTIVE,K(z)),this.fireActionable(A)},onTrash:function(A){A.selectedCoordPaths.sort(function(z,K){return K.localeCompare(z,"en",{numeric:!0})}).forEach(function(z){return A.feature.removeCoordinate(z)}),this.fireUpdate(),A.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(A),A.feature.isValid()===!1&&(this.deleteFeature([A.featureId]),this.changeMode(Gt.SIMPLE_SELECT,{}))},onMouseMove:function(A,z){var K=Ge(z),fe=pi(z),ve=cc(z),we=A.selectedCoordPaths.length===0;return K&&we||fe&&!we?this.updateUIClasses({mouse:Ne.MOVE}):this.updateUIClasses({mouse:Ne.NONE}),(fe||K||ve)&&A.dragMoving&&this.fireUpdate(),this.stopDragging(A),!0},onMouseOut:function(A){return A.dragMoving&&this.fireUpdate(),!0}};Kn.onTouchStart=Kn.onMouseDown=function(A,z){return pi(z)?this.onVertex(A,z):Ge(z)?this.onFeature(A,z):cc(z)?this.onMidpoint(A,z):void 0},Kn.onDrag=function(A,z){if(A.canDragMove===!0){A.dragMoving=!0,z.originalEvent.stopPropagation();var K={lng:z.lngLat.lng-A.dragMoveLocation.lng,lat:z.lngLat.lat-A.dragMoveLocation.lat};A.selectedCoordPaths.length>0?this.dragVertex(A,z,K):this.dragFeature(A,z,K),A.dragMoveLocation=z.lngLat}},Kn.onClick=function(A,z){return nt(z)?this.clickNoTarget(A,z):Ge(z)?this.clickActiveFeature(A,z):Ze(z)?this.clickInactive(A,z):void this.stopDragging(A)},Kn.onTap=function(A,z){return nt(z)?this.clickNoTarget(A,z):Ge(z)?this.clickActiveFeature(A,z):Ze(z)?this.clickInactive(A,z):void 0},Kn.onTouchEnd=Kn.onMouseUp=function(A){A.dragMoving&&this.fireUpdate(),this.stopDragging(A)};var xr={};function kl(A,z){return!!A.lngLat&&A.lngLat.lng===z[0]&&A.lngLat.lat===z[1]}xr.onSetup=function(){var A=this.newFeature({type:it.FEATURE,properties:{},geometry:{type:it.POINT,coordinates:[]}});return this.addFeature(A),this.clearSelectedFeatures(),this.updateUIClasses({mouse:Ne.ADD}),this.activateUIButton(lt.POINT),this.setActionableState({trash:!0}),{point:A}},xr.stopDrawingAndRemove=function(A){this.deleteFeature([A.point.id],{silent:!0}),this.changeMode(Gt.SIMPLE_SELECT)},xr.onTap=xr.onClick=function(A,z){this.updateUIClasses({mouse:Ne.MOVE}),A.point.updateCoordinate("",z.lngLat.lng,z.lngLat.lat),this.map.fire(Ei.CREATE,{features:[A.point.toGeoJSON()]}),this.changeMode(Gt.SIMPLE_SELECT,{featureIds:[A.point.id]})},xr.onStop=function(A){this.activateUIButton(),A.point.getCoordinate().length||this.deleteFeature([A.point.id],{silent:!0})},xr.toDisplayFeatures=function(A,z,K){var fe=z.properties.id===A.point.id;if(z.properties.active=fe?ni.ACTIVE:ni.INACTIVE,!fe)return K(z)},xr.onTrash=xr.stopDrawingAndRemove,xr.onKeyUp=function(A,z){if(xt(z)||Dt(z))return this.stopDrawingAndRemove(A,z)};var ia={onSetup:function(){var A=this.newFeature({type:it.FEATURE,properties:{},geometry:{type:it.POLYGON,coordinates:[[]]}});return this.addFeature(A),this.clearSelectedFeatures(),En.disable(this),this.updateUIClasses({mouse:Ne.ADD}),this.activateUIButton(lt.POLYGON),this.setActionableState({trash:!0}),{polygon:A,currentVertexPosition:0}},clickAnywhere:function(A,z){if(A.currentVertexPosition>0&&kl(z,A.polygon.coordinates[0][A.currentVertexPosition-1]))return this.changeMode(Gt.SIMPLE_SELECT,{featureIds:[A.polygon.id]});this.updateUIClasses({mouse:Ne.ADD}),A.polygon.updateCoordinate("0."+A.currentVertexPosition,z.lngLat.lng,z.lngLat.lat),A.currentVertexPosition++,A.polygon.updateCoordinate("0."+A.currentVertexPosition,z.lngLat.lng,z.lngLat.lat)},clickOnVertex:function(A){return this.changeMode(Gt.SIMPLE_SELECT,{featureIds:[A.polygon.id]})},onMouseMove:function(A,z){A.polygon.updateCoordinate("0."+A.currentVertexPosition,z.lngLat.lng,z.lngLat.lat),Ve(z)&&this.updateUIClasses({mouse:Ne.POINTER})}};ia.onTap=ia.onClick=function(A,z){return Ve(z)?this.clickOnVertex(A,z):this.clickAnywhere(A,z)},ia.onKeyUp=function(A,z){xt(z)?(this.deleteFeature([A.polygon.id],{silent:!0}),this.changeMode(Gt.SIMPLE_SELECT)):Dt(z)&&this.changeMode(Gt.SIMPLE_SELECT,{featureIds:[A.polygon.id]})},ia.onStop=function(A){this.updateUIClasses({mouse:Ne.NONE}),En.enable(this),this.activateUIButton(),this.getFeature(A.polygon.id)!==void 0&&(A.polygon.removeCoordinate("0."+A.currentVertexPosition),A.polygon.isValid()?this.map.fire(Ei.CREATE,{features:[A.polygon.toGeoJSON()]}):(this.deleteFeature([A.polygon.id],{silent:!0}),this.changeMode(Gt.SIMPLE_SELECT,{},{silent:!0})))},ia.toDisplayFeatures=function(A,z,K){var fe=z.properties.id===A.polygon.id;if(z.properties.active=fe?ni.ACTIVE:ni.INACTIVE,!fe)return K(z);if(z.geometry.coordinates.length!==0){var ve=z.geometry.coordinates[0].length;if(!(ve<3)){if(z.properties.meta=Xt.FEATURE,K(Ci(A.polygon.id,z.geometry.coordinates[0][0],"0.0",!1)),ve>3){var we=z.geometry.coordinates[0].length-3;K(Ci(A.polygon.id,z.geometry.coordinates[0][we],"0."+we,!1))}if(ve<=4){var Ae=[[z.geometry.coordinates[0][0][0],z.geometry.coordinates[0][0][1]],[z.geometry.coordinates[0][1][0],z.geometry.coordinates[0][1][1]]];if(K({type:it.FEATURE,properties:z.properties,geometry:{coordinates:Ae,type:it.LINE_STRING}}),ve===3)return}return K(z)}}},ia.onTrash=function(A){this.deleteFeature([A.polygon.id],{silent:!0}),this.changeMode(Gt.SIMPLE_SELECT)};var Rs={onSetup:function(A){var z,K,fe=(A=A||{}).featureId,ve="forward";if(fe){if(!(z=this.getFeature(fe)))throw new Error("Could not find a feature with the provided featureId");var we=A.from;if(we&&we.type==="Feature"&&we.geometry&&we.geometry.type==="Point"&&(we=we.geometry),we&&we.type==="Point"&&we.coordinates&&we.coordinates.length===2&&(we=we.coordinates),!we||!Array.isArray(we))throw new Error("Please use the `from` property to indicate which point to continue the line from");var Ae=z.coordinates.length-1;if(z.coordinates[Ae][0]===we[0]&&z.coordinates[Ae][1]===we[1])K=Ae+1,z.addCoordinate.apply(z,[K].concat(z.coordinates[Ae]));else{if(z.coordinates[0][0]!==we[0]||z.coordinates[0][1]!==we[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");ve="backwards",K=0,z.addCoordinate.apply(z,[K].concat(z.coordinates[0]))}}else z=this.newFeature({type:it.FEATURE,properties:{},geometry:{type:it.LINE_STRING,coordinates:[]}}),K=0,this.addFeature(z);return this.clearSelectedFeatures(),En.disable(this),this.updateUIClasses({mouse:Ne.ADD}),this.activateUIButton(lt.LINE),this.setActionableState({trash:!0}),{line:z,currentVertexPosition:K,direction:ve}},clickAnywhere:function(A,z){if(A.currentVertexPosition>0&&kl(z,A.line.coordinates[A.currentVertexPosition-1])||A.direction==="backwards"&&kl(z,A.line.coordinates[A.currentVertexPosition+1]))return this.changeMode(Gt.SIMPLE_SELECT,{featureIds:[A.line.id]});this.updateUIClasses({mouse:Ne.ADD}),A.line.updateCoordinate(A.currentVertexPosition,z.lngLat.lng,z.lngLat.lat),A.direction==="forward"?(A.currentVertexPosition++,A.line.updateCoordinate(A.currentVertexPosition,z.lngLat.lng,z.lngLat.lat)):A.line.addCoordinate(0,z.lngLat.lng,z.lngLat.lat)},clickOnVertex:function(A){return this.changeMode(Gt.SIMPLE_SELECT,{featureIds:[A.line.id]})},onMouseMove:function(A,z){A.line.updateCoordinate(A.currentVertexPosition,z.lngLat.lng,z.lngLat.lat),Ve(z)&&this.updateUIClasses({mouse:Ne.POINTER})}};Rs.onTap=Rs.onClick=function(A,z){if(Ve(z))return this.clickOnVertex(A,z);this.clickAnywhere(A,z)},Rs.onKeyUp=function(A,z){Dt(z)?this.changeMode(Gt.SIMPLE_SELECT,{featureIds:[A.line.id]}):xt(z)&&(this.deleteFeature([A.line.id],{silent:!0}),this.changeMode(Gt.SIMPLE_SELECT))},Rs.onStop=function(A){En.enable(this),this.activateUIButton(),this.getFeature(A.line.id)!==void 0&&(A.line.removeCoordinate(""+A.currentVertexPosition),A.line.isValid()?this.map.fire(Ei.CREATE,{features:[A.line.toGeoJSON()]}):(this.deleteFeature([A.line.id],{silent:!0}),this.changeMode(Gt.SIMPLE_SELECT,{},{silent:!0})))},Rs.onTrash=function(A){this.deleteFeature([A.line.id],{silent:!0}),this.changeMode(Gt.SIMPLE_SELECT)},Rs.toDisplayFeatures=function(A,z,K){var fe=z.properties.id===A.line.id;if(z.properties.active=fe?ni.ACTIVE:ni.INACTIVE,!fe)return K(z);z.geometry.coordinates.length<2||(z.properties.meta=Xt.FEATURE,K(Ci(A.line.id,z.geometry.coordinates[A.direction==="forward"?z.geometry.coordinates.length-2:1],""+(A.direction==="forward"?z.geometry.coordinates.length-2:1),!1)),K(z))};var du={simple_select:yr,direct_select:Kn,draw_point:xr,draw_polygon:ia,draw_line_string:Rs},Dh={defaultMode:Gt.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:J,modes:du,controls:{},userProperties:!1},Rh={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},Ph={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function pu(A,z){return A.map(function(K){return K.source?K:Mo(K,{id:K.id+"."+z,source:z==="hot"?Ie.HOT:Ie.COLD})})}var ol={exports:{}};(function(A,z){var K="__lodash_hash_undefined__",fe=9007199254740991,ve="[object Arguments]",we="[object Array]",Ae="[object Boolean]",dt="[object Date]",wt="[object Error]",Lt="[object Function]",Ft="[object Map]",ze="[object Number]",fi="[object Object]",kt="[object Promise]",bi="[object RegExp]",qt="[object Set]",ot="[object String]",Zt="[object Symbol]",Tt="[object WeakMap]",Pn="[object ArrayBuffer]",cr="[object DataView]",Ps=/^\[object .+?Constructor\]$/,Lh=/^(?:0|[1-9]\d*)$/,Sn={};Sn["[object Float32Array]"]=Sn["[object Float64Array]"]=Sn["[object Int8Array]"]=Sn["[object Int16Array]"]=Sn["[object Int32Array]"]=Sn["[object Uint8Array]"]=Sn["[object Uint8ClampedArray]"]=Sn["[object Uint16Array]"]=Sn["[object Uint32Array]"]=!0,Sn[ve]=Sn[we]=Sn[Pn]=Sn[Ae]=Sn[cr]=Sn[dt]=Sn[wt]=Sn[Lt]=Sn[Ft]=Sn[ze]=Sn[fi]=Sn[bi]=Sn[qt]=Sn[ot]=Sn[Tt]=!1;var Ao=typeof global=="object"&&global&&global.Object===Object&&global,ct=typeof self=="object"&&self&&self.Object===Object&&self,Go=Ao||ct||Function("return this")(),hc=z&&!z.nodeType&&z,Si=hc&&A&&!A.nodeType&&A,zr=Si&&Si.exports===hc,dc=zr&&Ao.process,Ll=function(){try{return dc&&dc.binding&&dc.binding("util")}catch{}}(),fu=Ll&&Ll.isTypedArray;function qo(Ce,We){for(var Ct=-1,Kt=Ce==null?0:Ce.length;++Ct<Kt;)if(We(Ce[Ct],Ct,Ce))return!0;return!1}function gi(Ce){var We=-1,Ct=Array(Ce.size);return Ce.forEach(function(Kt,kn){Ct[++We]=[kn,Kt]}),Ct}function Fl(Ce){var We=-1,Ct=Array(Ce.size);return Ce.forEach(function(Kt){Ct[++We]=Kt}),Ct}var as,pc,bo,Fh=Array.prototype,zi=Function.prototype,Ca=Object.prototype,zl=Go["__core-js_shared__"],mu=zi.toString,Do=Ca.hasOwnProperty,na=(as=/[^.]+$/.exec(zl&&zl.keys&&zl.keys.IE_PROTO||""))?"Symbol(src)_1."+as:"",Aa=Ca.toString,Bl=RegExp("^"+mu.call(Do).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ls=zr?Go.Buffer:void 0,sl=Go.Symbol,Mn=Go.Uint8Array,ks=Ca.propertyIsEnumerable,Nl=Fh.splice,$o=sl?sl.toStringTag:void 0,cs=Object.getOwnPropertySymbols,xo=ls?ls.isBuffer:void 0,fc=(pc=Object.keys,bo=Object,function(Ce){return pc(bo(Ce))}),al=Fa(Go,"DataView"),ra=Fa(Go,"Map"),Da=Fa(Go,"Promise"),us=Fa(Go,"Set"),oa=Fa(Go,"WeakMap"),sa=Fa(Object,"create"),gu=ds(al),Ra=ds(ra),Pa=ds(Da),_u=ds(us),Wo=ds(oa),yu=sl?sl.prototype:void 0,ll=yu?yu.valueOf:void 0;function Br(Ce){var We=-1,Ct=Ce==null?0:Ce.length;for(this.clear();++We<Ct;){var Kt=Ce[We];this.set(Kt[0],Kt[1])}}function Ro(Ce){var We=-1,Ct=Ce==null?0:Ce.length;for(this.clear();++We<Ct;){var Kt=Ce[We];this.set(Kt[0],Kt[1])}}function hs(Ce){var We=-1,Ct=Ce==null?0:Ce.length;for(this.clear();++We<Ct;){var Kt=Ce[We];this.set(Kt[0],Kt[1])}}function Os(Ce){var We=-1,Ct=Ce==null?0:Ce.length;for(this.__data__=new hs;++We<Ct;)this.add(Ce[We])}function Zo(Ce){var We=this.__data__=new Ro(Ce);this.size=We.size}function zh(Ce,We){var Ct=la(Ce),Kt=!Ct&&Vl(Ce),kn=!Ct&&!Kt&&jl(Ce),ji=!Ct&&!Kt&&!kn&&dl(Ce),Un=Ct||Kt||kn||ji,hn=Un?function(ur,ps){for(var fs=-1,Tr=Array(ur);++fs<ur;)Tr[fs]=ps(fs);return Tr}(Ce.length,String):[],wr=hn.length;for(var pn in Ce)!We&&!Do.call(Ce,pn)||Un&&(pn=="length"||kn&&(pn=="offset"||pn=="parent")||ji&&(pn=="buffer"||pn=="byteLength"||pn=="byteOffset")||gc(pn,wr))||hn.push(pn);return hn}function Po(Ce,We){for(var Ct=Ce.length;Ct--;)if(za(Ce[Ct][0],We))return Ct;return-1}function aa(Ce){return Ce==null?Ce===void 0?"[object Undefined]":"[object Null]":$o&&$o in Object(Ce)?function(We){var Ct=Do.call(We,$o),Kt=We[$o];try{We[$o]=void 0;var kn=!0}catch{}var ji=Aa.call(We);return kn&&(Ct?We[$o]=Kt:delete We[$o]),ji}(Ce):function(We){return Aa.call(We)}(Ce)}function mc(Ce){return Ba(Ce)&&aa(Ce)==ve}function ka(Ce,We,Ct,Kt,kn){return Ce===We||(Ce==null||We==null||!Ba(Ce)&&!Ba(We)?Ce!=Ce&&We!=We:function(ji,Un,hn,wr,pn,ur){var ps=la(ji),fs=la(Un),Tr=ps?we:Ls(ji),ko=fs?we:Ls(Un),ca=(Tr=Tr==ve?fi:Tr)==fi,Na=(ko=ko==ve?fi:ko)==fi,Wr=Tr==ko;if(Wr&&jl(ji)){if(!jl(Un))return!1;ps=!0,ca=!1}if(Wr&&!ca)return ur||(ur=new Zo),ps||dl(ji)?cl(ji,Un,hn,wr,pn,ur):function(Qi,dn,fl,Ho,ms,Zr,Hr){switch(fl){case cr:if(Qi.byteLength!=dn.byteLength||Qi.byteOffset!=dn.byteOffset)return!1;Qi=Qi.buffer,dn=dn.buffer;case Pn:return!(Qi.byteLength!=dn.byteLength||!Zr(new Mn(Qi),new Mn(dn)));case Ae:case dt:case ze:return za(+Qi,+dn);case wt:return Qi.name==dn.name&&Qi.message==dn.message;case bi:case ot:return Qi==dn+"";case Ft:var gs=gi;case qt:var Fs=1&Ho;if(gs||(gs=Fl),Qi.size!=dn.size&&!Fs)return!1;var Va=Hr.get(Qi);if(Va)return Va==dn;Ho|=2,Hr.set(Qi,dn);var _s=cl(gs(Qi),gs(dn),Ho,ms,Zr,Hr);return Hr.delete(Qi),_s;case Zt:if(ll)return ll.call(Qi)==ll.call(dn)}return!1}(ji,Un,Tr,hn,wr,pn,ur);if(!(1&hn)){var pl=ca&&Do.call(ji,"__wrapped__"),Nh=Na&&Do.call(Un,"__wrapped__");if(pl||Nh){var xu=pl?ji.value():ji,wu=Nh?Un.value():Un;return ur||(ur=new Zo),pn(xu,wu,hn,wr,ur)}}return Wr?(ur||(ur=new Zo),function(Qi,dn,fl,Ho,ms,Zr){var Hr=1&fl,gs=La(Qi),Fs=gs.length,Va=La(dn).length;if(Fs!=Va&&!Hr)return!1;for(var _s=Fs;_s--;){var ys=gs[_s];if(!(Hr?ys in dn:Do.call(dn,ys)))return!1}var Wi=Zr.get(Qi);if(Wi&&Zr.get(dn))return Wi==dn;var si=!0;Zr.set(Qi,dn),Zr.set(dn,Qi);for(var ja=Hr;++_s<Fs;){var ua=Qi[ys=gs[_s]],Ua=dn[ys];if(Ho)var Oo=Hr?Ho(Ua,ua,ys,dn,Qi,Zr):Ho(ua,Ua,ys,Qi,dn,Zr);if(!(Oo===void 0?ua===Ua||ms(ua,Ua,fl,Ho,Zr):Oo)){si=!1;break}ja||(ja=ys=="constructor")}if(si&&!ja){var Qo=Qi.constructor,ci=dn.constructor;Qo==ci||!("constructor"in Qi)||!("constructor"in dn)||typeof Qo=="function"&&Qo instanceof Qo&&typeof ci=="function"&&ci instanceof ci||(si=!1)}return Zr.delete(Qi),Zr.delete(dn),si}(ji,Un,hn,wr,pn,ur)):!1}(Ce,We,Ct,Kt,ka,kn))}function vu(Ce){return!(!hl(Ce)||function(We){return!!na&&na in We}(Ce))&&(bu(Ce)?Bl:Ps).test(ds(Ce))}function Oa(Ce){if(Ct=(We=Ce)&&We.constructor,Kt=typeof Ct=="function"&&Ct.prototype||Ca,We!==Kt)return fc(Ce);var We,Ct,Kt,kn=[];for(var ji in Object(Ce))Do.call(Ce,ji)&&ji!="constructor"&&kn.push(ji);return kn}function cl(Ce,We,Ct,Kt,kn,ji){var Un=1&Ct,hn=Ce.length,wr=We.length;if(hn!=wr&&!(Un&&wr>hn))return!1;var pn=ji.get(Ce);if(pn&&ji.get(We))return pn==We;var ur=-1,ps=!0,fs=2&Ct?new Os:void 0;for(ji.set(Ce,We),ji.set(We,Ce);++ur<hn;){var Tr=Ce[ur],ko=We[ur];if(Kt)var ca=Un?Kt(ko,Tr,ur,We,Ce,ji):Kt(Tr,ko,ur,Ce,We,ji);if(ca!==void 0){if(ca)continue;ps=!1;break}if(fs){if(!qo(We,function(Na,Wr){if(pl=Wr,!fs.has(pl)&&(Tr===Na||kn(Tr,Na,Ct,Kt,ji)))return fs.push(Wr);var pl})){ps=!1;break}}else if(Tr!==ko&&!kn(Tr,ko,Ct,Kt,ji)){ps=!1;break}}return ji.delete(Ce),ji.delete(We),ps}function La(Ce){return function(We,Ct,Kt){var kn=Ct(We);return la(We)?kn:function(ji,Un){for(var hn=-1,wr=Un.length,pn=ji.length;++hn<wr;)ji[pn+hn]=Un[hn];return ji}(kn,Kt(We))}(Ce,_c,Bh)}function ul(Ce,We){var Ct,Kt,kn=Ce.__data__;return((Kt=typeof(Ct=We))=="string"||Kt=="number"||Kt=="symbol"||Kt=="boolean"?Ct!=="__proto__":Ct===null)?kn[typeof We=="string"?"string":"hash"]:kn.map}function Fa(Ce,We){var Ct=function(Kt,kn){return Kt?.[kn]}(Ce,We);return vu(Ct)?Ct:void 0}Br.prototype.clear=function(){this.__data__=sa?sa(null):{},this.size=0},Br.prototype.delete=function(Ce){var We=this.has(Ce)&&delete this.__data__[Ce];return this.size-=We?1:0,We},Br.prototype.get=function(Ce){var We=this.__data__;if(sa){var Ct=We[Ce];return Ct===K?void 0:Ct}return Do.call(We,Ce)?We[Ce]:void 0},Br.prototype.has=function(Ce){var We=this.__data__;return sa?We[Ce]!==void 0:Do.call(We,Ce)},Br.prototype.set=function(Ce,We){var Ct=this.__data__;return this.size+=this.has(Ce)?0:1,Ct[Ce]=sa&&We===void 0?K:We,this},Ro.prototype.clear=function(){this.__data__=[],this.size=0},Ro.prototype.delete=function(Ce){var We=this.__data__,Ct=Po(We,Ce);return!(Ct<0)&&(Ct==We.length-1?We.pop():Nl.call(We,Ct,1),--this.size,!0)},Ro.prototype.get=function(Ce){var We=this.__data__,Ct=Po(We,Ce);return Ct<0?void 0:We[Ct][1]},Ro.prototype.has=function(Ce){return Po(this.__data__,Ce)>-1},Ro.prototype.set=function(Ce,We){var Ct=this.__data__,Kt=Po(Ct,Ce);return Kt<0?(++this.size,Ct.push([Ce,We])):Ct[Kt][1]=We,this},hs.prototype.clear=function(){this.size=0,this.__data__={hash:new Br,map:new(ra||Ro),string:new Br}},hs.prototype.delete=function(Ce){var We=ul(this,Ce).delete(Ce);return this.size-=We?1:0,We},hs.prototype.get=function(Ce){return ul(this,Ce).get(Ce)},hs.prototype.has=function(Ce){return ul(this,Ce).has(Ce)},hs.prototype.set=function(Ce,We){var Ct=ul(this,Ce),Kt=Ct.size;return Ct.set(Ce,We),this.size+=Ct.size==Kt?0:1,this},Os.prototype.add=Os.prototype.push=function(Ce){return this.__data__.set(Ce,K),this},Os.prototype.has=function(Ce){return this.__data__.has(Ce)},Zo.prototype.clear=function(){this.__data__=new Ro,this.size=0},Zo.prototype.delete=function(Ce){var We=this.__data__,Ct=We.delete(Ce);return this.size=We.size,Ct},Zo.prototype.get=function(Ce){return this.__data__.get(Ce)},Zo.prototype.has=function(Ce){return this.__data__.has(Ce)},Zo.prototype.set=function(Ce,We){var Ct=this.__data__;if(Ct instanceof Ro){var Kt=Ct.__data__;if(!ra||Kt.length<199)return Kt.push([Ce,We]),this.size=++Ct.size,this;Ct=this.__data__=new hs(Kt)}return Ct.set(Ce,We),this.size=Ct.size,this};var Bh=cs?function(Ce){return Ce==null?[]:(Ce=Object(Ce),function(We,Ct){for(var Kt=-1,kn=We==null?0:We.length,ji=0,Un=[];++Kt<kn;){var hn=We[Kt];Ct(hn,Kt,We)&&(Un[ji++]=hn)}return Un}(cs(Ce),function(We){return ks.call(Ce,We)}))}:function(){return[]},Ls=aa;function gc(Ce,We){return!!(We=We??fe)&&(typeof Ce=="number"||Lh.test(Ce))&&Ce>-1&&Ce%1==0&&Ce<We}function ds(Ce){if(Ce!=null){try{return mu.call(Ce)}catch{}try{return Ce+""}catch{}}return""}function za(Ce,We){return Ce===We||Ce!=Ce&&We!=We}(al&&Ls(new al(new ArrayBuffer(1)))!=cr||ra&&Ls(new ra)!=Ft||Da&&Ls(Da.resolve())!=kt||us&&Ls(new us)!=qt||oa&&Ls(new oa)!=Tt)&&(Ls=function(Ce){var We=aa(Ce),Ct=We==fi?Ce.constructor:void 0,Kt=Ct?ds(Ct):"";if(Kt)switch(Kt){case gu:return cr;case Ra:return Ft;case Pa:return kt;case _u:return qt;case Wo:return Tt}return We});var Vl=mc(function(){return arguments}())?mc:function(Ce){return Ba(Ce)&&Do.call(Ce,"callee")&&!ks.call(Ce,"callee")},la=Array.isArray,jl=xo||function(){return!1};function bu(Ce){if(!hl(Ce))return!1;var We=aa(Ce);return We==Lt||We=="[object GeneratorFunction]"||We=="[object AsyncFunction]"||We=="[object Proxy]"}function Ul(Ce){return typeof Ce=="number"&&Ce>-1&&Ce%1==0&&Ce<=fe}function hl(Ce){var We=typeof Ce;return Ce!=null&&(We=="object"||We=="function")}function Ba(Ce){return Ce!=null&&typeof Ce=="object"}var dl=fu?function(Ce){return function(We){return Ce(We)}}(fu):function(Ce){return Ba(Ce)&&Ul(Ce.length)&&!!Sn[aa(Ce)]};function _c(Ce){return(We=Ce)!=null&&Ul(We.length)&&!bu(We)?zh(Ce):Oa(Ce);var We}A.exports=function(Ce,We){return ka(Ce,We)}})(ol,ol.exports);var ri=d(ol.exports);function uc(A,z){return A.length===z.length&&JSON.stringify(A.map(function(K){return K}).sort())===JSON.stringify(z.map(function(K){return K}).sort())}var Ma={Polygon:Wn,LineString:$r,Point:So,MultiPolygon:ki,MultiLineString:ki,MultiPoint:ki},kh=Object.freeze({__proto__:null,CommonSelectors:mt,constrainFeatureMovement:Sa,createMidPoint:Ji,createSupplementaryPoints:yn,createVertex:Ci,doubleClickZoom:En,euclideanDistance:qr,featuresAt:Xn,getFeatureAtAndSetCursors:As,isClick:no,isEventAtCoordinates:kl,isTap:Ys,mapEventToBoundingBox:Rr,ModeHandler:p,moveFeatures:Pr,sortFeatures:_o,stringSetsAreEqual:uc,StringSet:Gr,theme:J,toDenseArray:Ds}),Oh=function(A,z){var K={options:A=function(ve){ve===void 0&&(ve={});var we=Mo(ve);return ve.controls||(we.controls={}),ve.displayControlsDefault===!1?we.controls=Mo(Ph,ve.controls):we.controls=Mo(Rh,ve.controls),(we=Mo(Dh,we)).styles=pu(we.styles,"cold").concat(pu(we.styles,"hot")),we}(A)};z=function(ve,we){return we.modes=Gt,we.getFeatureIdsAt=function(Ae){return Xn.click({point:Ae},null,ve).map(function(dt){return dt.properties.id})},we.getSelectedIds=function(){return ve.store.getSelectedIds()},we.getSelected=function(){return{type:it.FEATURE_COLLECTION,features:ve.store.getSelectedIds().map(function(Ae){return ve.store.get(Ae)}).map(function(Ae){return Ae.toGeoJSON()})}},we.getSelectedPoints=function(){return{type:it.FEATURE_COLLECTION,features:ve.store.getSelectedCoordinates().map(function(Ae){return{type:it.FEATURE,properties:{},geometry:{type:it.POINT,coordinates:Ae.coordinates}}})}},we.set=function(Ae){if(Ae.type===void 0||Ae.type!==it.FEATURE_COLLECTION||!Array.isArray(Ae.features))throw new Error("Invalid FeatureCollection");var dt=ve.store.createRenderBatch(),wt=ve.store.getAllIds().slice(),Lt=we.add(Ae),Ft=new Gr(Lt);return(wt=wt.filter(function(ze){return!Ft.has(ze)})).length&&we.delete(wt),dt(),Lt},we.add=function(Ae){var dt=JSON.parse(JSON.stringify(Uo(Ae))).features.map(function(wt){if(wt.id=wt.id||Js(),wt.geometry===null)throw new Error("Invalid geometry: null");if(ve.store.get(wt.id)===void 0||ve.store.get(wt.id).type!==wt.geometry.type){var Lt=Ma[wt.geometry.type];if(Lt===void 0)throw new Error("Invalid geometry type: "+wt.geometry.type+".");var Ft=new Lt(ve,wt);ve.store.add(Ft)}else{var ze=ve.store.get(wt.id);ze.properties=wt.properties,ri(ze.properties,wt.properties)||ve.store.featureChanged(ze.id),ri(ze.getCoordinates(),wt.geometry.coordinates)||ze.incomingCoords(wt.geometry.coordinates)}return wt.id});return ve.store.render(),dt},we.get=function(Ae){var dt=ve.store.get(Ae);if(dt)return dt.toGeoJSON()},we.getAll=function(){return{type:it.FEATURE_COLLECTION,features:ve.store.getAll().map(function(Ae){return Ae.toGeoJSON()})}},we.delete=function(Ae){return ve.store.delete(Ae,{silent:!0}),we.getMode()!==Gt.DIRECT_SELECT||ve.store.getSelectedIds().length?ve.store.render():ve.events.changeMode(Gt.SIMPLE_SELECT,void 0,{silent:!0}),we},we.deleteAll=function(){return ve.store.delete(ve.store.getAllIds(),{silent:!0}),we.getMode()===Gt.DIRECT_SELECT?ve.events.changeMode(Gt.SIMPLE_SELECT,void 0,{silent:!0}):ve.store.render(),we},we.changeMode=function(Ae,dt){return dt===void 0&&(dt={}),Ae===Gt.SIMPLE_SELECT&&we.getMode()===Gt.SIMPLE_SELECT?(uc(dt.featureIds||[],ve.store.getSelectedIds())||(ve.store.setSelected(dt.featureIds,{silent:!0}),ve.store.render()),we):(Ae===Gt.DIRECT_SELECT&&we.getMode()===Gt.DIRECT_SELECT&&dt.featureId===ve.store.getSelectedIds()[0]||ve.events.changeMode(Ae,dt,{silent:!0}),we)},we.getMode=function(){return ve.events.getMode()},we.trash=function(){return ve.events.trash({silent:!0}),we},we.combineFeatures=function(){return ve.events.combineFeatures({silent:!0}),we},we.uncombineFeatures=function(){return ve.events.uncombineFeatures({silent:!0}),we},we.setFeatureProperty=function(Ae,dt,wt){return ve.store.setFeatureProperty(Ae,dt,wt),we},we}(K,z),K.api=z;var fe=et(K);return z.onAdd=fe.onAdd,z.onRemove=fe.onRemove,z.types=lt,z.options=A,z};function Ol(A){Oh(A,this)}return Ol.modes=du,Ol.constants=rs,Ol.lib=kh,Ol})});var Th=cn((N3,MI)=>{"use strict";MI.exports=dO;var hO=Object.prototype.hasOwnProperty;function dO(){for(var p={},d=0;d<arguments.length;d++){var T=arguments[d];for(var f in T)hO.call(T,f)&&(p[f]=T[f])}return p}});var DI=cn((CI,AI)=>{"use strict";(function(){var p=this,d={};typeof CI<"u"?AI.exports=d:p.fuzzy=d,d.simpleFilter=function(T,f){return f.filter(function(v){return d.test(T,v)})},d.test=function(T,f){return d.match(T,f)!==null},d.match=function(T,f,v){v=v||{};var r=0,k=[],W=f.length,ee=0,de=0,Ie=v.pre||"",Ne=v.post||"",lt=v.caseSensitive&&f||f.toLowerCase(),it;T=v.caseSensitive&&T||T.toLowerCase();for(var Gt=0;Gt<W;Gt++)it=f[Gt],lt[Gt]===T[r]?(it=Ie+it+Ne,r+=1,de+=1+de):de=0,ee+=de,k[k.length]=it;return r===T.length?(ee=lt===T?1/0:ee,{rendered:k.join(""),score:ee}):null},d.filter=function(T,f,v){return!f||f.length===0?[]:typeof T!="string"?f:(v=v||{},f.reduce(function(r,k,W,ee){var de=k;v.extract&&(de=v.extract(k));var Ie=d.match(T,de,v);return Ie!=null&&(r[r.length]={string:Ie.rendered,score:Ie.score,index:W,original:k}),r},[]).sort(function(r,k){var W=k.score-r.score;return W||r.index-k.index}))}})()});var PI=cn((V3,RI)=>{"use strict";var Cs=function(p){return this.component=p,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,p.el.parentNode.insertBefore(this.wrapper,p.el.nextSibling),this};Cs.prototype.show=function(){this.element.style.display="block"};Cs.prototype.hide=function(){this.element.style.display="none"};Cs.prototype.add=function(p){this.items.push(p)};Cs.prototype.clear=function(){this.items=[],this.active=0};Cs.prototype.isEmpty=function(){return!this.items.length};Cs.prototype.isVisible=function(){return this.element.style.display==="block"};Cs.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var p=0;p<this.items.length;p++)this.drawItem(this.items[p],this.active===p);this.show()};Cs.prototype.drawItem=function(p,d){var T=document.createElement("li"),f=document.createElement("a");d&&(T.className+=" active"),f.innerHTML=p.string,T.appendChild(f),this.element.appendChild(T),T.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),T.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,p)}).bind(this))};Cs.prototype.handleMouseUp=function(p){this.selectingListItem=!1,this.component.value(p.original),this.clear(),this.draw()};Cs.prototype.move=function(p){this.active=p,this.draw()};Cs.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};Cs.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};Cs.prototype.drawError=function(p){var d=document.createElement("li");d.innerHTML=p,this.element.appendChild(d),this.show()};RI.exports=Cs});var OI=cn((j3,kI)=>{"use strict";var pO=Th(),fO=DI(),mO=PI(),Vo=function(p,d,T){return T=T||{},this.options=pO({minLength:2,limit:5,filter:!0,hideOnBlur:!0},T),this.el=p,this.data=d||[],this.list=new mO(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(f){this.handleKeyUp(f.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(f){this.handleKeyDown(f)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(f){this.handlePaste(f)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Vo.prototype.handleKeyUp=function(p){p===40||p===38||p===27||p===13||p===9||this.handleInputChange(this.el.value)};Vo.prototype.handleKeyDown=function(p){switch(p.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&p.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Vo.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Vo.prototype.handlePaste=function(p){if(p.clipboardData)this.handleInputChange(p.clipboardData.getData("Text"));else{var d=this;setTimeout(function(){d.handleInputChange(p.target.value)},100)}};Vo.prototype.handleInputChange=function(p){if(this.query=this.normalize(p),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(d){for(var T=0;T<d.length&&(this.list.add(d[T]),T!==this.options.limit-1);T++);this.list.draw()}).bind(this))};Vo.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Vo.prototype.update=function(p){this.data=p,this.handleKeyUp()};Vo.prototype.clear=function(){this.data=[],this.list.clear()};Vo.prototype.normalize=function(p){return p=p.toLowerCase(),p};Vo.prototype.match=function(p,d){return p.indexOf(d)>-1};Vo.prototype.value=function(p){if(this.selected=p,this.el.value=this.getItemValue(p),document.createEvent){var d=document.createEvent("HTMLEvents");d.initEvent("change",!0,!1),this.el.dispatchEvent(d)}else this.el.fireEvent("onchange")};Vo.prototype.getCandidates=function(p){var d={pre:"<strong>",post:"</strong>",extract:(function(f){return this.getItemValue(f)}).bind(this)},T;this.options.filter?(T=fO.filter(this.query,this.data,d),T=T.map((function(f){return{original:f.original,string:this.render(f.original,f.string)}}).bind(this))):T=this.data.map((function(f){var v=this.render(f);return{original:f,string:v}}).bind(this)),p(T)};Vo.prototype.getItemValue=function(p){return p};Vo.prototype.render=function(p,d){if(d)return d;for(var T=p.original?this.getItemValue(p.original):this.getItemValue(p),f=this.normalize(T),v=f.lastIndexOf(this.query);v>-1;){var r=v+this.query.length;T=T.slice(0,v)+"<strong>"+T.slice(v,r)+"</strong>"+T.slice(r),v=f.slice(0,v).lastIndexOf(this.query)}return T};Vo.prototype.renderError=function(p){this.list.drawError(p)};kI.exports=Vo});var zI=cn((U3,FI)=>{"use strict";var LI=OI();FI.exports=LI;typeof window<"u"&&(window.Suggestions=LI)});var jI=cn((G3,VI)=>{"use strict";var gO="Expected a function",BI=NaN,_O="[object Symbol]",yO=/^\s+|\s+$/g,vO=/^[-+]0x[0-9a-f]+$/i,bO=/^0b[01]+$/i,xO=/^0o[0-7]+$/i,wO=parseInt,TO=typeof global=="object"&&global&&global.Object===Object&&global,EO=typeof self=="object"&&self&&self.Object===Object&&self,IO=TO||EO||Function("return this")(),SO=Object.prototype,MO=SO.toString,CO=Math.max,AO=Math.min,pb=function(){return IO.Date.now()};function DO(p,d,T){var f,v,r,k,W,ee,de=0,Ie=!1,Ne=!1,lt=!0;if(typeof p!="function")throw new TypeError(gO);d=NI(d)||0,fb(T)&&(Ie=!!T.leading,Ne="maxWait"in T,r=Ne?CO(NI(T.maxWait)||0,d):r,lt="trailing"in T?!!T.trailing:lt);function it(jn){var Ni=f,_o=v;return f=v=void 0,de=jn,k=p.apply(_o,Ni),k}function Gt(jn){return de=jn,W=setTimeout(Xt,d),Ie?it(jn):k}function Ei(jn){var Ni=jn-ee,_o=jn-de,Rr=d-Ni;return Ne?AO(Rr,r-_o):Rr}function sn(jn){var Ni=jn-ee,_o=jn-de;return ee===void 0||Ni>=d||Ni<0||Ne&&_o>=r}function Xt(){var jn=pb();if(sn(jn))return ni(jn);W=setTimeout(Xt,Ei(jn))}function ni(jn){return W=void 0,lt&&f?it(jn):(f=v=void 0,k)}function Io(){W!==void 0&&clearTimeout(W),de=0,f=ee=v=W=void 0}function In(){return W===void 0?k:ni(pb())}function rs(){var jn=pb(),Ni=sn(jn);if(f=arguments,v=this,ee=jn,Ni){if(W===void 0)return Gt(ee);if(Ne)return W=setTimeout(Xt,d),it(ee)}return W===void 0&&(W=setTimeout(Xt,d)),k}return rs.cancel=Io,rs.flush=In,rs}function fb(p){var d=typeof p;return!!p&&(d=="object"||d=="function")}function RO(p){return!!p&&typeof p=="object"}function PO(p){return typeof p=="symbol"||RO(p)&&MO.call(p)==_O}function NI(p){if(typeof p=="number")return p;if(PO(p))return BI;if(fb(p)){var d=typeof p.valueOf=="function"?p.valueOf():p;p=fb(d)?d+"":d}if(typeof p!="string")return p===0?p:+p;p=p.replace(yO,"");var T=bO.test(p);return T||xO.test(p)?wO(p.slice(2),T?2:8):vO.test(p)?BI:+p}VI.exports=DO});var KI=cn((q3,mb)=>{"use strict";var Kd=typeof Reflect=="object"?Reflect:null,UI=Kd&&typeof Kd.apply=="function"?Kd.apply:function(d,T,f){return Function.prototype.apply.call(d,T,f)},b_;Kd&&typeof Kd.ownKeys=="function"?b_=Kd.ownKeys:Object.getOwnPropertySymbols?b_=function(d){return Object.getOwnPropertyNames(d).concat(Object.getOwnPropertySymbols(d))}:b_=function(d){return Object.getOwnPropertyNames(d)};function kO(p){console&&console.warn&&console.warn(p)}var qI=Number.isNaN||function(d){return d!==d};function $n(){$n.init.call(this)}mb.exports=$n;mb.exports.once=zO;$n.EventEmitter=$n;$n.prototype._events=void 0;$n.prototype._eventsCount=0;$n.prototype._maxListeners=void 0;var GI=10;function x_(p){if(typeof p!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof p)}Object.defineProperty($n,"defaultMaxListeners",{enumerable:!0,get:function(){return GI},set:function(p){if(typeof p!="number"||p<0||qI(p))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+p+".");GI=p}});$n.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};$n.prototype.setMaxListeners=function(d){if(typeof d!="number"||d<0||qI(d))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+d+".");return this._maxListeners=d,this};function $I(p){return p._maxListeners===void 0?$n.defaultMaxListeners:p._maxListeners}$n.prototype.getMaxListeners=function(){return $I(this)};$n.prototype.emit=function(d){for(var T=[],f=1;f<arguments.length;f++)T.push(arguments[f]);var v=d==="error",r=this._events;if(r!==void 0)v=v&&r.error===void 0;else if(!v)return!1;if(v){var k;if(T.length>0&&(k=T[0]),k instanceof Error)throw k;var W=new Error("Unhandled error."+(k?" ("+k.message+")":""));throw W.context=k,W}var ee=r[d];if(ee===void 0)return!1;if(typeof ee=="function")UI(ee,this,T);else for(var de=ee.length,Ie=XI(ee,de),f=0;f<de;++f)UI(Ie[f],this,T);return!0};function WI(p,d,T,f){var v,r,k;if(x_(T),r=p._events,r===void 0?(r=p._events=Object.create(null),p._eventsCount=0):(r.newListener!==void 0&&(p.emit("newListener",d,T.listener?T.listener:T),r=p._events),k=r[d]),k===void 0)k=r[d]=T,++p._eventsCount;else if(typeof k=="function"?k=r[d]=f?[T,k]:[k,T]:f?k.unshift(T):k.push(T),v=$I(p),v>0&&k.length>v&&!k.warned){k.warned=!0;var W=new Error("Possible EventEmitter memory leak detected. "+k.length+" "+String(d)+" listeners added. Use emitter.setMaxListeners() to increase limit");W.name="MaxListenersExceededWarning",W.emitter=p,W.type=d,W.count=k.length,kO(W)}return p}$n.prototype.addListener=function(d,T){return WI(this,d,T,!1)};$n.prototype.on=$n.prototype.addListener;$n.prototype.prependListener=function(d,T){return WI(this,d,T,!0)};function OO(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ZI(p,d,T){var f={fired:!1,wrapFn:void 0,target:p,type:d,listener:T},v=OO.bind(f);return v.listener=T,f.wrapFn=v,v}$n.prototype.once=function(d,T){return x_(T),this.on(d,ZI(this,d,T)),this};$n.prototype.prependOnceListener=function(d,T){return x_(T),this.prependListener(d,ZI(this,d,T)),this};$n.prototype.removeListener=function(d,T){var f,v,r,k,W;if(x_(T),v=this._events,v===void 0)return this;if(f=v[d],f===void 0)return this;if(f===T||f.listener===T)--this._eventsCount===0?this._events=Object.create(null):(delete v[d],v.removeListener&&this.emit("removeListener",d,f.listener||T));else if(typeof f!="function"){for(r=-1,k=f.length-1;k>=0;k--)if(f[k]===T||f[k].listener===T){W=f[k].listener,r=k;break}if(r<0)return this;r===0?f.shift():LO(f,r),f.length===1&&(v[d]=f[0]),v.removeListener!==void 0&&this.emit("removeListener",d,W||T)}return this};$n.prototype.off=$n.prototype.removeListener;$n.prototype.removeAllListeners=function(d){var T,f,v;if(f=this._events,f===void 0)return this;if(f.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):f[d]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete f[d]),this;if(arguments.length===0){var r=Object.keys(f),k;for(v=0;v<r.length;++v)k=r[v],k!=="removeListener"&&this.removeAllListeners(k);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(T=f[d],typeof T=="function")this.removeListener(d,T);else if(T!==void 0)for(v=T.length-1;v>=0;v--)this.removeListener(d,T[v]);return this};function HI(p,d,T){var f=p._events;if(f===void 0)return[];var v=f[d];return v===void 0?[]:typeof v=="function"?T?[v.listener||v]:[v]:T?FO(v):XI(v,v.length)}$n.prototype.listeners=function(d){return HI(this,d,!0)};$n.prototype.rawListeners=function(d){return HI(this,d,!1)};$n.listenerCount=function(p,d){return typeof p.listenerCount=="function"?p.listenerCount(d):QI.call(p,d)};$n.prototype.listenerCount=QI;function QI(p){var d=this._events;if(d!==void 0){var T=d[p];if(typeof T=="function")return 1;if(T!==void 0)return T.length}return 0}$n.prototype.eventNames=function(){return this._eventsCount>0?b_(this._events):[]};function XI(p,d){for(var T=new Array(d),f=0;f<d;++f)T[f]=p[f];return T}function LO(p,d){for(;d+1<p.length;d++)p[d]=p[d+1];p.pop()}function FO(p){for(var d=new Array(p.length),T=0;T<d.length;++T)d[T]=p[T].listener||p[T];return d}function zO(p,d){return new Promise(function(T,f){function v(k){p.removeListener(d,r),f(k)}function r(){typeof p.removeListener=="function"&&p.removeListener("error",v),T([].slice.call(arguments))}YI(p,d,r,{once:!0}),d!=="error"&&BO(p,v,{once:!0})})}function BO(p,d,T){typeof p.on=="function"&&YI(p,"error",d,T)}function YI(p,d,T,f){if(typeof p.on=="function")f.once?p.once(d,T):p.on(d,T);else if(typeof p.addEventListener=="function")p.addEventListener(d,function v(r){f.once&&p.removeEventListener(d,v),T(r)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof p)}});var eS=cn(($3,JI)=>{"use strict";JI.exports={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}});var iS=cn((W3,tS)=>{"use strict";function NO(p){var d=p.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return d?{key:d[1],value:d[2]}:null}function VO(p){var d=p.match(/<?([^>]*)>(.*)/);if(!d)return null;var T=d[1],f=d[2].split(";"),v=null,r=f.reduce(function(k,W){var ee=NO(W);return ee?ee.key==="rel"?(v||(v=ee.value),k):(k[ee.key]=ee.value,k):k},{});return v?{url:T,rel:v,params:r}:null}function jO(p){return p?p.split(/,\s*</).reduce(function(d,T){var f=VO(T);if(!f)return d;var v=f.rel.split(/\s+/);return v.forEach(function(r){d[r]||(d[r]={url:f.url,params:f.params})}),d},{}):{}}tS.exports=jO});var rS=cn((Z3,nS)=>{"use strict";var UO=iS();function gb(p,d){this.request=p,this.headers=d.headers,this.rawBody=d.body,this.statusCode=d.statusCode;try{this.body=JSON.parse(d.body||"{}")}catch{this.body=d.body}this.links=UO(this.headers.link)}gb.prototype.hasNextPage=function(){return!!this.links.next};gb.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};nS.exports=gb});var Kf=cn((H3,oS)=>{"use strict";oS.exports={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}});var lS=cn((Q3,aS)=>{"use strict";var sS=Kf();function GO(p){var d=p.type||sS.ERROR_HTTP,T;if(p.body)try{T=JSON.parse(p.body)}catch{T=p.body}else T=null;var f=p.message||null;f||(typeof T=="string"?f=T:T&&typeof T.message=="string"?f=T.message:d===sS.ERROR_REQUEST_ABORTED&&(f="Request aborted")),this.message=f,this.type=d,this.statusCode=p.statusCode||null,this.request=p.request,this.body=T}aS.exports=GO});var uS=cn((X3,cS)=>{"use strict";function qO(p){var d=p.indexOf(":"),T=p.substring(0,d).trim().toLowerCase(),f=p.substring(d+1).trim();return{name:T,value:f}}function $O(p){var d={};return p&&p.trim().split(/[\r|\n]+/).forEach(function(T){var f=qO(T);d[f.name]=f.value}),d}cS.exports=$O});var gS=cn((Y3,mS)=>{"use strict";var WO=rS(),hS=lS(),_b=Kf(),ZO=uS(),w_={};function HO(p){var d=w_[p.id];d&&(d.abort(),delete w_[p.id])}function QO(p,d){return new WO(p,{body:d.response,headers:ZO(d.getAllResponseHeaders()),statusCode:d.status})}function dS(p){var d=p.total,T=p.loaded,f=100*T/d;return{total:d,transferred:T,percent:f}}function pS(p,d){return new Promise(function(T,f){d.onprogress=function(k){p.emitter.emit(_b.EVENT_PROGRESS_DOWNLOAD,dS(k))};var v=p.file;v&&(d.upload.onprogress=function(k){p.emitter.emit(_b.EVENT_PROGRESS_UPLOAD,dS(k))}),d.onerror=function(k){f(k)},d.onabort=function(){var k=new hS({request:p,type:_b.ERROR_REQUEST_ABORTED});f(k)},d.onload=function(){if(delete w_[p.id],d.status<200||d.status>=400){var k=new hS({request:p,body:d.response,statusCode:d.status});f(k);return}T(d)};var r=p.body;typeof r=="string"?d.send(r):r?d.send(JSON.stringify(r)):v?d.send(v):d.send(),w_[p.id]=d}).then(function(T){return QO(p,T)})}function fS(p,d){var T=p.url(d),f=new window.XMLHttpRequest;return f.open(p.method,T),Object.keys(p.headers).forEach(function(v){f.setRequestHeader(v,p.headers[v])}),f}function XO(p){return Promise.resolve().then(function(){var d=fS(p,p.client.accessToken);return pS(p,d)})}mS.exports={browserAbort:HO,sendRequestXhr:pS,browserSend:XO,createRequestXhr:fS}});var _S=cn((T_,Jf)=>{"use strict";(function(p){var d=typeof T_=="object"&&T_,T=typeof Jf=="object"&&Jf&&Jf.exports==d&&Jf,f=typeof global=="object"&&global;(f.global===f||f.window===f)&&(p=f);var v=function(lt){this.message=lt};v.prototype=new Error,v.prototype.name="InvalidCharacterError";var r=function(lt){throw new v(lt)},k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",W=/[\t\n\f\r ]/g,ee=function(lt){lt=String(lt).replace(W,"");var it=lt.length;it%4==0&&(lt=lt.replace(/==?$/,""),it=lt.length),(it%4==1||/[^+a-zA-Z0-9/]/.test(lt))&&r("Invalid character: the string to be decoded is not correctly encoded.");for(var Gt=0,Ei,sn,Xt="",ni=-1;++ni<it;)sn=k.indexOf(lt.charAt(ni)),Ei=Gt%4?Ei*64+sn:sn,Gt++%4&&(Xt+=String.fromCharCode(255&Ei>>(-2*Gt&6)));return Xt},de=function(lt){lt=String(lt),/[^\0-\xFF]/.test(lt)&&r("The string to be encoded contains characters outside of the Latin1 range.");for(var it=lt.length%3,Gt="",Ei=-1,sn,Xt,ni,Io,In,rs=lt.length-it;++Ei<rs;)sn=lt.charCodeAt(Ei)<<16,Xt=lt.charCodeAt(++Ei)<<8,ni=lt.charCodeAt(++Ei),In=sn+Xt+ni,Gt+=k.charAt(In>>18&63)+k.charAt(In>>12&63)+k.charAt(In>>6&63)+k.charAt(In&63);return it==2?(sn=lt.charCodeAt(Ei)<<8,Xt=lt.charCodeAt(++Ei),In=sn+Xt,Gt+=k.charAt(In>>10)+k.charAt(In>>4&63)+k.charAt(In<<2&63)+"="):it==1&&(In=lt.charCodeAt(Ei),Gt+=k.charAt(In>>2)+k.charAt(In<<4&63)+"=="),Gt},Ie={encode:de,decode:ee,version:"0.1.0"};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd)define(function(){return Ie});else if(d&&!d.nodeType)if(T)T.exports=Ie;else for(var Ne in Ie)Ie.hasOwnProperty(Ne)&&(d[Ne]=Ie[Ne]);else p.base64=Ie})(T_)});var vb=cn((K3,yS)=>{"use strict";var YO=_S(),yb={};function KO(p){if(yb[p])return yb[p];var d=p.split("."),T=d[0],f=d[1];if(!f)throw new Error("Invalid token");var v=JO(f),r={usage:T,user:v.u};return Eh(v,"a")&&(r.authorization=v.a),Eh(v,"exp")&&(r.expires=v.exp*1e3),Eh(v,"iat")&&(r.created=v.iat*1e3),Eh(v,"scopes")&&(r.scopes=v.scopes),Eh(v,"client")&&(r.client=v.client),Eh(v,"ll")&&(r.lastLogin=v.ll),Eh(v,"iu")&&(r.impersonator=v.iu),yb[p]=r,r}function JO(p){try{return JSON.parse(YO.decode(p))}catch{throw new Error("Invalid token")}}function Eh(p,d){return Object.prototype.hasOwnProperty.call(p,d)}yS.exports=KO});var bS=cn((J3,bb)=>{"use strict";var eL=Object.prototype.hasOwnProperty,is="~";function em(){}Object.create&&(em.prototype=Object.create(null),new em().__proto__||(is=!1));function tL(p,d,T){this.fn=p,this.context=d,this.once=T||!1}function vS(p,d,T,f,v){if(typeof T!="function")throw new TypeError("The listener must be a function");var r=new tL(T,f||p,v),k=is?is+d:d;return p._events[k]?p._events[k].fn?p._events[k]=[p._events[k],r]:p._events[k].push(r):(p._events[k]=r,p._eventsCount++),p}function E_(p,d){--p._eventsCount===0?p._events=new em:delete p._events[d]}function jo(){this._events=new em,this._eventsCount=0}jo.prototype.eventNames=function(){var d=[],T,f;if(this._eventsCount===0)return d;for(f in T=this._events)eL.call(T,f)&&d.push(is?f.slice(1):f);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(T)):d};jo.prototype.listeners=function(d){var T=is?is+d:d,f=this._events[T];if(!f)return[];if(f.fn)return[f.fn];for(var v=0,r=f.length,k=new Array(r);v<r;v++)k[v]=f[v].fn;return k};jo.prototype.listenerCount=function(d){var T=is?is+d:d,f=this._events[T];return f?f.fn?1:f.length:0};jo.prototype.emit=function(d,T,f,v,r,k){var W=is?is+d:d;if(!this._events[W])return!1;var ee=this._events[W],de=arguments.length,Ie,Ne;if(ee.fn){switch(ee.once&&this.removeListener(d,ee.fn,void 0,!0),de){case 1:return ee.fn.call(ee.context),!0;case 2:return ee.fn.call(ee.context,T),!0;case 3:return ee.fn.call(ee.context,T,f),!0;case 4:return ee.fn.call(ee.context,T,f,v),!0;case 5:return ee.fn.call(ee.context,T,f,v,r),!0;case 6:return ee.fn.call(ee.context,T,f,v,r,k),!0}for(Ne=1,Ie=new Array(de-1);Ne<de;Ne++)Ie[Ne-1]=arguments[Ne];ee.fn.apply(ee.context,Ie)}else{var lt=ee.length,it;for(Ne=0;Ne<lt;Ne++)switch(ee[Ne].once&&this.removeListener(d,ee[Ne].fn,void 0,!0),de){case 1:ee[Ne].fn.call(ee[Ne].context);break;case 2:ee[Ne].fn.call(ee[Ne].context,T);break;case 3:ee[Ne].fn.call(ee[Ne].context,T,f);break;case 4:ee[Ne].fn.call(ee[Ne].context,T,f,v);break;default:if(!Ie)for(it=1,Ie=new Array(de-1);it<de;it++)Ie[it-1]=arguments[it];ee[Ne].fn.apply(ee[Ne].context,Ie)}}return!0};jo.prototype.on=function(d,T,f){return vS(this,d,T,f,!1)};jo.prototype.once=function(d,T,f){return vS(this,d,T,f,!0)};jo.prototype.removeListener=function(d,T,f,v){var r=is?is+d:d;if(!this._events[r])return this;if(!T)return E_(this,r),this;var k=this._events[r];if(k.fn)k.fn===T&&(!v||k.once)&&(!f||k.context===f)&&E_(this,r);else{for(var W=0,ee=[],de=k.length;W<de;W++)(k[W].fn!==T||v&&!k[W].once||f&&k[W].context!==f)&&ee.push(k[W]);ee.length?this._events[r]=ee.length===1?ee[0]:ee:E_(this,r)}return this};jo.prototype.removeAllListeners=function(d){var T;return d?(T=is?is+d:d,this._events[T]&&E_(this,T)):(this._events=new em,this._eventsCount=0),this};jo.prototype.off=jo.prototype.removeListener;jo.prototype.addListener=jo.prototype.on;jo.prefixed=is;jo.EventEmitter=jo;typeof bb<"u"&&(bb.exports=jo)});var ES=cn((eB,TS)=>{"use strict";function iL(p){return p.map(encodeURIComponent).join(",")}function xS(p){return Array.isArray(p)?iL(p):encodeURIComponent(String(p))}function wS(p,d,T){if(T===!1||T===null)return p;var f=/\?/.test(p)?"&":"?",v=encodeURIComponent(d);return T!==void 0&&T!==""&&T!==!0&&(v+="="+xS(T)),""+p+f+v}function nL(p,d){if(!d)return p;var T=p;return Object.keys(d).forEach(function(f){var v=d[f];v!==void 0&&(Array.isArray(v)&&(v=v.filter(function(r){return r!=null}).join(",")),T=wS(T,f,v))}),T}function rL(p,d){if(!d||p.slice(0,4)==="http")return p;var T=p[0]==="/"?"":"/";return""+d.replace(/\/$/,"")+T+p}function oL(p,d){return d?p.replace(/\/:([a-zA-Z0-9]+)/g,function(T,f){var v=d[f];if(v===void 0)throw new Error("Unspecified route parameter "+f);var r=xS(v);return"/"+r}):p}TS.exports={appendQueryObject:nL,appendQueryParam:wS,prependOrigin:rL,interpolateRouteParams:oL}});var MS=cn((tB,SS)=>{"use strict";var sL=vb(),xb=Th(),aL=bS(),I_=ES(),IS=Kf(),lL=1;function lu(p,d){if(!p)throw new Error("MapiRequest requires a client");if(!d||!d.path||!d.method)throw new Error("MapiRequest requires an options object with path and method properties");var T={};d.body&&(T["content-type"]="application/json");var f=xb(T,d.headers),v=Object.keys(f).reduce(function(r,k){return r[k.toLowerCase()]=f[k],r},{});this.id=lL++,this._options=d,this.emitter=new aL,this.client=p,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=d.path,this.method=d.method,this.origin=d.origin||p.origin,this.query=d.query||{},this.params=d.params||{},this.body=d.body||null,this.file=d.file||null,this.encoding=d.encoding||"utf8",this.sendFileAs=d.sendFileAs||null,this.headers=v}lu.prototype.url=function(d){var T=I_.prependOrigin(this.path,this.origin);T=I_.appendQueryObject(T,this.query);var f=this.params,v=d??this.client.accessToken;if(v){T=I_.appendQueryParam(T,"access_token",v);var r=sL(v).user;f=xb({ownerId:r},f)}return T=I_.interpolateRouteParams(T,f),T};lu.prototype.send=function(){var d=this;if(d.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return d.sent=!0,d.client.sendRequest(d).then(function(T){return d.response=T,d.emitter.emit(IS.EVENT_RESPONSE,T),T},function(T){throw d.error=T,d.emitter.emit(IS.EVENT_ERROR,T),T})};lu.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};lu.prototype.eachPage=function(d){var T=this;function f(k){function W(){delete T._nextPageRequest;var ee=k.nextPage();ee&&(T._nextPageRequest=ee,r(ee))}d(null,k,W)}function v(k){d(k,null,function(){})}function r(k){k.send().then(f,v)}r(this)};lu.prototype.clone=function(){return this._extend()};lu.prototype._extend=function(d){var T=xb(this._options,d);return new lu(this.client,T)};SS.exports=lu});var wb=cn((iB,AS)=>{"use strict";var cL=vb(),uL=MS(),hL=Kf();function CS(p){if(!p||!p.accessToken)throw new Error("Cannot create a client without an access token");cL(p.accessToken),this.accessToken=p.accessToken,this.origin=p.origin||hL.API_ORIGIN}CS.prototype.createRequest=function(d){return new uL(this,d)};AS.exports=CS});var Tb=cn((nB,PS)=>{"use strict";var DS=gS(),RS=wb();function Jd(p){RS.call(this,p)}Jd.prototype=Object.create(RS.prototype);Jd.prototype.constructor=Jd;Jd.prototype.sendRequest=DS.browserSend;Jd.prototype.abortRequest=DS.browserAbort;function dL(p){return new Jd(p)}PS.exports=dL});var OS=cn((rB,kS)=>{"use strict";var pL=Tb();kS.exports=pL});var FS=cn((oB,LS)=>{"use strict";var fL=Object.prototype.toString;LS.exports=function(p){var d;return fL.call(p)==="[object Object]"&&(d=Object.getPrototypeOf(p),d===null||d===Object.getPrototypeOf({}))}});var US=cn((sB,jS)=>{"use strict";var mL=FS(),gL=Th(),zS="value",Eb=`
  `,or={};or.assert=function(p,d){return d=d||{},function(T){var f=cu(p,T);if(f){var v=Ib(f,d);throw d.apiName&&(v=d.apiName+": "+v),new Error(v)}}};or.shape=function(d){var T=bL(d);return function(v){var r=cu(or.plainObject,v);if(r)return r;for(var k,W,ee=[],de=0;de<T.length;de++)k=T[de].key,W=T[de].value,r=cu(W,v[k]),r&&ee.push([k].concat(r));return ee.length<2?ee[0]:function(Ie){ee=ee.map(function(it){var Gt=it[0],Ei=Ib(it,Ie).split(`
`).join(Eb);return"- "+Gt+": "+Ei});var Ne=Ie.path.join("."),lt=Ne===zS?"":" of "+Ne;return"The following properties"+lt+" have invalid values:"+Eb+ee.join(Eb)}}};or.strictShape=function(d){var T=or.shape(d);return function(v){var r=T(v);if(r)return r;var k=Object.keys(v).reduce(function(W,ee){return d[ee]===void 0&&W.push(ee),W},[]);if(k.length!==0)return function(){return"The following keys are invalid: "+k.join(", ")}}};or.arrayOf=function(d){return BS(d)};or.tuple=function(){var d=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return BS(d)};function BS(p){var d=Array.isArray(p),T=function(f){return d?p[f]:p};return function(v){var r=cu(or.plainArray,v);if(r)return r;if(d&&v.length!==p.length)return"an array with "+p.length+" items";for(var k=0;k<v.length;k++)if(r=cu(T(k),v[k]),r)return[k].concat(r)}}or.required=function(d){function T(f){return f==null?function(v){return NS(v,VS(v.path)?"cannot be undefined/null.":"is required.")}:d.apply(this,arguments)}return T.__required=!0,T};or.oneOfType=function(){var d=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(f){var v=d.map(function(r){return cu(r,f)}).filter(Boolean);if(v.length===d.length)return v.every(function(r){return r.length===1&&typeof r[0]=="string"})?_L(v.map(function(r){return r[0]})):v.reduce(function(r,k){return k.length>r.length?k:r})}};or.equal=function(d){return function(f){if(f!==d)return JSON.stringify(d)}};or.oneOf=function(){var d=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),T=d.map(function(f){return or.equal(f)});return or.oneOfType.apply(this,T)};or.range=function(d){var T=d[0],f=d[1];return function(r){var k=cu(or.number,r);if(k||r<T||r>f)return"number between "+T+" & "+f+" (inclusive)"}};or.any=function(){};or.boolean=function(d){if(typeof d!="boolean")return"boolean"};or.number=function(d){if(typeof d!="number")return"number"};or.plainArray=function(d){if(!Array.isArray(d))return"array"};or.plainObject=function(d){if(!mL(d))return"object"};or.string=function(d){if(typeof d!="string")return"string"};or.func=function(d){if(typeof d!="function")return"function"};function cu(p,d){if(!(d==null&&!p.hasOwnProperty("__required"))){var T=p(d);if(T)return Array.isArray(T)?T:[T]}}function Ib(p,d){var T=p.length,f=p[T-1],v=p.slice(0,T-1);return v.length===0&&(v=[zS]),d=gL(d,{path:v}),typeof f=="function"?f(d):NS(d,yL(f))}function _L(p){return p.length<2?p[0]:p.length===2?p.join(" or "):p.slice(0,-1).join(", ")+", or "+p.slice(-1)}function yL(p){return"must be "+vL(p)+"."}function vL(p){return/^an? /.test(p)?p:/^[aeiou]/i.test(p)?"an "+p:/^[a-z]/i.test(p)?"a "+p:p}function NS(p,d){var T=VS(p.path),f=p.path.join(".")+" "+d,v=T?"Item at position ":"";return v+f}function VS(p){return typeof p[p.length-1]=="number"||typeof p[0]=="number"}function bL(p){return Object.keys(p||{}).map(function(d){return{key:d,value:p[d]}})}or.validate=cu;or.processMessage=Ib;jS.exports=or});var qS=cn((aB,GS)=>{"use strict";var xL=Th(),ep=US();function wL(p){if(typeof window<"u")return p instanceof global.Blob||p instanceof global.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof p=="string"||p.pipe!==void 0))return"Filename or Readable stream"}function TL(p,d){return ep.assert(ep.strictShape(p),d)}function EL(p){var d="date";if(typeof p=="boolean")return d;try{var T=new Date(p);if(T.getTime&&isNaN(T.getTime()))return d}catch{return d}}function IL(p){return ep.tuple(ep.number,ep.number)(p)}GS.exports=xL(ep,{file:wL,date:EL,coordinates:IL,assertShape:TL})});var WS=cn((lB,$S)=>{"use strict";function SL(p,d){var T=function(f,v){return d.indexOf(f)!==-1&&v!==void 0};return typeof d=="function"&&(T=d),Object.keys(p).filter(function(f){return T(f,p[f])}).reduce(function(f,v){return f[v]=p[v],f},{})}$S.exports=SL});var HS=cn((cB,ZS)=>{"use strict";function ML(p,d){return Object.keys(p).reduce(function(T,f){return T[f]=d(f,p[f]),T},{})}ZS.exports=ML});var XS=cn((uB,QS)=>{"use strict";var CL=HS();function AL(p){return CL(p,function(d,T){return typeof T=="boolean"?JSON.stringify(T):T})}QS.exports=AL});var KS=cn((hB,YS)=>{"use strict";var DL=wb(),RL=Tb();function PL(p){return function(d){var T;DL.prototype.isPrototypeOf(d)?T=d:T=RL(d);var f=Object.create(p);return f.client=T,f}}YS.exports=PL});var nM=cn((dB,iM)=>{"use strict";var JS=Th(),bn=qS(),S_=WS(),eM=XS(),kL=KS(),Sb={},tM=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Sb.forwardGeocode=function(p){bn.assertShape({query:bn.required(bn.string),mode:bn.oneOf("mapbox.places","mapbox.places-permanent"),countries:bn.arrayOf(bn.string),proximity:bn.oneOf(bn.coordinates,"ip"),types:bn.arrayOf(bn.oneOf(tM)),autocomplete:bn.boolean,bbox:bn.arrayOf(bn.number),limit:bn.number,language:bn.arrayOf(bn.string),routing:bn.boolean,fuzzyMatch:bn.boolean,worldview:bn.string})(p),p.mode=p.mode||"mapbox.places";var d=eM(JS({country:p.countries},S_(p,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:S_(p,["mode","query"]),query:d})};Sb.reverseGeocode=function(p){bn.assertShape({query:bn.required(bn.coordinates),mode:bn.oneOf("mapbox.places","mapbox.places-permanent"),countries:bn.arrayOf(bn.string),types:bn.arrayOf(bn.oneOf(tM)),bbox:bn.arrayOf(bn.number),limit:bn.number,language:bn.arrayOf(bn.string),reverseMode:bn.oneOf("distance","score"),routing:bn.boolean,worldview:bn.string})(p),p.mode=p.mode||"mapbox.places";var d=eM(JS({country:p.countries},S_(p,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:S_(p,["mode","query"]),query:d})};iM.exports=kL(Sb)});var rM,oM=bT(()=>{"use strict";rM="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"});var lM={};uR(lM,{customAlphabet:()=>OL,customRandom:()=>aM,nanoid:()=>LL,random:()=>sM,urlAlphabet:()=>rM});var sM,aM,OL,LL,cM=bT(()=>{"use strict";oM();sM=p=>crypto.getRandomValues(new Uint8Array(p)),aM=(p,d,T)=>{let f=(2<<Math.log(p.length-1)/Math.LN2)-1,v=-~(1.6*f*d/p.length);return(r=d)=>{let k="";for(;;){let W=T(v),ee=v;for(;ee--;)if(k+=p[W[ee]&f]||"",k.length===r)return k}}},OL=(p,d=21)=>aM(p,d,sM),LL=(p=21)=>crypto.getRandomValues(new Uint8Array(p)).reduce((d,T)=>(T&=63,T<36?d+=T.toString(36):T<62?d+=(T-26).toString(36).toUpperCase():T>62?d+="-":d+="_",d),"")});var dM=cn((mB,hM)=>{"use strict";var FL=(cM(),hR(lM)).nanoid;function uM(p){this.origin=p.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=p.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=p,this.send=this.send.bind(this),this.countries=p.countries?p.countries.split(","):null,this.types=p.types?p.types.split(","):null,this.bbox=p.bbox?p.bbox:null,this.language=p.language?p.language.split(","):null,this.limit=p.limit?+p.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(p),this.eventQueue=new Array,this.flushInterval=p.flushInterval||1e3,this.maxQueueSize=p.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}uM.prototype={select:function(p,d){var T=this.getSelectedIndex(p,d),f=this.getEventPayload("search.select",d);if(f.resultIndex=T,f.resultPlaceName=p.place_name,f.resultId=p.id,!(T===this.lastSentIndex&&f.queryString===this.lastSentInput||T==-1)&&(this.lastSentIndex=T,this.lastSentInput=f.queryString,!!f.queryString))return this.push(f)},start:function(p){var d=this.getEventPayload("search.start",p);if(d.queryString)return this.push(d)},keyevent:function(p,d){if(p.key&&!(p.metaKey||[9,27,37,39,13,38,40].indexOf(p.keyCode)!==-1)){var T=this.getEventPayload("search.keystroke",d);if(T.lastAction=p.key,!!T.queryString)return this.push(T)}},send:function(p,d){if(!this.enableEventLogging)return d?d():void 0;var T=this.getRequestOptions(p);this.request(T,(function(f){if(f)return this.handleError(f,d);if(d)return d()}).bind(this))},getRequestOptions:function(p){Array.isArray(p)||(p=[p]);var d={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(p)};return d},getEventPayload:function(p,d){var T;d.options.proximity?typeof d.options.proximity=="object"?T=[d.options.proximity.longitude,d.options.proximity.latitude]:d.options.proximity==="ip"?T=[999,999]:T=d.options.proximity:T=null;var f=d._map?d._map.getZoom():void 0,v={event:p,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:d.options.autocomplete,fuzzyMatch:d.options.fuzzyMatch,proximity:T,limit:d.options.limit,routing:d.options.routing,worldview:d.options.worldview,mapZoom:f,keyboardLocale:this.locale};return p==="search.select"?v.queryString=d.inputString:p!="search.select"&&d._inputEl?v.queryString=d._inputEl.value:v.queryString=d.inputString,v},request:function(p,d){var T=new XMLHttpRequest;T.onreadystatechange=function(){if(this.readyState==4)return this.status==204?d(null):d(this.statusText)},T.open(p.method,p.host+"/"+p.path,!0);for(var f in p.headers){var v=p.headers[f];T.setRequestHeader(f,v)}T.send(p.body)},handleError:function(p,d){if(d)return d(p)},generateSessionID:function(){return FL()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(p,d){if(d._typeahead){var T=d._typeahead.data,f=p.id,v=T.map(function(k){return k.id}),r=v.indexOf(f);return r}},shouldEnableLogging:function(p){return!(p.enableEventLogging===!1||p.origin&&p.origin!=="https://api.mapbox.com"||p.localGeocoder||p.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(p,d){this.eventQueue.push(p),(this.eventQueue.length>=this.maxQueueSize||d)&&this.flush()},remove:function(){this.flush()}};hM.exports=uM});var fM=cn((gB,pM)=>{"use strict";var zL={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05DC\u05D7\u05E4\u05E9",ja:"\u30B5\u30FC\u30C1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041F\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641C\u7D22",cs:"Vyhled\xE1v\xE1n\xED",hu:"Keres\xE9s",ka:"\u10EB\u10D8\u10D4\u10D1\u10D0",nb:"S\xF8ke",sk:"Vyh\u013Ead\xE1vanie",th:"\u0E04\u0E49\u0E19\u0E2B\u0E32",fi:"Hae",is:"Leita",ko:"\uC218\uC0C9",pl:"Szukaj",sl:"Iskanje",fa:"\u062C\u0633\u062A\u062C\u0648",ru:"\u041F\u043E\u0438\u0441\u043A"};pM.exports={placeholder:zL}});var gM=cn((mM,M_)=>{"use strict";(function(p,d,T){typeof M_<"u"&&M_.exports?M_.exports=T():p[d]=T()})(mM,"subtag",function(){var p="",d=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function T(W){return W.match(d)||[]}function f(W){return T(W).filter(function(ee,de){return ee&&de})}function v(W){return W=T(W),{language:W[1]||p,extlang:W[2]||p,script:W[3]||p,region:W[4]||p}}function r(W,ee,de){Object.defineProperty(W,ee,{value:de,enumerable:!0})}function k(W,ee,de){function Ie(Ne){return T(Ne)[W]||p}r(Ie,"pattern",ee),r(v,de,Ie)}return k(1,/^[a-zA-Z]{2,3}$/,"language"),k(2,/^[a-zA-Z]{3}$/,"extlang"),k(3,/^[a-zA-Z]{4}$/,"script"),k(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),r(v,"split",f),v})});var vM=cn((_B,yM)=>{"use strict";function _M(){}_M.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){let p={enableHighAccuracy:!0};return new Promise(function(d,T){window.navigator.geolocation.getCurrentPosition(d,T,p)})}};yM.exports=_M});var wM=cn((yB,xM)=>{"use strict";function BL(p,d){let T=bM(p),f=["address","street","place","country"];var v;if(typeof d=="function")return d(T);let r=f.indexOf(d);return r===-1?v=f:v=f.slice(r),v.reduce(function(k,W){return T[W]?(k!==""&&(k=k+", "),k+T[W]):k},"")}function bM(p){let d=p.address||"",T=p.text||"",f=p.place_name||"",r={address:f.split(",")[0],houseNumber:d,street:T,placeName:f};return p.context.forEach(function(k){let W=k.id.split(".")[0];r[W]=k.text}),r}var NL=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;xM.exports={transformFeatureToGeolocationText:BL,getAddressInfo:bM,REVERSE_GEOCODE_COORD_RGX:NL}});var MM=cn((vB,SM)=>{"use strict";var VL=zI(),jL=jI(),Ih=Th(),UL=KI().EventEmitter,TM=eS(),Mb=OS(),Cb=nM(),GL=dM(),qL=fM(),$L=gM(),WL=vM(),EM=wM(),uu={FORWARD:0,LOCAL:1,REVERSE:2};function ZL(){var p=document.createElement("div");return p.className="mapboxgl-ctrl-geocoder--powered-by",p.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',p}function IM(p){this._eventEmitter=new UL,this.options=Ih({},this.options,p),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new WL}IM.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(p){return p.place_name},render:function(p){var d=p.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+d[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+d.splice(1,d.length).join(",")+"</div></div>"}},addTo:function(p){function d(T,f){if(!document.body.contains(f))throw new Error("Element provided to #addTo() exists, but is not in the DOM");let v=T.onAdd();f.appendChild(v)}if(p._controlContainer)p.addControl(this);else if(p instanceof HTMLElement)d(this,p);else if(typeof p=="string"){let T=document.querySelectorAll(p);if(T.length===0)throw new Error("Element ",p,"not found.");if(T.length>1)throw new Error("Geocoder can only be added to a single html element");d(this,T[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(p){if(p&&typeof p!="string"&&(this._map=p),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=Cb(Mb({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new GL(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var d=this.container=document.createElement("div");d.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var T=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",jL(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(de){this.eventManager.keyevent(de,this)}).bind(this));var f=document.createElement("div");f.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var v=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(v),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),f.appendChild(this._clearEl),f.appendChild(this._loadingEl),d.appendChild(T),d.appendChild(this._inputEl),d.appendChild(f),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var r=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(r),f.appendChild(this._geolocateEl),this._showGeolocateButton()}var k=this._typeahead=new VL(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),k.getItemValue=this.options.getItemValue;var W=k.list.draw,ee=this._footerNode=ZL();return k.list.draw=function(){W.call(this),ee.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),ee.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(ee)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),d},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(p){this._hideLoadingIcon();let d={geometry:{type:"Point",coordinates:[p.coords.longitude,p.coords.latitude]}};this._handleMarker(d),this._fly(d),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(d),this._showClearButton(),this.fresh=!1;let T={limit:1,language:[this.options.language],query:d.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){let f=d.geometry.coordinates[0]+","+d.geometry.coordinates[1];this._setInputValue(f),this._eventEmitter.emit("result",{result:d})}else this.geocoderService.reverseGeocode(T).send().then((function(f){let v=f.body.features[0];if(v){let r=EM.transformFeatureToGeolocationText(v,this.options.addressAccuracy);this._setInputValue(r),v.user_coordinates=d.geometry.coordinates,this._eventEmitter.emit("result",{result:v})}else this._eventEmitter.emit("result",{result:{user_coordinates:d.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(p){p.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(p,d){var T=document.createElementNS("http://www.w3.org/2000/svg","svg");return T.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+p),T.setAttribute("viewBox","0 0 18 18"),T.setAttribute("xml:space","preserve"),T.setAttribute("width",18),T.setAttribute("height",18),T.innerHTML=d,T},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(p){this._inputEl.value=p,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(p){var d=(p.clipboardData||window.clipboardData).getData("text");d.length>=this.options.minLength&&this._geocode(d)},_onKeyDown:function(p){var d=27,T=9;if(p.keyCode===d&&this.options.clearAndBlurOnEsc)return this._clear(p),this._inputEl.blur();var f=p.target&&p.target.shadowRoot?p.target.shadowRoot.activeElement:p.target,v=f?f.value:"";if(!v)return this.fresh=!0,p.keyCode!==T&&this.clear(p),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(p.metaKey||[T,d,37,39,13,38,40].indexOf(p.keyCode)!==-1)&&f.value.length>=this.options.minLength&&this._geocode(f.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(p){this.options.clearOnBlur&&this._clearOnBlur(p),this.options.collapsed&&this._collapse()},_onChange:function(){var p=this._typeahead.selected;p&&JSON.stringify(p)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(p),this.options.marker&&this._mapboxgl&&this._handleMarker(p),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(p),this._eventEmitter.emit("result",{result:p}),this.eventManager.select(p,this))},_fly:function(p){var d;if(p.properties&&TM[p.properties.short_code])d=Ih({},this.options.flyTo),this._map&&this._map.fitBounds(TM[p.properties.short_code].bbox,d);else if(p.bbox){var T=p.bbox;d=Ih({},this.options.flyTo),this._map&&this._map.fitBounds([[T[0],T[1]],[T[2],T[3]]],d)}else{var f={zoom:this.options.zoom};d=Ih({},f,this.options.flyTo),p.center?d.center=p.center:p.geometry&&p.geometry.type&&p.geometry.type==="Point"&&p.geometry.coordinates&&(d.center=p.geometry.coordinates),this._map&&this._map.flyTo(d)}},_requestType:function(p,d){var T;return p.localGeocoderOnly?T=uu.LOCAL:p.reverseGeocode&&EM.REVERSE_GEOCODE_COORD_RGX.test(d)?T=uu.REVERSE:T=uu.FORWARD,T},_setupConfig:function(p,d){let T=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],f=/[\s,]+/;var v=this,r=T.reduce(function(W,ee){if(v.options[ee]===void 0||v.options[ee]===null)return W;["countries","types","language"].indexOf(ee)>-1?W[ee]=v.options[ee].split(f):W[ee]=v.options[ee];let de=typeof v.options[ee].longitude=="number"&&typeof v.options[ee].latitude=="number";if(ee==="proximity"&&de){let Ie=v.options[ee].longitude,Ne=v.options[ee].latitude;W[ee]=[Ie,Ne]}return W},{});switch(p){case uu.REVERSE:{var k=d.split(f).map(function(W){return parseFloat(W,10)});v.options.flipCoordinates||k.reverse(),r.types&&r.types[0],r=Ih(r,{query:k,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(W){W in r&&delete r[W]})}break;case uu.FORWARD:{let W=d.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(W)&&(d=d.replace(/,/g," ")),r=Ih(r,{query:d})}break}return r},_geocode:function(p){this.inputString=p,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:p});let d=this._requestType(this.options,p),T=this._setupConfig(d,p);var f;switch(d){case uu.LOCAL:f=Promise.resolve();break;case uu.FORWARD:f=this.geocoderService.forwardGeocode(T).send();break;case uu.REVERSE:f=this.geocoderService.reverseGeocode(T).send();break}var v=this.options.localGeocoder?this.options.localGeocoder(p)||[]:[],r=[],k=null;return f.catch((function(W){k=W}).bind(this)).then((function(W){this._hideLoadingIcon();var ee={};return W?W.statusCode=="200"&&(ee=W.body,ee.request=W.request,ee.headers=W.headers):ee={type:"FeatureCollection",features:[]},ee.config=T,this.fresh&&(this.eventManager.start(this),this.fresh=!1),ee.features=ee.features?v.concat(ee.features):v,this.options.externalGeocoder?(r=this.options.externalGeocoder(p,ee.features)||Promise.resolve([]),r.then(function(de){return ee.features=ee.features?de.concat(ee.features):de,ee},function(){return ee})):ee}).bind(this)).then((function(W){if(k)throw k;this.options.filter&&W.features.length&&(W.features=W.features.filter(this.options.filter)),W.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",W),this._typeahead.update(W.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",W))}).bind(this)).catch((function(W){this._hideLoadingIcon(),this._hideAttribution(),v.length&&this.options.localGeocoder||r.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(v)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:v}),this._eventEmitter.emit("error",{error:W})}).bind(this)),f},_clear:function(p){p&&p.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(p){this._clear(p),this._inputEl.focus()},_clearOnBlur:function(p){var d=this;p.relatedTarget&&d._clear(p)},_onQueryResult:function(p){var d=p.body;if(d.features.length){var T=d.features[0];this._typeahead.selected=T,this._inputEl.value=T.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var p=this._map.getCenter().wrap();this.setProximity({longitude:p.lng,latitude:p.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(p){return this._geocode(p).then(this._onQueryResult),this},_renderError:function(){var p="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(p)},_renderLocationError:function(){var p="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(p)},_renderNoResults:function(){var p="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(p)},_renderUserDeniedGeolocationError:function(){var p="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(p)},_renderMessage:function(p){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(p)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var p=this.options.language.split(",")[0],d=$L.language(p),T=qL.placeholder[d];if(T)return T}return"Search"},setInput:function(p,d){return d===void 0&&(d=!1),this._inputEl.value=p,this._typeahead.selected=null,this._typeahead.clear(),p.length>=this.options.minLength&&(d?this._geocode(p):this._onChange()),this},setProximity:function(p,d=!0){return this.options.proximity=p,d&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(p){return p&&typeof p=="function"&&(this._typeahead.render=p),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(p){var d=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=p||this.options.language||d,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(p){return this.options.zoom=p,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(p){return this.options.flyTo=p,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(p){return this.options.placeholder=p||this._getPlaceholderText(),this._inputEl.placeholder=this.options.placeholder,this._inputEl.setAttribute("aria-label",this.options.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(p){return this.options.bbox=p,this},getCountries:function(){return this.options.countries},setCountries:function(p){return this.options.countries=p,this},getTypes:function(){return this.options.types},setTypes:function(p){return this.options.types=p,this},getMinLength:function(){return this.options.minLength},setMinLength:function(p){return this.options.minLength=p,this._typeahead&&(this._typeahead.options.minLength=p),this},getLimit:function(){return this.options.limit},setLimit:function(p){return this.options.limit=p,this._typeahead&&(this._typeahead.options.limit=p),this},getFilter:function(){return this.options.filter},setFilter:function(p){return this.options.filter=p,this},setOrigin:function(p){return this.options.origin=p,this.geocoderService=Cb(Mb({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(p){return this.options.accessToken=p,this.geocoderService=Cb(Mb({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(p){return this.options.autocomplete=p,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(p){return this.options.fuzzyMatch=p,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(p){return this.options.routing=p,this},getRouting:function(){return this.options.routing},setWorldview:function(p){return this.options.worldview=p,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(p){if(this._map){this._removeMarker();var d={color:"#4668F2"},T=Ih({},d,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(T),p.center?this.mapMarker.setLngLat(p.center).addTo(this._map):p.geometry&&p.geometry.type&&p.geometry.type==="Point"&&p.geometry.coordinates&&this.mapMarker.setLngLat(p.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(p,d){return this._eventEmitter.on(p,d),this},off:function(p,d){return this._eventEmitter.removeListener(p,d),this.eventManager.remove(),this}};SM.exports=IM});var AM=cn((Ab,Db)=>{"use strict";(function(p,d){typeof Ab=="object"&&typeof Db<"u"?Db.exports=d():typeof define=="function"&&define.amd?define(d):(p=typeof globalThis<"u"?globalThis:p||self,p.mapboxgl=d())})(Ab,function(){"use strict";var p,d,T;function f(r,k){if(!p)p=k;else if(!d)d=k;else{var W="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+p+")(sharedChunk); ("+d+")(sharedChunk); self.onerror = null;",ee={};p(ee),T=k(ee),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(T.workerUrl=window.URL.createObjectURL(new Blob([W],{type:"text/javascript"})))}}f(["exports"],function(r){"use strict";var k="3.4.0";let W,ee={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(W==null){let t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{W=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):t}catch{W=t}}return W},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ee.API_URL)return null;try{let t=new URL(ee.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function de(t){return ee.API_URL_REGEX.test(t)}function Ie(t){return t.indexOf("mapbox:")===0}function Ne(t){return ee.API_CDN_URL_REGEX.test(t)}function lt(t){return ee.API_SPRITE_REGEX.test(t)}function it(t){return ee.API_STYLE_REGEX.test(t)&&!lt(t)}let Gt={create:"create",load:"load",fullLoad:"fullLoad"};function Ei(t){let e=t.name.split("?")[0];return Ne(e)&&e.includes("mapbox-gl.js")?"javascript":Ne(e)&&e.includes("mapbox-gl.css")?"css":function(i){return ee.API_FONTS_REGEX.test(i)}(e)?"fontRange":lt(e)?"sprite":it(e)?"style":function(i){return ee.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}function sn(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Xt={},ni={};Object.defineProperty(ni,"__esModule",{value:!0}),ni.setMatrixArrayType=function(t){ni.ARRAY_TYPE=In=t},ni.toRadian=function(t){return t*jn},ni.equals=function(t,e){return Math.abs(t-e)<=Io*Math.max(1,Math.abs(t),Math.abs(e))},ni.RANDOM=ni.ARRAY_TYPE=ni.EPSILON=void 0;var Io=1e-6;ni.EPSILON=Io;var In=typeof Float32Array<"u"?Float32Array:Array;ni.ARRAY_TYPE=In;var rs=Math.random;ni.RANDOM=rs;var jn=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Ni={};function _o(t){return _o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_o(t)}Object.defineProperty(Ni,"__esModule",{value:!0}),Ni.create=function(){var t=new Rr.ARRAY_TYPE(4);return Rr.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},Ni.clone=function(t){var e=new Rr.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Ni.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Ni.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},Ni.fromValues=function(t,e,i,o){var a=new Rr.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=i,a[3]=o,a},Ni.set=function(t,e,i,o,a){return t[0]=e,t[1]=i,t[2]=o,t[3]=a,t},Ni.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},Ni.invert=function(t,e){var i=e[0],o=e[1],a=e[2],l=e[3],h=i*l-a*o;return h?(t[0]=l*(h=1/h),t[1]=-o*h,t[2]=-a*h,t[3]=i*h,t):null},Ni.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},Ni.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},Ni.multiply=Rl,Ni.rotate=function(t,e,i){var o=e[0],a=e[1],l=e[2],h=e[3],g=Math.sin(i),y=Math.cos(i);return t[0]=o*y+l*g,t[1]=a*y+h*g,t[2]=o*-g+l*y,t[3]=a*-g+h*y,t},Ni.scale=function(t,e,i){var o=e[1],a=e[2],l=e[3],h=i[0],g=i[1];return t[0]=e[0]*h,t[1]=o*h,t[2]=a*g,t[3]=l*g,t},Ni.fromRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=i,t[2]=-i,t[3]=o,t},Ni.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},Ni.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Ni.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},Ni.LDU=function(t,e,i,o){return t[2]=o[2]/o[0],i[0]=o[0],i[1]=o[1],i[3]=o[3]-t[2]*i[1],[t,e,i]},Ni.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},Ni.subtract=Xn,Ni.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Ni.equals=function(t,e){var i=t[0],o=t[1],a=t[2],l=t[3],h=e[0],g=e[1],y=e[2],x=e[3];return Math.abs(i-h)<=Rr.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-g)<=Rr.EPSILON*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(a-y)<=Rr.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(l-x)<=Rr.EPSILON*Math.max(1,Math.abs(l),Math.abs(x))},Ni.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},Ni.multiplyScalarAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t},Ni.sub=Ni.mul=void 0;var Rr=function(t,e){if(t&&t.__esModule)return t;if(t===null||_o(t)!=="object"&&typeof t!="function")return{default:t};var i=Gr(void 0);if(i&&i.has(t))return i.get(t);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(o,l,h):o[l]=t[l]}return o.default=t,i&&i.set(t,o),o}(ni);function Gr(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Gr=function(o){return o?i:e})(t)}function Rl(t,e,i){var o=e[0],a=e[1],l=e[2],h=e[3],g=i[0],y=i[1],x=i[2],E=i[3];return t[0]=o*g+l*y,t[1]=a*g+h*y,t[2]=o*x+l*E,t[3]=a*x+h*E,t}function Xn(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}Ni.mul=Rl,Ni.sub=Xn;var un={};function As(t){return As=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},As(t)}Object.defineProperty(un,"__esModule",{value:!0}),un.create=function(){var t=new qr.ARRAY_TYPE(6);return qr.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},un.clone=function(t){var e=new qr.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},un.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},un.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},un.fromValues=function(t,e,i,o,a,l){var h=new qr.ARRAY_TYPE(6);return h[0]=t,h[1]=e,h[2]=i,h[3]=o,h[4]=a,h[5]=l,h},un.set=function(t,e,i,o,a,l,h){return t[0]=e,t[1]=i,t[2]=o,t[3]=a,t[4]=l,t[5]=h,t},un.invert=function(t,e){var i=e[0],o=e[1],a=e[2],l=e[3],h=e[4],g=e[5],y=i*l-o*a;return y?(t[0]=l*(y=1/y),t[1]=-o*y,t[2]=-a*y,t[3]=i*y,t[4]=(a*g-l*h)*y,t[5]=(o*h-i*g)*y,t):null},un.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},un.multiply=Ys,un.rotate=function(t,e,i){var o=e[0],a=e[1],l=e[2],h=e[3],g=e[4],y=e[5],x=Math.sin(i),E=Math.cos(i);return t[0]=o*E+l*x,t[1]=a*E+h*x,t[2]=o*-x+l*E,t[3]=a*-x+h*E,t[4]=g,t[5]=y,t},un.scale=function(t,e,i){var o=e[1],a=e[2],l=e[3],h=e[4],g=e[5],y=i[0],x=i[1];return t[0]=e[0]*y,t[1]=o*y,t[2]=a*x,t[3]=l*x,t[4]=h,t[5]=g,t},un.translate=function(t,e,i){var o=e[0],a=e[1],l=e[2],h=e[3],g=e[4],y=e[5],x=i[0],E=i[1];return t[0]=o,t[1]=a,t[2]=l,t[3]=h,t[4]=o*x+l*E+g,t[5]=a*x+h*E+y,t},un.fromRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=i,t[2]=-i,t[3]=o,t[4]=0,t[5]=0,t},un.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},un.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},un.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},un.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},un.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},un.subtract=Ks,un.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},un.multiplyScalarAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t[4]=e[4]+i[4]*o,t[5]=e[5]+i[5]*o,t},un.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},un.equals=function(t,e){var i=t[0],o=t[1],a=t[2],l=t[3],h=t[4],g=t[5],y=e[0],x=e[1],E=e[2],I=e[3],M=e[4],D=e[5];return Math.abs(i-y)<=qr.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(o-x)<=qr.EPSILON*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-E)<=qr.EPSILON*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(l-I)<=qr.EPSILON*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(h-M)<=qr.EPSILON*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(g-D)<=qr.EPSILON*Math.max(1,Math.abs(g),Math.abs(D))},un.sub=un.mul=void 0;var qr=function(t,e){if(t&&t.__esModule)return t;if(t===null||As(t)!=="object"&&typeof t!="function")return{default:t};var i=no(void 0);if(i&&i.has(t))return i.get(t);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(o,l,h):o[l]=t[l]}return o.default=t,i&&i.set(t,o),o}(ni);function no(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(no=function(o){return o?i:e})(t)}function Ys(t,e,i){var o=e[0],a=e[1],l=e[2],h=e[3],g=e[4],y=e[5],x=i[0],E=i[1],I=i[2],M=i[3],D=i[4],P=i[5];return t[0]=o*x+l*E,t[1]=a*x+h*E,t[2]=o*I+l*M,t[3]=a*I+h*M,t[4]=o*D+l*P+g,t[5]=a*D+h*P+y,t}function Ks(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}un.mul=Ys,un.sub=Ks;var Pi={};function Js(t){return Js=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Js(t)}Object.defineProperty(Pi,"__esModule",{value:!0}),Pi.create=function(){var t=new xn.ARRAY_TYPE(9);return xn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},Pi.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},Pi.clone=function(t){var e=new xn.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},Pi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Pi.fromValues=function(t,e,i,o,a,l,h,g,y){var x=new xn.ARRAY_TYPE(9);return x[0]=t,x[1]=e,x[2]=i,x[3]=o,x[4]=a,x[5]=l,x[6]=h,x[7]=g,x[8]=y,x},Pi.set=function(t,e,i,o,a,l,h,g,y,x){return t[0]=e,t[1]=i,t[2]=o,t[3]=a,t[4]=l,t[5]=h,t[6]=g,t[7]=y,t[8]=x,t},Pi.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Pi.transpose=function(t,e){if(t===e){var i=e[1],o=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=o,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},Pi.invert=function(t,e){var i=e[0],o=e[1],a=e[2],l=e[3],h=e[4],g=e[5],y=e[6],x=e[7],E=e[8],I=E*h-g*x,M=-E*l+g*y,D=x*l-h*y,P=i*I+o*M+a*D;return P?(t[0]=I*(P=1/P),t[1]=(-E*o+a*x)*P,t[2]=(g*o-a*h)*P,t[3]=M*P,t[4]=(E*i-a*y)*P,t[5]=(-g*i+a*l)*P,t[6]=D*P,t[7]=(-x*i+o*y)*P,t[8]=(h*i-o*l)*P,t):null},Pi.adjoint=function(t,e){var i=e[0],o=e[1],a=e[2],l=e[3],h=e[4],g=e[5],y=e[6],x=e[7],E=e[8];return t[0]=h*E-g*x,t[1]=a*x-o*E,t[2]=o*g-a*h,t[3]=g*y-l*E,t[4]=i*E-a*y,t[5]=a*l-i*g,t[6]=l*x-h*y,t[7]=o*y-i*x,t[8]=i*h-o*l,t},Pi.determinant=function(t){var e=t[3],i=t[4],o=t[5],a=t[6],l=t[7],h=t[8];return t[0]*(h*i-o*l)+t[1]*(-h*e+o*a)+t[2]*(l*e-i*a)},Pi.multiply=$r,Pi.translate=function(t,e,i){var o=e[0],a=e[1],l=e[2],h=e[3],g=e[4],y=e[5],x=e[6],E=e[7],I=e[8],M=i[0],D=i[1];return t[0]=o,t[1]=a,t[2]=l,t[3]=h,t[4]=g,t[5]=y,t[6]=M*o+D*h+x,t[7]=M*a+D*g+E,t[8]=M*l+D*y+I,t},Pi.rotate=function(t,e,i){var o=e[0],a=e[1],l=e[2],h=e[3],g=e[4],y=e[5],x=e[6],E=e[7],I=e[8],M=Math.sin(i),D=Math.cos(i);return t[0]=D*o+M*h,t[1]=D*a+M*g,t[2]=D*l+M*y,t[3]=D*h-M*o,t[4]=D*g-M*a,t[5]=D*y-M*l,t[6]=x,t[7]=E,t[8]=I,t},Pi.scale=function(t,e,i){var o=i[0],a=i[1];return t[0]=o*e[0],t[1]=o*e[1],t[2]=o*e[2],t[3]=a*e[3],t[4]=a*e[4],t[5]=a*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Pi.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},Pi.fromRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=i,t[2]=0,t[3]=-i,t[4]=o,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Pi.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Pi.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},Pi.fromQuat=function(t,e){var i=e[0],o=e[1],a=e[2],l=e[3],h=i+i,g=o+o,y=a+a,x=i*h,E=o*h,I=o*g,M=a*h,D=a*g,P=a*y,L=l*h,N=l*g,V=l*y;return t[0]=1-I-P,t[3]=E-V,t[6]=M+N,t[1]=E+V,t[4]=1-x-P,t[7]=D-L,t[2]=M-N,t[5]=D+L,t[8]=1-x-I,t},Pi.normalFromMat4=function(t,e){var i=e[0],o=e[1],a=e[2],l=e[3],h=e[4],g=e[5],y=e[6],x=e[7],E=e[8],I=e[9],M=e[10],D=e[11],P=e[12],L=e[13],N=e[14],V=e[15],Z=i*g-o*h,Y=i*y-a*h,Q=i*x-l*h,ae=o*y-a*g,te=o*x-l*g,ce=a*x-l*y,he=E*L-I*P,be=E*N-M*P,Pe=E*V-D*P,Te=I*N-M*L,Le=I*V-D*L,Oe=M*V-D*N,ke=Z*Oe-Y*Le+Q*Te+ae*Pe-te*be+ce*he;return ke?(t[0]=(g*Oe-y*Le+x*Te)*(ke=1/ke),t[1]=(y*Pe-h*Oe-x*be)*ke,t[2]=(h*Le-g*Pe+x*he)*ke,t[3]=(a*Le-o*Oe-l*Te)*ke,t[4]=(i*Oe-a*Pe+l*be)*ke,t[5]=(o*Pe-i*Le-l*he)*ke,t[6]=(L*ce-N*te+V*ae)*ke,t[7]=(N*Q-P*ce-V*Y)*ke,t[8]=(P*te-L*Q+V*Z)*ke,t):null},Pi.projection=function(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},Pi.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},Pi.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},Pi.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t},Pi.subtract=Wn,Pi.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t},Pi.multiplyScalarAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t[4]=e[4]+i[4]*o,t[5]=e[5]+i[5]*o,t[6]=e[6]+i[6]*o,t[7]=e[7]+i[7]*o,t[8]=e[8]+i[8]*o,t},Pi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},Pi.equals=function(t,e){var i=t[0],o=t[1],a=t[2],l=t[3],h=t[4],g=t[5],y=t[6],x=t[7],E=t[8],I=e[0],M=e[1],D=e[2],P=e[3],L=e[4],N=e[5],V=e[6],Z=e[7],Y=e[8];return Math.abs(i-I)<=xn.EPSILON*Math.max(1,Math.abs(i),Math.abs(I))&&Math.abs(o-M)<=xn.EPSILON*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(a-D)<=xn.EPSILON*Math.max(1,Math.abs(a),Math.abs(D))&&Math.abs(l-P)<=xn.EPSILON*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(h-L)<=xn.EPSILON*Math.max(1,Math.abs(h),Math.abs(L))&&Math.abs(g-N)<=xn.EPSILON*Math.max(1,Math.abs(g),Math.abs(N))&&Math.abs(y-V)<=xn.EPSILON*Math.max(1,Math.abs(y),Math.abs(V))&&Math.abs(x-Z)<=xn.EPSILON*Math.max(1,Math.abs(x),Math.abs(Z))&&Math.abs(E-Y)<=xn.EPSILON*Math.max(1,Math.abs(E),Math.abs(Y))},Pi.sub=Pi.mul=void 0;var xn=function(t,e){if(t&&t.__esModule)return t;if(t===null||Js(t)!=="object"&&typeof t!="function")return{default:t};var i=So(void 0);if(i&&i.has(t))return i.get(t);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(o,l,h):o[l]=t[l]}return o.default=t,i&&i.set(t,o),o}(ni);function So(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(So=function(o){return o?i:e})(t)}function $r(t,e,i){var o=e[0],a=e[1],l=e[2],h=e[3],g=e[4],y=e[5],x=e[6],E=e[7],I=e[8],M=i[0],D=i[1],P=i[2],L=i[3],N=i[4],V=i[5],Z=i[6],Y=i[7],Q=i[8];return t[0]=M*o+D*h+P*x,t[1]=M*a+D*g+P*E,t[2]=M*l+D*y+P*I,t[3]=L*o+N*h+V*x,t[4]=L*a+N*g+V*E,t[5]=L*l+N*y+V*I,t[6]=Z*o+Y*h+Q*x,t[7]=Z*a+Y*g+Q*E,t[8]=Z*l+Y*y+Q*I,t}function Wn(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}Pi.mul=$r,Pi.sub=Wn;var jt={};function os(t){return os=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},os(t)}Object.defineProperty(jt,"__esModule",{value:!0}),jt.create=function(){var t=new ki.ARRAY_TYPE(16);return ki.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},jt.clone=function(t){var e=new ki.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},jt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},jt.fromValues=function(t,e,i,o,a,l,h,g,y,x,E,I,M,D,P,L){var N=new ki.ARRAY_TYPE(16);return N[0]=t,N[1]=e,N[2]=i,N[3]=o,N[4]=a,N[5]=l,N[6]=h,N[7]=g,N[8]=y,N[9]=x,N[10]=E,N[11]=I,N[12]=M,N[13]=D,N[14]=P,N[15]=L,N},jt.set=function(t,e,i,o,a,l,h,g,y,x,E,I,M,D,P,L,N){return t[0]=e,t[1]=i,t[2]=o,t[3]=a,t[4]=l,t[5]=h,t[6]=g,t[7]=y,t[8]=x,t[9]=E,t[10]=I,t[11]=M,t[12]=D,t[13]=P,t[14]=L,t[15]=N,t},jt.identity=Ia,jt.transpose=function(t,e){if(t===e){var i=e[1],o=e[2],a=e[3],l=e[6],h=e[7],g=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=o,t[9]=l,t[11]=e[14],t[12]=a,t[13]=h,t[14]=g}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},jt.invert=function(t,e){var i=e[0],o=e[1],a=e[2],l=e[3],h=e[4],g=e[5],y=e[6],x=e[7],E=e[8],I=e[9],M=e[10],D=e[11],P=e[12],L=e[13],N=e[14],V=e[15],Z=i*g-o*h,Y=i*y-a*h,Q=i*x-l*h,ae=o*y-a*g,te=o*x-l*g,ce=a*x-l*y,he=E*L-I*P,be=E*N-M*P,Pe=E*V-D*P,Te=I*N-M*L,Le=I*V-D*L,Oe=M*V-D*N,ke=Z*Oe-Y*Le+Q*Te+ae*Pe-te*be+ce*he;return ke?(t[0]=(g*Oe-y*Le+x*Te)*(ke=1/ke),t[1]=(a*Le-o*Oe-l*Te)*ke,t[2]=(L*ce-N*te+V*ae)*ke,t[3]=(M*te-I*ce-D*ae)*ke,t[4]=(y*Pe-h*Oe-x*be)*ke,t[5]=(i*Oe-a*Pe+l*be)*ke,t[6]=(N*Q-P*ce-V*Y)*ke,t[7]=(E*ce-M*Q+D*Y)*ke,t[8]=(h*Le-g*Pe+x*he)*ke,t[9]=(o*Pe-i*Le-l*he)*ke,t[10]=(P*te-L*Q+V*Z)*ke,t[11]=(I*Q-E*te-D*Z)*ke,t[12]=(g*be-h*Te-y*he)*ke,t[13]=(i*Te-o*be+a*he)*ke,t[14]=(L*Y-P*ae-N*Z)*ke,t[15]=(E*ae-I*Y+M*Z)*ke,t):null},jt.adjoint=function(t,e){var i=e[0],o=e[1],a=e[2],l=e[3],h=e[4],g=e[5],y=e[6],x=e[7],E=e[8],I=e[9],M=e[10],D=e[11],P=e[12],L=e[13],N=e[14],V=e[15];return t[0]=g*(M*V-D*N)-I*(y*V-x*N)+L*(y*D-x*M),t[1]=-(o*(M*V-D*N)-I*(a*V-l*N)+L*(a*D-l*M)),t[2]=o*(y*V-x*N)-g*(a*V-l*N)+L*(a*x-l*y),t[3]=-(o*(y*D-x*M)-g*(a*D-l*M)+I*(a*x-l*y)),t[4]=-(h*(M*V-D*N)-E*(y*V-x*N)+P*(y*D-x*M)),t[5]=i*(M*V-D*N)-E*(a*V-l*N)+P*(a*D-l*M),t[6]=-(i*(y*V-x*N)-h*(a*V-l*N)+P*(a*x-l*y)),t[7]=i*(y*D-x*M)-h*(a*D-l*M)+E*(a*x-l*y),t[8]=h*(I*V-D*L)-E*(g*V-x*L)+P*(g*D-x*I),t[9]=-(i*(I*V-D*L)-E*(o*V-l*L)+P*(o*D-l*I)),t[10]=i*(g*V-x*L)-h*(o*V-l*L)+P*(o*x-l*g),t[11]=-(i*(g*D-x*I)-h*(o*D-l*I)+E*(o*x-l*g)),t[12]=-(h*(I*N-M*L)-E*(g*N-y*L)+P*(g*M-y*I)),t[13]=i*(I*N-M*L)-E*(o*N-a*L)+P*(o*M-a*I),t[14]=-(i*(g*N-y*L)-h*(o*N-a*L)+P*(o*y-a*g)),t[15]=i*(g*M-y*I)-h*(o*M-a*I)+E*(o*y-a*g),t},jt.determinant=function(t){var e=t[0],i=t[1],o=t[2],a=t[3],l=t[4],h=t[5],g=t[6],y=t[7],x=t[8],E=t[9],I=t[10],M=t[11],D=t[12],P=t[13],L=t[14],N=t[15];return(e*h-i*l)*(I*N-M*L)-(e*g-o*l)*(E*N-M*P)+(e*y-a*l)*(E*L-I*P)+(i*g-o*h)*(x*N-M*D)-(i*y-a*h)*(x*L-I*D)+(o*y-a*g)*(x*P-E*D)},jt.multiply=ea,jt.translate=function(t,e,i){var o,a,l,h,g,y,x,E,I,M,D,P,L=i[0],N=i[1],V=i[2];return e===t?(t[12]=e[0]*L+e[4]*N+e[8]*V+e[12],t[13]=e[1]*L+e[5]*N+e[9]*V+e[13],t[14]=e[2]*L+e[6]*N+e[10]*V+e[14],t[15]=e[3]*L+e[7]*N+e[11]*V+e[15]):(a=e[1],l=e[2],h=e[3],g=e[4],y=e[5],x=e[6],E=e[7],I=e[8],M=e[9],D=e[10],P=e[11],t[0]=o=e[0],t[1]=a,t[2]=l,t[3]=h,t[4]=g,t[5]=y,t[6]=x,t[7]=E,t[8]=I,t[9]=M,t[10]=D,t[11]=P,t[12]=o*L+g*N+I*V+e[12],t[13]=a*L+y*N+M*V+e[13],t[14]=l*L+x*N+D*V+e[14],t[15]=h*L+E*N+P*V+e[15]),t},jt.scale=function(t,e,i){var o=i[0],a=i[1],l=i[2];return t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*l,t[9]=e[9]*l,t[10]=e[10]*l,t[11]=e[11]*l,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},jt.rotate=function(t,e,i,o){var a,l,h,g,y,x,E,I,M,D,P,L,N,V,Z,Y,Q,ae,te,ce,he,be,Pe,Te,Le=o[0],Oe=o[1],ke=o[2],$e=Math.hypot(Le,Oe,ke);return $e<ki.EPSILON?null:(Le*=$e=1/$e,Oe*=$e,ke*=$e,a=Math.sin(i),l=Math.cos(i),y=e[1],x=e[2],E=e[3],M=e[5],D=e[6],P=e[7],N=e[9],V=e[10],Z=e[11],Y=Le*Le*(h=1-l)+l,te=Le*Oe*h-ke*a,ce=Oe*Oe*h+l,he=ke*Oe*h+Le*a,be=Le*ke*h+Oe*a,Pe=Oe*ke*h-Le*a,Te=ke*ke*h+l,t[0]=(g=e[0])*Y+(I=e[4])*(Q=Oe*Le*h+ke*a)+(L=e[8])*(ae=ke*Le*h-Oe*a),t[1]=y*Y+M*Q+N*ae,t[2]=x*Y+D*Q+V*ae,t[3]=E*Y+P*Q+Z*ae,t[4]=g*te+I*ce+L*he,t[5]=y*te+M*ce+N*he,t[6]=x*te+D*ce+V*he,t[7]=E*te+P*ce+Z*he,t[8]=g*be+I*Pe+L*Te,t[9]=y*be+M*Pe+N*Te,t[10]=x*be+D*Pe+V*Te,t[11]=E*be+P*Pe+Z*Te,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},jt.rotateX=function(t,e,i){var o=Math.sin(i),a=Math.cos(i),l=e[4],h=e[5],g=e[6],y=e[7],x=e[8],E=e[9],I=e[10],M=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=l*a+x*o,t[5]=h*a+E*o,t[6]=g*a+I*o,t[7]=y*a+M*o,t[8]=x*a-l*o,t[9]=E*a-h*o,t[10]=I*a-g*o,t[11]=M*a-y*o,t},jt.rotateY=function(t,e,i){var o=Math.sin(i),a=Math.cos(i),l=e[0],h=e[1],g=e[2],y=e[3],x=e[8],E=e[9],I=e[10],M=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*a-x*o,t[1]=h*a-E*o,t[2]=g*a-I*o,t[3]=y*a-M*o,t[8]=l*o+x*a,t[9]=h*o+E*a,t[10]=g*o+I*a,t[11]=y*o+M*a,t},jt.rotateZ=function(t,e,i){var o=Math.sin(i),a=Math.cos(i),l=e[0],h=e[1],g=e[2],y=e[3],x=e[4],E=e[5],I=e[6],M=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*a+x*o,t[1]=h*a+E*o,t[2]=g*a+I*o,t[3]=y*a+M*o,t[4]=x*a-l*o,t[5]=E*a-h*o,t[6]=I*a-g*o,t[7]=M*a-y*o,t},jt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},jt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},jt.fromRotation=function(t,e,i){var o,a,l,h=i[0],g=i[1],y=i[2],x=Math.hypot(h,g,y);return x<ki.EPSILON?null:(h*=x=1/x,g*=x,y*=x,o=Math.sin(e),a=Math.cos(e),t[0]=h*h*(l=1-a)+a,t[1]=g*h*l+y*o,t[2]=y*h*l-g*o,t[3]=0,t[4]=h*g*l-y*o,t[5]=g*g*l+a,t[6]=y*g*l+h*o,t[7]=0,t[8]=h*y*l+g*o,t[9]=g*y*l-h*o,t[10]=y*y*l+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},jt.fromXRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},jt.fromYRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},jt.fromZRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},jt.fromRotationTranslation=ta,jt.fromQuat2=function(t,e){var i=new ki.ARRAY_TYPE(3),o=-e[0],a=-e[1],l=-e[2],h=e[3],g=e[4],y=e[5],x=e[6],E=e[7],I=o*o+a*a+l*l+h*h;return I>0?(i[0]=2*(g*h+E*o+y*l-x*a)/I,i[1]=2*(y*h+E*a+x*o-g*l)/I,i[2]=2*(x*h+E*l+g*a-y*o)/I):(i[0]=2*(g*h+E*o+y*l-x*a),i[1]=2*(y*h+E*a+x*o-g*l),i[2]=2*(x*h+E*l+g*a-y*o)),ta(t,e,i),t},jt.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},jt.getScaling=Ds,jt.getRotation=function(t,e){var i=new ki.ARRAY_TYPE(3);Ds(i,e);var o=1/i[0],a=1/i[1],l=1/i[2],h=e[0]*o,g=e[1]*a,y=e[2]*l,x=e[4]*o,E=e[5]*a,I=e[6]*l,M=e[8]*o,D=e[9]*a,P=e[10]*l,L=h+E+P,N=0;return L>0?(N=2*Math.sqrt(L+1),t[3]=.25*N,t[0]=(I-D)/N,t[1]=(M-y)/N,t[2]=(g-x)/N):h>E&&h>P?(N=2*Math.sqrt(1+h-E-P),t[3]=(I-D)/N,t[0]=.25*N,t[1]=(g+x)/N,t[2]=(M+y)/N):E>P?(N=2*Math.sqrt(1+E-h-P),t[3]=(M-y)/N,t[0]=(g+x)/N,t[1]=.25*N,t[2]=(I+D)/N):(N=2*Math.sqrt(1+P-h-E),t[3]=(g-x)/N,t[0]=(M+y)/N,t[1]=(I+D)/N,t[2]=.25*N),t},jt.fromRotationTranslationScale=function(t,e,i,o){var a=e[0],l=e[1],h=e[2],g=e[3],y=a+a,x=l+l,E=h+h,I=a*y,M=a*x,D=a*E,P=l*x,L=l*E,N=h*E,V=g*y,Z=g*x,Y=g*E,Q=o[0],ae=o[1],te=o[2];return t[0]=(1-(P+N))*Q,t[1]=(M+Y)*Q,t[2]=(D-Z)*Q,t[3]=0,t[4]=(M-Y)*ae,t[5]=(1-(I+N))*ae,t[6]=(L+V)*ae,t[7]=0,t[8]=(D+Z)*te,t[9]=(L-V)*te,t[10]=(1-(I+P))*te,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},jt.fromRotationTranslationScaleOrigin=function(t,e,i,o,a){var l=e[0],h=e[1],g=e[2],y=e[3],x=l+l,E=h+h,I=g+g,M=l*x,D=l*E,P=l*I,L=h*E,N=h*I,V=g*I,Z=y*x,Y=y*E,Q=y*I,ae=o[0],te=o[1],ce=o[2],he=a[0],be=a[1],Pe=a[2],Te=(1-(L+V))*ae,Le=(D+Q)*ae,Oe=(P-Y)*ae,ke=(D-Q)*te,$e=(1-(M+V))*te,qe=(N+Z)*te,Xe=(P+Y)*ce,Qe=(N-Z)*ce,Fe=(1-(M+L))*ce;return t[0]=Te,t[1]=Le,t[2]=Oe,t[3]=0,t[4]=ke,t[5]=$e,t[6]=qe,t[7]=0,t[8]=Xe,t[9]=Qe,t[10]=Fe,t[11]=0,t[12]=i[0]+he-(Te*he+ke*be+Xe*Pe),t[13]=i[1]+be-(Le*he+$e*be+Qe*Pe),t[14]=i[2]+Pe-(Oe*he+qe*be+Fe*Pe),t[15]=1,t},jt.fromQuat=function(t,e){var i=e[0],o=e[1],a=e[2],l=e[3],h=i+i,g=o+o,y=a+a,x=i*h,E=o*h,I=o*g,M=a*h,D=a*g,P=a*y,L=l*h,N=l*g,V=l*y;return t[0]=1-I-P,t[1]=E+V,t[2]=M-N,t[3]=0,t[4]=E-V,t[5]=1-x-P,t[6]=D+L,t[7]=0,t[8]=M+N,t[9]=D-L,t[10]=1-x-I,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},jt.frustum=function(t,e,i,o,a,l,h){var g=1/(i-e),y=1/(a-o),x=1/(l-h);return t[0]=2*l*g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*l*y,t[6]=0,t[7]=0,t[8]=(i+e)*g,t[9]=(a+o)*y,t[10]=(h+l)*x,t[11]=-1,t[12]=0,t[13]=0,t[14]=h*l*2*x,t[15]=0,t},jt.perspectiveNO=rl,jt.perspectiveZO=function(t,e,i,o,a){var l,h=1/Math.tan(e/2);return t[0]=h/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(t[10]=a*(l=1/(o-a)),t[14]=a*o*l):(t[10]=-1,t[14]=-o),t},jt.perspectiveFromFieldOfView=function(t,e,i,o){var a=Math.tan(e.upDegrees*Math.PI/180),l=Math.tan(e.downDegrees*Math.PI/180),h=Math.tan(e.leftDegrees*Math.PI/180),g=Math.tan(e.rightDegrees*Math.PI/180),y=2/(h+g),x=2/(a+l);return t[0]=y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=x,t[6]=0,t[7]=0,t[8]=-(h-g)*y*.5,t[9]=(a-l)*x*.5,t[10]=o/(i-o),t[11]=-1,t[12]=0,t[13]=0,t[14]=o*i/(i-o),t[15]=0,t},jt.orthoNO=Ii,jt.orthoZO=function(t,e,i,o,a,l,h){var g=1/(e-i),y=1/(o-a),x=1/(l-h);return t[0]=-2*g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=x,t[11]=0,t[12]=(e+i)*g,t[13]=(a+o)*y,t[14]=l*x,t[15]=1,t},jt.lookAt=function(t,e,i,o){var a,l,h,g,y,x,E,I,M,D,P=e[0],L=e[1],N=e[2],V=o[0],Z=o[1],Y=o[2],Q=i[0],ae=i[1],te=i[2];return Math.abs(P-Q)<ki.EPSILON&&Math.abs(L-ae)<ki.EPSILON&&Math.abs(N-te)<ki.EPSILON?Ia(t):(E=P-Q,I=L-ae,M=N-te,a=Z*(M*=D=1/Math.hypot(E,I,M))-Y*(I*=D),l=Y*(E*=D)-V*M,h=V*I-Z*E,(D=Math.hypot(a,l,h))?(a*=D=1/D,l*=D,h*=D):(a=0,l=0,h=0),g=I*h-M*l,y=M*a-E*h,x=E*l-I*a,(D=Math.hypot(g,y,x))?(g*=D=1/D,y*=D,x*=D):(g=0,y=0,x=0),t[0]=a,t[1]=g,t[2]=E,t[3]=0,t[4]=l,t[5]=y,t[6]=I,t[7]=0,t[8]=h,t[9]=x,t[10]=M,t[11]=0,t[12]=-(a*P+l*L+h*N),t[13]=-(g*P+y*L+x*N),t[14]=-(E*P+I*L+M*N),t[15]=1,t)},jt.targetTo=function(t,e,i,o){var a=e[0],l=e[1],h=e[2],g=o[0],y=o[1],x=o[2],E=a-i[0],I=l-i[1],M=h-i[2],D=E*E+I*I+M*M;D>0&&(E*=D=1/Math.sqrt(D),I*=D,M*=D);var P=y*M-x*I,L=x*E-g*M,N=g*I-y*E;return(D=P*P+L*L+N*N)>0&&(P*=D=1/Math.sqrt(D),L*=D,N*=D),t[0]=P,t[1]=L,t[2]=N,t[3]=0,t[4]=I*N-M*L,t[5]=M*P-E*N,t[6]=E*L-I*P,t[7]=0,t[8]=E,t[9]=I,t[10]=M,t[11]=0,t[12]=a,t[13]=l,t[14]=h,t[15]=1,t},jt.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},jt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},jt.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t},jt.subtract=Pl,jt.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t},jt.multiplyScalarAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t[4]=e[4]+i[4]*o,t[5]=e[5]+i[5]*o,t[6]=e[6]+i[6]*o,t[7]=e[7]+i[7]*o,t[8]=e[8]+i[8]*o,t[9]=e[9]+i[9]*o,t[10]=e[10]+i[10]*o,t[11]=e[11]+i[11]*o,t[12]=e[12]+i[12]*o,t[13]=e[13]+i[13]*o,t[14]=e[14]+i[14]*o,t[15]=e[15]+i[15]*o,t},jt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},jt.equals=function(t,e){var i=t[0],o=t[1],a=t[2],l=t[3],h=t[4],g=t[5],y=t[6],x=t[7],E=t[8],I=t[9],M=t[10],D=t[11],P=t[12],L=t[13],N=t[14],V=t[15],Z=e[0],Y=e[1],Q=e[2],ae=e[3],te=e[4],ce=e[5],he=e[6],be=e[7],Pe=e[8],Te=e[9],Le=e[10],Oe=e[11],ke=e[12],$e=e[13],qe=e[14],Xe=e[15];return Math.abs(i-Z)<=ki.EPSILON*Math.max(1,Math.abs(i),Math.abs(Z))&&Math.abs(o-Y)<=ki.EPSILON*Math.max(1,Math.abs(o),Math.abs(Y))&&Math.abs(a-Q)<=ki.EPSILON*Math.max(1,Math.abs(a),Math.abs(Q))&&Math.abs(l-ae)<=ki.EPSILON*Math.max(1,Math.abs(l),Math.abs(ae))&&Math.abs(h-te)<=ki.EPSILON*Math.max(1,Math.abs(h),Math.abs(te))&&Math.abs(g-ce)<=ki.EPSILON*Math.max(1,Math.abs(g),Math.abs(ce))&&Math.abs(y-he)<=ki.EPSILON*Math.max(1,Math.abs(y),Math.abs(he))&&Math.abs(x-be)<=ki.EPSILON*Math.max(1,Math.abs(x),Math.abs(be))&&Math.abs(E-Pe)<=ki.EPSILON*Math.max(1,Math.abs(E),Math.abs(Pe))&&Math.abs(I-Te)<=ki.EPSILON*Math.max(1,Math.abs(I),Math.abs(Te))&&Math.abs(M-Le)<=ki.EPSILON*Math.max(1,Math.abs(M),Math.abs(Le))&&Math.abs(D-Oe)<=ki.EPSILON*Math.max(1,Math.abs(D),Math.abs(Oe))&&Math.abs(P-ke)<=ki.EPSILON*Math.max(1,Math.abs(P),Math.abs(ke))&&Math.abs(L-$e)<=ki.EPSILON*Math.max(1,Math.abs(L),Math.abs($e))&&Math.abs(N-qe)<=ki.EPSILON*Math.max(1,Math.abs(N),Math.abs(qe))&&Math.abs(V-Xe)<=ki.EPSILON*Math.max(1,Math.abs(V),Math.abs(Xe))},jt.sub=jt.mul=jt.ortho=jt.perspective=void 0;var ki=function(t,e){if(t&&t.__esModule)return t;if(t===null||os(t)!=="object"&&typeof t!="function")return{default:t};var i=Oi(void 0);if(i&&i.has(t))return i.get(t);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(o,l,h):o[l]=t[l]}return o.default=t,i&&i.set(t,o),o}(ni);function Oi(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Oi=function(o){return o?i:e})(t)}function Ia(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ea(t,e,i){var o=e[0],a=e[1],l=e[2],h=e[3],g=e[4],y=e[5],x=e[6],E=e[7],I=e[8],M=e[9],D=e[10],P=e[11],L=e[12],N=e[13],V=e[14],Z=e[15],Y=i[0],Q=i[1],ae=i[2],te=i[3];return t[0]=Y*o+Q*g+ae*I+te*L,t[1]=Y*a+Q*y+ae*M+te*N,t[2]=Y*l+Q*x+ae*D+te*V,t[3]=Y*h+Q*E+ae*P+te*Z,t[4]=(Y=i[4])*o+(Q=i[5])*g+(ae=i[6])*I+(te=i[7])*L,t[5]=Y*a+Q*y+ae*M+te*N,t[6]=Y*l+Q*x+ae*D+te*V,t[7]=Y*h+Q*E+ae*P+te*Z,t[8]=(Y=i[8])*o+(Q=i[9])*g+(ae=i[10])*I+(te=i[11])*L,t[9]=Y*a+Q*y+ae*M+te*N,t[10]=Y*l+Q*x+ae*D+te*V,t[11]=Y*h+Q*E+ae*P+te*Z,t[12]=(Y=i[12])*o+(Q=i[13])*g+(ae=i[14])*I+(te=i[15])*L,t[13]=Y*a+Q*y+ae*M+te*N,t[14]=Y*l+Q*x+ae*D+te*V,t[15]=Y*h+Q*E+ae*P+te*Z,t}function ta(t,e,i){var o=e[0],a=e[1],l=e[2],h=e[3],g=o+o,y=a+a,x=l+l,E=o*g,I=o*y,M=o*x,D=a*y,P=a*x,L=l*x,N=h*g,V=h*y,Z=h*x;return t[0]=1-(D+L),t[1]=I+Z,t[2]=M-V,t[3]=0,t[4]=I-Z,t[5]=1-(E+L),t[6]=P+N,t[7]=0,t[8]=M+V,t[9]=P-N,t[10]=1-(E+D),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function Ds(t,e){var i=e[4],o=e[5],a=e[6],l=e[8],h=e[9],g=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(i,o,a),t[2]=Math.hypot(l,h,g),t}function rl(t,e,i,o,a){var l,h=1/Math.tan(e/2);return t[0]=h/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(t[10]=(a+o)*(l=1/(o-a)),t[14]=2*a*o*l):(t[10]=-1,t[14]=-2*o),t}function Ii(t,e,i,o,a,l,h){var g=1/(e-i),y=1/(o-a),x=1/(l-h);return t[0]=-2*g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*x,t[11]=0,t[12]=(e+i)*g,t[13]=(a+o)*y,t[14]=(h+l)*x,t[15]=1,t}function Pl(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}jt.perspective=rl,jt.ortho=Ii,jt.mul=ea,jt.sub=Pl;var Yt={},Wt={};function Mo(t){return Mo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mo(t)}Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.create=J,Wt.clone=function(t){var e=new Co.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Wt.length=se,Wt.fromValues=function(t,e,i){var o=new Co.ARRAY_TYPE(3);return o[0]=t,o[1]=e,o[2]=i,o},Wt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Wt.set=function(t,e,i,o){return t[0]=e,t[1]=i,t[2]=o,t},Wt.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},Wt.subtract=_e,Wt.multiply=Ge,Wt.divide=Ze,Wt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Wt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Wt.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},Wt.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},Wt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Wt.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},Wt.scaleAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t},Wt.distance=nt,Wt.squaredDistance=Mt,Wt.squaredLength=Ve,Wt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Wt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Wt.normalize=function(t,e){var i=e[0],o=e[1],a=e[2],l=i*i+o*o+a*a;return l>0&&(l=1/Math.sqrt(l)),t[0]=e[0]*l,t[1]=e[1]*l,t[2]=e[2]*l,t},Wt.dot=_t,Wt.cross=function(t,e,i){var o=e[0],a=e[1],l=e[2],h=i[0],g=i[1],y=i[2];return t[0]=a*y-l*g,t[1]=l*h-o*y,t[2]=o*g-a*h,t},Wt.lerp=function(t,e,i,o){var a=e[0],l=e[1],h=e[2];return t[0]=a+o*(i[0]-a),t[1]=l+o*(i[1]-l),t[2]=h+o*(i[2]-h),t},Wt.hermite=function(t,e,i,o,a,l){var h=l*l,g=h*(2*l-3)+1,y=h*(l-2)+l,x=h*(l-1),E=h*(3-2*l);return t[0]=e[0]*g+i[0]*y+o[0]*x+a[0]*E,t[1]=e[1]*g+i[1]*y+o[1]*x+a[1]*E,t[2]=e[2]*g+i[2]*y+o[2]*x+a[2]*E,t},Wt.bezier=function(t,e,i,o,a,l){var h=1-l,g=h*h,y=l*l,x=g*h,E=3*l*g,I=3*y*h,M=y*l;return t[0]=e[0]*x+i[0]*E+o[0]*I+a[0]*M,t[1]=e[1]*x+i[1]*E+o[1]*I+a[1]*M,t[2]=e[2]*x+i[2]*E+o[2]*I+a[2]*M,t},Wt.random=function(t,e){e=e||1;var i=2*Co.RANDOM()*Math.PI,o=2*Co.RANDOM()-1,a=Math.sqrt(1-o*o)*e;return t[0]=Math.cos(i)*a,t[1]=Math.sin(i)*a,t[2]=o*e,t},Wt.transformMat4=function(t,e,i){var o=e[0],a=e[1],l=e[2],h=i[3]*o+i[7]*a+i[11]*l+i[15];return t[0]=(i[0]*o+i[4]*a+i[8]*l+i[12])/(h=h||1),t[1]=(i[1]*o+i[5]*a+i[9]*l+i[13])/h,t[2]=(i[2]*o+i[6]*a+i[10]*l+i[14])/h,t},Wt.transformMat3=function(t,e,i){var o=e[0],a=e[1],l=e[2];return t[0]=o*i[0]+a*i[3]+l*i[6],t[1]=o*i[1]+a*i[4]+l*i[7],t[2]=o*i[2]+a*i[5]+l*i[8],t},Wt.transformQuat=function(t,e,i){var o=i[0],a=i[1],l=i[2],h=e[0],g=e[1],y=e[2],x=a*y-l*g,E=l*h-o*y,I=o*g-a*h,M=a*I-l*E,D=l*x-o*I,P=o*E-a*x,L=2*i[3];return E*=L,I*=L,D*=2,P*=2,t[0]=h+(x*=L)+(M*=2),t[1]=g+E+D,t[2]=y+I+P,t},Wt.rotateX=function(t,e,i,o){var a=[],l=[];return a[0]=e[0]-i[0],a[1]=e[1]-i[1],a[2]=e[2]-i[2],l[0]=a[0],l[1]=a[1]*Math.cos(o)-a[2]*Math.sin(o),l[2]=a[1]*Math.sin(o)+a[2]*Math.cos(o),t[0]=l[0]+i[0],t[1]=l[1]+i[1],t[2]=l[2]+i[2],t},Wt.rotateY=function(t,e,i,o){var a=[],l=[];return a[0]=e[0]-i[0],a[1]=e[1]-i[1],a[2]=e[2]-i[2],l[0]=a[2]*Math.sin(o)+a[0]*Math.cos(o),l[1]=a[1],l[2]=a[2]*Math.cos(o)-a[0]*Math.sin(o),t[0]=l[0]+i[0],t[1]=l[1]+i[1],t[2]=l[2]+i[2],t},Wt.rotateZ=function(t,e,i,o){var a=[],l=[];return a[0]=e[0]-i[0],a[1]=e[1]-i[1],a[2]=e[2]-i[2],l[0]=a[0]*Math.cos(o)-a[1]*Math.sin(o),l[1]=a[0]*Math.sin(o)+a[1]*Math.cos(o),l[2]=a[2],t[0]=l[0]+i[0],t[1]=l[1]+i[1],t[2]=l[2]+i[2],t},Wt.angle=function(t,e){var i=t[0],o=t[1],a=t[2],l=e[0],h=e[1],g=e[2],y=Math.sqrt(i*i+o*o+a*a)*Math.sqrt(l*l+h*h+g*g),x=y&&_t(t,e)/y;return Math.acos(Math.min(Math.max(x,-1),1))},Wt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Wt.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Wt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Wt.equals=function(t,e){var i=t[0],o=t[1],a=t[2],l=e[0],h=e[1],g=e[2];return Math.abs(i-l)<=Co.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(o-h)<=Co.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(a-g)<=Co.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))},Wt.forEach=Wt.sqrLen=Wt.len=Wt.sqrDist=Wt.dist=Wt.div=Wt.mul=Wt.sub=void 0;var Co=function(t,e){if(t&&t.__esModule)return t;if(t===null||Mo(t)!=="object"&&typeof t!="function")return{default:t};var i=et(void 0);if(i&&i.has(t))return i.get(t);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(o,l,h):o[l]=t[l]}return o.default=t,i&&i.set(t,o),o}(ni);function et(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(et=function(o){return o?i:e})(t)}function J(){var t=new Co.ARRAY_TYPE(3);return Co.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function se(t){return Math.hypot(t[0],t[1],t[2])}function _e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Ge(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function Ze(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function nt(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function Mt(t,e){var i=e[0]-t[0],o=e[1]-t[1],a=e[2]-t[2];return i*i+o*o+a*a}function Ve(t){var e=t[0],i=t[1],o=t[2];return e*e+i*i+o*o}function _t(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Wt.sub=_e,Wt.mul=Ge,Wt.div=Ze,Wt.dist=nt,Wt.sqrDist=Mt,Wt.len=se,Wt.sqrLen=Ve;var xt,Dt=(xt=J(),function(t,e,i,o,a,l){var h,g;for(e||(e=3),i||(i=0),g=o?Math.min(o*e+i,t.length):t.length,h=i;h<g;h+=e)xt[0]=t[h],xt[1]=t[h+1],xt[2]=t[h+2],a(xt,xt,l),t[h]=xt[0],t[h+1]=xt[1],t[h+2]=xt[2];return t});Wt.forEach=Dt;var mt={};function tn(t){return tn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tn(t)}Object.defineProperty(mt,"__esModule",{value:!0}),mt.create=Fi,mt.clone=function(t){var e=new Mi.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},mt.fromValues=function(t,e,i,o){var a=new Mi.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=i,a[3]=o,a},mt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},mt.set=function(t,e,i,o,a){return t[0]=e,t[1]=i,t[2]=o,t[3]=a,t},mt.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},mt.subtract=Ci,mt.multiply=Ji,mt.divide=yn,mt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},mt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},mt.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},mt.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},mt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},mt.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},mt.scaleAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t},mt.distance=En,mt.squaredDistance=an,mt.length=Lr,mt.squaredLength=Fr,mt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},mt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},mt.normalize=function(t,e){var i=e[0],o=e[1],a=e[2],l=e[3],h=i*i+o*o+a*a+l*l;return h>0&&(h=1/Math.sqrt(h)),t[0]=i*h,t[1]=o*h,t[2]=a*h,t[3]=l*h,t},mt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},mt.cross=function(t,e,i,o){var a=i[0]*o[1]-i[1]*o[0],l=i[0]*o[2]-i[2]*o[0],h=i[0]*o[3]-i[3]*o[0],g=i[1]*o[2]-i[2]*o[1],y=i[1]*o[3]-i[3]*o[1],x=i[2]*o[3]-i[3]*o[2],E=e[0],I=e[1],M=e[2],D=e[3];return t[0]=I*x-M*y+D*g,t[1]=-E*x+M*h-D*l,t[2]=E*y-I*h+D*a,t[3]=-E*g+I*l-M*a,t},mt.lerp=function(t,e,i,o){var a=e[0],l=e[1],h=e[2],g=e[3];return t[0]=a+o*(i[0]-a),t[1]=l+o*(i[1]-l),t[2]=h+o*(i[2]-h),t[3]=g+o*(i[3]-g),t},mt.random=function(t,e){var i,o,a,l,h,g;e=e||1;do h=(i=2*Mi.RANDOM()-1)*i+(o=2*Mi.RANDOM()-1)*o;while(h>=1);do g=(a=2*Mi.RANDOM()-1)*a+(l=2*Mi.RANDOM()-1)*l;while(g>=1);var y=Math.sqrt((1-h)/g);return t[0]=e*i,t[1]=e*o,t[2]=e*a*y,t[3]=e*l*y,t},mt.transformMat4=function(t,e,i){var o=e[0],a=e[1],l=e[2],h=e[3];return t[0]=i[0]*o+i[4]*a+i[8]*l+i[12]*h,t[1]=i[1]*o+i[5]*a+i[9]*l+i[13]*h,t[2]=i[2]*o+i[6]*a+i[10]*l+i[14]*h,t[3]=i[3]*o+i[7]*a+i[11]*l+i[15]*h,t},mt.transformQuat=function(t,e,i){var o=e[0],a=e[1],l=e[2],h=i[0],g=i[1],y=i[2],x=i[3],E=x*o+g*l-y*a,I=x*a+y*o-h*l,M=x*l+h*a-g*o,D=-h*o-g*a-y*l;return t[0]=E*x+D*-h+I*-y-M*-g,t[1]=I*x+D*-g+M*-h-E*-y,t[2]=M*x+D*-y+E*-g-I*-h,t[3]=e[3],t},mt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},mt.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},mt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},mt.equals=function(t,e){var i=t[0],o=t[1],a=t[2],l=t[3],h=e[0],g=e[1],y=e[2],x=e[3];return Math.abs(i-h)<=Mi.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-g)<=Mi.EPSILON*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(a-y)<=Mi.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(l-x)<=Mi.EPSILON*Math.max(1,Math.abs(l),Math.abs(x))},mt.forEach=mt.sqrLen=mt.len=mt.sqrDist=mt.dist=mt.div=mt.mul=mt.sub=void 0;var Mi=function(t,e){if(t&&t.__esModule)return t;if(t===null||tn(t)!=="object"&&typeof t!="function")return{default:t};var i=Ki(void 0);if(i&&i.has(t))return i.get(t);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(o,l,h):o[l]=t[l]}return o.default=t,i&&i.set(t,o),o}(ni);function Ki(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Ki=function(o){return o?i:e})(t)}function Fi(){var t=new Mi.ARRAY_TYPE(4);return Mi.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Ci(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function Ji(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function yn(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function En(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function an(t,e){var i=e[0]-t[0],o=e[1]-t[1],a=e[2]-t[2],l=e[3]-t[3];return i*i+o*o+a*a+l*l}function Lr(t){return Math.hypot(t[0],t[1],t[2],t[3])}function Fr(t){var e=t[0],i=t[1],o=t[2],a=t[3];return e*e+i*i+o*o+a*a}mt.sub=Ci,mt.mul=Ji,mt.div=yn,mt.dist=En,mt.sqrDist=an,mt.len=Lr,mt.sqrLen=Fr;var Uo=function(){var t=Fi();return function(e,i,o,a,l,h){var g,y;for(i||(i=4),o||(o=0),y=a?Math.min(a*i+o,e.length):e.length,g=o;g<y;g+=i)t[0]=e[g],t[1]=e[g+1],t[2]=e[g+2],t[3]=e[g+3],l(t,t,h),e[g]=t[0],e[g+1]=t[1],e[g+2]=t[2],e[g+3]=t[3];return e}}();function Yn(t){return Yn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yn(t)}mt.forEach=Uo,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.create=ut,Yt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Yt.setAxisAngle=ht,Yt.getAxisAngle=function(t,e){var i=2*Math.acos(e[3]),o=Math.sin(i/2);return o>Dn.EPSILON?(t[0]=e[0]/o,t[1]=e[1]/o,t[2]=e[2]/o):(t[0]=1,t[1]=0,t[2]=0),i},Yt.getAngle=function(t,e){var i=nn(t,e);return Math.acos(2*i*i-1)},Yt.multiply=rt,Yt.rotateX=function(t,e,i){i*=.5;var o=e[0],a=e[1],l=e[2],h=e[3],g=Math.sin(i),y=Math.cos(i);return t[0]=o*y+h*g,t[1]=a*y+l*g,t[2]=l*y-a*g,t[3]=h*y-o*g,t},Yt.rotateY=function(t,e,i){i*=.5;var o=e[0],a=e[1],l=e[2],h=e[3],g=Math.sin(i),y=Math.cos(i);return t[0]=o*y-l*g,t[1]=a*y+h*g,t[2]=l*y+o*g,t[3]=h*y-a*g,t},Yt.rotateZ=function(t,e,i){i*=.5;var o=e[0],a=e[1],l=e[2],h=e[3],g=Math.sin(i),y=Math.cos(i);return t[0]=o*y+a*g,t[1]=a*y-o*g,t[2]=l*y+h*g,t[3]=h*y-l*g,t},Yt.calculateW=function(t,e){var i=e[0],o=e[1],a=e[2];return t[0]=i,t[1]=o,t[2]=a,t[3]=Math.sqrt(Math.abs(1-i*i-o*o-a*a)),t},Yt.exp=ft,Yt.ln=at,Yt.pow=function(t,e,i){return at(t,e),Rt(t,t,i),ft(t,t),t},Yt.slerp=Ht,Yt.random=function(t){var e=Dn.RANDOM(),i=Dn.RANDOM(),o=Dn.RANDOM(),a=Math.sqrt(1-e),l=Math.sqrt(e);return t[0]=a*Math.sin(2*Math.PI*i),t[1]=a*Math.cos(2*Math.PI*i),t[2]=l*Math.sin(2*Math.PI*o),t[3]=l*Math.cos(2*Math.PI*o),t},Yt.invert=function(t,e){var i=e[0],o=e[1],a=e[2],l=e[3],h=i*i+o*o+a*a+l*l,g=h?1/h:0;return t[0]=-i*g,t[1]=-o*g,t[2]=-a*g,t[3]=l*g,t},Yt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Yt.fromMat3=mi,Yt.fromEuler=function(t,e,i,o){var a=.5*Math.PI/180;e*=a,i*=a,o*=a;var l=Math.sin(e),h=Math.cos(e),g=Math.sin(i),y=Math.cos(i),x=Math.sin(o),E=Math.cos(o);return t[0]=l*y*E-h*g*x,t[1]=h*g*E+l*y*x,t[2]=h*y*x-l*g*E,t[3]=h*y*E+l*g*x,t},Yt.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Yt.setAxes=Yt.sqlerp=Yt.rotationTo=Yt.equals=Yt.exactEquals=Yt.normalize=Yt.sqrLen=Yt.squaredLength=Yt.len=Yt.length=Yt.lerp=Yt.dot=Yt.scale=Yt.mul=Yt.add=Yt.set=Yt.copy=Yt.fromValues=Yt.clone=void 0;var Dn=tt(ni),Be=tt(Pi),je=tt(Wt),Ye=tt(mt);function st(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(st=function(o){return o?i:e})(t)}function tt(t,e){if(t&&t.__esModule)return t;if(t===null||Yn(t)!=="object"&&typeof t!="function")return{default:t};var i=st(e);if(i&&i.has(t))return i.get(t);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(o,l,h):o[l]=t[l]}return o.default=t,i&&i.set(t,o),o}function ut(){var t=new Dn.ARRAY_TYPE(4);return Dn.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function ht(t,e,i){i*=.5;var o=Math.sin(i);return t[0]=o*e[0],t[1]=o*e[1],t[2]=o*e[2],t[3]=Math.cos(i),t}function rt(t,e,i){var o=e[0],a=e[1],l=e[2],h=e[3],g=i[0],y=i[1],x=i[2],E=i[3];return t[0]=o*E+h*g+a*x-l*y,t[1]=a*E+h*y+l*g-o*x,t[2]=l*E+h*x+o*y-a*g,t[3]=h*E-o*g-a*y-l*x,t}function ft(t,e){var i=e[0],o=e[1],a=e[2],l=e[3],h=Math.sqrt(i*i+o*o+a*a),g=Math.exp(l),y=h>0?g*Math.sin(h)/h:0;return t[0]=i*y,t[1]=o*y,t[2]=a*y,t[3]=g*Math.cos(h),t}function at(t,e){var i=e[0],o=e[1],a=e[2],l=e[3],h=Math.sqrt(i*i+o*o+a*a),g=h>0?Math.atan2(h,l)/h:0;return t[0]=i*g,t[1]=o*g,t[2]=a*g,t[3]=.5*Math.log(i*i+o*o+a*a+l*l),t}function Ht(t,e,i,o){var a,l,h,g,y,x=e[0],E=e[1],I=e[2],M=e[3],D=i[0],P=i[1],L=i[2],N=i[3];return(l=x*D+E*P+I*L+M*N)<0&&(l=-l,D=-D,P=-P,L=-L,N=-N),1-l>Dn.EPSILON?(a=Math.acos(l),h=Math.sin(a),g=Math.sin((1-o)*a)/h,y=Math.sin(o*a)/h):(g=1-o,y=o),t[0]=g*x+y*D,t[1]=g*E+y*P,t[2]=g*I+y*L,t[3]=g*M+y*N,t}function mi(t,e){var i,o=e[0]+e[4]+e[8];if(o>0)i=Math.sqrt(o+1),t[3]=.5*i,t[0]=(e[5]-e[7])*(i=.5/i),t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[3*a+a]&&(a=2);var l=(a+1)%3,h=(a+2)%3;i=Math.sqrt(e[3*a+a]-e[3*l+l]-e[3*h+h]+1),t[a]=.5*i,t[3]=(e[3*l+h]-e[3*h+l])*(i=.5/i),t[l]=(e[3*l+a]+e[3*a+l])*i,t[h]=(e[3*h+a]+e[3*a+h])*i}return t}Yt.clone=Ye.clone,Yt.fromValues=Ye.fromValues,Yt.copy=Ye.copy,Yt.set=Ye.set,Yt.add=Ye.add,Yt.mul=rt;var Rt=Ye.scale;Yt.scale=Rt;var nn=Ye.dot;Yt.dot=nn,Yt.lerp=Ye.lerp;var Vi=Ye.length;Yt.length=Vi,Yt.len=Vi;var Rn=Ye.squaredLength;Yt.squaredLength=Rn,Yt.sqrLen=Rn;var qn=Ye.normalize;Yt.normalize=qn,Yt.exactEquals=Ye.exactEquals,Yt.equals=Ye.equals;var Bn,Ai,yo,vo=(Bn=je.create(),Ai=je.fromValues(1,0,0),yo=je.fromValues(0,1,0),function(t,e,i){var o=je.dot(e,i);return o<-.999999?(je.cross(Bn,Ai,e),je.len(Bn)<1e-6&&je.cross(Bn,yo,e),je.normalize(Bn,Bn),ht(t,Bn,Math.PI),t):o>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(je.cross(Bn,e,i),t[0]=Bn[0],t[1]=Bn[1],t[2]=Bn[2],t[3]=1+o,qn(t,t))});Yt.rotationTo=vo;var br,ss,Sa=(br=ut(),ss=ut(),function(t,e,i,o,a,l){return Ht(br,e,a,l),Ht(ss,i,o,l),Ht(t,br,ss,2*l*(1-l)),t});Yt.sqlerp=Sa;var Pr,yr=(Pr=Be.create(),function(t,e,i,o){return Pr[0]=i[0],Pr[3]=i[1],Pr[6]=i[2],Pr[1]=o[0],Pr[4]=o[1],Pr[7]=o[2],Pr[2]=-e[0],Pr[5]=-e[1],Pr[8]=-e[2],qn(t,mi(t,Pr))});Yt.setAxes=yr;var pi={};function cc(t){return cc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cc(t)}Object.defineProperty(pi,"__esModule",{value:!0}),pi.create=function(){var t=new Kn.ARRAY_TYPE(8);return Kn.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},pi.clone=function(t){var e=new Kn.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},pi.fromValues=function(t,e,i,o,a,l,h,g){var y=new Kn.ARRAY_TYPE(8);return y[0]=t,y[1]=e,y[2]=i,y[3]=o,y[4]=a,y[5]=l,y[6]=h,y[7]=g,y},pi.fromRotationTranslationValues=function(t,e,i,o,a,l,h){var g=new Kn.ARRAY_TYPE(8);g[0]=t,g[1]=e,g[2]=i,g[3]=o;var y=.5*a,x=.5*l,E=.5*h;return g[4]=y*o+x*i-E*e,g[5]=x*o+E*t-y*i,g[6]=E*o+y*e-x*t,g[7]=-y*t-x*e-E*i,g},pi.fromRotationTranslation=du,pi.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},pi.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},pi.fromMat4=function(t,e){var i=xr.create();kl.getRotation(i,e);var o=new Kn.ARRAY_TYPE(3);return kl.getTranslation(o,e),du(t,i,o),t},pi.copy=Dh,pi.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},pi.set=function(t,e,i,o,a,l,h,g,y){return t[0]=e,t[1]=i,t[2]=o,t[3]=a,t[4]=l,t[5]=h,t[6]=g,t[7]=y,t},pi.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},pi.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},pi.getTranslation=function(t,e){var i=e[4],o=e[5],a=e[6],l=e[7],h=-e[0],g=-e[1],y=-e[2],x=e[3];return t[0]=2*(i*x+l*h+o*y-a*g),t[1]=2*(o*x+l*g+a*h-i*y),t[2]=2*(a*x+l*y+i*g-o*h),t},pi.translate=function(t,e,i){var o=e[0],a=e[1],l=e[2],h=e[3],g=.5*i[0],y=.5*i[1],x=.5*i[2],E=e[4],I=e[5],M=e[6],D=e[7];return t[0]=o,t[1]=a,t[2]=l,t[3]=h,t[4]=h*g+a*x-l*y+E,t[5]=h*y+l*g-o*x+I,t[6]=h*x+o*y-a*g+M,t[7]=-o*g-a*y-l*x+D,t},pi.rotateX=function(t,e,i){var o=-e[0],a=-e[1],l=-e[2],h=e[3],g=e[4],y=e[5],x=e[6],E=e[7],I=g*h+E*o+y*l-x*a,M=y*h+E*a+x*o-g*l,D=x*h+E*l+g*a-y*o,P=E*h-g*o-y*a-x*l;return xr.rotateX(t,e,i),t[4]=I*(h=t[3])+P*(o=t[0])+M*(l=t[2])-D*(a=t[1]),t[5]=M*h+P*a+D*o-I*l,t[6]=D*h+P*l+I*a-M*o,t[7]=P*h-I*o-M*a-D*l,t},pi.rotateY=function(t,e,i){var o=-e[0],a=-e[1],l=-e[2],h=e[3],g=e[4],y=e[5],x=e[6],E=e[7],I=g*h+E*o+y*l-x*a,M=y*h+E*a+x*o-g*l,D=x*h+E*l+g*a-y*o,P=E*h-g*o-y*a-x*l;return xr.rotateY(t,e,i),t[4]=I*(h=t[3])+P*(o=t[0])+M*(l=t[2])-D*(a=t[1]),t[5]=M*h+P*a+D*o-I*l,t[6]=D*h+P*l+I*a-M*o,t[7]=P*h-I*o-M*a-D*l,t},pi.rotateZ=function(t,e,i){var o=-e[0],a=-e[1],l=-e[2],h=e[3],g=e[4],y=e[5],x=e[6],E=e[7],I=g*h+E*o+y*l-x*a,M=y*h+E*a+x*o-g*l,D=x*h+E*l+g*a-y*o,P=E*h-g*o-y*a-x*l;return xr.rotateZ(t,e,i),t[4]=I*(h=t[3])+P*(o=t[0])+M*(l=t[2])-D*(a=t[1]),t[5]=M*h+P*a+D*o-I*l,t[6]=D*h+P*l+I*a-M*o,t[7]=P*h-I*o-M*a-D*l,t},pi.rotateByQuatAppend=function(t,e,i){var o=i[0],a=i[1],l=i[2],h=i[3],g=e[0],y=e[1],x=e[2],E=e[3];return t[0]=g*h+E*o+y*l-x*a,t[1]=y*h+E*a+x*o-g*l,t[2]=x*h+E*l+g*a-y*o,t[3]=E*h-g*o-y*a-x*l,t[4]=(g=e[4])*h+(E=e[7])*o+(y=e[5])*l-(x=e[6])*a,t[5]=y*h+E*a+x*o-g*l,t[6]=x*h+E*l+g*a-y*o,t[7]=E*h-g*o-y*a-x*l,t},pi.rotateByQuatPrepend=function(t,e,i){var o=e[0],a=e[1],l=e[2],h=e[3],g=i[0],y=i[1],x=i[2],E=i[3];return t[0]=o*E+h*g+a*x-l*y,t[1]=a*E+h*y+l*g-o*x,t[2]=l*E+h*x+o*y-a*g,t[3]=h*E-o*g-a*y-l*x,t[4]=o*(E=i[7])+h*(g=i[4])+a*(x=i[6])-l*(y=i[5]),t[5]=a*E+h*y+l*g-o*x,t[6]=l*E+h*x+o*y-a*g,t[7]=h*E-o*g-a*y-l*x,t},pi.rotateAroundAxis=function(t,e,i,o){if(Math.abs(o)<Kn.EPSILON)return Dh(t,e);var a=Math.hypot(i[0],i[1],i[2]);o*=.5;var l=Math.sin(o),h=l*i[0]/a,g=l*i[1]/a,y=l*i[2]/a,x=Math.cos(o),E=e[0],I=e[1],M=e[2],D=e[3];t[0]=E*x+D*h+I*y-M*g,t[1]=I*x+D*g+M*h-E*y,t[2]=M*x+D*y+E*g-I*h,t[3]=D*x-E*h-I*g-M*y;var P=e[4],L=e[5],N=e[6],V=e[7];return t[4]=P*x+V*h+L*y-N*g,t[5]=L*x+V*g+N*h-P*y,t[6]=N*x+V*y+P*g-L*h,t[7]=V*x-P*h-L*g-N*y,t},pi.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t},pi.multiply=Rh,pi.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t},pi.lerp=function(t,e,i,o){var a=1-o;return Ph(e,i)<0&&(o=-o),t[0]=e[0]*a+i[0]*o,t[1]=e[1]*a+i[1]*o,t[2]=e[2]*a+i[2]*o,t[3]=e[3]*a+i[3]*o,t[4]=e[4]*a+i[4]*o,t[5]=e[5]*a+i[5]*o,t[6]=e[6]*a+i[6]*o,t[7]=e[7]*a+i[7]*o,t},pi.invert=function(t,e){var i=ol(e);return t[0]=-e[0]/i,t[1]=-e[1]/i,t[2]=-e[2]/i,t[3]=e[3]/i,t[4]=-e[4]/i,t[5]=-e[5]/i,t[6]=-e[6]/i,t[7]=e[7]/i,t},pi.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},pi.normalize=function(t,e){var i=ol(e);if(i>0){i=Math.sqrt(i);var o=e[0]/i,a=e[1]/i,l=e[2]/i,h=e[3]/i,g=e[4],y=e[5],x=e[6],E=e[7],I=o*g+a*y+l*x+h*E;t[0]=o,t[1]=a,t[2]=l,t[3]=h,t[4]=(g-o*I)/i,t[5]=(y-a*I)/i,t[6]=(x-l*I)/i,t[7]=(E-h*I)/i}return t},pi.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},pi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},pi.equals=function(t,e){var i=t[0],o=t[1],a=t[2],l=t[3],h=t[4],g=t[5],y=t[6],x=t[7],E=e[0],I=e[1],M=e[2],D=e[3],P=e[4],L=e[5],N=e[6],V=e[7];return Math.abs(i-E)<=Kn.EPSILON*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(o-I)<=Kn.EPSILON*Math.max(1,Math.abs(o),Math.abs(I))&&Math.abs(a-M)<=Kn.EPSILON*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(l-D)<=Kn.EPSILON*Math.max(1,Math.abs(l),Math.abs(D))&&Math.abs(h-P)<=Kn.EPSILON*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(g-L)<=Kn.EPSILON*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(y-N)<=Kn.EPSILON*Math.max(1,Math.abs(y),Math.abs(N))&&Math.abs(x-V)<=Kn.EPSILON*Math.max(1,Math.abs(x),Math.abs(V))},pi.sqrLen=pi.squaredLength=pi.len=pi.length=pi.dot=pi.mul=pi.setReal=pi.getReal=void 0;var Kn=Rs(ni),xr=Rs(Yt),kl=Rs(jt);function ia(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(ia=function(o){return o?i:e})(t)}function Rs(t,e){if(t&&t.__esModule)return t;if(t===null||cc(t)!=="object"&&typeof t!="function")return{default:t};var i=ia(e);if(i&&i.has(t))return i.get(t);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(o,l,h):o[l]=t[l]}return o.default=t,i&&i.set(t,o),o}function du(t,e,i){var o=.5*i[0],a=.5*i[1],l=.5*i[2],h=e[0],g=e[1],y=e[2],x=e[3];return t[0]=h,t[1]=g,t[2]=y,t[3]=x,t[4]=o*x+a*y-l*g,t[5]=a*x+l*h-o*y,t[6]=l*x+o*g-a*h,t[7]=-o*h-a*g-l*y,t}function Dh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Rh(t,e,i){var o=e[0],a=e[1],l=e[2],h=e[3],g=i[4],y=i[5],x=i[6],E=i[7],I=e[4],M=e[5],D=e[6],P=e[7],L=i[0],N=i[1],V=i[2],Z=i[3];return t[0]=o*Z+h*L+a*V-l*N,t[1]=a*Z+h*N+l*L-o*V,t[2]=l*Z+h*V+o*N-a*L,t[3]=h*Z-o*L-a*N-l*V,t[4]=o*E+h*g+a*x-l*y+I*Z+P*L+M*V-D*N,t[5]=a*E+h*y+l*g-o*x+M*Z+P*N+D*L-I*V,t[6]=l*E+h*x+o*y-a*g+D*Z+P*V+I*N-M*L,t[7]=h*E-o*g-a*y-l*x+P*Z-I*L-M*N-D*V,t}pi.getReal=xr.copy,pi.setReal=xr.copy,pi.mul=Rh;var Ph=xr.dot;pi.dot=Ph;var pu=xr.length;pi.length=pu,pi.len=pu;var ol=xr.squaredLength;pi.squaredLength=ol,pi.sqrLen=ol;var ri={};function uc(t){return uc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},uc(t)}Object.defineProperty(ri,"__esModule",{value:!0}),ri.create=Oh,ri.clone=function(t){var e=new Ma.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},ri.fromValues=function(t,e){var i=new Ma.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},ri.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},ri.set=function(t,e,i){return t[0]=e,t[1]=i,t},ri.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},ri.subtract=Ol,ri.multiply=A,ri.divide=z,ri.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},ri.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},ri.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},ri.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},ri.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},ri.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},ri.scaleAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t},ri.distance=K,ri.squaredDistance=fe,ri.length=ve,ri.squaredLength=we,ri.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},ri.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},ri.normalize=function(t,e){var i=e[0],o=e[1],a=i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t},ri.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},ri.cross=function(t,e,i){var o=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=o,t},ri.lerp=function(t,e,i,o){var a=e[0],l=e[1];return t[0]=a+o*(i[0]-a),t[1]=l+o*(i[1]-l),t},ri.random=function(t,e){e=e||1;var i=2*Ma.RANDOM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},ri.transformMat2=function(t,e,i){var o=e[0],a=e[1];return t[0]=i[0]*o+i[2]*a,t[1]=i[1]*o+i[3]*a,t},ri.transformMat2d=function(t,e,i){var o=e[0],a=e[1];return t[0]=i[0]*o+i[2]*a+i[4],t[1]=i[1]*o+i[3]*a+i[5],t},ri.transformMat3=function(t,e,i){var o=e[0],a=e[1];return t[0]=i[0]*o+i[3]*a+i[6],t[1]=i[1]*o+i[4]*a+i[7],t},ri.transformMat4=function(t,e,i){var o=e[0],a=e[1];return t[0]=i[0]*o+i[4]*a+i[12],t[1]=i[1]*o+i[5]*a+i[13],t},ri.rotate=function(t,e,i,o){var a=e[0]-i[0],l=e[1]-i[1],h=Math.sin(o),g=Math.cos(o);return t[0]=a*g-l*h+i[0],t[1]=a*h+l*g+i[1],t},ri.angle=function(t,e){var i=t[0],o=t[1],a=e[0],l=e[1],h=Math.sqrt(i*i+o*o)*Math.sqrt(a*a+l*l);return Math.acos(Math.min(Math.max(h&&(i*a+o*l)/h,-1),1))},ri.zero=function(t){return t[0]=0,t[1]=0,t},ri.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},ri.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},ri.equals=function(t,e){var i=t[0],o=t[1],a=e[0],l=e[1];return Math.abs(i-a)<=Ma.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(o-l)<=Ma.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))},ri.forEach=ri.sqrLen=ri.sqrDist=ri.dist=ri.div=ri.mul=ri.sub=ri.len=void 0;var Ma=function(t,e){if(t&&t.__esModule)return t;if(t===null||uc(t)!=="object"&&typeof t!="function")return{default:t};var i=kh(void 0);if(i&&i.has(t))return i.get(t);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(o,l,h):o[l]=t[l]}return o.default=t,i&&i.set(t,o),o}(ni);function kh(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(kh=function(o){return o?i:e})(t)}function Oh(){var t=new Ma.ARRAY_TYPE(2);return Ma.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function Ol(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function A(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function z(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function K(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function fe(t,e){var i=e[0]-t[0],o=e[1]-t[1];return i*i+o*o}function ve(t){return Math.hypot(t[0],t[1])}function we(t){var e=t[0],i=t[1];return e*e+i*i}ri.len=ve,ri.sub=Ol,ri.mul=A,ri.div=z,ri.dist=K,ri.sqrDist=fe,ri.sqrLen=we;var Ae=function(){var t=Oh();return function(e,i,o,a,l,h){var g,y;for(i||(i=2),o||(o=0),y=a?Math.min(a*i+o,e.length):e.length,g=o;g<y;g+=i)t[0]=e[g],t[1]=e[g+1],l(t,t,h),e[g]=t[0],e[g+1]=t[1];return e}}();function dt(t){return dt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dt(t)}ri.forEach=Ae,Object.defineProperty(Xt,"__esModule",{value:!0}),r.aa=Xt.vec4=r.Q=Xt.vec3=Xt.vec2=Xt.quat2=r.bl=Xt.quat=r.a9=Xt.mat4=r.ct=Xt.mat3=Xt.mat2d=r.b7=Xt.mat2=Xt.glMatrix=void 0;var wt=Pn(ni);Xt.glMatrix=wt;var Lt=Pn(Ni);r.b7=Xt.mat2=Lt;var Ft=Pn(un);Xt.mat2d=Ft;var ze=Pn(Pi);r.ct=Xt.mat3=ze;var fi=Pn(jt);r.a9=Xt.mat4=fi;var kt=Pn(Yt);r.bl=Xt.quat=kt;var bi=Pn(pi);Xt.quat2=bi;var qt=Pn(ri);Xt.vec2=qt;var ot=Pn(Wt);r.Q=Xt.vec3=ot;var Zt=Pn(mt);function Tt(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Tt=function(o){return o?i:e})(t)}function Pn(t,e){if(t&&t.__esModule)return t;if(t===null||dt(t)!=="object"&&typeof t!="function")return{default:t};var i=Tt(e);if(i&&i.has(t))return i.get(t);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(o,l,h):o[l]=t[l]}return o.default=t,i&&i.set(t,o),o}r.aa=Xt.vec4=Zt;var cr=Ps;function Ps(t,e,i,o){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=o}Ps.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,o=0;o<8;o++){var a=this.sampleCurveX(i)-t;if(Math.abs(a)<e)return i;var l=this.sampleCurveDerivativeX(i);if(Math.abs(l)<1e-6)break;i-=a/l}var h=0,g=1;for(i=t,o=0;o<20&&(a=this.sampleCurveX(i),!(Math.abs(a-t)<e));o++)t>a?h=i:g=i,i=.5*(g-h)+h;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Lh=sn(cr),Sn=Ao;function Ao(t,e){this.x=t,this.y=e}Ao.prototype={clone:function(){return new Ao(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),o=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=o,this},_rotateAround:function(t,e){var i=Math.cos(t),o=Math.sin(t),a=e.y+o*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-o*(this.y-e.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ao.convert=function(t){return t instanceof Ao?t:Array.isArray(t)?new Ao(t[0],t[1]):t};var ct=sn(Sn);let Go=Math.PI/180,hc=180/Math.PI;function Si(t){return t*Go}function zr(t){return t*hc}let dc=[[0,0],[1,0],[1,1],[0,1]];function Ll(t){if(t<=0)return 0;if(t>=1)return 1;let e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function fu(t,e,i,o){let a=new Lh(t,e,i,o);return function(l){return a.solve(l)}}let qo=fu(.25,.1,.25,1);function gi(t,e,i){return Math.min(i,Math.max(e,t))}function Fl(t,e,i){return(i=gi((i-t)/(e-t),0,1))*i*(3-2*i)}function as(t,e,i){let o=i-e,a=((t-e)%o+o)%o+e;return a===e?i:a}function pc(t,e,i){if(!t.length)return i(null,[]);let o=t.length,a=new Array(t.length),l=null;t.forEach((h,g)=>{e(h,(y,x)=>{y&&(l=y),a[g]=x,--o==0&&i(l,a)})})}function bo(t,...e){for(let i of e)for(let o in i)t[o]=i[o];return t}let Fh=1;function zi(){return Fh++}function Ca(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function zl(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function mu(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Do(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function na(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Aa(t,e,i){let o={};for(let a in t)o[a]=e.call(this,t[a],a,t);return o}function Bl(t,e,i){let o={};for(let a in t)e.call(this,t[a],a,t)&&(o[a]=t[a]);return o}function ls(t){return Array.isArray(t)?t.map(ls):typeof t=="object"&&t?Aa(t,ls):t}let sl={};function Mn(t){sl[t]||(typeof console<"u"&&console.warn(t),sl[t]=!0)}function ks(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function Nl(t){let e=0;for(let i,o,a=0,l=t.length,h=l-1;a<l;h=a++)i=t[a],o=t[h],e+=(o.x-i.x)*(i.y+o.y);return e}function $o([t,e,i]){let o=Si(e+90),a=Si(i);return{x:t*Math.cos(o)*Math.sin(a),y:t*Math.sin(o)*Math.sin(a),z:t*Math.cos(a),azimuthal:e,polar:i}}function cs(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function xo(t){let e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,o,a,l)=>{let h=a||l;return e[o]=!h||h.toLowerCase(),""}),e["max-age"]){let i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let fc,al,ra,Da,us,oa,sa=null;function gu(t){try{let e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Ra(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function Pa(t,e,i,o){for(;e<i;){let a=e+i>>1;t[a]<o?e=a+1:i=a}return e}function _u(t,e,i,o){for(;e<i;){let a=e+i>>1;t[a]<=o?e=a+1:i=a}return e}function Wo(t){return t>0?1/(1.001-t):1+t}function yu(t){return t>0?1-1/(1.001-t):-t}function ll(){return fc==null&&(fc=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),fc}let Br={now:()=>Da!==void 0?Da:performance.now(),setNow(t){Da=t},restoreNow(){Da=void 0},frame(t){let e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){let{width:i,height:o}=t;us||(us=document.createElement("canvas"));let a=us.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(i>us.width||o>us.height)&&(us.width=i,us.height=o),a.clearRect(-e,-e,i+2*e,o+2*e),a.drawImage(t,0,0,i,o),a.getImageData(-e,-e,i+2*e,o+2*e)},resolveURL:t=>(al||(al=document.createElement("a")),al.href=t,al.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(ra==null&&(ra=window.matchMedia("(prefers-reduced-motion: reduce)")),ra.matches)},hasCanvasFingerprintNoise(){if(oa!==void 0)return oa;if(!ll())return oa=!1,!1;let t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0}),i=0;for(let a=0;a<t.width;++a)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(a,0,1,1);let o=e.getImageData(0,0,t.width,t.height);i=0;for(let a=0;a<o.data.length;++a)if(a%4!=3&&i++!==o.data[a])return oa=!0,!0;return oa=!1,!1}};function Ro(t,e){let i=t.indexOf("?");if(i<0)return`${t}?${new URLSearchParams(e).toString()}`;let o=new URLSearchParams(t.slice(i));for(let a in e)o.set(a,e[a]);return`${t.slice(0,i)}?${o.toString()}`}function hs(t,e={persistentParams:[]}){let i=t.indexOf("?");if(i<0)return t;let o=new URLSearchParams,a=new URLSearchParams(t.slice(i));for(let h of e.persistentParams){let g=a.get(h);g&&o.set(h,g)}let l=o.toString();return`${t.slice(0,i)}${l.length>0?`?${l}`:""}`}let Os="mapbox-tiles",Zo=500,zh=50,Po,aa;function mc(){try{return caches}catch{}}function ka(){let t=mc();t&&!Po&&(Po=t.open(Os))}let vu=1/0,Oa={supported:!1,testSupport:function(t){!ul&&La&&(Fa?Ls(t):cl=t)}},cl,La,ul=!1,Fa=!1,Bh=typeof self<"u"?self:{};function Ls(t){let e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,La),t.isContextLost())return;Oa.supported=!0}catch{}t.deleteTexture(e),ul=!0}Bh.document&&(La=Bh.document.createElement("img"),La.onload=function(){cl&&Ls(cl),cl=null,Fa=!0},La.onerror=function(){ul=!0,cl=null},La.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let gc={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(gc);class ds extends Error{constructor(e,i,o){i===401&&de(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let za=cs()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Vl=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(za())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(o,a){let l=new AbortController,h=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:za(),referrerPolicy:o.referrerPolicy,signal:l.signal}),g=!1,y=!1,x=(E=h.url).indexOf("sku=")>0&&de(E);var E;o.type==="json"&&h.headers.set("Accept","application/json");let I=(D,P,L)=>{if(y)return;if(D&&D.message!=="SecurityError"&&Mn(D.toString()),P&&L)return M(P);let N=Date.now();fetch(h).then(V=>{if(V.ok){let Z=x?V.clone():null;return M(V,Z,N)}return a(new ds(V.statusText,V.status,o.url))}).catch(V=>{V.name!=="AbortError"&&a(new Error(`${V.message} ${o.url}`))})},M=(D,P,L)=>{(o.type==="arrayBuffer"?D.arrayBuffer():o.type==="json"?D.json():D.text()).then(N=>{y||(P&&L&&function(V,Z,Y){if(ka(),!Po)return;let Q=xo(Z.headers.get("Cache-Control")||"");if(Q["no-store"])return;let ae={status:Z.status,statusText:Z.statusText,headers:new Headers};Z.headers.forEach((he,be)=>ae.headers.set(be,he)),Q["max-age"]&&ae.headers.set("Expires",new Date(Y+1e3*Q["max-age"]).toUTCString());let te=ae.headers.get("Expires");if(!te||new Date(te).getTime()-Y<42e4)return;let ce=hs(V.url,{persistentParams:["language","worldview"]});if(Z.status===206){let he=V.headers.get("Range");if(!he)return;ae.status=200,ce=Ro(ce,{range:he})}(function(he,be){if(aa===void 0)try{new Response(new ReadableStream),aa=!0}catch{aa=!1}aa?be(he.body):he.blob().then(be)})(Z,he=>{let be=new Response(he,ae);ka(),Po&&Po.then(Pe=>Pe.put(ce,be)).catch(Pe=>Mn(Pe.message))})}(h,P,L),g=!0,a(null,N,D.headers.get("Cache-Control"),D.headers.get("Expires")))}).catch(N=>{y||a(new Error(N.message))})};return x?function(D,P){if(ka(),!Po)return P(null);Po.then(L=>{let N=hs(D.url,{persistentParams:["language","worldview"]}),V=D.headers.get("Range");V&&(N=Ro(N,{range:V})),L.match(N).then(Z=>{let Y=function(Q){if(!Q)return!1;let ae=new Date(Q.headers.get("Expires")||0),te=xo(Q.headers.get("Cache-Control")||"");return ae>Date.now()&&!te["no-cache"]}(Z);L.delete(N),Y&&L.put(N,Z.clone()),P(null,Z,Y)}).catch(P)}).catch(P)}(h,I):I(null,null),{cancel:()=>{y=!0,g||l.abort()}}}(t,e);if(cs()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(o,a){let l=new XMLHttpRequest;l.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(l.responseType="arraybuffer");for(let h in o.headers)l.setRequestHeader(h,o.headers[h]);return o.type==="json"&&(l.responseType="text",l.setRequestHeader("Accept","application/json")),l.withCredentials=o.credentials==="include",l.onerror=()=>{a(new Error(l.statusText))},l.onload=()=>{if((l.status>=200&&l.status<300||l.status===0)&&l.response!==null){let h=l.response;if(o.type==="json")try{h=JSON.parse(l.response)}catch(g){return a(g)}a(null,h,l.getResponseHeader("Cache-Control"),l.getResponseHeader("Expires"))}else a(new ds(l.statusText,l.status,o.url))},l.send(o.body),{cancel:()=>l.abort()}}(t,e)},la=function(t,e){return Vl(bo(t,{type:"arrayBuffer"}),e)};function jl(t){let e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}let bu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Ul,hl;Ul=[],hl=0;let Ba=function(t,e){if(Oa.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),hl>=ee.MAX_PARALLEL_IMAGE_REQUESTS){let l={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ul.push(l),l}hl++;let i=!1,o=()=>{if(!i)for(i=!0,hl--;Ul.length&&hl<ee.MAX_PARALLEL_IMAGE_REQUESTS;){let l=Ul.shift(),{requestParameters:h,callback:g,cancelled:y}=l;y||(l.cancel=Ba(h,g).cancel)}},a=la(t,(l,h,g,y)=>{o(),l?e(l):h&&(self.createImageBitmap?function(x,E){let I=new Blob([new Uint8Array(x)],{type:"image/png"});createImageBitmap(I).then(M=>{E(null,M)}).catch(M=>{E(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(h,(x,E)=>e(x,E,g,y)):function(x,E){let I=new Image;I.onload=()=>{E(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=bu})},I.onerror=()=>E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let M=new Blob([new Uint8Array(x)],{type:"image/png"});I.src=x.byteLength?URL.createObjectURL(M):bu}(h,(x,E)=>e(x,E,g,y)))});return{cancel:()=>{a.cancel(),o()}}},dl="01",_c="NO_ACCESS_TOKEN",Ce=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function We(t){let e=t.match(Ce);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Ct(t){let e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}let Kt="mapbox.eventData";function kn(t){if(!t)return null;let e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class ji{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let i=kn(ee.ACCESS_TOKEN),o="";return o=i&&i.u?btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(a,l)=>String.fromCharCode(+("0x"+l)))):ee.ACCESS_TOKEN||"",e?`${Kt}.${e}:${o}`:`${Kt}:${o}`}fetchEventData(){let e=gu("localStorage"),i=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{let a=localStorage.getItem(i);a&&(this.eventData=JSON.parse(a));let l=localStorage.getItem(o);l&&(this.anonId=l)}catch{Mn("Unable to read from LocalStorage")}}saveEventData(){let e=gu("localStorage"),i=this.getStorageKey(),o=this.getStorageKey("uuid"),a=this.anonId;if(e&&a)try{localStorage.setItem(o,a),Object.keys(this.eventData).length>=1&&localStorage.setItem(i,JSON.stringify(this.eventData))}catch{Mn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,o,a){if(!ee.EVENTS_URL)return;let l=We(ee.EVENTS_URL);l.params.push(`access_token=${a||ee.ACCESS_TOKEN||""}`);let h={event:this.type,created:new Date(e).toISOString()},g=i?bo(h,i):h,y={url:Ct(l),headers:{"Content-Type":"text/plain"},body:JSON.stringify([g])};this.pendingRequest=function(x,E){return Vl(bo(x,{method:"POST"}),E)}(y,x=>{this.pendingRequest=null,o(x),this.saveEventData(),this.processRequests(a)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}let Un=new class extends ji{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){ee.EVENTS_URL&&ee.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>Ie(i)||de(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=kn(ee.ACCESS_TOKEN),i=e?e.u:ee.ACCESS_TOKEN,o=i!==this.eventData.tokenU;mu(this.anonId)||(this.anonId=Ca(),o=!0);let a=this.queue.shift();if(this.eventData.lastSuccess){let l=new Date(this.eventData.lastSuccess),h=new Date(a),g=(a-this.eventData.lastSuccess)/864e5;o=o||g>=1||g<-1||l.getDate()!==h.getDate()}else o=!0;o?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:dl,"enabled.telemetry":!1,userId:this.anonId},l=>{l||(this.eventData.lastSuccess=a,this.eventData.tokenU=i)},t):this.processRequests()}},hn=Un.postTurnstileEvent.bind(Un),wr=new class extends ji{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,o){this.skuToken=e,this.errorCb=o,ee.EVENTS_URL&&(i||ee.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(_c)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),mu(this.anonId)||(this.anonId=Ca()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:dl,skuToken:this.skuToken,userId:this.anonId},o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},pn=wr.postMapLoadEvent.bind(wr),ur=new class extends ji{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let e=this.mapInstanceIdMap.get(t);return e||(e=Ca(),this.mapInstanceIdMap.set(t,e)),e}getEventId(t){let e=this.eventIdPerMapInstanceMap.get(t)||0;return this.eventIdPerMapInstanceMap.set(t,e+1),e}postStyleLoadEvent(t,e){let{map:i,style:o,importedStyles:a}=e;if(!ee.EVENTS_URL||!t&&!ee.ACCESS_TOKEN)return;let l=this.getMapInstanceId(i),h={mapInstanceId:l,eventId:this.getEventId(l),style:o};a.length&&(h.importedStyles=a),this.queueRequest({timestamp:Date.now(),payload:h},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,payload:i}=this.queue.shift();this.postEvent(e,i,()=>{},t)}},ps=ur.postStyleLoadEvent.bind(ur),fs=new class extends ji{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){ee.EVENTS_URL&&(t||ee.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:i}=this.queue.shift(),o=function(a){let l=performance.getEntriesByType("resource"),h=performance.getEntriesByType("mark"),g=function(D){let P={};if(D){for(let L in D)if(L!=="other")for(let N of D[L]){let V=`${L}ResolveRangeMin`,Z=`${L}ResolveRangeMax`,Y=`${L}RequestCount`,Q=`${L}RequestCachedCount`;P[V]=Math.min(P[V]||1/0,N.startTime),P[Z]=Math.max(P[Z]||-1/0,N.responseEnd);let ae=te=>{P[te]===void 0&&(P[te]=0),++P[te]};N.transferSize!==void 0&&N.transferSize===0&&ae(Q),ae(Y)}}return P}(function(D,P){let L={};if(D)for(let N of D){let V=P(N);L[V]===void 0&&(L[V]=[]),L[V].push(N)}return L}(l,Ei)),y=window.devicePixelRatio,x=navigator.connection||navigator.mozConnection||navigator.webkitConnection,E=x?x.effectiveType:void 0,I={counters:[],metadata:[],attributes:[]},M=(D,P,L)=>{L!=null&&D.push({name:P,value:L.toString()})};for(let D in g)M(I.counters,D,g[D]);if(a.interactionRange[0]!==1/0&&a.interactionRange[1]!==-1/0&&(M(I.counters,"interactionRangeMin",a.interactionRange[0]),M(I.counters,"interactionRangeMax",a.interactionRange[1])),h)for(let D of Object.keys(Gt)){let P=Gt[D],L=h.find(N=>N.name===P);L&&M(I.counters,P,L.startTime)}return M(I.counters,"visibilityHidden",a.visibilityHidden),M(I.attributes,"style",function(D){if(D)for(let P of D){let L=P.name.split("?")[0];if(it(L)){let N=L.split("/").slice(-2);if(N.length===2)return`mapbox://styles/${N[0]}/${N[1]}`}}}(l)),M(I.attributes,"terrainEnabled",a.terrainEnabled?"true":"false"),M(I.attributes,"fogEnabled",a.fogEnabled?"true":"false"),M(I.attributes,"projection",a.projection),M(I.attributes,"zoom",a.zoom),M(I.metadata,"devicePixelRatio",y),M(I.metadata,"connectionEffectiveType",E),M(I.metadata,"navigatorUserAgent",navigator.userAgent),M(I.metadata,"screenWidth",window.screen.width),M(I.metadata,"screenHeight",window.screen.height),M(I.metadata,"windowWidth",window.innerWidth),M(I.metadata,"windowHeight",window.innerHeight),M(I.metadata,"mapWidth",a.width/y),M(I.metadata,"mapHeight",a.height/y),M(I.metadata,"webglRenderer",a.renderer),M(I.metadata,"webglVendor",a.vendor),M(I.metadata,"sdkVersion",k),M(I.metadata,"sdkIdentifier","mapbox-gl-js"),I}(i);for(let a of o.metadata);for(let a of o.counters);for(let a of o.attributes);this.postEvent(e,o,()=>{},t)}},Tr=fs.postPerformanceEvent.bind(fs),ko=new class extends ji{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,o){if(!ee.API_URL||!ee.SESSION_PATH)return;let a=We(ee.API_URL+ee.SESSION_PATH);a.params.push(`sku=${e||""}`),a.params.push(`access_token=${o||ee.ACCESS_TOKEN||""}`);let l={url:Ct(a),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(h,g){return Vl(bo(h,{method:"GET"}),g)}(l,h=>{this.pendingRequest=null,i(h),this.saveEventData(),this.processRequests(o)})}getSessionAPI(t,e,i,o){this.skuToken=e,this.errorCb=o,ee.SESSION_PATH&&ee.API_URL&&(i||ee.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(_c)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},ca=ko.getSessionAPI.bind(ko),Na=new Set;var Wr={exports:{}},pl={exports:{}};pl.exports=function(t,e){var i,o,a,l,h,g,y,x;for(o=t.length-(i=3&t.length),a=e,h=3432918353,g=461845907,x=0;x<o;)y=255&t.charCodeAt(x)|(255&t.charCodeAt(++x))<<8|(255&t.charCodeAt(++x))<<16|(255&t.charCodeAt(++x))<<24,++x,a=27492+(65535&(l=5*(65535&(a=(a^=y=(65535&(y=(y=(65535&y)*h+(((y>>>16)*h&65535)<<16)&4294967295)<<15|y>>>17))*g+(((y>>>16)*g&65535)<<16)&4294967295)<<13|a>>>19))+((5*(a>>>16)&65535)<<16)&4294967295))+((58964+(l>>>16)&65535)<<16);switch(y=0,i){case 3:y^=(255&t.charCodeAt(x+2))<<16;case 2:y^=(255&t.charCodeAt(x+1))<<8;case 1:a^=y=(65535&(y=(y=(65535&(y^=255&t.charCodeAt(x)))*h+(((y>>>16)*h&65535)<<16)&4294967295)<<15|y>>>17))*g+(((y>>>16)*g&65535)<<16)&4294967295}return a^=t.length,a=2246822507*(65535&(a^=a>>>16))+((2246822507*(a>>>16)&65535)<<16)&4294967295,a=3266489909*(65535&(a^=a>>>13))+((3266489909*(a>>>16)&65535)<<16)&4294967295,(a^=a>>>16)>>>0};var Nh=pl.exports,xu={exports:{}};xu.exports=function(t,e){for(var i,o=t.length,a=e^o,l=0;o>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(l)|(255&t.charCodeAt(++l))<<8|(255&t.charCodeAt(++l))<<16|(255&t.charCodeAt(++l))<<24))+((1540483477*(i>>>16)&65535)<<16),a=1540483477*(65535&a)+((1540483477*(a>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),o-=4,++l;switch(o){case 3:a^=(255&t.charCodeAt(l+2))<<16;case 2:a^=(255&t.charCodeAt(l+1))<<8;case 1:a=1540483477*(65535&(a^=255&t.charCodeAt(l)))+((1540483477*(a>>>16)&65535)<<16)}return a=1540483477*(65535&(a^=a>>>13))+((1540483477*(a>>>16)&65535)<<16),(a^=a>>>15)>>>0};var wu=Nh,Qi=xu.exports;Wr.exports=wu,Wr.exports.murmur3=wu,Wr.exports.murmur2=Qi;var dn=sn(Wr.exports);function fl(t,e,i){i[t]&&i[t].indexOf(e)!==-1||(i[t]=i[t]||[],i[t].push(e))}function Ho(t,e,i){if(i&&i[t]){let o=i[t].indexOf(e);o!==-1&&i[t].splice(o,1)}}class ms{constructor(e,i={}){bo(this,i),this.type=e}}class Zr extends ms{constructor(e,i={}){super("error",bo({error:e},i))}}class Hr{on(e,i){return this._listeners=this._listeners||{},fl(e,i,this._listeners),this}off(e,i){return Ho(e,i,this._listeners),Ho(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},fl(e,i,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,i){typeof e=="string"&&(e=new ms(e,i||{}));let o=e.type;if(this.listens(o)){e.target=this;let a=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(let g of a)g.call(this,e);let l=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(let g of l)Ho(o,g,this._oneTimeListeners),g.call(this,e);let h=this._eventedParent;h&&(bo(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),h.fire(e))}else e instanceof Zr&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}r.z=void 0;var gs={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Fs(t){return(t=Math.round(t))<0?0:t>255?255:t}function Va(t){return Fs(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function _s(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function ys(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{r.z={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in gs)return gs[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var o=i.indexOf("("),a=i.indexOf(")");if(o!==-1&&a+1===i.length){var l=i.substr(0,o),h=i.substr(o+1,a-(o+1)).split(","),g=1;switch(l){case"rgba":if(h.length!==4)return null;g=_s(h.pop());case"rgb":return h.length!==3?null:[Va(h[0]),Va(h[1]),Va(h[2]),g];case"hsla":if(h.length!==4)return null;g=_s(h.pop());case"hsl":if(h.length!==3)return null;var y=(parseFloat(h[0])%360+360)%360/360,x=_s(h[1]),E=_s(h[2]),I=E<=.5?E*(x+1):E+x-E*x,M=2*E-I;return[Fs(255*ys(M,I,y+1/3)),Fs(255*ys(M,I,y)),Fs(255*ys(M,I,y-1/3)),g];default:return null}}return null}}catch{}class Wi{constructor(e,i,o,a=1){this.r=e,this.g=i,this.b=o,this.a=a}static parse(e){if(!e)return;if(e instanceof Wi)return e;if(typeof e!="string")return;let i=r.z(e);return i?new Wi(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){let[e,i,o,a]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(o)},${a})`}toArray(){let{r:e,g:i,b:o,a}=this;return a===0?[0,0,0,0]:[255*e/a,255*i/a,255*o/a,a]}toArray01(){let{r:e,g:i,b:o,a}=this;return a===0?[0,0,0,0]:[e/a,i/a,o/a,a]}toArray01Scaled(e){let{r:i,g:o,b:a,a:l}=this;return l===0?[0,0,0]:[i/l*e,o/l*e,a/l*e]}toArray01PremultipliedAlpha(){let{r:e,g:i,b:o,a}=this;return[e,i,o,a]}toArray01Linear(){let{r:e,g:i,b:o,a}=this;return a===0?[0,0,0,0]:[Math.pow(e/a,2.2),Math.pow(i/a,2.2),Math.pow(o/a,2.2),a]}}function si(t,e,i){return t*(1-i)+e*i}function ja(t,e,i){return t.map((o,a)=>si(o,e[a],i))}Wi.black=new Wi(0,0,0,1),Wi.white=new Wi(1,1,1,1),Wi.transparent=new Wi(0,0,0,0),Wi.red=new Wi(1,0,0,1),Wi.blue=new Wi(0,0,1,1);var ua=Object.freeze({__proto__:null,array:ja,color:function(t,e,i){return new Wi(si(t.r,e.r,i),si(t.g,e.g,i),si(t.b,e.b,i),si(t.a,e.a,i))},number:si});function Ua(t,...e){for(let i of e)for(let o in i)t[o]=i[o];return t}class Oo extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Qo{constructor(e,i=[]){this.parent=e,this.bindings={};for(let[o,a]of i)this.bindings[o]=a}concat(e){return new Qo(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let ci={kind:"null"},vt={kind:"number"},Zi={kind:"string"},Hi={kind:"boolean"},Xo={kind:"color"},yc={kind:"object"},Li={kind:"value"},Tu={kind:"collator"},vc={kind:"formatted"},bc={kind:"resolvedImage"};function kr(t,e){return{kind:"array",itemType:t,N:e}}function Zn(t){if(t.kind==="array"){let e=Zn(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}let rm=[ci,vt,Zi,Hi,Xo,vc,yc,kr(Li),bc];function Eu(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Eu(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(let i of rm)if(!Eu(i,e))return null}}return`Expected ${Zn(t)} but found ${Zn(e)} instead.`}function Iu(t,e){return e.some(i=>i.kind===t.kind)}function Gl(t,e){return e.some(i=>i==="null"?t===null:i==="array"?Array.isArray(t):i==="object"?t&&!Array.isArray(t)&&typeof t=="object":i===typeof t)}class ap{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Vh{constructor(e,i,o,a,l){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=o,this.fontStack=a,this.textColor=l}}class Qr{constructor(e){this.sections=e}static fromString(e){return new Qr([new Vh(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof Qr?e:Qr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let i of this.sections){if(i.image){e.push(["image",i.image.namePrimary]);continue}e.push(i.text);let o={};i.fontStack&&(o["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(o["font-scale"]=i.scale),i.textColor&&(o["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(o)}return e}}class Yo{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,i){return e?new Yo({namePrimary:e,nameSecondary:i,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function om(t,e,i,o){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[t,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[t,e,i,o]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function xc(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Wi||t instanceof ap||t instanceof Qr||t instanceof Yo)return!0;if(Array.isArray(t)){for(let e of t)if(!xc(e))return!1;return!0}if(typeof t=="object"){for(let e in t)if(!xc(t[e]))return!1;return!0}return!1}function hr(t){if(t===null)return ci;if(typeof t=="string")return Zi;if(typeof t=="boolean")return Hi;if(typeof t=="number")return vt;if(t instanceof Wi)return Xo;if(t instanceof ap)return Tu;if(t instanceof Qr)return vc;if(t instanceof Yo)return bc;if(Array.isArray(t)){let e=t.length,i;for(let o of t){let a=hr(o);if(i){if(i===a)continue;i=Li;break}i=a}return kr(i||Li,e)}return yc}function vs(t){let e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Wi||t instanceof Qr||t instanceof Yo?t.toString():JSON.stringify(t)}class ha{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!xc(e[1]))return i.error("invalid value");let o=e[1],a=hr(o),l=i.expectedType;return a.kind!=="array"||a.N!==0||!l||l.kind!=="array"||typeof l.N=="number"&&l.N!==0||(a=l),new ha(a,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Wi?["rgba"].concat(this.value.toArray()):this.value instanceof Qr?this.value.serialize():this.value}}class Er{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let jh={string:Zi,number:vt,boolean:Hi,object:yc};class zs{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,a=1,l=e[0];if(l==="array"){let g,y;if(e.length>2){let x=e[1];if(typeof x!="string"||!(x in jh)||x==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);g=jh[x],a++}else g=Li;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);y=e[2],a++}o=kr(g,y)}else o=jh[l];let h=[];for(;a<e.length;a++){let g=i.parse(e[a],a,Li);if(!g)return null;h.push(g)}return new zs(o,h)}evaluate(e){for(let i=0;i<this.args.length;i++){let o=this.args[i].evaluate(e);if(!Eu(this.type,hr(o)))return o;if(i===this.args.length-1)throw new Er(`Expected value to be of type ${Zn(this.type)}, but found ${Zn(hr(o))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,i=[e.kind];if(e.kind==="array"){let o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){i.push(o.kind);let a=e.N;(typeof a=="number"||this.args.length>1)&&i.push(a)}}return i.concat(this.args.map(o=>o.serialize()))}}class Su{constructor(e){this.type=vc,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");let a=[],l=!1;for(let h=1;h<=e.length-1;++h){let g=e[h];if(l&&typeof g=="object"&&!Array.isArray(g)){l=!1;let y=null;if(g["font-scale"]&&(y=i.parse(g["font-scale"],1,vt),!y))return null;let x=null;if(g["text-font"]&&(x=i.parse(g["text-font"],1,kr(Zi)),!x))return null;let E=null;if(g["text-color"]&&(E=i.parse(g["text-color"],1,Xo),!E))return null;let I=a[a.length-1];I.scale=y,I.font=x,I.textColor=E}else{let y=i.parse(e[h],1,Li);if(!y)return null;let x=y.type.kind;if(x!=="string"&&x!=="value"&&x!=="null"&&x!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");l=!0,a.push({content:y,scale:null,font:null,textColor:null})}}return new Su(a)}evaluate(e){return new Qr(this.sections.map(i=>{let o=i.content.evaluate(e);return hr(o)===bc?new Vh("",o,null,null,null):new Vh(vs(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(let i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let i of this.sections){e.push(i.content.serialize());let o={};i.scale&&(o["font-scale"]=i.scale.serialize()),i.font&&(o["text-font"]=i.font.serialize()),i.textColor&&(o["text-color"]=i.textColor.serialize()),e.push(o)}return e}}class wc{constructor(e,i){this.type=bc,this.inputPrimary=e,this.inputSecondary=i}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let o=i.parse(e[1],1,Zi);if(!o)return i.error("No image name provided.");if(e.length===2)return new wc(o);let a=i.parse(e[2],1,Zi);return a?new wc(o,a):i.error("Secondary image variant is not a string.")}evaluate(e){let i=Yo.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&e.availableImages&&(i.available=e.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function ml(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}let q_={"to-boolean":Hi,"to-color":Xo,"to-number":vt,"to-string":Zi};class Ga{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o=e[0],a=[],l=ci;if(o==="to-array"){if(!Array.isArray(e[1]))return null;let h=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);l=kr(i.expectedType.itemType,h)}else{if(!(h>0&&xc(e[1][0])))return null;l=kr(hr(e[1][0]),h)}for(let g=0;g<h;g++){let y=e[1][g],x;if(ml(y)==="array")x=i.parse(y,void 0,l.itemType);else{let E=ml(y);if(E!==l.itemType.kind)return i.error(`Expected ${l.itemType.kind} but found ${E}.`);x=i.registry.literal.parse(["literal",y===void 0?null:y],i)}if(!x)return null;a.push(x)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");l=q_[o];for(let h=1;h<e.length;h++){let g=i.parse(e[h],h,Li);if(!g)return null;a.push(g)}}return new Ga(l,a)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,o;for(let a of this.args){if(i=a.evaluate(e),o=null,i instanceof Wi)return i;if(typeof i=="string"){let l=e.parseColor(i);if(l)return l}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:om(i[0],i[1],i[2],i[3]),!o))return new Wi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Er(o||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(let o of this.args){if(i=o.evaluate(e),i===null)return 0;let a=Number(i);if(!isNaN(a))return a}throw new Er(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Qr.fromString(vs(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Yo.fromString(vs(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):vs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Su([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new wc(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}let $_=["Unknown","Point","LineString","Polygon"];class lp{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?$_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:o,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*i-e[0])+this.featureDistanceData.bearing[1]*(a*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Wi.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class Lo{constructor(e,i,o,a,l){this.name=e,this.type=i,this._evaluate=o,this.args=a,this._overloadIndex=l}evaluate(e){if(!this._evaluate){let i=Lo.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){let o=e[0],a=Lo.definitions[o];if(!a)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);let l=Array.isArray(a)?a[0]:a.type,h=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,g=[],y=null,x=-1;for(let[E,I]of h){if(Array.isArray(E)&&E.length!==e.length-1)continue;g.push(E),x++,y=new Xh(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);let M=[],D=!1;for(let P=1;P<e.length;P++){let L=e[P],N=Array.isArray(E)?E[P-1]:E.type,V=y.parse(L,1+M.length,N);if(!V){D=!0;break}M.push(V)}if(!D)if(Array.isArray(E)&&E.length!==M.length)y.error(`Expected ${E.length} arguments, but found ${M.length} instead.`);else{for(let P=0;P<M.length;P++){let L=Array.isArray(E)?E[P]:E.type,N=M[P];y.concat(P+1).checkSubtype(L,N.type)}if(y.errors.length===0)return new Lo(o,l,I,M,x)}}if(g.length===1)i.errors.push(...y.errors);else{let E=(g.length?g:h.map(([M])=>M)).map(W_).join(" | "),I=[];for(let M=1;M<e.length;M++){let D=i.parse(e[M],1+I.length);if(!D)return null;I.push(Zn(D.type))}i.error(`Expected arguments of type ${E}, but found (${I.join(", ")}) instead.`)}return null}static register(e,i){Lo.definitions=i;for(let o in i)e[o]=Lo}}function W_(t){return Array.isArray(t)?`(${t.map(Zn).join(", ")})`:`(${Zn(t.type)}...)`}class Mu{constructor(e,i,o){this.type=Tu,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");let o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");let a=i.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Hi);if(!a)return null;let l=i.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Hi);if(!l)return null;let h=null;return o.locale&&(h=i.parse(o.locale,1,Zi),!h)?null:new Mu(a,l,h)}evaluate(e){return new ap(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var cp={exports:{}};cp.exports=function(){function t(o,a,l,h,g){for(;h>l;){if(h-l>600){var y=h-l+1,x=a-l+1,E=Math.log(y),I=.5*Math.exp(2*E/3),M=.5*Math.sqrt(E*I*(y-I)/y)*(x-y/2<0?-1:1);t(o,a,Math.max(l,Math.floor(a-x*I/y+M)),Math.min(h,Math.floor(a+(y-x)*I/y+M)),g)}var D=o[a],P=l,L=h;for(e(o,l,a),g(o[h],D)>0&&e(o,l,h);P<L;){for(e(o,P,L),P++,L--;g(o[P],D)<0;)P++;for(;g(o[L],D)>0;)L--}g(o[l],D)===0?e(o,l,L):e(o,++L,h),L<=a&&(l=L+1),a<=L&&(h=L-1)}}function e(o,a,l){var h=o[a];o[a]=o[l],o[l]=h}function i(o,a){return o<a?-1:o>a?1:0}return function(o,a,l,h,g){t(o,a,l||0,h||o.length-1,g||i)}}();var sm=sn(cp.exports);function Z_(t){let e=0;for(let i,o,a=0,l=t.length,h=l-1;a<l;h=a++)i=t[a],o=t[h],e+=(o.x-i.x)*(i.y+o.y);return e}function Cu(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Au(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function H_(t,e,i){let o=t[0]-e[0],a=t[1]-e[1],l=t[0]-i[0],h=t[1]-i[1];return o*h-l*a==0&&o*l<=0&&a*h<=0}function ql(t,e,i=!1){let o=!1;for(let g=0,y=e.length;g<y;g++){let x=e[g];for(let E=0,I=x.length,M=I-1;E<I;M=E++){let D=x[M],P=x[E];if(H_(t,D,P))return i;(l=D)[1]>(a=t)[1]!=(h=P)[1]>a[1]&&a[0]<(h[0]-l[0])*(a[1]-l[1])/(h[1]-l[1])+l[0]&&(o=!o)}}var a,l,h;return o}function up(t,e,i,o){let a=o[0]-i[0],l=o[1]-i[1],h=(t[0]-i[0])*l-a*(t[1]-i[1]),g=(e[0]-i[0])*l-a*(e[1]-i[1]);return h>0&&g<0||h<0&&g>0}function Tc(t,e,i,o){return(a=[o[0]-i[0],o[1]-i[1]])[0]*(l=[e[0]-t[0],e[1]-t[1]])[1]-a[1]*l[0]!=0&&!(!up(t,e,i,o)||!up(i,o,t,e));var a,l}let gl=8192;function Q_(t,e){let i=(180+t[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(i*a*gl),Math.round(o*a*gl)]}function X_(t,e){for(let i=0;i<e.length;i++)if(ql(t,e[i]))return!0;return!1}function hp(t,e,i){for(let o of i)for(let a=0,l=o.length,h=l-1;a<l;h=a++)if(Tc(t,e,o[h],o[a]))return!0;return!1}function Uh(t,e){for(let i=0;i<t.length;++i)if(!ql(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(hp(t[i],t[i+1],e))return!1;return!0}function am(t,e){for(let i=0;i<e.length;i++)if(Uh(t,e[i]))return!0;return!1}function dp(t,e,i){let o=[];for(let a=0;a<t.length;a++){let l=[];for(let h=0;h<t[a].length;h++){let g=Q_(t[a][h],i);Cu(e,g),l.push(g)}o.push(l)}return o}function Du(t,e,i){let o=[];for(let a=0;a<t.length;a++){let l=dp(t[a],e,i);o.push(l)}return o}function pp(t,e,i,o){if(t[0]<i[0]||t[0]>i[2]){let a=.5*o,l=t[0]-i[0]>a?-o:i[0]-t[0]>a?o:0;l===0&&(l=t[0]-i[2]>a?-o:i[2]-t[0]>a?o:0),t[0]+=l}Cu(e,t)}function Ru(t,e,i,o){let a=Math.pow(2,o.z)*gl,l=[o.x*gl,o.y*gl],h=[];if(!t)return h;for(let g of t)for(let y of g){let x=[y.x+l[0],y.y+l[1]];pp(x,e,i,a),h.push(x)}return h}function fp(t,e,i,o){let a=Math.pow(2,o.z)*gl,l=[o.x*gl,o.y*gl],h=[];if(!t)return h;for(let y of t){let x=[];for(let E of y){let I=[E.x+l[0],E.y+l[1]];Cu(e,I),x.push(I)}h.push(x)}if(e[2]-e[0]<=a/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(let y of h)for(let x of y)pp(x,e,i,a)}var g;return h}class $l{constructor(e,i){this.type=Hi,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(xc(e[1])){let o=e[1];if(o.type==="FeatureCollection")for(let a=0;a<o.features.length;++a){let l=o.features[a].geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new $l(o,o.features[a].geometry)}else if(o.type==="Feature"){let a=o.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new $l(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new $l(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,o){let a=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(!h)return!1;if(o.type==="Polygon"){let g=dp(o.coordinates,l,h),y=Ru(i.geometry(),a,l,h);if(!Au(a,l))return!1;for(let x of y)if(!ql(x,g))return!1}if(o.type==="MultiPolygon"){let g=Du(o.coordinates,l,h),y=Ru(i.geometry(),a,l,h);if(!Au(a,l))return!1;for(let x of y)if(!X_(x,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,o){let a=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(!h)return!1;if(o.type==="Polygon"){let g=dp(o.coordinates,l,h),y=fp(i.geometry(),a,l,h);if(!Au(a,l))return!1;for(let x of y)if(!Uh(x,g))return!1}if(o.type==="MultiPolygon"){let g=Du(o.coordinates,l,h),y=fp(i.geometry(),a,l,h);if(!Au(a,l))return!1;for(let x of y)if(!am(x,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var lm={exports:{}};(function(t,e){t.exports=function(){var i={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},o=1/298.257223563,a=o*(2-o),l=Math.PI/180,h=function(I,M){if(I===void 0)throw new Error("No latitude given.");if(M&&!i[M])throw new Error("Unknown unit "+M+". Use one of: "+Object.keys(i).join(", "));var D=6378.137*l*(M?i[M]:1),P=Math.cos(I*l),L=1/(1-a*(1-P*P)),N=Math.sqrt(L);this.kx=D*N*P,this.ky=D*N*L*(1-a)},g={units:{configurable:!0}};function y(I,M){return I[0]===M[0]&&I[1]===M[1]}function x(I,M,D){var P=E(M[0]-I[0]);return[I[0]+P*D,I[1]+(M[1]-I[1])*D]}function E(I){for(;I<-180;)I+=360;for(;I>180;)I-=360;return I}return h.fromTile=function(I,M,D){var P=Math.PI*(1-2*(I+.5)/Math.pow(2,M)),L=Math.atan(.5*(Math.exp(P)-Math.exp(-P)))/l;return new h(L,D)},g.units.get=function(){return i},h.prototype.distance=function(I,M){var D=E(I[0]-M[0])*this.kx,P=(I[1]-M[1])*this.ky;return Math.sqrt(D*D+P*P)},h.prototype.bearing=function(I,M){var D=E(M[0]-I[0])*this.kx;return Math.atan2(D,(M[1]-I[1])*this.ky)/l},h.prototype.destination=function(I,M,D){var P=D*l;return this.offset(I,Math.sin(P)*M,Math.cos(P)*M)},h.prototype.offset=function(I,M,D){return[I[0]+M/this.kx,I[1]+D/this.ky]},h.prototype.lineDistance=function(I){for(var M=0,D=0;D<I.length-1;D++)M+=this.distance(I[D],I[D+1]);return M},h.prototype.area=function(I){for(var M=0,D=0;D<I.length;D++)for(var P=I[D],L=0,N=P.length,V=N-1;L<N;V=L++)M+=E(P[L][0]-P[V][0])*(P[L][1]+P[V][1])*(D?-1:1);return Math.abs(M)/2*this.kx*this.ky},h.prototype.along=function(I,M){var D=0;if(M<=0)return I[0];for(var P=0;P<I.length-1;P++){var L=I[P],N=I[P+1],V=this.distance(L,N);if((D+=V)>M)return x(L,N,(M-(D-V))/V)}return I[I.length-1]},h.prototype.pointToSegmentDistance=function(I,M,D){var P=M[0],L=M[1],N=E(D[0]-P)*this.kx,V=(D[1]-L)*this.ky,Z=0;return N===0&&V===0||((Z=(E(I[0]-P)*this.kx*N+(I[1]-L)*this.ky*V)/(N*N+V*V))>1?(P=D[0],L=D[1]):Z>0&&(P+=N/this.kx*Z,L+=V/this.ky*Z)),N=E(I[0]-P)*this.kx,V=(I[1]-L)*this.ky,Math.sqrt(N*N+V*V)},h.prototype.pointOnLine=function(I,M){for(var D,P,L,N,V=1/0,Z=0;Z<I.length-1;Z++){var Y=I[Z][0],Q=I[Z][1],ae=E(I[Z+1][0]-Y)*this.kx,te=(I[Z+1][1]-Q)*this.ky,ce=0;ae===0&&te===0||((ce=(E(M[0]-Y)*this.kx*ae+(M[1]-Q)*this.ky*te)/(ae*ae+te*te))>1?(Y=I[Z+1][0],Q=I[Z+1][1]):ce>0&&(Y+=ae/this.kx*ce,Q+=te/this.ky*ce));var he=(ae=E(M[0]-Y)*this.kx)*ae+(te=(M[1]-Q)*this.ky)*te;he<V&&(V=he,D=Y,P=Q,L=Z,N=ce)}return{point:[D,P],index:L,t:Math.max(0,Math.min(1,N))}},h.prototype.lineSlice=function(I,M,D){var P=this.pointOnLine(D,I),L=this.pointOnLine(D,M);if(P.index>L.index||P.index===L.index&&P.t>L.t){var N=P;P=L,L=N}var V=[P.point],Z=P.index+1,Y=L.index;!y(D[Z],V[0])&&Z<=Y&&V.push(D[Z]);for(var Q=Z+1;Q<=Y;Q++)V.push(D[Q]);return y(D[Y],L.point)||V.push(L.point),V},h.prototype.lineSliceAlong=function(I,M,D){for(var P=0,L=[],N=0;N<D.length-1;N++){var V=D[N],Z=D[N+1],Y=this.distance(V,Z);if((P+=Y)>I&&L.length===0&&L.push(x(V,Z,(I-(P-Y))/Y)),P>=M)return L.push(x(V,Z,(M-(P-Y))/Y)),L;P>I&&L.push(Z)}return L},h.prototype.bufferPoint=function(I,M){var D=M/this.ky,P=M/this.kx;return[I[0]-P,I[1]-D,I[0]+P,I[1]+D]},h.prototype.bufferBBox=function(I,M){var D=M/this.ky,P=M/this.kx;return[I[0]-P,I[1]-D,I[2]+P,I[3]+D]},h.prototype.insideBBox=function(I,M){return E(I[0]-M[0])>=0&&E(I[0]-M[2])<=0&&I[1]>=M[1]&&I[1]<=M[3]},Object.defineProperties(h,g),h}()})(lm);var Pu=sn(lm.exports),Gh={exports:{}};(function(t,e){t.exports=function(){var i=function(a,l){if(a===void 0&&(a=[]),l===void 0&&(l=o),this.data=a,this.length=this.data.length,this.compare=l,this.length>0)for(var h=(this.length>>1)-1;h>=0;h--)this._down(h)};function o(a,l){return a<l?-1:a>l?1:0}return i.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},i.prototype.pop=function(){if(this.length!==0){var a=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),a}},i.prototype.peek=function(){return this.data[0]},i.prototype._up=function(a){for(var l=this.data,h=this.compare,g=l[a];a>0;){var y=a-1>>1,x=l[y];if(h(g,x)>=0)break;l[a]=x,a=y}l[a]=g},i.prototype._down=function(a){for(var l=this.data,h=this.compare,g=this.length>>1,y=l[a];a<g;){var x=1+(a<<1),E=l[x],I=x+1;if(I<this.length&&h(l[I],E)<0&&(x=I,E=l[I]),h(E,y)>=0)break;l[a]=E,a=x}l[a]=y},i}()})(Gh);var qh=sn(Gh.exports),pt=8192;function Wl(t,e){return e.dist-t.dist}let mp=100,gp=50;function cm(t){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function $h(t){return t[1]-t[0]+1}function qa(t,e){let i=t[1]>=t[0]&&t[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Wh(t,e){if(t[0]>t[1])return[null,null];let i=$h(t);if(e){if(i===2)return[t,null];let o=Math.floor(i/2);return[[t[0],t[0]+o],[t[0]+o,t[1]]]}{if(i===1)return[t,null];let o=Math.floor(i/2)-1;return[[t[0],t[0]+o],[t[0]+o+1,t[1]]]}}function $a(t,e){let i=[1/0,1/0,-1/0,-1/0];if(!qa(e,t.length))return i;for(let o=e[0];o<=e[1];++o)Cu(i,t[o]);return i}function Zh(t){let e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<t.length;++i)for(let o=0;o<t[i].length;++o)Cu(e,t[i][o]);return e}function Ec(t,e,i){if(cm(t)||cm(e))return NaN;let o=0,a=0;return t[2]<e[0]&&(o=e[0]-t[2]),t[0]>e[2]&&(o=t[0]-e[2]),t[1]>e[3]&&(a=t[1]-e[3]),t[3]<e[1]&&(a=e[1]-t[3]),i.distance([0,0],[o,a])}function Y_(t){return 360*t-180}function K_(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function _p(t,e){let i=Math.pow(2,e.z),o=(t.y/pt+e.y)/i;return[Y_((t.x/pt+e.x)/i),K_(o)]}function J_(t,e){let i=[];for(let o=0;o<t.length;++o)i.push(_p(t[o],e));return i}function um(t,e,i){let o=i.pointOnLine(e,t).point;return i.distance(t,o)}function hm(t,e,i,o,a){let l=i.slice(o[0],o[1]+1),h=1/0;for(let g=e[0];g<=e[1];++g)if((h=Math.min(h,um(t[g],l,a)))===0)return 0;return h}function yp(t,e,i,o,a){let l=Math.min(a.pointToSegmentDistance(t,i,o),a.pointToSegmentDistance(e,i,o)),h=Math.min(a.pointToSegmentDistance(i,t,e),a.pointToSegmentDistance(o,t,e));return Math.min(l,h)}function Ic(t,e,i,o,a){if(!qa(e,t.length)||!qa(o,i.length))return NaN;let l=1/0;for(let h=e[0];h<e[1];++h)for(let g=o[0];g<o[1];++g){if(Tc(t[h],t[h+1],i[g],i[g+1]))return 0;l=Math.min(l,yp(t[h],t[h+1],i[g],i[g+1],a))}return l}function dm(t,e,i,o,a){if(!qa(e,t.length)||!qa(o,i.length))return NaN;let l=1/0;for(let h=e[0];h<=e[1];++h)for(let g=o[0];g<=o[1];++g)if((l=Math.min(l,a.distance(t[h],i[g])))===0)return l;return l}function pm(t,e,i){if(ql(t,e,!0))return 0;let o=1/0;for(let a of e){let l=a.length;if(l<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(a[0]!==a[l-1]&&(o=Math.min(o,i.pointToSegmentDistance(t,a[l-1],a[0])))===0||(o=Math.min(o,um(t,a,i)))===0)return o}return o}function Hh(t,e,i,o){if(!qa(e,t.length))return NaN;for(let l=e[0];l<=e[1];++l)if(ql(t[l],i,!0))return 0;let a=1/0;for(let l=e[0];l<e[1];++l)for(let h of i)for(let g=0,y=h.length,x=y-1;g<y;x=g++){if(Tc(t[l],t[l+1],h[x],h[g]))return 0;a=Math.min(a,yp(t[l],t[l+1],h[x],h[g],o))}return a}function fm(t,e){for(let i of t)for(let o=0;o<=i.length-1;++o)if(ql(i[o],e,!0))return!0;return!1}function ey(t,e,i,o=1/0){let a=Zh(t),l=Zh(e);if(o!==1/0&&Ec(a,l,i)>=o)return o;if(Au(a,l)){if(fm(t,e))return 0}else if(fm(e,t))return 0;let h=o;for(let g of t)for(let y=0,x=g.length,E=x-1;y<x;E=y++)for(let I of e)for(let M=0,D=I.length,P=D-1;M<D;P=M++){if(Tc(g[E],g[y],I[P],I[M]))return 0;h=Math.min(h,yp(g[E],g[y],I[P],I[M],i))}return h}function Bs(t,e,i,o,a,l,h){if(l===null||h===null)return;let g=Ec($a(o,l),$a(a,h),i);g<e&&t.push({dist:g,range1:l,range2:h})}function mm(t,e,i,o,a=1/0){let l=Math.min(o.distance(t[0],i[0][0]),a);if(l===0)return l;let h=new qh([{dist:0,range1:[0,t.length-1],range2:[0,0]}],Wl),g=e?gp:mp,y=Zh(i);for(;h.length;){let x=h.pop();if(x.dist>=l)continue;let E=x.range1;if($h(E)<=g){if(!qa(E,t.length))return NaN;if(e){let I=Hh(t,E,i,o);if((l=Math.min(l,I))===0)return l}else for(let I=E[0];I<=E[1];++I){let M=pm(t[I],i,o);if((l=Math.min(l,M))===0)return l}}else{let I=Wh(E,e);if(I[0]!==null){let M=Ec($a(t,I[0]),y,o);M<l&&h.push({dist:M,range1:I[0],range2:[0,0]})}if(I[1]!==null){let M=Ec($a(t,I[1]),y,o);M<l&&h.push({dist:M,range1:I[1],range2:[0,0]})}}}return l}function Zl(t,e,i,o,a,l=1/0){let h=Math.min(l,a.distance(t[0],i[0]));if(h===0)return h;let g=new qh([{dist:0,range1:[0,t.length-1],range2:[0,i.length-1]}],Wl),y=e?gp:mp,x=o?gp:mp;for(;g.length;){let E=g.pop();if(E.dist>=h)continue;let I=E.range1,M=E.range2;if($h(I)<=y&&$h(M)<=x){if(!qa(I,t.length)||!qa(M,i.length))return NaN;if(e&&o?h=Math.min(h,Ic(t,I,i,M,a)):e||o?e&&!o?h=Math.min(h,hm(i,M,t,I,a)):!e&&o&&(h=Math.min(h,hm(t,I,i,M,a))):h=Math.min(h,dm(t,I,i,M,a)),h===0)return h}else{let D=Wh(I,e),P=Wh(M,o);Bs(g,h,a,t,i,D[0],P[0]),Bs(g,h,a,t,i,D[0],P[1]),Bs(g,h,a,t,i,D[1],P[0]),Bs(g,h,a,t,i,D[1],P[1])}}return h}function vp(t,e,i,o,a=1/0){let l=a,h=$a(t,[0,t.length-1]);for(let g of i)if(!(l!==1/0&&Ec(h,$a(g,[0,g.length-1]),o)>=l)&&(l=Math.min(l,Zl(t,e,g,!0,o,l)),l===0))return l;return l}function Qh(t,e,i,o,a=1/0){let l=a,h=$a(t,[0,t.length-1]);for(let g of i){if(l!==1/0&&Ec(h,Zh(g),o)>=l)continue;let y=mm(t,e,g,o,l);if(isNaN(y))return y;if((l=Math.min(l,y))===0)return l}return l}function bp(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class Hl{constructor(e,i){this.type=vt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(xc(e[1])){let o=e[1];if(o.type==="FeatureCollection"){for(let a=0;a<o.features.length;++a)if(bp(o.features[a].geometry.type))return new Hl(o,o.features[a].geometry)}else if(o.type==="Feature"){if(bp(o.geometry.type))return new Hl(o,o.geometry)}else if(bp(o.type))return new Hl(o,o)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let i=e.geometry(),o=e.canonicalID();if(i!=null&&o!=null){if(e.geometryType()==="Point")return function(a,l,h){let g=[];for(let x of a)for(let E of x)g.push(_p(E,l));let y=new Pu(g[0][1],"meters");return h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString"?Zl(g,!1,h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",y):h.type==="MultiLineString"?vp(g,!1,h.coordinates,y):h.type==="Polygon"||h.type==="MultiPolygon"?Qh(g,!1,h.type==="Polygon"?[h.coordinates]:h.coordinates,y):null}(i,o,this.geometries);if(e.geometryType()==="LineString")return function(a,l,h){let g=[];for(let x of a){let E=[];for(let I of x)E.push(_p(I,l));g.push(E)}let y=new Pu(g[0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return vp(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",g,y);if(h.type==="MultiLineString"){let x=1/0;for(let E=0;E<h.coordinates.length;E++){let I=vp(h.coordinates[E],!0,g,y,x);if(isNaN(I))return I;if((x=Math.min(x,I))===0)return x}return x}if(h.type==="Polygon"||h.type==="MultiPolygon"){let x=1/0;for(let E=0;E<g.length;E++){let I=Qh(g[E],!0,h.type==="Polygon"?[h.coordinates]:h.coordinates,y,x);if(isNaN(I))return I;if((x=Math.min(x,I))===0)return x}return x}return null}(i,o,this.geometries);if(e.geometryType()==="Polygon")return function(a,l,h){let g=[];for(let x of function(E,I){let M=E.length;if(M<=1)return[E];let D=[],P,L;for(let N=0;N<M;N++){let V=Z_(E[N]);V!==0&&(E[N].area=Math.abs(V),L===void 0&&(L=V<0),L===V<0?(P&&D.push(P),P=[E[N]]):P.push(E[N]))}return P&&D.push(P),D}(a)){let E=[];for(let I=0;I<x.length;++I)E.push(J_(x[I],l));g.push(E)}let y=new Pu(g[0][0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return Qh(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",g,y);if(h.type==="MultiLineString"){let x=1/0;for(let E=0;E<h.coordinates.length;E++){let I=Qh(h.coordinates[E],!0,g,y,x);if(isNaN(I))return I;if((x=Math.min(x,I))===0)return x}return x}return h.type==="Polygon"||h.type==="MultiPolygon"?function(x,E,I){let M=1/0;for(let D of x)for(let P of E){let L=ey(D,P,I,M);if(isNaN(L))return L;if((M=Math.min(M,L))===0)return M}return M}(h.type==="Polygon"?[h.coordinates]:h.coordinates,g,y):null}(i,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function xp(t,e){switch(t){case"string":return vs(e);case"number":return+e;case"boolean":return!!e;case"color":return Wi.parse(e);case"formatted":return Qr.fromString(vs(e));case"resolvedImage":return Yo.fromString(vs(e))}return e}function wp(t,e,i,o){return o!==void 0&&(t=o*Math.round(t/o)),e!==void 0&&t<e&&(t=e),i!==void 0&&t>i&&(t=i),t}class _l{constructor(e,i,o){this.type=e,this.key=i,this.scope=o}static parse(e,i){let o=i.expectedType;if(o==null&&(o=Li),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");let a=i.parse(e[1],1);if(!(a instanceof ha))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let l=i.parse(e[2],2);return l instanceof ha?new _l(o,vs(a.value),vs(l.value)):i.error("Scope of 'config' expression must be a string literal.")}return new _l(o,vs(a.value))}evaluate(e){let i=[this.key,this.scope,e.scope].filter(Boolean).join(""),o=e.getConfig(i);if(!o)return null;let{type:a,value:l,values:h,minValue:g,maxValue:y,stepValue:x}=o,E=o.default.evaluate(e),I=E;if(l){let M=e.scope;e.scope=(M||"").split("").slice(1).join(""),I=l.evaluate(e),e.scope=M}return a&&(I=xp(a,I)),I===void 0||g===void 0&&y===void 0&&x===void 0||(typeof I=="number"?I=wp(I,g,y,x):Array.isArray(I)&&(I=I.map(M=>typeof M=="number"?wp(M,g,y,x):M))),l!==void 0&&I!==void 0&&h&&!h.includes(I)&&(I=E,a&&(I=xp(a,I))),(a&&a!==this.type||I!==void 0&&hr(I)!==this.type)&&(I=xp(this.type.kind,I)),I}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}function yl(t){if(t instanceof Lo&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof $l||t instanceof Hl)return!1;let e=!0;return t.eachChild(i=>{e&&!yl(i)&&(e=!1)}),e}function ku(t){if(t instanceof Lo&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(i=>{e&&!ku(i)&&(e=!1)}),e}function Ou(t){if(t instanceof _l)return!1;let e=!0;return t.eachChild(i=>{e&&!Ou(i)&&(e=!1)}),e}function Lu(t,e){if(t instanceof Lo&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(o=>{i&&!Lu(o,e)&&(i=!1)}),i}class Ko{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");let o=e[1];return i.scope.has(o)?new Ko(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Xh{constructor(e,i=[],o,a=new Qo,l=[],h,g){this.registry=e,this.path=i,this.key=i.map(y=>`[${y}]`).join(""),this.scope=a,this.errors=l,this.expectedType=o,this._scope=h,this.options=g}parse(e,i,o,a,l={}){return i||o?this.concat(i,o,a)._parse(e,l):this._parse(e,l)}_parse(e,i){function o(a,l,h){return h==="assert"?new zs(l,[a]):h==="coerce"?new Ga(l,[a]):a}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let a=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(a){let l=a.parse(e,this);if(!l)return null;if(this.expectedType){let h=this.expectedType,g=l.type;if(h.kind!=="string"&&h.kind!=="number"&&h.kind!=="boolean"&&h.kind!=="object"&&h.kind!=="array"||g.kind!=="value")if(h.kind!=="color"&&h.kind!=="formatted"&&h.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string"){if(this.checkSubtype(h,g))return null}else l=o(l,h,i.typeAnnotation||"coerce");else l=o(l,h,i.typeAnnotation||"assert")}if(!(l instanceof ha)&&l.type.kind!=="resolvedImage"&&Yh(l)){let h=new lp(this._scope,this.options);try{l=new ha(l.type,l.evaluate(h))}catch(g){return this.error(g.message),null}}return l}return Ga.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o){let a=typeof e=="number"?this.path.concat(e):this.path,l=o?this.scope.concat(o):this.scope;return new Xh(this.registry,a,i||null,l,this.errors,this._scope,this.options)}error(e,...i){let o=`${this.key}${i.map(a=>`[${a}]`).join("")}`;this.errors.push(new Oo(o,e))}checkSubtype(e,i){let o=Eu(e,i);return o&&this.error(o),o}}function Yh(t){if(t instanceof Ko)return Yh(t.boundExpression);if(t instanceof Lo&&t.name==="error"||t instanceof Mu||t instanceof $l||t instanceof Hl||t instanceof _l)return!1;let e=t instanceof Ga||t instanceof zs,i=!0;return t.eachChild(o=>{i=e?i&&Yh(o):i&&o instanceof ha}),!!i&&yl(t)&&Lu(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Kh(t,e){let i=t.length-1,o,a,l=0,h=i,g=0;for(;l<=h;)if(g=Math.floor((l+h)/2),o=t[g],a=t[g+1],o<=e){if(g===i||e<a)return g;l=g+1}else{if(!(o>e))throw new Er("Input is not a number.");h=g-1}return 0}class Fu{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(let[a,l]of o)this.labels.push(a),this.outputs.push(l)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");let o=i.parse(e[1],1,vt);if(!o)return null;let a=[],l=null;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);for(let h=1;h<e.length;h+=2){let g=h===1?-1/0:e[h],y=e[h+1],x=h,E=h+1;if(typeof g!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(a.length&&a[a.length-1][0]>=g)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);let I=i.parse(y,E,l);if(!I)return null;l=l||I.type,a.push([g,I])}return new Fu(l,o,a)}evaluate(e){let i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);let a=this.input.evaluate(e);if(a<=i[0])return o[0].evaluate(e);let l=i.length;return a>=i[l-1]?o[l-1].evaluate(e):o[Kh(i,a)].evaluate(e)}eachChild(e){e(this.input);for(let i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}let gm=.95047,_m=1.08883,Jh=4/29,Ql=6/29,ym=3*Ql*Ql,vm=Ql*Ql*Ql,ty=Math.PI/180,bm=180/Math.PI;function Sc(t){return t>vm?Math.pow(t,1/3):t/ym+Jh}function Tp(t){return t>Ql?t*t*t:ym*(t-Jh)}function Ep(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ip(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function xm(t){let e=Ip(t.r),i=Ip(t.g),o=Ip(t.b),a=Sc((.4124564*e+.3575761*i+.1804375*o)/gm),l=Sc((.2126729*e+.7151522*i+.072175*o)/1);return{l:116*l-16,a:500*(a-l),b:200*(l-Sc((.0193339*e+.119192*i+.9503041*o)/_m)),alpha:t.a}}function wm(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,o=isNaN(t.b)?e:e-t.b/200;return e=1*Tp(e),i=gm*Tp(i),o=_m*Tp(o),new Wi(Ep(3.2404542*i-1.5371385*e-.4985314*o),Ep(-.969266*i+1.8760108*e+.041556*o),Ep(.0556434*i-.2040259*e+1.0572252*o),t.alpha)}function ed(t,e,i){let o=e-t;return t+i*(o>180||o<-180?o-360*Math.round(o/360):o)}let vl={forward:xm,reverse:wm,interpolate:function(t,e,i){return{l:si(t.l,e.l,i),a:si(t.a,e.a,i),b:si(t.b,e.b,i),alpha:si(t.alpha,e.alpha,i)}}},Xr={forward:function(t){let{l:e,a:i,b:o}=xm(t),a=Math.atan2(o,i)*bm;return{h:a<0?a+360:a,c:Math.sqrt(i*i+o*o),l:e,alpha:t.a}},reverse:function(t){let e=t.h*ty,i=t.c;return wm({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:ed(t.h,e.h,i),c:si(t.c,e.c,i),l:si(t.l,e.l,i),alpha:si(t.alpha,e.alpha,i)}}};var zu=Object.freeze({__proto__:null,hcl:Xr,lab:vl});class Jo{constructor(e,i,o,a,l){this.type=e,this.operator=i,this.interpolation=o,this.input=a,this.labels=[],this.outputs=[];for(let[h,g]of l)this.labels.push(h),this.outputs.push(g)}static interpolationFactor(e,i,o,a){let l=0;if(e.name==="exponential")l=Sp(i,e.base,o,a);else if(e.name==="linear")l=Sp(i,1,o,a);else if(e.name==="cubic-bezier"){let h=e.controlPoints;l=new Lh(h[0],h[1],h[2],h[3]).solve(Sp(i,1,o,a))}return l}static parse(e,i){let[o,a,l,...h]=e;if(!Array.isArray(a)||a.length===0)return i.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){let x=a[1];if(typeof x!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:x}}else{if(a[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(a[0])}`,1,0);{let x=a.slice(1);if(x.length!==4||x.some(E=>typeof E!="number"||E<0||E>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:x}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(l=i.parse(l,2,vt),!l)return null;let g=[],y=null;o==="interpolate-hcl"||o==="interpolate-lab"?y=Xo:i.expectedType&&i.expectedType.kind!=="value"&&(y=i.expectedType);for(let x=0;x<h.length;x+=2){let E=h[x],I=h[x+1],M=x+3,D=x+4;if(typeof E!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(g.length&&g[g.length-1][0]>=E)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);let P=i.parse(I,D,y);if(!P)return null;y=y||P.type,g.push([E,P])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new Jo(y,o,a,l,g):i.error(`Type ${Zn(y)} is not interpolatable.`)}evaluate(e){let i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);let a=this.input.evaluate(e);if(a<=i[0])return o[0].evaluate(e);let l=i.length;if(a>=i[l-1])return o[l-1].evaluate(e);let h=Kh(i,a),g=Jo.interpolationFactor(this.interpolation,a,i[h],i[h+1]),y=o[h].evaluate(e),x=o[h+1].evaluate(e);return this.operator==="interpolate"?ua[this.type.kind.toLowerCase()](y,x,g):this.operator==="interpolate-hcl"?Xr.reverse(Xr.interpolate(Xr.forward(y),Xr.forward(x),g)):vl.reverse(vl.interpolate(vl.forward(y),vl.forward(x),g))}eachChild(e){e(this.input);for(let i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let i=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)i.push(this.labels[o],this.outputs[o].serialize());return i}}function Sp(t,e,i,o){let a=o-i,l=t-i;return a===0?0:e===1?l/a:(Math.pow(e,l)-1)/(Math.pow(e,a)-1)}class td{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let o=null,a=i.expectedType;a&&a.kind!=="value"&&(o=a);let l=[];for(let g of e.slice(1)){let y=i.parse(g,1+l.length,o,void 0,{typeAnnotation:"omit"});if(!y)return null;o=o||y.type,l.push(y)}let h=a&&l.some(g=>Eu(a,g.type));return new td(h?Li:o,l)}evaluate(e){let i,o=null,a=0;for(let l of this.args){if(a++,o=l.evaluate(e),o&&o instanceof Yo&&!o.available&&(i||(i=o),o=null,a===this.args.length))return i;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class id{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let o=[];for(let l=1;l<e.length-1;l+=2){let h=e[l];if(typeof h!="string")return i.error(`Expected string, but found ${typeof h} instead.`,l);if(/[^a-zA-Z0-9_]/.test(h))return i.error("Variable names must contain only alphanumeric characters or '_'.",l);let g=i.parse(e[l+1],l+1);if(!g)return null;o.push([h,g])}let a=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return a?new id(o,a):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[i,o]of this.bindings)e.push(i,o.serialize());return e.push(this.result.serialize()),e}}class Bu{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let o=i.parse(e[1],1,vt),a=i.parse(e[2],2,kr(i.expectedType||Li));return o&&a?new Bu(a.type.itemType,o,a):null}evaluate(e){let i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new Er(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new Er(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new Er(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Mp{constructor(e,i){this.type=Hi,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let o=i.parse(e[1],1,Li),a=i.parse(e[2],2,Li);return o&&a?Iu(o.type,[Hi,Zi,vt,ci,Li])?new Mp(o,a):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Zn(o.type)} instead`):null}evaluate(e){let i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!Gl(i,["boolean","string","number","null"]))throw new Er(`Expected first argument to be of type boolean, string, number or null, but found ${Zn(hr(i))} instead.`);if(!Gl(o,["string","array"]))throw new Er(`Expected second argument to be of type array or string, but found ${Zn(hr(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Mc{constructor(e,i,o){this.type=vt,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let o=i.parse(e[1],1,Li),a=i.parse(e[2],2,Li);if(!o||!a)return null;if(!Iu(o.type,[Hi,Zi,vt,ci,Li]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Zn(o.type)} instead`);if(e.length===4){let l=i.parse(e[3],3,vt);return l?new Mc(o,a,l):null}return new Mc(o,a)}evaluate(e){let i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Gl(i,["boolean","string","number","null"]))throw new Er(`Expected first argument to be of type boolean, string, number or null, but found ${Zn(hr(i))} instead.`);if(!Gl(o,["string","array"]))throw new Er(`Expected second argument to be of type array or string, but found ${Zn(hr(o))} instead.`);if(this.fromIndex){let a=this.fromIndex.evaluate(e);return o.indexOf(i,a)}return o.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Cp{constructor(e,i,o,a,l,h){this.inputType=e,this.type=i,this.input=o,this.cases=a,this.outputs=l,this.otherwise=h}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);let l={},h=[];for(let x=2;x<e.length-1;x+=2){let E=e[x],I=e[x+1];Array.isArray(E)||(E=[E]);let M=i.concat(x);if(E.length===0)return M.error("Expected at least one branch label.");for(let P of E){if(typeof P!="number"&&typeof P!="string")return M.error("Branch labels must be numbers or strings.");if(typeof P=="number"&&Math.abs(P)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof P=="number"&&Math.floor(P)!==P)return M.error("Numeric branch labels must be integer values.");if(o){if(M.checkSubtype(o,hr(P)))return null}else o=hr(P);if(l[String(P)]!==void 0)return M.error("Branch labels must be unique.");l[String(P)]=h.length}let D=i.parse(I,x,a);if(!D)return null;a=a||D.type,h.push(D)}let g=i.parse(e[1],1,Li);if(!g)return null;let y=i.parse(e[e.length-1],e.length-1,a);return y?g.type.kind!=="value"&&i.concat(1).checkSubtype(o,g.type)?null:new Cp(o,a,g,l,h,y):null}evaluate(e){let i=this.input.evaluate(e);return(hr(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),o=[],a={};for(let h of i){let g=a[this.cases[h]];g===void 0?(a[this.cases[h]]=o.length,o.push([this.cases[h],[h]])):o[g][1].push(h)}let l=h=>this.inputType.kind==="number"?Number(h):h;for(let[h,g]of o)e.push(g.length===1?l(g[0]):g.map(l)),e.push(this.outputs[h].serialize());return e.push(this.otherwise.serialize()),e}}class Ap{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);let a=[];for(let h=1;h<e.length-1;h+=2){let g=i.parse(e[h],h,Hi);if(!g)return null;let y=i.parse(e[h+1],h+1,o);if(!y)return null;a.push([g,y]),o=o||y.type}let l=i.parse(e[e.length-1],e.length-1,o);return l?new Ap(o,a,l):null}evaluate(e){for(let[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Cc{constructor(e,i,o,a){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let o=i.parse(e[1],1,Li),a=i.parse(e[2],2,vt);if(!o||!a)return null;if(!Iu(o.type,[kr(Li),Zi,Li]))return i.error(`Expected first argument to be of type array or string, but found ${Zn(o.type)} instead`);if(e.length===4){let l=i.parse(e[3],3,vt);return l?new Cc(o.type,o,a,l):null}return new Cc(o.type,o,a)}evaluate(e){let i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!Gl(i,["string","array"]))throw new Er(`Expected first argument to be of type array or string, but found ${Zn(hr(i))} instead.`);if(this.endIndex){let a=this.endIndex.evaluate(e);return i.slice(o,a)}return i.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Tm(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Dp(t,e,i,o){return o.compare(e,i)===0}function Xl(t,e,i){let o=t!=="=="&&t!=="!=";return class CM{constructor(l,h,g){this.type=Hi,this.lhs=l,this.rhs=h,this.collator=g,this.hasUntypedArgument=l.type.kind==="value"||h.type.kind==="value"}static parse(l,h){if(l.length!==3&&l.length!==4)return h.error("Expected two or three arguments.");let g=l[0],y=h.parse(l[1],1,Li);if(!y)return null;if(!Tm(g,y.type))return h.concat(1).error(`"${g}" comparisons are not supported for type '${Zn(y.type)}'.`);let x=h.parse(l[2],2,Li);if(!x)return null;if(!Tm(g,x.type))return h.concat(2).error(`"${g}" comparisons are not supported for type '${Zn(x.type)}'.`);if(y.type.kind!==x.type.kind&&y.type.kind!=="value"&&x.type.kind!=="value")return h.error(`Cannot compare types '${Zn(y.type)}' and '${Zn(x.type)}'.`);o&&(y.type.kind==="value"&&x.type.kind!=="value"?y=new zs(x.type,[y]):y.type.kind!=="value"&&x.type.kind==="value"&&(x=new zs(y.type,[x])));let E=null;if(l.length===4){if(y.type.kind!=="string"&&x.type.kind!=="string"&&y.type.kind!=="value"&&x.type.kind!=="value")return h.error("Cannot use collator to compare non-string types.");if(E=h.parse(l[3],3,Tu),!E)return null}return new CM(y,x,E)}evaluate(l){let h=this.lhs.evaluate(l),g=this.rhs.evaluate(l);if(o&&this.hasUntypedArgument){let y=hr(h),x=hr(g);if(y.kind!==x.kind||y.kind!=="string"&&y.kind!=="number")throw new Er(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${y.kind}, ${x.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){let y=hr(h),x=hr(g);if(y.kind!=="string"||x.kind!=="string")return e(l,h,g)}return this.collator?i(l,h,g,this.collator.evaluate(l)):e(l,h,g)}eachChild(l){l(this.lhs),l(this.rhs),this.collator&&l(this.collator)}outputDefined(){return!0}serialize(){let l=[t];return this.eachChild(h=>{l.push(h.serialize())}),l}}}let iy=Xl("==",function(t,e,i){return e===i},Dp),Rp=Xl("!=",function(t,e,i){return e!==i},function(t,e,i,o){return!Dp(0,e,i,o)}),nd=Xl("<",function(t,e,i){return e<i},function(t,e,i,o){return o.compare(e,i)<0}),Em=Xl(">",function(t,e,i){return e>i},function(t,e,i,o){return o.compare(e,i)>0}),ny=Xl("<=",function(t,e,i){return e<=i},function(t,e,i,o){return o.compare(e,i)<=0}),Im=Xl(">=",function(t,e,i){return e>=i},function(t,e,i,o){return o.compare(e,i)>=0});class Pp{constructor(e,i,o,a,l,h){this.type=Zi,this.number=e,this.locale=i,this.currency=o,this.unit=a,this.minFractionDigits=l,this.maxFractionDigits=h}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");let o=i.parse(e[1],1,vt);if(!o)return null;let a=e[2];if(typeof a!="object"||Array.isArray(a))return i.error("NumberFormat options argument must be an object.");let l=null;if(a.locale&&(l=i.parse(a.locale,1,Zi),!l))return null;let h=null;if(a.currency&&(h=i.parse(a.currency,1,Zi),!h))return null;let g=null;if(a.unit&&(g=i.parse(a.unit,1,Zi),!g))return null;let y=null;if(a["min-fraction-digits"]&&(y=i.parse(a["min-fraction-digits"],1,vt),!y))return null;let x=null;return a["max-fraction-digits"]&&(x=i.parse(a["max-fraction-digits"],1,vt),!x)?null:new Pp(o,l,h,g,y,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Nu{constructor(e){this.type=vt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);let o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Zn(o.type)} instead.`):new Nu(o):null}evaluate(e){let i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Er(`Expected value to be of type string or array, but found ${Zn(hr(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function Sm(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let Ac={"==":iy,"!=":Rp,">":Em,"<":nd,">=":Im,"<=":ny,array:zs,at:Bu,boolean:zs,case:Ap,coalesce:td,collator:Mu,format:Su,image:wc,in:Mp,"index-of":Mc,interpolate:Jo,"interpolate-hcl":Jo,"interpolate-lab":Jo,length:Nu,let:id,literal:ha,match:Cp,number:zs,"number-format":Pp,object:zs,slice:Cc,step:Fu,string:zs,"to-boolean":Ga,"to-color":Ga,"to-number":Ga,"to-string":Ga,var:Ko,within:$l,distance:Hl,config:_l};function Mm(t,[e,i,o,a]){e=e.evaluate(t),i=i.evaluate(t),o=o.evaluate(t);let l=a?a.evaluate(t):1,h=om(e,i,o,l);if(h)throw new Er(h);return new Wi(e/255*l,i/255*l,o/255*l,l)}function Cm(t,[e,i,o,a]){e=e.evaluate(t),i=i.evaluate(t),o=o.evaluate(t);let l=a?a.evaluate(t):1,h=function(x,E,I,M){return typeof x=="number"&&x>=0&&x<=360?typeof E=="number"&&E>=0&&E<=100&&typeof I=="number"&&I>=0&&I<=100?M===void 0||typeof M=="number"&&M>=0&&M<=1?null:`Invalid hsla value [${[x,E,I,M].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof M=="number"?[x,E,I,M]:[x,E,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof M=="number"?[x,E,I,M]:[x,E,I]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,o,l);if(h)throw new Er(h);let g=`hsla(${e}, ${i}%, ${o}%, ${l})`,y=Wi.parse(g);if(!y)throw new Er(`Failed to parse HSLA color: ${g}`);return y}function kp(t,e){return t in e}function Op(t,e){let i=e[t];return i===void 0?null:i}function Yl(t){return{type:t}}function Am(t){return{result:"success",value:t}}function Kl(t){return{result:"error",value:t}}function Dm(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function rd(t){return t["property-type"]==="data-driven"}function Rm(t){return Dm(t.expression,"measure-light")}function Pm(t){return Dm(t.expression,"zoom")}function Dc(t){return!!t.expression&&t.expression.interpolated}function Lp(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function ry(t){return t}function Vu(t,e){let i=e.type==="color",o=t.stops&&typeof t.stops[0][0]=="object",a=o||!(o||t.property!==void 0),l=t.type||(Dc(e)?"exponential":"interval");if(i&&((t=Ua({},t)).stops&&(t.stops=t.stops.map(x=>[x[0],Wi.parse(x[1])])),t.default=Wi.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!zu[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let h,g,y;if(l==="exponential")h=Fp;else if(l==="interval")h=oy;else if(l==="categorical"){h=km,g=Object.create(null);for(let x of t.stops)g[x[0]]=x[1];y=typeof t.stops[0][0]}else{if(l!=="identity")throw new Error(`Unknown function type "${l}"`);h=Om}if(o){let x={},E=[];for(let D=0;D<t.stops.length;D++){let P=t.stops[D],L=P[0].zoom;x[L]===void 0&&(x[L]={zoom:L,type:t.type,property:t.property,default:t.default,stops:[]},E.push(L)),x[L].stops.push([P[0].value,P[1]])}let I=[];for(let D of E)I.push([x[D].zoom,Vu(x[D],e)]);let M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:Jo.interpolationFactor.bind(void 0,M),zoomStops:I.map(D=>D[0]),evaluate:({zoom:D},P)=>Fp({stops:I,base:t.base},e,D).evaluate(D,P)}}if(a){let x=l==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:x,interpolationFactor:Jo.interpolationFactor.bind(void 0,x),zoomStops:t.stops.map(E=>E[0]),evaluate:({zoom:E})=>h(t,e,E,g,y)}}return{kind:"source",evaluate(x,E){let I=E&&E.properties?E.properties[t.property]:void 0;return I===void 0?ju(t.default,e.default):h(t,e,I,g,y)}}}function ju(t,e,i){return t!==void 0?t:e!==void 0?e:i!==void 0?i:void 0}function km(t,e,i,o,a){return ju(typeof i===a?o[i]:void 0,t.default,e.default)}function oy(t,e,i){if(ml(i)!=="number")return ju(t.default,e.default);let o=t.stops.length;if(o===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[o-1][0])return t.stops[o-1][1];let a=Kh(t.stops.map(l=>l[0]),i);return t.stops[a][1]}function Fp(t,e,i){let o=t.base!==void 0?t.base:1;if(ml(i)!=="number")return ju(t.default,e.default);let a=t.stops.length;if(a===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[a-1][0])return t.stops[a-1][1];let l=Kh(t.stops.map(E=>E[0]),i),h=function(E,I,M,D){let P=D-M,L=E-M;return P===0?0:I===1?L/P:(Math.pow(I,L)-1)/(Math.pow(I,P)-1)}(i,o,t.stops[l][0],t.stops[l+1][0]),g=t.stops[l][1],y=t.stops[l+1][1],x=ua[e.type]||ry;if(t.colorSpace&&t.colorSpace!=="rgb"){let E=zu[t.colorSpace];x=(I,M)=>E.reverse(E.interpolate(E.forward(I),E.forward(M),h))}return typeof g.evaluate=="function"?{evaluate(...E){let I=g.evaluate.apply(void 0,E),M=y.evaluate.apply(void 0,E);if(I!==void 0&&M!==void 0)return x(I,M,h)}}:x(g,y,h)}function Om(t,e,i){return e.type==="color"?i=Wi.parse(i):e.type==="formatted"?i=Qr.fromString(i.toString()):e.type==="resolvedImage"?i=Yo.fromString(i.toString()):ml(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),ju(i,t.default,e.default)}Lo.register(Ac,{error:[{kind:"error"},[Zi],(t,[e])=>{throw new Er(e.evaluate(t))}],typeof:[Zi,[Li],(t,[e])=>Zn(hr(e.evaluate(t)))],"to-rgba":[kr(vt,4),[Xo],(t,[e])=>e.evaluate(t).toArray()],rgb:[Xo,[vt,vt,vt],Mm],rgba:[Xo,[vt,vt,vt,vt],Mm],hsl:[Xo,[vt,vt,vt],Cm],hsla:[Xo,[vt,vt,vt,vt],Cm],has:{type:Hi,overloads:[[[Zi],(t,[e])=>kp(e.evaluate(t),t.properties())],[[Zi,yc],(t,[e,i])=>kp(e.evaluate(t),i.evaluate(t))]]},get:{type:Li,overloads:[[[Zi],(t,[e])=>Op(e.evaluate(t),t.properties())],[[Zi,yc],(t,[e,i])=>Op(e.evaluate(t),i.evaluate(t))]]},"feature-state":[Li,[Zi],(t,[e])=>Op(e.evaluate(t),t.featureState||{})],properties:[yc,[],t=>t.properties()],"geometry-type":[Zi,[],t=>t.geometryType()],id:[Li,[],t=>t.id()],zoom:[vt,[],t=>t.globals.zoom],pitch:[vt,[],t=>t.globals.pitch||0],"distance-from-center":[vt,[],t=>t.distanceFromCenter()],"measure-light":[vt,[Zi],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[vt,[],t=>t.globals.heatmapDensity||0],"line-progress":[vt,[],t=>t.globals.lineProgress||0],"raster-value":[vt,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[vt,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[vt,[],t=>t.globals.skyRadialProgress||0],accumulated:[Li,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[vt,Yl(vt),(t,e)=>{let i=0;for(let o of e)i+=o.evaluate(t);return i}],"*":[vt,Yl(vt),(t,e)=>{let i=1;for(let o of e)i*=o.evaluate(t);return i}],"-":{type:vt,overloads:[[[vt,vt],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[vt],(t,[e])=>-e.evaluate(t)]]},"/":[vt,[vt,vt],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[vt,[vt,vt],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[vt,[],()=>Math.LN2],pi:[vt,[],()=>Math.PI],e:[vt,[],()=>Math.E],"^":[vt,[vt,vt],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[vt,[vt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[vt,[vt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[vt,[vt],(t,[e])=>Math.log(e.evaluate(t))],log2:[vt,[vt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[vt,[vt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[vt,[vt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[vt,[vt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[vt,[vt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[vt,[vt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[vt,[vt],(t,[e])=>Math.atan(e.evaluate(t))],min:[vt,Yl(vt),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[vt,Yl(vt),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[vt,[vt],(t,[e])=>Math.abs(e.evaluate(t))],round:[vt,[vt],(t,[e])=>{let i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[vt,[vt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[vt,[vt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Hi,[Zi,Li],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[Hi,[Li],(t,[e])=>t.id()===e.value],"filter-type-==":[Hi,[Zi],(t,[e])=>t.geometryType()===e.value],"filter-<":[Hi,[Zi,Li],(t,[e,i])=>{let o=t.properties()[e.value],a=i.value;return typeof o==typeof a&&o<a}],"filter-id-<":[Hi,[Li],(t,[e])=>{let i=t.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[Hi,[Zi,Li],(t,[e,i])=>{let o=t.properties()[e.value],a=i.value;return typeof o==typeof a&&o>a}],"filter-id->":[Hi,[Li],(t,[e])=>{let i=t.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[Hi,[Zi,Li],(t,[e,i])=>{let o=t.properties()[e.value],a=i.value;return typeof o==typeof a&&o<=a}],"filter-id-<=":[Hi,[Li],(t,[e])=>{let i=t.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[Hi,[Zi,Li],(t,[e,i])=>{let o=t.properties()[e.value],a=i.value;return typeof o==typeof a&&o>=a}],"filter-id->=":[Hi,[Li],(t,[e])=>{let i=t.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[Hi,[Li],(t,[e])=>e.value in t.properties()],"filter-has-id":[Hi,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Hi,[kr(Zi)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Hi,[kr(Li)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Hi,[Zi,kr(Li)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Hi,[Zi,kr(Li)],(t,[e,i])=>function(o,a,l,h){for(;l<=h;){let g=l+h>>1;if(a[g]===o)return!0;a[g]>o?h=g-1:l=g+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Hi,overloads:[[[Hi,Hi],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[Yl(Hi),(t,e)=>{for(let i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:Hi,overloads:[[[Hi,Hi],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[Yl(Hi),(t,e)=>{for(let i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[Hi,[Hi],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Hi,[Zi],(t,[e])=>{let i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[Zi,[Zi],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Zi,[Zi],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Zi,Yl(Li),(t,e)=>e.map(i=>vs(i.evaluate(t))).join("")],"resolved-locale":[Zi,[Tu],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[vt,[vt,vt,Li],(t,e)=>{let[i,o,a]=e.map(h=>h.evaluate(t));if(i>o||i===o)return i;let l;if(typeof a=="string")l=function(h){let g=0;if(h.length===0)return g;for(let y=0;y<h.length;y++)g=(g<<5)-g+h.charCodeAt(y),g|=0;return g}(a);else{if(typeof a!="number")throw new Er(`Invalid seed input: ${a}`);l=a}return i+Sm(l)()*(o-i)}]});class od{constructor(e,i,o,a){this.expression=e,this._warningHistory={},this._evaluator=new lp(o,a),this._defaultValue=i?function(l){return l.type==="color"&&(Lp(l.default)||Array.isArray(l.default))?new Wi(0,0,0,0):l.type==="color"?Wi.parse(l.default)||null:l.default===void 0?null:l.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,o,a,l,h,g,y){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=a||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=h,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,a,l,h,g,y){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=h||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=y||null;try{let x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new Er(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function sd(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Ac}function Rc(t,e,i,o){let a=new Xh(Ac,[],e?function(h){let g={color:Xo,string:Zi,number:vt,enum:Zi,boolean:Hi,formatted:vc,resolvedImage:bc};return h.type==="array"?kr(g[h.value]||Li,h.length):g[h.type]}(e):void 0,void 0,void 0,i,o),l=a.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?Am(new od(l,e,i,o)):Kl(a.errors)}class Uu{constructor(e,i,o){this.kind=e,this._styleExpression=i,this.isLightConstant=o,this.isStateDependent=e!=="constant"&&!ku(i.expression),this.isConfigDependent=!Ou(i.expression)}evaluateWithoutErrorHandling(e,i,o,a,l,h){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,a,l,h)}evaluate(e,i,o,a,l,h){return this._styleExpression.evaluate(e,i,o,a,l,h)}}class Gu{constructor(e,i,o,a,l){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!ku(i.expression),this.isLightConstant=l,this.isConfigDependent=!Ou(i.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,i,o,a,l,h){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,a,l,h)}evaluate(e,i,o,a,l,h){return this._styleExpression.evaluate(e,i,o,a,l,h)}interpolationFactor(e,i,o){return this.interpolationType?Jo.interpolationFactor(this.interpolationType,e,i,o):0}}function Lm(t,e,i,o){if((t=Rc(t,e,i,o)).result==="error")return t;let a=t.value.expression,l=yl(a);if(!l&&!rd(e))return Kl([new Oo("","data expressions not supported")]);let h=Lu(a,["zoom","pitch","distance-from-center"]);if(!h&&!Pm(e))return Kl([new Oo("","zoom expressions not supported")]);let g=Lu(a,["measure-light"]);if(!g&&!Rm(e))return Kl([new Oo("","measure-light expression not supported")]);let y=e.expression&&e.expression.relaxZoomRestriction,x=ad(a);return x||h||y?x instanceof Oo?Kl([x]):x instanceof Jo&&!Dc(e)?Kl([new Oo("",'"interpolate" expressions cannot be used with this property')]):Am(x?new Gu(l?"camera":"composite",t.value,x.labels,x instanceof Jo?x.interpolation:void 0,g):new Uu(l?"constant":"source",t.value,g)):Kl([new Oo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class qu{constructor(e,i){this._parameters=e,this._specification=i,Ua(this,Vu(this._parameters,this._specification))}static deserialize(e){return new qu(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ad(t){let e=null;if(t instanceof id)e=ad(t.result);else if(t instanceof td){for(let i of t.args)if(e=ad(i),e)break}else(t instanceof Fu||t instanceof Jo)&&t.input instanceof Lo&&t.input.name==="zoom"&&(e=t);return e instanceof Oo||t.eachChild(i=>{let o=ad(i);o instanceof Oo?e=o:e&&o&&e!==o&&(e=new Oo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Fm=da,bl=3;function da(t,e,i){var o=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var a=new Int32Array(this.arrayBuffer);t=a[0],this.d=(e=a[1])+2*(i=a[2]);for(var l=0;l<this.d*this.d;l++){var h=a[bl+l],g=a[bl+l+1];o.push(h===g?null:a.subarray(h,g))}var y=a[bl+o.length+1];this.keys=a.subarray(a[bl+o.length],y),this.bboxes=a.subarray(y),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var x=0;x<this.d*this.d;x++)o.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var E=i/e*t;this.min=-E,this.max=t+E}da.prototype.insert=function(t,e,i,o,a){this._forEachCell(e,i,o,a,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(a)},da.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},da.prototype._insertCell=function(t,e,i,o,a,l){this.cells[a].push(l)},da.prototype.query=function(t,e,i,o,a){var l=this.min,h=this.max;if(t<=l&&e<=l&&h<=i&&h<=o&&!a)return Array.prototype.slice.call(this.keys);var g=[];return this._forEachCell(t,e,i,o,this._queryCell,g,{},a),g},da.prototype._queryCell=function(t,e,i,o,a,l,h,g){var y=this.cells[a];if(y!==null)for(var x=this.keys,E=this.bboxes,I=0;I<y.length;I++){var M=y[I];if(h[M]===void 0){var D=4*M;(g?g(E[D+0],E[D+1],E[D+2],E[D+3]):t<=E[D+2]&&e<=E[D+3]&&i>=E[D+0]&&o>=E[D+1])?(h[M]=!0,l.push(x[M])):h[M]=!1}}},da.prototype._forEachCell=function(t,e,i,o,a,l,h,g){for(var y=this._convertToCellCoord(t),x=this._convertToCellCoord(e),E=this._convertToCellCoord(i),I=this._convertToCellCoord(o),M=y;M<=E;M++)for(var D=x;D<=I;D++){var P=this.d*D+M;if((!g||g(this._convertFromCellCoord(M),this._convertFromCellCoord(D),this._convertFromCellCoord(M+1),this._convertFromCellCoord(D+1)))&&a.call(this,t,e,i,o,P,l,h,g))return}},da.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},da.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},da.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=bl+this.cells.length+1+1,i=0,o=0;o<this.cells.length;o++)i+=this.cells[o].length;var a=new Int32Array(e+i+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var l=e,h=0;h<t.length;h++){var g=t[h];a[bl+h]=l,a.set(g,l),l+=g.length}return a[bl+t.length]=l,a.set(this.keys,l),a[bl+t.length+1]=l+=this.keys.length,a.set(this.bboxes,l),l+=this.bboxes.length,a.buffer};var Pc=sn(Fm);let ld={};function bt(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),ld[e]={klass:t,omit:i.omit||[]}}bt(Object,"Object"),Pc.serialize=function(t,e){let i=t.toArrayBuffer();return e&&e.add(i),{buffer:i}},Pc.deserialize=function(t){return new Pc(t.buffer)},Object.defineProperty(Pc,"name",{value:"Grid"}),bt(Pc,"Grid"),bt(Wi,"Color"),bt(Error,"Error"),bt(Qr,"Formatted"),bt(Vh,"FormattedSection"),bt(ds,"AJAXError"),bt(Yo,"ResolvedImage"),bt(qu,"StylePropertyFunction"),bt(od,"StyleExpression",{omit:["_evaluator"]}),bt(Gu,"ZoomDependentExpression"),bt(Uu,"ZoomConstantExpression"),bt(Lo,"CompoundExpression",{omit:["_evaluate"]});for(let t in Ac)ld[Ac[t]._classRegistryKey]||bt(Ac[t],`Expression${t}`);function zm(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Bm(t){return self.ImageBitmap&&t instanceof ImageBitmap}function $u(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(zm(t)||Bm(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){let i=t;return e&&e.add(i.buffer),i}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){let i=[];for(let o of t)i.push($u(o,e));return i}if(t instanceof Map){let i={$name:"Map"};for(let[o,a]of t.entries())i[o]=$u(a);return i}if(typeof t=="object"){let i=t.constructor,o=i._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${o}`);let a=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(let l in t)t.hasOwnProperty(l)&&(ld[o].omit.indexOf(l)>=0||(a[l]=$u(t[l],e)));t instanceof Error&&(a.message=t.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(a.$name=o),a}throw new Error("can't serialize object of type "+typeof t)}function c(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||zm(t)||Bm(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(c);if(typeof t=="object"){let e=t.$name||"Object";if(e==="Map"){let a=new Map;for(let l of Object.keys(t))l!=="$name"&&a.set(l,c(t[l]));return a}let{klass:i}=ld[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);let o=Object.create(i.prototype);for(let a of Object.keys(t))a!=="$name"&&(o[a]=c(t[a]));return o}throw new Error("can't deserialize object of type "+typeof t)}let n={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function s(t){for(let e of t)if(_(e.charCodeAt(0)))return!0;return!1}function u(t){for(let e of t)if(!m(e.charCodeAt(0)))return!1;return!0}function m(t){return!(n.Arabic(t)||n["Arabic Supplement"](t)||n["Arabic Extended-A"](t)||n["Arabic Presentation Forms-A"](t)||n["Arabic Presentation Forms-B"](t))}function _(t){return!(t!==746&&t!==747&&(t<4352||!(n["Bopomofo Extended"](t)||n.Bopomofo(t)||n["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||n["CJK Compatibility Ideographs"](t)||n["CJK Compatibility"](t)||n["CJK Radicals Supplement"](t)||n["CJK Strokes"](t)||!(!n["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||n["CJK Unified Ideographs Extension A"](t)||n["CJK Unified Ideographs"](t)||n["Enclosed CJK Letters and Months"](t)||n["Hangul Compatibility Jamo"](t)||n["Hangul Jamo Extended-A"](t)||n["Hangul Jamo Extended-B"](t)||n["Hangul Jamo"](t)||n["Hangul Syllables"](t)||n.Hiragana(t)||n["Ideographic Description Characters"](t)||n.Kanbun(t)||n["Kangxi Radicals"](t)||n["Katakana Phonetic Extensions"](t)||n.Katakana(t)&&t!==12540||!(!n["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!n["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||n["Unified Canadian Aboriginal Syllabics"](t)||n["Unified Canadian Aboriginal Syllabics Extended"](t)||n["Vertical Forms"](t)||n["Yijing Hexagram Symbols"](t)||n["Yi Syllables"](t)||n["Yi Radicals"](t))))}function b(t){return!(_(t)||function(e){return!!(n["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||n["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||n["Letterlike Symbols"](e)||n["Number Forms"](e)||n["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||n["Control Pictures"](e)&&e!==9251||n["Optical Character Recognition"](e)||n["Enclosed Alphanumerics"](e)||n["Geometric Shapes"](e)||n["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||n["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||n["CJK Symbols and Punctuation"](e)||n.Katakana(e)||n["Private Use Area"](e)||n["CJK Compatibility Forms"](e)||n["Small Form Variants"](e)||n["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function w(t){return t>=1424&&t<=2303||n["Arabic Presentation Forms-A"](t)||n["Arabic Presentation Forms-B"](t)}function S(t,e){return!(!e&&w(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||n.Khmer(t))}function C(t){for(let e of t)if(w(e.charCodeAt(0)))return!0;return!1}let R="deferred",O="loading",F="loaded",B=null,U="unavailable",j=null,G=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(U="error"),B&&B(t)};function q(){H.fire(new ms("pluginStateChange",{pluginStatus:U,pluginURL:j}))}let H=new Hr,ne=function(){return U},ie=function(){if(U!==R||!j)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");U=O,q(),j&&la({url:j},t=>{t?G(t):(U=F,q())})},oe={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>U===F||oe.applyArabicShaping!=null,isLoading:()=>U===O,setState(t){U=t.pluginStatus,j=t.pluginURL},isParsed:()=>oe.applyArabicShaping!=null&&oe.processBidirectionalText!=null&&oe.processStyledBidirectionalText!=null,getPluginURL:()=>j};class ${constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,o){for(let a of i)if(!S(a.charCodeAt(0),o))return!1;return!0}(e,oe.isLoaded())}}class X{constructor(e,i,o,a){this.property=e,this.value=i,this.expression=function(l,h,g,y){if(Lp(l))return new qu(l,h);if(sd(l)||Array.isArray(l)&&l.length>0){let x=Lm(l,h,g,y);if(x.result==="error")throw new Error(x.value.map(E=>`${E.key}: ${E.message}`).join(", "));return x.value}{let x=l;return typeof l=="string"&&h.type==="color"&&(x=Wi.parse(l)),{kind:"constant",isConfigDependent:!1,evaluate:()=>x}}}(i===void 0?e.specification.default:i,e.specification,o,a)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class ue{constructor(e,i,o){this.property=e,this.value=new X(e,void 0,i,o)}transitioned(e,i){return new ge(this.property,this.value,i,bo({},e.transition,this.transition),e.now)}untransitioned(){return new ge(this.property,this.value,null,{},0)}}class le{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=o,this.isConfigDependent=!1}getValue(e){return ls(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new ue(this._values[e].property,this._scope,this._options)),this._values[e].value=new X(this._values[e].property,i===null?void 0:ls(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,i){i&&(this._options=i);let o=this._properties.properties;if(e)for(let a in e){let l=e[a];if(na(a,"-transition")){let h=a.slice(0,-11);o[h]&&this.setTransition(h,l)}else o[a]&&this.setValue(a,l)}}getTransition(e){return ls(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new ue(this._values[e].property)),this._values[e].transition=ls(i)||void 0}serialize(){let e={};for(let i of Object.keys(this._values)){let o=this.getValue(i);o!==void 0&&(e[i]=o);let a=this.getTransition(i);a!==void 0&&(e[`${i}-transition`]=a)}return e}transitioned(e,i){let o=new Me(this._properties);for(let a of Object.keys(this._values))o._values[a]=this._values[a].transitioned(e,i._values[a]);return o}untransitioned(){let e=new Me(this._properties);for(let i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class ge{constructor(e,i,o,a,l){let h=a.delay||0,g=a.duration||0;l=l||0,this.property=e,this.value=i,this.begin=l+h,this.end=this.begin+g,e.specification.transition&&(a.delay||a.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){let a=e.now||0,l=this.value.possiblyEvaluate(e,i,o),h=this.prior;if(h){if(a>this.end)return this.prior=null,l;if(this.value.isDataDriven())return this.prior=null,l;if(a<this.begin)return h.possiblyEvaluate(e,i,o);{let g=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(h.possiblyEvaluate(e,i,o),l,Ll(g))}}return l}}class Me{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){let a=new Re(this._properties);for(let l of Object.keys(this._values))a._values[l]=this._values[l].possiblyEvaluate(e,i,o);return a}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class me{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=o,this.isConfigDependent=!1}getValue(e){return ls(this._values[e].value)}setValue(e,i){this._values[e]=new X(this._values[e].property,i===null?void 0:ls(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){let e={};for(let i of Object.keys(this._values)){let o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){let a=new Re(this._properties);for(let l of Object.keys(this._values))a._values[l]=this._values[l].possiblyEvaluate(e,i,o);return a}}class Ee{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,a){return this.property.evaluate(this.value,this.parameters,e,i,o,a)}}class Re{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class pe{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,o){let a=ua[this.specification.type];return a?a(e,i,o):e}}class xe{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,a){return new Ee(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,a)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Ee(this,{kind:"constant",value:void 0},e.parameters);let a=ua[this.specification.type];return a?new Ee(this,{kind:"constant",value:a(e.value.value,i.value.value,o)},e.parameters):e}evaluate(e,i,o,a,l,h){return e.kind==="constant"?e.value:e.evaluate(i,o,a,l,h)}}class He{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,a){return!!e.expression.evaluate(i,null,{},o,a)}interpolate(){return!1}}class ye{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let i=new $(0,{});for(let o in e){let a=e[o];a.specification.overridable&&this.overridableProperties.push(o);let l=this.defaultPropertyValues[o]=new X(a,void 0),h=this.defaultTransitionablePropertyValues[o]=new ue(a);this.defaultTransitioningPropertyValues[o]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=l.possiblyEvaluate(i)}}}function Se(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function De(t){if(Array.isArray(t))return t.map(De);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){let e={};for(let i in t)e[i]=De(t[i]);return e}return Se(t)}bt(xe,"DataDrivenProperty"),bt(pe,"DataConstantProperty"),bt(He,"ColorRampProperty");var re=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ue(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(let e of t.slice(1))if(!Ue(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function gt(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ue(t)||(t=Di(t));let i=t,o=!0;try{o=function(x){if(!At(x))return x;let E=De(x);return Ot(E),E=Et(E),E}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}let a=re[`filter_${e}`],l=Rc(o,a),h=null;if(l.result==="error")throw new Error(l.value.map(x=>`${x.key}: ${x.message}`).join(", "));h=(x,E,I)=>l.value.evaluate(x,E,{},I);let g=null,y=null;if(o!==i){let x=Rc(i,a);if(x.result==="error")throw new Error(x.value.map(E=>`${E.key}: ${E.message}`).join(", "));g=(E,I,M,D,P)=>x.value.evaluate(E,I,{},M,void 0,void 0,D,P),y=!yl(x.value.expression)}return{filter:h,dynamicFilter:g||void 0,needGeometry:ei(o),needFeature:!!y}}function Et(t){if(!Array.isArray(t))return t;let e=function(i){if(Nt.has(i[0])){for(let o=1;o<i.length;o++)if(At(i[o]))return!0}return i}(t);return e===!0?e:e.map(i=>Et(i))}function Ot(t){let e=!1,i=[];if(t[0]==="case"){for(let o=1;o<t.length-1;o+=2)e=e||At(t[o]),i.push(t[o+1]);i.push(t[t.length-1])}else if(t[0]==="match"){e=e||At(t[1]);for(let o=2;o<t.length-1;o+=2)i.push(t[o+1]);i.push(t[t.length-1])}else if(t[0]==="step"){e=e||At(t[1]);for(let o=1;o<t.length-1;o+=2)i.push(t[o+1])}e&&(t.length=0,t.push("any",...i));for(let o=1;o<t.length;o++)Ot(t[o])}function At(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<t.length;i++)if(At(t[i]))return!0;return!1}let Nt=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function xi(t,e){return t<e?-1:t>e?1:0}function ei(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(ei(t[e]))return!0;return!1}function Di(t){if(!t)return!0;let e=t[0];return t.length<=1?e!=="any":e==="=="?wi(t[1],t[2],"=="):e==="!="?dr(wi(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?wi(t[1],t[2],e):e==="any"?(i=t.slice(1),["any"].concat(i.map(Di))):e==="all"?["all"].concat(t.slice(1).map(Di)):e==="none"?["all"].concat(t.slice(1).map(Di).map(dr)):e==="in"?Cn(t[1],t.slice(2)):e==="!in"?dr(Cn(t[1],t.slice(2))):e==="has"?Xi(t[1]):e!=="!has"||dr(Xi(t[1]));var i}function wi(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function Cn(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(xi)]]:["filter-in-small",t,["literal",e]]}}function Xi(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function dr(t){return["!",t]}let Jn="";function fn(t,e){return e?`${t}${Jn}${e}`:t}let rn="-transition",ui=new Set(["fill","line","background","hillshade","raster"]);class di extends Hr{constructor(e,i,o,a){if(super(),this.id=e.id,this.fqid=fn(this.id,o),this.type=e.type,this.scope=o,this.options=a,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new me(i.layout,this.scope,a),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),i.paint)){this._transitionablePaint=new le(i.paint,this.scope,a);for(let l in e.paint)this.setPaintProperty(l,e.paint[l]);for(let l in e.layout)this.setLayoutProperty(l,e.layout[l]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Re(i.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return ui.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);let o=this._unevaluatedLayout;o._properties.properties[e]&&(o.setValue(e,i),this.isConfigDependent=this.isConfigDependent||o.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return na(e,rn)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){let o=this._transitionablePaint,a=o._properties.properties;if(na(e,rn)){let I=e.slice(0,-11);return a[I]&&o.setTransition(I,i||void 0),!1}if(!a[e])return!1;let l=o._values[e],h=l.value.isDataDriven(),g=l.value;o.setValue(e,i),this.isConfigDependent=this.isConfigDependent||o.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);let y=o._values[e].value,x=y.isDataDriven(),E=na(e,"pattern")||e==="line-dasharray";return x||h||E||this._handleOverridablePaintPropertyUpdate(e,g,y)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i){return null}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return Bl({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let i=this.paint.get(e);if(i instanceof Ee&&rd(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=gt(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,o,a,l,h,g,y,x){}queryIntersectsMatchingFeature(e,i,o,a){}}let wn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class mn{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class yi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function oi(t,e=1){let i=0,o=0;return{members:t.map(a=>{let l=wn[a.type].BYTES_PER_ELEMENT,h=i=wo(i,Math.max(e,l)),g=a.components||1;return o=Math.max(o,l),i+=l*g,{name:a.name,type:a.type,components:g,offset:h}}),size:wo(i,Math.max(o,e)),alignment:e}}function wo(t,e){return Math.ceil(t/e)*e}class Yr extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){let o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){let a=2*e;return this.int16[a+0]=i,this.int16[a+1]=o,e}}Yr.prototype.bytesPerElement=4,bt(Yr,"StructArrayLayout2i4");class Ir extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){let a=this.length;return this.resize(a+1),this.emplace(a,e,i,o)}emplace(e,i,o,a){let l=3*e;return this.int16[l+0]=i,this.int16[l+1]=o,this.int16[l+2]=a,e}}Ir.prototype.bytesPerElement=6,bt(Ir,"StructArrayLayout3i6");class Kr extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,a){let l=this.length;return this.resize(l+1),this.emplace(l,e,i,o,a)}emplace(e,i,o,a,l){let h=4*e;return this.int16[h+0]=i,this.int16[h+1]=o,this.int16[h+2]=a,this.int16[h+3]=l,e}}Kr.prototype.bytesPerElement=8,bt(Kr,"StructArrayLayout4i8");class To extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,a,l){let h=this.length;return this.resize(h+1),this.emplace(h,e,i,o,a,l)}emplace(e,i,o,a,l,h){let g=5*e;return this.int16[g+0]=i,this.int16[g+1]=o,this.int16[g+2]=a,this.int16[g+3]=l,this.int16[g+4]=h,e}}To.prototype.bytesPerElement=10,bt(To,"StructArrayLayout5i10");class ro extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,l,h,g){let y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,a,l,h,g)}emplace(e,i,o,a,l,h,g,y){let x=6*e,E=12*e,I=3*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.uint8[E+4]=a,this.uint8[E+5]=l,this.uint8[E+6]=h,this.uint8[E+7]=g,this.float32[I+2]=y,e}}ro.prototype.bytesPerElement=12,bt(ro,"StructArrayLayout2i4ub1f12");class Sr extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a){let l=this.length;return this.resize(l+1),this.emplace(l,e,i,o,a)}emplace(e,i,o,a,l){let h=4*e;return this.float32[h+0]=i,this.float32[h+1]=o,this.float32[h+2]=a,this.float32[h+3]=l,e}}Sr.prototype.bytesPerElement=16,bt(Sr,"StructArrayLayout4f16");class Nr extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){let o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){let a=2*e;return this.float32[a+0]=i,this.float32[a+1]=o,e}}Nr.prototype.bytesPerElement=8,bt(Nr,"StructArrayLayout2f8");class Vr extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,l){let h=this.length;return this.resize(h+1),this.emplace(h,e,i,o,a,l)}emplace(e,i,o,a,l,h){let g=6*e,y=3*e;return this.uint16[g+0]=i,this.uint16[g+1]=o,this.uint16[g+2]=a,this.uint16[g+3]=l,this.float32[y+2]=h,e}}Vr.prototype.bytesPerElement=12,bt(Vr,"StructArrayLayout4ui1f12");class pa extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,a){let l=this.length;return this.resize(l+1),this.emplace(l,e,i,o,a)}emplace(e,i,o,a,l){let h=4*e;return this.uint16[h+0]=i,this.uint16[h+1]=o,this.uint16[h+2]=a,this.uint16[h+3]=l,e}}pa.prototype.bytesPerElement=8,bt(pa,"StructArrayLayout4ui8");class Ns extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,a,l,h){let g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,a,l,h)}emplace(e,i,o,a,l,h,g){let y=6*e;return this.int16[y+0]=i,this.int16[y+1]=o,this.int16[y+2]=a,this.int16[y+3]=l,this.int16[y+4]=h,this.int16[y+5]=g,e}}Ns.prototype.bytesPerElement=12,bt(Ns,"StructArrayLayout6i12");class fa extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,a,l,h,g,y,x,E,I,M){let D=this.length;return this.resize(D+1),this.emplace(D,e,i,o,a,l,h,g,y,x,E,I,M)}emplace(e,i,o,a,l,h,g,y,x,E,I,M,D){let P=12*e;return this.int16[P+0]=i,this.int16[P+1]=o,this.int16[P+2]=a,this.int16[P+3]=l,this.uint16[P+4]=h,this.uint16[P+5]=g,this.uint16[P+6]=y,this.uint16[P+7]=x,this.int16[P+8]=E,this.int16[P+9]=I,this.int16[P+10]=M,this.int16[P+11]=D,e}}fa.prototype.bytesPerElement=24,bt(fa,"StructArrayLayout4i4ui4i24");class ma extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,l,h){let g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,a,l,h)}emplace(e,i,o,a,l,h,g){let y=10*e,x=5*e;return this.int16[y+0]=i,this.int16[y+1]=o,this.int16[y+2]=a,this.float32[x+2]=l,this.float32[x+3]=h,this.float32[x+4]=g,e}}ma.prototype.bytesPerElement=20,bt(ma,"StructArrayLayout3i3f20");class xl extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}xl.prototype.bytesPerElement=4,bt(xl,"StructArrayLayout1ul4");class bs extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){let o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){let a=2*e;return this.uint16[a+0]=i,this.uint16[a+1]=o,e}}bs.prototype.bytesPerElement=4,bt(bs,"StructArrayLayout2ui4");class Wu extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,a,l,h,g,y,x,E,I,M,D){let P=this.length;return this.resize(P+1),this.emplace(P,e,i,o,a,l,h,g,y,x,E,I,M,D)}emplace(e,i,o,a,l,h,g,y,x,E,I,M,D,P){let L=20*e,N=10*e;return this.int16[L+0]=i,this.int16[L+1]=o,this.int16[L+2]=a,this.int16[L+3]=l,this.int16[L+4]=h,this.float32[N+3]=g,this.float32[N+4]=y,this.float32[N+5]=x,this.float32[N+6]=E,this.int16[L+14]=I,this.uint32[N+8]=M,this.uint16[L+18]=D,this.uint16[L+19]=P,e}}Wu.prototype.bytesPerElement=40,bt(Wu,"StructArrayLayout5i4f1i1ul2ui40");class kc extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,a,l,h,g){let y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,a,l,h,g)}emplace(e,i,o,a,l,h,g,y){let x=8*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=a,this.int16[x+4]=l,this.int16[x+5]=h,this.int16[x+6]=g,this.int16[x+7]=y,e}}kc.prototype.bytesPerElement=16,bt(kc,"StructArrayLayout3i2i2i16");class Zu extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,a,l){let h=this.length;return this.resize(h+1),this.emplace(h,e,i,o,a,l)}emplace(e,i,o,a,l,h){let g=4*e,y=8*e;return this.float32[g+0]=i,this.float32[g+1]=o,this.float32[g+2]=a,this.int16[y+6]=l,this.int16[y+7]=h,e}}Zu.prototype.bytesPerElement=16,bt(Zu,"StructArrayLayout2f1f2i16");class Wa extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a){let l=this.length;return this.resize(l+1),this.emplace(l,e,i,o,a)}emplace(e,i,o,a,l){let h=12*e,g=3*e;return this.uint8[h+0]=i,this.uint8[h+1]=o,this.float32[g+1]=a,this.float32[g+2]=l,e}}Wa.prototype.bytesPerElement=12,bt(Wa,"StructArrayLayout2ub2f12");class Mr extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){let a=this.length;return this.resize(a+1),this.emplace(a,e,i,o)}emplace(e,i,o,a){let l=3*e;return this.uint16[l+0]=i,this.uint16[l+1]=o,this.uint16[l+2]=a,e}}Mr.prototype.bytesPerElement=6,bt(Mr,"StructArrayLayout3ui6");class Hu extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,l,h,g,y,x,E,I,M,D,P,L,N,V,Z,Y,Q,ae){let te=this.length;return this.resize(te+1),this.emplace(te,e,i,o,a,l,h,g,y,x,E,I,M,D,P,L,N,V,Z,Y,Q,ae)}emplace(e,i,o,a,l,h,g,y,x,E,I,M,D,P,L,N,V,Z,Y,Q,ae,te){let ce=30*e,he=15*e,be=60*e;return this.int16[ce+0]=i,this.int16[ce+1]=o,this.int16[ce+2]=a,this.float32[he+2]=l,this.float32[he+3]=h,this.uint16[ce+8]=g,this.uint16[ce+9]=y,this.uint32[he+5]=x,this.uint32[he+6]=E,this.uint32[he+7]=I,this.uint16[ce+16]=M,this.uint16[ce+17]=D,this.uint16[ce+18]=P,this.float32[he+10]=L,this.float32[he+11]=N,this.uint8[be+48]=V,this.uint8[be+49]=Z,this.uint8[be+50]=Y,this.uint32[he+13]=Q,this.int16[ce+28]=ae,this.uint8[be+58]=te,e}}Hu.prototype.bytesPerElement=60,bt(Hu,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class sy extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,l,h,g,y,x,E,I,M,D,P,L,N,V,Z,Y,Q,ae,te,ce,he,be,Pe,Te,Le,Oe,ke,$e,qe){let Xe=this.length;return this.resize(Xe+1),this.emplace(Xe,e,i,o,a,l,h,g,y,x,E,I,M,D,P,L,N,V,Z,Y,Q,ae,te,ce,he,be,Pe,Te,Le,Oe,ke,$e,qe)}emplace(e,i,o,a,l,h,g,y,x,E,I,M,D,P,L,N,V,Z,Y,Q,ae,te,ce,he,be,Pe,Te,Le,Oe,ke,$e,qe,Xe){let Qe=20*e,Fe=40*e,It=80*e;return this.float32[Qe+0]=i,this.float32[Qe+1]=o,this.int16[Fe+4]=a,this.int16[Fe+5]=l,this.int16[Fe+6]=h,this.int16[Fe+7]=g,this.int16[Fe+8]=y,this.int16[Fe+9]=x,this.int16[Fe+10]=E,this.int16[Fe+11]=I,this.int16[Fe+12]=M,this.uint16[Fe+13]=D,this.uint16[Fe+14]=P,this.uint16[Fe+15]=L,this.uint16[Fe+16]=N,this.uint16[Fe+17]=V,this.uint16[Fe+18]=Z,this.uint16[Fe+19]=Y,this.uint16[Fe+20]=Q,this.uint16[Fe+21]=ae,this.uint16[Fe+22]=te,this.uint16[Fe+23]=ce,this.uint16[Fe+24]=he,this.uint16[Fe+25]=be,this.uint16[Fe+26]=Pe,this.uint16[Fe+27]=Te,this.uint32[Qe+14]=Le,this.float32[Qe+15]=Oe,this.float32[Qe+16]=ke,this.float32[Qe+17]=$e,this.float32[Qe+18]=qe,this.uint8[It+76]=Xe,e}}sy.prototype.bytesPerElement=80,bt(sy,"StructArrayLayout2f9i15ui1ul4f1ub80");class zp extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}zp.prototype.bytesPerElement=4,bt(zp,"StructArrayLayout1f4");class Qu extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,l){let h=this.length;return this.resize(h+1),this.emplace(h,e,i,o,a,l)}emplace(e,i,o,a,l,h){let g=5*e;return this.float32[g+0]=i,this.float32[g+1]=o,this.float32[g+2]=a,this.float32[g+3]=l,this.float32[g+4]=h,e}}Qu.prototype.bytesPerElement=20,bt(Qu,"StructArrayLayout5f20");class ay extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,l,h,g){let y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,a,l,h,g)}emplace(e,i,o,a,l,h,g,y){let x=7*e;return this.float32[x+0]=i,this.float32[x+1]=o,this.float32[x+2]=a,this.float32[x+3]=l,this.float32[x+4]=h,this.float32[x+5]=g,this.float32[x+6]=y,e}}ay.prototype.bytesPerElement=28,bt(ay,"StructArrayLayout7f28");class ly extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,a){let l=this.length;return this.resize(l+1),this.emplace(l,e,i,o,a)}emplace(e,i,o,a,l){let h=6*e;return this.uint32[3*e+0]=i,this.uint16[h+2]=o,this.uint16[h+3]=a,this.uint16[h+4]=l,e}}ly.prototype.bytesPerElement=12,bt(ly,"StructArrayLayout1ul3ui12");class cy extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}cy.prototype.bytesPerElement=2,bt(cy,"StructArrayLayout1ui2");class Xu extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){let a=this.length;return this.resize(a+1),this.emplace(a,e,i,o)}emplace(e,i,o,a){let l=3*e;return this.float32[l+0]=i,this.float32[l+1]=o,this.float32[l+2]=a,e}}Xu.prototype.bytesPerElement=12,bt(Xu,"StructArrayLayout3f12");class uy extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,l,h,g,y,x,E,I,M,D,P,L,N){let V=this.length;return this.resize(V+1),this.emplace(V,e,i,o,a,l,h,g,y,x,E,I,M,D,P,L,N)}emplace(e,i,o,a,l,h,g,y,x,E,I,M,D,P,L,N,V){let Z=16*e;return this.float32[Z+0]=i,this.float32[Z+1]=o,this.float32[Z+2]=a,this.float32[Z+3]=l,this.float32[Z+4]=h,this.float32[Z+5]=g,this.float32[Z+6]=y,this.float32[Z+7]=x,this.float32[Z+8]=E,this.float32[Z+9]=I,this.float32[Z+10]=M,this.float32[Z+11]=D,this.float32[Z+12]=P,this.float32[Z+13]=L,this.float32[Z+14]=N,this.float32[Z+15]=V,e}}uy.prototype.bytesPerElement=64,bt(uy,"StructArrayLayout16f64");class Nm extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,l,h,g){let y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,a,l,h,g)}emplace(e,i,o,a,l,h,g,y){let x=10*e,E=5*e;return this.uint16[x+0]=i,this.uint16[x+1]=o,this.uint16[x+2]=a,this.uint16[x+3]=l,this.float32[E+2]=h,this.float32[E+3]=g,this.float32[E+4]=y,e}}Nm.prototype.bytesPerElement=20,bt(Nm,"StructArrayLayout4ui3f20");class hy extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}hy.prototype.bytesPerElement=2,bt(hy,"StructArrayLayout1i2");class dy extends yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}dy.prototype.bytesPerElement=1,bt(dy,"StructArrayLayout1ub1");class Jb extends mn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Jb.prototype.size=40;class ex extends Wu{get(e){return new Jb(this,e)}}bt(ex,"CollisionBoxArray");class tx extends mn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}tx.prototype.size=60;class ix extends Hu{get(e){return new tx(this,e)}}bt(ix,"PlacedSymbolArray");class nx extends mn{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}nx.prototype.size=80;class rx extends sy{get(e){return new nx(this,e)}}bt(rx,"SymbolInstanceArray");class ox extends zp{getoffsetX(e){return this.float32[1*e+0]}}bt(ox,"GlyphOffsetArray");class sx extends Yr{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}bt(sx,"SymbolLineVertexArray");class ax extends mn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ax.prototype.size=12;class lx extends ly{get(e){return new ax(this,e)}}bt(lx,"FeatureIndexArray");class cx extends bs{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}bt(cx,"FillExtrusionCentroidArray");let AC=oi([{name:"a_pos",components:2,type:"Int16"}],4),DC=oi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class er{constructor(e=[]){this.segments=e}_prepareSegment(e,i,o,a){let l=this.segments[this.segments.length-1];return e>er.MAX_VERTEX_ARRAY_LENGTH&&Mn(`Max vertices per segment is ${er.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!l||l.vertexLength+e>er.MAX_VERTEX_ARRAY_LENGTH||l.sortKey!==a)&&(l={vertexOffset:i,primitiveOffset:o,vertexLength:0,primitiveLength:0},a!==void 0&&(l.sortKey=a),this.segments.push(l)),l}prepareSegment(e,i,o,a){return this._prepareSegment(e,i.length,o.length,a)}get(){return this.segments}destroy(){for(let e of this.segments)for(let i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,a){return new er([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:a,vaos:{},sortKey:0}])}}function ux(t,e){return 256*(t=gi(Math.floor(t),0,255))+gi(Math.floor(e),0,255)}er.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,bt(er,"SegmentVector");let RC=oi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),PC=oi([{name:"a_dash",components:4,type:"Uint16"}]);class Bp{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,o,a){this.ids.push(hx(e)),this.positions.push(i,o,a)}eachPosition(e,i){let o=hx(e),a=0,l=this.ids.length-1;for(;a<l;){let h=a+l>>1;this.ids[h]>=o?l=h:a=h+1}for(;this.ids[a]===o;)i(this.positions[3*a],this.positions[3*a+1],this.positions[3*a+2]),a++}static serialize(e,i){let o=new Float64Array(e.ids),a=new Uint32Array(e.positions);return py(o,a,0,o.length-1),i&&(i.add(o.buffer),i.add(a.buffer)),{ids:o,positions:a}}static deserialize(e){let i=new Bp,o;i.ids=e.ids,i.positions=e.positions;for(let a of i.ids)a!==o&&i.uniqueIds.push(a),o=a;return i.indexed=!0,i}}function hx(t){let e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:dn(String(t))}function py(t,e,i,o){for(;i<o;){let a=t[i+o>>1],l=i-1,h=o+1;for(;;){do l++;while(t[l]<a);do h--;while(t[h]>a);if(l>=h)break;Vm(t,l,h),Vm(e,3*l,3*h),Vm(e,3*l+1,3*h+1),Vm(e,3*l+2,3*h+2)}h-i<o-h?(py(t,e,i,h),i=h+1):(py(t,e,h+1,o),o=h)}}function Vm(t,e,i){let o=t[e];t[e]=t[i],t[i]=o}bt(Bp,"FeaturePositionMap");class Jl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,o){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class jm extends Jl{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class Fo extends Jl{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class Oc extends Jl{constructor(e){super(e),this.current=[0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class fy extends Jl{constructor(e){super(e),this.current=[0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class dx extends Jl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class px extends Jl{constructor(e){super(e),this.current=Wi.transparent}set(e,i,o){this.fetchUniformLocation(e,i)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}let kC=new Float32Array(16);class Np extends Jl{constructor(e){super(e),this.current=kC}set(e,i,o){if(this.fetchUniformLocation(e,i)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let a=1;a<16;a++)if(o[a]!==this.current[a]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}let OC=new Float32Array(9),LC=new Float32Array(4);class my extends Jl{constructor(e){super(e),this.current=LC}set(e,i,o){if(this.fetchUniformLocation(e,i)){for(let a=0;a<4;a++)if(o[a]!==this.current[a]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function gy(t){return[ux(255*t.r,255*t.g),ux(255*t.b,255*t.a)]}class Vp{constructor(e,i,o){this.value=e,this.uniformNames=i.map(a=>`u_${a}`),this.type=o}setUniform(e,i,o,a,l){i.set(e,l,a.constantOr(this.value))}getBinding(e,i){return this.type==="color"?new px(e):new Fo(e)}}class cd{constructor(e,i){this.uniformNames=i.map(o=>`u_${o}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,o,a,l){let h=l==="u_pattern"||l==="u_dash"?this.pattern:l==="u_pixel_ratio"?this.pixelRatio:null;h&&i.set(e,l,h)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new dx(e):new Fo(e)}}class ec{constructor(e,i,o,a){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map(l=>({name:`a_${l}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,i,o,a,l,h,g){let y=this.paintVertexArray.length,x=this.expression.evaluate(new $(0,{brightness:h}),i,{},l,a,g);this.paintVertexArray.resize(e),this._setPaintValue(y,e,x)}updatePaintArray(e,i,o,a,l,h,g){let y=this.expression.evaluate({zoom:0,brightness:g},o,a,void 0,l);this._setPaintValue(e,i,y)}_setPaintValue(e,i,o){if(this.type==="color"){let a=gy(o);for(let l=e;l<i;l++)this.paintVertexArray.emplace(l,a[0],a[1])}else{for(let a=e;a<i;a++)this.paintVertexArray.emplace(a,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Za{constructor(e,i,o,a,l,h){this.expression=e,this.uniformNames=i.map(g=>`u_${g}_t`),this.type=o,this.useIntegerZoom=a,this.zoom=l,this.maxValue=0,this.paintVertexAttributes=i.map(g=>({name:`a_${g}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,i,o,a,l,h,g){let y=this.expression.evaluate(new $(this.zoom,{brightness:h}),i,{},l,a,g),x=this.expression.evaluate(new $(this.zoom+1,{brightness:h}),i,{},l,a,g),E=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(E,e,y,x)}updatePaintArray(e,i,o,a,l,h,g){let y=this.expression.evaluate({zoom:this.zoom,brightness:g},o,a,void 0,l),x=this.expression.evaluate({zoom:this.zoom+1,brightness:g},o,a,void 0,l);this._setPaintValue(e,i,y,x)}_setPaintValue(e,i,o,a){if(this.type==="color"){let l=gy(o),h=gy(a);for(let g=e;g<i;g++)this.paintVertexArray.emplace(g,l[0],l[1],h[0],h[1])}else{for(let l=e;l<i;l++)this.paintVertexArray.emplace(l,o,a);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,o,a,l){let h=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,g=gi(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);i.set(e,l,g)}getBinding(e,i){return new Fo(e)}}class Lc{constructor(e,i,o,a,l){this.expression=e,this.layerId=l,this.paintVertexAttributes=(o==="array"?PC:RC).members;for(let h=0;h<i.length;++h);this.paintVertexArray=new a}populatePaintArray(e,i,o){let a=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(a,e,i.patterns&&i.patterns[this.layerId],o)}updatePaintArray(e,i,o,a,l,h,g){this._setPaintValues(e,i,o.patterns&&o.patterns[this.layerId],h)}_setPaintValues(e,i,o,a){if(!a||!o)return;let l=a[o];if(!l)return;let{tl:h,br:g,pixelRatio:y}=l;for(let x=e;x<i;x++)this.paintVertexArray.emplace(x,h[0],h[1],g[0],g[1],y)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Yu{constructor(e,i,o=()=>!0){this.binders={},this._buffers=[];let a=[];for(let l in e.paint._values){let h=e.paint.get(l);if(!o(l)||!(h instanceof Ee&&rd(h.property.specification)))continue;let g=zC(l,e.type),y=h.value,x=h.property.specification.type,E=!!h.property.useIntegerZoom,I=l==="line-dasharray"||l.endsWith("pattern"),M=l==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(y.kind!=="constant"||M)if(y.kind==="source"||M||I){let D=fx(l,x,"source");this.binders[l]=I?new Lc(y,g,x,D,e.id):new ec(y,g,x,D),a.push(`/a_${l}`)}else{let D=fx(l,x,"composite");this.binders[l]=new Za(y,g,x,E,i,D),a.push(`/z_${l}`)}else this.binders[l]=I?new cd(y.value,g):new Vp(y.value,g,x),a.push(`/u_${l}`)}this.cacheKey=a.sort().join("")}getMaxValue(e){let i=this.binders[e];return i instanceof ec||i instanceof Za?i.maxValue:0}populatePaintArrays(e,i,o,a,l,h,g){for(let y in this.binders){let x=this.binders[y];(x instanceof ec||x instanceof Za||x instanceof Lc)&&x.populatePaintArray(e,i,o,a,l,h,g)}}setConstantPatternPositions(e){for(let i in this.binders){let o=this.binders[i];o instanceof cd&&o.setConstantPatternPositions(e)}}updatePaintArrays(e,i,o,a,l,h,g,y){let x=!1,E=Object.keys(e),I=E.length!==0,M=I?E:i.uniqueIds;for(let D in this.binders){let P=this.binders[D];if((P instanceof ec||P instanceof Za||P instanceof Lc)&&(P.expression.isStateDependent===!0||P.expression.isLightConstant===!1)){let L=l.paint.get(D);P.expression=L.value;for(let N of M){let V=e[N.toString()];i.eachPosition(N,(Z,Y,Q)=>{let ae=a.feature(Z);P.updatePaintArray(Y,Q,ae,V,h,g,y)})}if(!I)for(let N of o.uniqueIds){let V=e[N.toString()];o.eachPosition(N,(Z,Y,Q)=>{let ae=a.feature(Z);P.updatePaintArray(Y,Q,ae,V,h,g,y)})}x=!0}}return x}defines(){let e=[];for(let i in this.binders){let o=this.binders[i];(o instanceof Vp||o instanceof cd)&&e.push(...o.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return e}getBinderAttributes(){let e=[];for(let i in this.binders){let o=this.binders[i];if(o instanceof ec||o instanceof Za||o instanceof Lc)for(let a=0;a<o.paintVertexAttributes.length;a++)e.push(o.paintVertexAttributes[a].name)}return e}getBinderUniforms(){let e=[];for(let i in this.binders){let o=this.binders[i];if(o instanceof Vp||o instanceof cd||o instanceof Za)for(let a of o.uniformNames)e.push(a)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let i=[];for(let o in this.binders){let a=this.binders[o];if(a instanceof Vp||a instanceof cd||a instanceof Za)for(let l of a.uniformNames)i.push({name:l,property:o,binding:a.getBinding(e,l)})}return i}setUniforms(e,i,o,a,l){for(let{name:h,property:g,binding:y}of o)this.binders[g].setUniform(e,y,l,a.get(g),h)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let i=this.binders[e];(i instanceof ec||i instanceof Za||i instanceof Lc)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(let i in this.binders){let o=this.binders[i];(o instanceof ec||o instanceof Za||o instanceof Lc)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let i=this.binders[e];(i instanceof ec||i instanceof Za||i instanceof Lc)&&i.destroy()}}}class Fc{constructor(e,i,o=()=>!0){this.programConfigurations={};for(let a of e)this.programConfigurations[a.id]=new Yu(a,i,o);this.needsUpload=!1,this._featureMap=new Bp,this._featureMapWithoutIds=new Bp,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,o,a,l,h,g,y){for(let x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,i,a,l,h,g,y);i.id!==void 0?this._featureMap.add(i.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,a,l,h){for(let g of o)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,g,a,l,h||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let FC={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function zC(t,e){return FC[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}let BC={"line-pattern":{source:Vr,composite:Vr},"fill-pattern":{source:Vr,composite:Vr},"fill-extrusion-pattern":{source:Vr,composite:Vr},"line-dasharray":{source:pa,composite:pa}},NC={color:{source:Nr,composite:Sr},number:{source:zp,composite:Nr}};function fx(t,e,i){let o=BC[t];return o&&o[i]||NC[e][i]}bt(Vp,"ConstantBinder"),bt(cd,"PatternConstantBinder"),bt(ec,"SourceExpressionBinder"),bt(Lc,"PatternCompositeBinder"),bt(Za,"CompositeExpressionBinder"),bt(Yu,"ProgramConfiguration",{omit:["_buffers"]}),bt(Fc,"ProgramConfigurationSet");let zo=pt/Math.PI/2,_y=5,mx=6,VC=16383,ud=64,yy=[ud,32,16],ga=-zo,_a=zo;function hd(t,e,i,o=zo){return i=Si(i),[t*Math.sin(i)*o,-e*o,t*Math.cos(i)*o]}function Ku(t,e,i){return hd(Math.cos(Si(t)),Math.sin(Si(t)),e,i)}let dd=63710088e-1,vy=2*Math.PI*dd;class Bi{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Bi(as(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let i=Math.PI/180,o=this.lat*i,a=e.lat*i,l=Math.sin(o)*Math.sin(a)+Math.cos(o)*Math.cos(a)*Math.cos((e.lng-this.lng)*i);return dd*Math.acos(Math.min(l,1))}toBounds(e=0){let i=360*e/40075017,o=i/Math.cos(Math.PI/180*this.lat);return new zc({lng:this.lng-o,lat:this.lat-i},{lng:this.lng+o,lat:this.lat+i})}toEcef(e){return Ku(this.lat,this.lng,zo+e*zo/dd)}static convert(e){if(e instanceof Bi)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Bi(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Bi(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class zc{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){let o=e;this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]])}else{let o=e;this.setSouthWest(o[0]).setNorthEast(o[1])}}setNorthEast(e){return this._ne=e instanceof Bi?new Bi(e.lng,e.lat):Bi.convert(e),this}setSouthWest(e){return this._sw=e instanceof Bi?new Bi(e.lng,e.lat):Bi.convert(e),this}extend(e){let i=this._sw,o=this._ne,a,l;if(e instanceof Bi)a=e,l=e;else{if(!(e instanceof zc))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(zc.convert(e)):this.extend(Bi.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Bi.convert(e)):this;if(a=e._sw,l=e._ne,!a||!l)return this}return i||o?(i.lng=Math.min(a.lng,i.lng),i.lat=Math.min(a.lat,i.lat),o.lng=Math.max(l.lng,o.lng),o.lat=Math.max(l.lat,o.lat)):(this._sw=new Bi(a.lng,a.lat),this._ne=new Bi(l.lng,l.lat)),this}getCenter(){return new Bi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Bi(this.getWest(),this.getNorth())}getSouthEast(){return new Bi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:i,lat:o}=Bi.convert(e),a=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&a}static convert(e){return!e||e instanceof zc?e:new zc(e)}}var gx={};(function(t,e){(function(i){function o(l,h,g){var y=a(256*l,256*(h=Math.pow(2,g)-h-1),g),x=a(256*(l+1),256*(h+1),g);return y[0]+","+y[1]+","+x[0]+","+x[1]}function a(l,h,g){var y=2*Math.PI*6378137/256/Math.pow(2,g);return[l*y-2*Math.PI*6378137/2,h*y-2*Math.PI*6378137/2]}i.getURL=function(l,h,g,y,x,E){return E=E||{},l+"?"+["bbox="+o(g,y,x),"format="+(E.format||"image/png"),"service="+(E.service||"WMS"),"version="+(E.version||"1.1.1"),"request="+(E.request||"GetMap"),"srs="+(E.srs||"EPSG:3857"),"width="+(E.width||256),"height="+(E.height||256),"layers="+h].join("&")},i.getTileBBox=o,i.getMercCoords=a,Object.defineProperty(i,"__esModule",{value:!0})})(e)})(0,gx);var jC=gx;class Ju{constructor(e,i,o){this.z=e,this.x=i,this.y=o,this.key=jp(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){let o=jC.getTileBBox(this.x,this.y,this.z),a=function(l,h,g){let y,x="";for(let E=l;E>0;E--)y=1<<E-1,x+=(h&y?1:0)+(g&y?2:0);return x}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class _x{constructor(e,i){this.wrap=e,this.canonical=i,this.key=jp(e,i.z,i.z,i.x,i.y)}}class oo{constructor(e,i,o,a,l){this.overscaledZ=e,this.wrap=i,this.canonical=new Ju(o,+a,+l),this.key=i===0&&e===o?this.canonical.key:jp(i,e,o,a,l)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let i=this.canonical.z-e;return e>this.canonical.z?new oo(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new oo(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return jp(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{let o=this.canonical.z-e;return jp(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new oo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let i=this.canonical.z+1,o=2*this.canonical.x,a=2*this.canonical.y;return[new oo(i,this.wrap,i,o,a),new oo(i,this.wrap,i,o+1,a),new oo(i,this.wrap,i,o,a+1),new oo(i,this.wrap,i,o+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new oo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new oo(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new _x(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function jp(t,e,i,o,a){let l=1<<Math.min(i,22),h=l*(a%l)+o%l;return t&&i<22&&(h+=l*l*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*h+i)+(e-i)}let UC=[t=>{let e=t.canonical.x-1,i=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,i--),new oo(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,i=t.wrap;return e===1<<t.canonical.z&&(e=0,i++),new oo(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>new oo(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new oo(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];bt(Ju,"CanonicalTileID"),bt(oo,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let GC=0,qC=25.5;function by(t){return vy*Math.cos(t*Math.PI/180)}function Bc(t){return(180+t)/360}function tc(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Bo(t,e){return t/by(e)}function xs(t){return 360*t-180}function Jr(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function yx(t,e){return t*by(Jr(e))}let tr=85.051129;function vx(t){return Math.cos(Si(gi(t,-tr,tr)))}function eh(t,e){let i=gi(e,GC,qC),o=Math.pow(2,i);return vx(t)*vy/(512*o)}function bx(t){return 1/Math.cos(t*Math.PI/180)}function Um(t,e=0){let i=Math.exp(Math.PI*(1-(t.y+e/pt)/(1<<t.z)*2));return 80150034*i/(i*i+1)/pt/(1<<t.z)}class so{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){let o=Bi.convert(e);return new so(Bc(o.lng),tc(o.lat),Bo(i,o.lat))}toLngLat(){return new Bi(xs(this.x),Jr(this.y))}toAltitude(){return yx(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/vy*bx(Jr(this.y))}}function xy(t,e,i,o,a,l,h,g,y){let x=(e+o)/2,E=(i+a)/2,I=new ct(x,E);g(I),function(M,D,P,L,N,V){let Z=P-N,Y=L-V;return Math.abs((L-D)*Z-(P-M)*Y)/Math.hypot(Z,Y)}(I.x,I.y,l.x,l.y,h.x,h.y)>=y?(xy(t,e,i,x,E,l,I,g,y),xy(t,x,E,o,a,I,h,g,y)):t.push(h)}function xx(t,e,i){let o=t[0],a=o.x,l=o.y;e(o);let h=[o];for(let g=1;g<t.length;g++){let y=t[g],{x,y:E}=y;e(y),xy(h,a,l,x,E,o,y,e,i),a=x,l=E,o=y}return h}function wy(t,e,i,o){if(o(e,i)){let a=e.add(i)._mult(.5);wy(t,e,a,o),wy(t,a,i,o)}else t.push(i)}function $C(t,e){let i=t[0],o=[i];for(let a=1;a<t.length;a++){let l=t[a];wy(o,i,l,e),i=l}return o}let Ty=Math.pow(2,14)-1,wx=-Ty-1;function WC(t,e){let i=Math.round(t.x*e),o=Math.round(t.y*e);return t.x=gi(i,wx,Ty),t.y=gi(o,wx,Ty),(i<t.x||i>t.x+1||o<t.y||o>t.y+1)&&Mn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function ic(t,e,i){let o=t.loadGeometry(),a=t.extent,l=pt/a;if(e&&i&&i.projection.isReprojectedInTileSpace){let h=1<<e.z,{scale:g,x:y,y:x,projection:E}=i,I=M=>{let D=xs((e.x+M.x/a)/h),P=Jr((e.y+M.y/a)/h),L=E.project(D,P);M.x=(L.x*g-y)*a,M.y=(L.y*g-x)*a};for(let M=0;M<o.length;M++)if(t.type!==1)o[M]=xx(o[M],I,1);else{let D=[];for(let P of o[M])P.x<0||P.x>=a||P.y<0||P.y>=a||(I(P),D.push(P));o[M]=D}}for(let h of o)for(let g of h)WC(g,l);return o}function Nc(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?ic(t):[]}}function Gm(t,e,i,o,a){t.emplaceBack(2*e+(o+1)/2,2*i+(a+1)/2)}function qm(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Ey{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Yr,this.indexArray=new Mr,this.segments=new er,this.programConfigurations=new Fc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,o,a){let l=this.layers[0],h=[],g=null;l.type==="circle"&&(g=l.layout.get("circle-sort-key"));for(let{feature:x,id:E,index:I,sourceLayerIndex:M}of e){let D=this.layers[0]._featureFilter.needGeometry,P=Nc(x,D);if(!this.layers[0]._featureFilter.filter(new $(this.zoom),P,o))continue;let L=g?g.evaluate(P,{},o):void 0,N={id:E,properties:x.properties,type:x.type,sourceLayerIndex:M,index:I,geometry:D?P.geometry:ic(x,o,a),patterns:{},sortKey:L};h.push(N)}g&&h.sort((x,E)=>x.sortKey-E.sortKey);let y=null;a.projection.name==="globe"&&(this.globeExtVertexArray=new Ns,y=a.projection);for(let x of h){let{geometry:E,index:I,sourceLayerIndex:M}=x,D=e[I].feature;this.addFeature(x,E,I,i.availableImages,o,y,i.brightness),i.featureIndex.insert(D,E,I,M,this.index)}}update(e,i,o,a,l){let h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,h?this.stateDependentLayers:this.layers,o,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,AC.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,DC.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,o,a,l,h,g){for(let y of i)for(let x of y){let E=x.x,I=x.y;if(E<0||E>=pt||I<0||I>=pt)continue;if(h){let P=h.projectTilePoint(E,I,l),L=h.upVector(l,E,I),N=this.globeExtVertexArray;qm(N,P,L),qm(N,P,L),qm(N,P,L),qm(N,P,L)}let M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),D=M.vertexLength;Gm(this.layoutVertexArray,E,I,-1,-1),Gm(this.layoutVertexArray,E,I,1,-1),Gm(this.layoutVertexArray,E,I,1,1),Gm(this.layoutVertexArray,E,I,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+2,D+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},a,l,g)}}function Iy(t,e){for(let i=0;i<t.length;i++)if(th(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(th(t,e[i]))return!0;return!!Sy(t,e)}function ZC(t,e,i){return!!th(t,e)||!!My(e,t,i)}function Tx(t,e){if(t.length===1)return Ix(e,t[0]);for(let i=0;i<e.length;i++){let o=e[i];for(let a=0;a<o.length;a++)if(th(t,o[a]))return!0}for(let i=0;i<t.length;i++)if(Ix(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Sy(t,e[i]))return!0;return!1}function HC(t,e,i){if(t.length>1){if(Sy(t,e))return!0;for(let o=0;o<e.length;o++)if(My(e[o],t,i))return!0}for(let o=0;o<t.length;o++)if(My(t[o],e,i))return!0;return!1}function Sy(t,e){if(t.length===0||e.length===0)return!1;for(let i=0;i<t.length-1;i++){let o=t[i],a=t[i+1];for(let l=0;l<e.length-1;l++)if(QC(o,a,e[l],e[l+1]))return!0}return!1}function QC(t,e,i,o){return ks(t,i,o)!==ks(e,i,o)&&ks(t,e,i)!==ks(t,e,o)}function My(t,e,i){let o=i*i;if(e.length===1)return t.distSqr(e[0])<o;for(let a=1;a<e.length;a++)if(Ex(t,e[a-1],e[a])<o)return!0;return!1}function Ex(t,e,i){let o=e.distSqr(i);if(o===0)return t.distSqr(e);let a=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/o;return t.distSqr(a<0?e:a>1?i:i.sub(e)._mult(a)._add(e))}function Ix(t,e){let i,o,a,l=!1;for(let h=0;h<t.length;h++){i=t[h];for(let g=0,y=i.length-1;g<i.length;y=g++)o=i[g],a=i[y],o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(l=!l)}return l}function th(t,e){let i=!1;for(let o=0,a=t.length-1;o<t.length;a=o++){let l=t[o],h=t[a];l.y>e.y!=h.y>e.y&&e.x<(h.x-l.x)*(e.y-l.y)/(h.y-l.y)+l.x&&(i=!i)}return i}function Sx(t,e,i,o,a){for(let h of t)if(e<=h.x&&i<=h.y&&o>=h.x&&a>=h.y)return!0;let l=[new ct(e,i),new ct(e,a),new ct(o,a),new ct(o,i)];if(t.length>2){for(let h of l)if(th(t,h))return!0}for(let h=0;h<t.length-1;h++)if(XC(t[h],t[h+1],l))return!0;return!1}function XC(t,e,i){let o=i[0],a=i[2];if(t.x<o.x&&e.x<o.x||t.x>a.x&&e.x>a.x||t.y<o.y&&e.y<o.y||t.y>a.y&&e.y>a.y)return!1;let l=ks(t,e,i[0]);return l!==ks(t,e,i[1])||l!==ks(t,e,i[2])||l!==ks(t,e,i[3])}function pd(t,e,i,o,a,l){let h=e.y-t.y,g=t.x-e.x;if(l=l||0){let y=h*h+g*g;if(y===0)return!0;let x=Math.sqrt(y);h/=x,g/=x}return!((i.x-t.x)*h+(i.y-t.y)*g-l<0||(o.x-t.x)*h+(o.y-t.y)*g-l<0||(a.x-t.x)*h+(a.y-t.y)*g-l<0)}function Cy(t,e,i,o,a,l,h){return!(pd(t,e,o,a,l,h)||pd(e,i,o,a,l,h)||pd(i,t,o,a,l,h)||pd(o,a,t,e,i,h)||pd(a,l,t,e,i,h)||pd(l,o,t,e,i,h))}function fd(t,e,i){let o=e.paint.get(t).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(t)}function $m(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Mx(t,e,i,o,a){if(!e[0]&&!e[1])return t;let l=ct.convert(e)._mult(a);i==="viewport"&&l._rotate(-o);let h=[];for(let g=0;g<t.length;g++)h.push(t[g].sub(l));return h}function Cx(t,e,i,o){let a=ct.convert(t)._mult(o);return e==="viewport"&&a._rotate(-i),a}bt(Ey,"CircleBucket",{omit:["layers"]});let YC=new ye({"circle-sort-key":new xe(re.layout_circle["circle-sort-key"]),visibility:new pe(re.layout_circle.visibility)});var KC={paint:new ye({"circle-radius":new xe(re.paint_circle["circle-radius"]),"circle-color":new xe(re.paint_circle["circle-color"]),"circle-blur":new xe(re.paint_circle["circle-blur"]),"circle-opacity":new xe(re.paint_circle["circle-opacity"]),"circle-translate":new pe(re.paint_circle["circle-translate"]),"circle-translate-anchor":new pe(re.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new pe(re.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new pe(re.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new xe(re.paint_circle["circle-stroke-width"]),"circle-stroke-color":new xe(re.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new xe(re.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new pe(re.paint_circle["circle-emissive-strength"])}),layout:YC};class Ay{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){let a=r.Q.dot(i,this.dir);if(Math.abs(a)<1e-6)return!1;let l=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/a;return o[0]=this.pos[0]+this.dir[0]*l,o[1]=this.pos[1]+this.dir[1]*l,o[2]=this.pos[2]+this.dir[2]*l,!0}closestPointOnSphere(e,i,o){if(r.Q.equals(this.pos,e)||i===0)return o[0]=o[1]=o[2]=0,!1;let[a,l,h]=this.dir,g=this.pos[0]-e[0],y=this.pos[1]-e[1],x=this.pos[2]-e[2],E=a*a+l*l+h*h,I=2*(g*a+y*l+x*h),M=I*I-4*E*(g*g+y*y+x*x-i*i);if(M<0){let D=Math.max(-I/2,0),P=g+a*D,L=y+l*D,N=x+h*D,V=Math.hypot(P,L,N);return o[0]=P*i/V,o[1]=L*i/V,o[2]=N*i/V,!1}{let D=(-I-Math.sqrt(M))/(2*E);if(D<0){let P=Math.hypot(g,y,x);return o[0]=g*i/P,o[1]=y*i/P,o[2]=x*i/P,!1}return o[0]=g+a*D,o[1]=y+l*D,o[2]=x+h*D,!0}}}class Dy{constructor(e,i,o,a,l){this.TL=e,this.TR=i,this.BR=o,this.BL=a,this.horizon=l}static fromInvProjectionMatrix(e,i,o){let a=[-1,1,1],l=[1,1,1],h=[1,-1,1],g=[-1,-1,1],y=r.Q.transformMat4(a,a,e),x=r.Q.transformMat4(l,l,e),E=r.Q.transformMat4(h,h,e),I=r.Q.transformMat4(g,g,e);return new Dy(y,x,E,I,i/o)}}function Up(t,e,i){let o=1/0,a=-1/0,l=[];for(let h of t){r.Q.sub(l,h,e);let g=r.Q.dot(l,i);o=Math.min(o,g),a=Math.max(a,g)}return[o,a]}function Ax(t,e){let i=!0;for(let o=0;o<t.planes.length;o++){let a=t.planes[o],l=0;for(let h=0;h<e.length;h++)l+=r.Q.dot(a,e[h])+a[3]>=0;if(l===0)return 0;l!==e.length&&(i=!1)}return i?2:1}function Dx(t,e){for(let i of t.projections){let o=Up(e,t.points[0],i.axis);if(i.projection[1]<o[0]||i.projection[0]>o[1])return 0}return 1}function Rx(t,e){let i=0,o=[0,0,0,0];for(let a=0;a<t.length;a++)o[0]=t[a][0],o[1]=t[a][1],o[2]=t[a][2],o[3]=1,r.aa.dot(o,e)>=0&&i++;return i}class Ry{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=On.fromPoints(this.points),this.projections=[],this.frustumEdges=[r.Q.sub([],this.points[2],this.points[3]),r.Q.sub([],this.points[0],this.points[3]),r.Q.sub([],this.points[4],this.points[0]),r.Q.sub([],this.points[5],this.points[1]),r.Q.sub([],this.points[6],this.points[2]),r.Q.sub([],this.points[7],this.points[3])];for(let o of this.frustumEdges){let a=[0,-o[2],o[1]],l=[o[2],0,-o[0]];this.projections.push({axis:a,projection:Up(this.points,this.points[0],a)}),this.projections.push({axis:l,projection:Up(this.points,this.points[0],l)})}}static fromInvProjectionMatrix(e,i,o,a){let l=Math.pow(2,o),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{let E=r.aa.transformMat4([],x,e),I=1/E[3]/i*l;return r.aa.mul(E,E,[I,I,a?1/E[3]:I,I])}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{let E=r.Q.sub([],h[x[0]],h[x[1]]),I=r.Q.sub([],h[x[2]],h[x[1]]),M=r.Q.normalize([],r.Q.cross([],E,I)),D=-r.Q.dot(M,h[x[1]]);return M.concat(D)}),y=[];for(let x=0;x<h.length;x++)y.push([h[x][0],h[x][1],h[x][2]]);return new Ry(y,g)}intersectsPrecise(e,i,o){for(let a=0;a<i.length;a++)if(!Rx(e,i[a]))return 0;for(let a=0;a<this.planes.length;a++)if(!Rx(e,this.planes[a]))return 0;for(let a of o)for(let l of this.frustumEdges){let h=r.Q.cross([],a,l),g=r.Q.length(h);if(g===0)continue;r.Q.scale(h,h,1/g);let y=Up(this.points,this.points[0],h),x=Up(e,this.points[0],h);if(y[0]>x[1]||x[0]>y[1])return 0}return 1}}class On{static fromPoints(e){let i=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(let a of e)r.Q.min(i,i,a),r.Q.max(o,o,a);return new On(i,o)}static fromTileIdAndHeight(e,i,o){let a=1<<e.canonical.z,l=e.canonical.x,h=e.canonical.y;return new On([l/a,h/a,i],[(l+1)/a,(h+1)/a,o])}static applyTransform(e,i){let o=e.getCorners();for(let a=0;a<o.length;++a)r.Q.transformMat4(o[a],o[a],i);return On.fromPoints(o)}static projectAabbCorners(e,i){let o=e.getCorners();for(let a=0;a<o.length;++a)r.Q.transformMat4(o[a],o[a],i);return o}constructor(e,i){this.min=e,this.max=i,this.center=r.Q.scale([],r.Q.add([],this.min,this.max),.5)}quadrant(e){let i=[e%2==0,e<2],o=r.Q.clone(this.min),a=r.Q.clone(this.max);for(let l=0;l<i.length;l++)o[l]=i[l]?this.min[l]:this.center[l],a[l]=i[l]?this.center[l]:this.max[l];return a[2]=this.max[2],new On(o,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Ax(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Ax(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Dx(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Dx(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}bt(On,"Aabb");let JC=oi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Wm}=JC,eA=oi([{name:"a_pos_3",components:3,type:"Int16"}]);var Px=oi([{name:"a_pos",type:"Int16",components:2}]);function Zm(t){return t*zo/dd}let tA=[new On([ga,ga,ga],[_a,_a,_a]),new On([ga,ga,ga],[0,0,_a]),new On([0,ga,ga],[_a,0,_a]),new On([ga,0,ga],[0,_a,_a]),new On([0,0,ga],[_a,_a,_a])];function kx(t,e,i,o=!0){let a=r.Q.scale([],t._camera.position,t.worldSize),l=[e,i,1,1];r.aa.transformMat4(l,l,t.pixelMatrixInverse),r.aa.scale(l,l,1/l[3]);let h=r.Q.sub([],l,a),g=r.Q.normalize([],h),y=t.globeMatrix,x=[y[12],y[13],y[14]],E=r.Q.sub([],x,a),I=r.Q.length(E),M=r.Q.normalize([],E),D=t.worldSize/(2*Math.PI),P=r.Q.dot(M,g),L=Math.asin(D/I);if(L<Math.acos(P)){if(!o)return null;let Te=[],Le=[];r.Q.scale(Te,g,I/P),r.Q.normalize(Le,r.Q.sub(Le,Te,E)),r.Q.normalize(g,r.Q.add(g,E,r.Q.scale(g,Le,Math.tan(L)*I)))}let N=[];new Ay(a,g).closestPointOnSphere(x,D,N);let V=r.Q.normalize([],Ra(y,0)),Z=r.Q.normalize([],Ra(y,1)),Y=r.Q.normalize([],Ra(y,2)),Q=r.Q.dot(V,N),ae=r.Q.dot(Z,N),te=r.Q.dot(Y,N),ce=zr(Math.asin(-ae/D)),he=zr(Math.atan2(Q,te));he=t.center.lng+function(Te,Le){let Oe=(Le-Te+180)%360-180;return Oe<-180?Oe+360:Oe}(t.center.lng,he);let be=Bc(he),Pe=gi(tc(ce),0,1);return new so(be,Pe)}class iA{constructor(e,i,o){this.a=r.Q.sub([],e,o),this.b=r.Q.sub([],i,o),this.center=o;let a=r.Q.normalize([],this.a),l=r.Q.normalize([],this.b);this.angle=Math.acos(r.Q.dot(a,l))}}function Py(t,e){if(t.angle===0)return null;let i;return i=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(o,a,l,h){let g=Math.sin(l);return o*(Math.sin((1-h)*l)/g)+a*(Math.sin(h*l)/g)}(t.a[e],t.b[e],t.angle,gi(i,0,1))+t.center[e]}function wl(t){if(t.z<=1)return tA[t.z+2*t.y+t.x];let e=ky(Hm(t));return On.fromPoints(e)}function nc(t,e,i){return r.Q.scale(t,t,1-i),r.Q.scaleAndAdd(t,t,e,i)}function Ox(t,e,i){for(let o of t)r.Q.transformMat4(o,o,e),r.Q.scale(o,o,i)}function Lx(t,e,i,o){let a=e/t.worldSize,l=t.globeMatrix;if(i.z<=1){let be=wl(i).getCorners();return Ox(be,l,a),On.fromPoints(be)}let h=Hm(i,o),g=ky(h,zo+Zm(t._tileCoverLift));Ox(g,l,a);let y=Number.MAX_VALUE,x=[-y,-y,-y],E=[y,y,y];if(h.contains(t.center)){for(let Te of g)r.Q.min(E,E,Te),r.Q.max(x,x,Te);x[2]=0;let be=t.point,Pe=[be.x*a,be.y*a,0];return r.Q.min(E,E,Pe),r.Q.max(x,x,Pe),new On(E,x)}if(t._tileCoverLift>0){for(let be of g)r.Q.min(E,E,be),r.Q.max(x,x,be);return new On(E,x)}let I=[l[12]*a,l[13]*a,l[14]*a],M=h.getCenter(),D=gi(t.center.lat,-tr,tr),P=gi(M.lat,-tr,tr),L=Bc(t.center.lng),N=tc(D),V=L-Bc(M.lng),Z=N-tc(P);V>.5?V-=1:V<-.5&&(V+=1);let Y=0;if(Math.abs(V)>Math.abs(Z))Y=V>=0?1:3;else{Y=Z>=0?0:2;let be=[l[4]*a,l[5]*a,l[6]*a],Pe=-Math.sin(Si(Z>=0?h.getSouth():h.getNorth()))*zo;r.Q.scaleAndAdd(I,I,be,Pe)}let Q=g[Y],ae=g[(Y+1)%4],te=new iA(Q,ae,I),ce=[Py(te,0)||Q[0],Py(te,1)||Q[1],Py(te,2)||Q[2]],he=Vc(t.zoom);if(he>0){let be=function({x:Te,y:Le,z:Oe},ke,$e,qe,Xe){let Qe=1/(1<<Oe),Fe=Te*Qe,It=Fe+Qe,yt=Le*Qe,Ke=yt+Qe,Ut=0,Pt=(Fe+It)/2-qe;return Pt>.5?Ut=-1:Pt<-.5&&(Ut=1),Fe=((Fe+Ut)*ke-(qe*=ke))*$e+qe,It=((It+Ut)*ke-qe)*$e+qe,yt=(yt*ke-(Xe*=ke))*$e+Xe,Ke=(Ke*ke-Xe)*$e+Xe,[[Fe,Ke,0],[It,Ke,0],[It,yt,0],[Fe,yt,0]]}(i,e,t._pixelsPerMercatorPixel,L,N);for(let Te=0;Te<g.length;Te++)nc(g[Te],be[Te],he);let Pe=r.Q.add([],be[Y],be[(Y+1)%4]);r.Q.scale(Pe,Pe,.5),nc(ce,Pe,he)}for(let be of g)r.Q.min(E,E,be),r.Q.max(x,x,be);return E[2]=Math.min(Q[2],ae[2]),r.Q.min(E,E,ce),r.Q.max(x,x,ce),new On(E,x)}function Hm({x:t,y:e,z:i},o=!1){let a=1/(1<<i),l=new Bi(xs(t*a),e===(1<<i)-1&&o?-90:Jr((e+1)*a)),h=new Bi(xs((t+1)*a),e===0&&o?90:Jr(e*a));return new zc(l,h)}function ky(t,e=zo){let i=Si(t.getNorth()),o=Si(t.getSouth()),a=Math.cos(i),l=Math.cos(o),h=Math.sin(i),g=Math.sin(o),y=t.getWest(),x=t.getEast();return[hd(l,g,y,e),hd(l,g,x,e),hd(a,h,x,e),hd(a,h,y,e)]}function Gp(t,e,i,o){let a=1<<i.z,l=(t/pt+i.x)/a;return Ku(Jr((e/pt+i.y)/a),xs(l),o)}function Qm({min:t,max:e}){return VC/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}let Fx=new Float64Array(16);function Xm(t){let e=Qm(t),i=r.a9.fromScaling(Fx,[e,e,e]);return r.a9.translate(i,i,r.Q.negate([],t.min))}function Oy(t){let e=r.a9.fromTranslation(Fx,t.min),i=1/Qm(t);return r.a9.scale(e,e,[i,i,i])}function Ly(t){let e=pt/(2*Math.PI);return t/(2*Math.PI)/e}function zx(t,e){return pt/(512*Math.pow(2,t))*Qm(wl(e))}function Bx(t,e,i,o,a){let l=Ly(i),h=[t,e,-i/(2*Math.PI)],g=r.a9.identity(new Float64Array(16));return r.a9.translate(g,g,h),r.a9.scale(g,g,[l,l,l]),r.a9.rotateX(g,g,Si(-a)),r.a9.rotateY(g,g,Si(-o)),g}function Vc(t){return Fl(_y,mx,t)}function Nx(t,e){let i=Ku(e.lat,e.lng),o=function(l){let h=Ku(l._center.lat,l._center.lng),g=r.Q.fromValues(0,1,0),y=r.Q.cross([],g,h),x=r.a9.fromRotation([],-l.angle,h);y=r.Q.transformMat4(y,y,x),r.a9.fromRotation(x,-l._pitch,y);let E=r.Q.normalize([],h);return r.Q.scale(E,E,Zm(l.cameraToCenterDistance/l.pixelsPerMeter)),r.Q.transformMat4(E,E,x),r.Q.add([],h,E)}(t),a=r.Q.subtract([],o,i);return r.Q.angle(a,i)}function Fy(t,e){return Nx(t,e)>Math.PI/2*1.01}let Vx=Si(85),nA=Math.cos(Vx),rA=Math.sin(Vx),oA=r.a9.create(),jx=t=>{let e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Ux(t,e,i,o,a,l,h,g,y){if(l&&t.queryGeometry.isAboveHorizon)return!1;l&&(y*=t.pixelToTileUnitsFactor);let x=t.tileID.canonical,E=i.projection.upVectorScale(x,i.center.lat,i.worldSize).metersToTile;for(let I of e)for(let M of I){let D=M.add(g),P=a&&i.elevation?i.elevation.exaggeration()*a.getElevationAt(D.x,D.y,!0):0,L=i.projection.projectTilePoint(D.x,D.y,x);if(P>0){let Y=i.projection.upVector(x,D.x,D.y);L.x+=Y[0]*E*P,L.y+=Y[1]*E*P,L.z+=Y[2]*E*P}let N=l?D:sA(L.x,L.y,L.z,o),V=l?t.tilespaceRays.map(Y=>lA(Y,P)):t.queryGeometry.screenGeometry,Z=r.aa.transformMat4([],[L.x,L.y,L.z,1],o);if(!h&&l?y*=Z[3]/i.cameraToCenterDistance:h&&!l&&(y*=i.cameraToCenterDistance/Z[3]),l){let Y=Jr((M.y/pt+x.y)/(1<<x.z));y/=i.projection.pixelsPerMeter(Y,1)/Bo(1,Y)}if(ZC(V,N,y))return!0}return!1}function sA(t,e,i,o){let a=r.aa.transformMat4([],[t,e,i,1],o);return new ct(a[0]/a[3],a[1]/a[3])}let Gx=r.Q.fromValues(0,0,0),aA=r.Q.fromValues(0,0,1);function lA(t,e){let i=r.Q.create();return Gx[2]=e,t.intersectsPlane(Gx,aA,i),new ct(i[0],i[1])}class qx extends Ey{}function $x(t,{width:e,height:i},o,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*i*o)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*i*o);return t.width=e,t.height=i,t.data=a,t}function Wx(t,e,i){let{width:o,height:a}=e;o===t.width&&a===t.height||(zy(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,o),height:Math.min(t.height,a)},i),t.width=o,t.height=a,t.data=e.data)}function zy(t,e,i,o,a,l,h){if(a.width===0||a.height===0)return e;if(a.width>t.width||a.height>t.height||i.x>t.width-a.width||i.y>t.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||o.x>e.width-a.width||o.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");let g=t.data,y=e.data,x=l===4&&h;for(let E=0;E<a.height;E++){let I=((i.y+E)*t.width+i.x)*l,M=((o.y+E)*e.width+o.x)*l;if(x)for(let D=0;D<a.width;D++){let P=I+D*l+3,L=M+D*l;y[L+0]=255,y[L+1]=255,y[L+2]=255,y[L+3]=g[P]}else for(let D=0;D<a.width*l;D++)y[M+D]=g[I+D]}return e}bt(qx,"HeatmapBucket",{omit:["layers"]});class jc{constructor(e,i){$x(this,e,1,i)}resize(e){Wx(this,new jc(e),1)}clone(){return new jc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,a,l){zy(e,i,o,a,l,1)}}class Vs{constructor(e,i){$x(this,e,4,i)}resize(e){Wx(this,new Vs(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Vs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,a,l,h){zy(e,i,o,a,l,4,h)}}class Zx{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}bt(jc,"AlphaImage"),bt(Vs,"RGBAImage");let cA=new ye({visibility:new pe(re.layout_heatmap.visibility)});var uA={paint:new ye({"heatmap-radius":new xe(re.paint_heatmap["heatmap-radius"]),"heatmap-weight":new xe(re.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new pe(re.paint_heatmap["heatmap-intensity"]),"heatmap-color":new He(re.paint_heatmap["heatmap-color"]),"heatmap-opacity":new pe(re.paint_heatmap["heatmap-opacity"])}),layout:cA};function qp(t){let e={},i=t.resolution||256,o=t.clips?t.clips.length:1,a=t.image||new Vs({width:i,height:o}),l=(h,g,y)=>{e[t.evaluationKey]=y;let x=t.expression.evaluate(e);x&&(a.data[h+g+0]=Math.floor(255*x.r/x.a),a.data[h+g+1]=Math.floor(255*x.g/x.a),a.data[h+g+2]=Math.floor(255*x.b/x.a),a.data[h+g+3]=Math.floor(255*x.a))};if(t.clips)for(let h=0,g=0;h<o;++h,g+=4*i)for(let y=0,x=0;y<i;y++,x+=4){let E=y/(i-1),{start:I,end:M}=t.clips[h];l(g,x,I*(1-E)+M*E)}else for(let h=0,g=0;h<i;h++,g+=4)l(0,g,h/(i-1));return a}let hA=new ye({visibility:new pe(re.layout_hillshade.visibility)});var dA={paint:new ye({"hillshade-illumination-direction":new pe(re.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new pe(re.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new pe(re.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new pe(re.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new pe(re.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new pe(re.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new pe(re.paint_hillshade["hillshade-emissive-strength"])}),layout:hA};let pA=oi([{name:"a_pos",components:2,type:"Int16"}],4),{members:fA}=pA;var By={exports:{}};function Ym(t,e,i){i=i||2;var o,a,l,h,g,y,x,E=e&&e.length,I=E?e[0]*i:t.length,M=Hx(t,0,I,i,!0),D=[];if(!M||M.next===M.prev)return D;if(E&&(M=function(L,N,V,Z){var Y,Q,ae,te=[];for(Y=0,Q=N.length;Y<Q;Y++)(ae=Hx(L,N[Y]*Z,Y<Q-1?N[Y+1]*Z:L.length,Z,!1))===ae.next&&(ae.steiner=!0),te.push(wA(ae));for(te.sort(vA),Y=0;Y<te.length;Y++)V=bA(te[Y],V);return V}(t,e,M,i)),t.length>80*i){o=l=t[0],a=h=t[1];for(var P=i;P<I;P+=i)(g=t[P])<o&&(o=g),(y=t[P+1])<a&&(a=y),g>l&&(l=g),y>h&&(h=y);x=(x=Math.max(l-o,h-a))!==0?32767/x:0}return $p(M,D,i,o,a,x,0),D}function Hx(t,e,i,o,a){var l,h;if(a===jy(t,e,i,o)>0)for(l=e;l<i;l+=o)h=Yx(l,t[l],t[l+1],h);else for(l=i-o;l>=e;l-=o)h=Yx(l,t[l],t[l+1],h);return h&&Km(h,h.next)&&(Zp(h),h=h.next),h}function ih(t,e){if(!t)return t;e||(e=t);var i,o=t;do if(i=!1,o.steiner||!Km(o,o.next)&&vr(o.prev,o,o.next)!==0)o=o.next;else{if(Zp(o),(o=e=o.prev)===o.next)break;i=!0}while(i||o!==e);return e}function $p(t,e,i,o,a,l,h){if(t){!h&&l&&function(E,I,M,D){var P=E;do P.z===0&&(P.z=Ny(P.x,P.y,I,M,D)),P.prevZ=P.prev,P.nextZ=P.next,P=P.next;while(P!==E);P.prevZ.nextZ=null,P.prevZ=null,function(L){var N,V,Z,Y,Q,ae,te,ce,he=1;do{for(V=L,L=null,Q=null,ae=0;V;){for(ae++,Z=V,te=0,N=0;N<he&&(te++,Z=Z.nextZ);N++);for(ce=he;te>0||ce>0&&Z;)te!==0&&(ce===0||!Z||V.z<=Z.z)?(Y=V,V=V.nextZ,te--):(Y=Z,Z=Z.nextZ,ce--),Q?Q.nextZ=Y:L=Y,Y.prevZ=Q,Q=Y;V=Z}Q.nextZ=null,he*=2}while(ae>1)}(P)}(t,o,a,l);for(var g,y,x=t;t.prev!==t.next;)if(g=t.prev,y=t.next,l?gA(t,o,a,l):mA(t))e.push(g.i/i|0),e.push(t.i/i|0),e.push(y.i/i|0),Zp(t),t=y.next,x=y.next;else if((t=y)===x){h?h===1?$p(t=_A(ih(t),e,i),e,i,o,a,l,2):h===2&&yA(t,e,i,o,a,l):$p(ih(t),e,i,o,a,l,1);break}}}function mA(t){var e=t.prev,i=t,o=t.next;if(vr(e,i,o)>=0)return!1;for(var a=e.x,l=i.x,h=o.x,g=e.y,y=i.y,x=o.y,E=a<l?a<h?a:h:l<h?l:h,I=g<y?g<x?g:x:y<x?y:x,M=a>l?a>h?a:h:l>h?l:h,D=g>y?g>x?g:x:y>x?y:x,P=o.next;P!==e;){if(P.x>=E&&P.x<=M&&P.y>=I&&P.y<=D&&md(a,g,l,y,h,x,P.x,P.y)&&vr(P.prev,P,P.next)>=0)return!1;P=P.next}return!0}function gA(t,e,i,o){var a=t.prev,l=t,h=t.next;if(vr(a,l,h)>=0)return!1;for(var g=a.x,y=l.x,x=h.x,E=a.y,I=l.y,M=h.y,D=g<y?g<x?g:x:y<x?y:x,P=E<I?E<M?E:M:I<M?I:M,L=g>y?g>x?g:x:y>x?y:x,N=E>I?E>M?E:M:I>M?I:M,V=Ny(D,P,e,i,o),Z=Ny(L,N,e,i,o),Y=t.prevZ,Q=t.nextZ;Y&&Y.z>=V&&Q&&Q.z<=Z;){if(Y.x>=D&&Y.x<=L&&Y.y>=P&&Y.y<=N&&Y!==a&&Y!==h&&md(g,E,y,I,x,M,Y.x,Y.y)&&vr(Y.prev,Y,Y.next)>=0||(Y=Y.prevZ,Q.x>=D&&Q.x<=L&&Q.y>=P&&Q.y<=N&&Q!==a&&Q!==h&&md(g,E,y,I,x,M,Q.x,Q.y)&&vr(Q.prev,Q,Q.next)>=0))return!1;Q=Q.nextZ}for(;Y&&Y.z>=V;){if(Y.x>=D&&Y.x<=L&&Y.y>=P&&Y.y<=N&&Y!==a&&Y!==h&&md(g,E,y,I,x,M,Y.x,Y.y)&&vr(Y.prev,Y,Y.next)>=0)return!1;Y=Y.prevZ}for(;Q&&Q.z<=Z;){if(Q.x>=D&&Q.x<=L&&Q.y>=P&&Q.y<=N&&Q!==a&&Q!==h&&md(g,E,y,I,x,M,Q.x,Q.y)&&vr(Q.prev,Q,Q.next)>=0)return!1;Q=Q.nextZ}return!0}function _A(t,e,i){var o=t;do{var a=o.prev,l=o.next.next;!Km(a,l)&&Qx(a,o,o.next,l)&&Wp(a,l)&&Wp(l,a)&&(e.push(a.i/i|0),e.push(o.i/i|0),e.push(l.i/i|0),Zp(o),Zp(o.next),o=t=l),o=o.next}while(o!==t);return ih(o)}function yA(t,e,i,o,a,l){var h=t;do{for(var g=h.next.next;g!==h.prev;){if(h.i!==g.i&&TA(h,g)){var y=Xx(h,g);return h=ih(h,h.next),y=ih(y,y.next),$p(h,e,i,o,a,l,0),void $p(y,e,i,o,a,l,0)}g=g.next}h=h.next}while(h!==t)}function vA(t,e){return t.x-e.x}function bA(t,e){var i=function(a,l){var h,g=l,y=a.x,x=a.y,E=-1/0;do{if(x<=g.y&&x>=g.next.y&&g.next.y!==g.y){var I=g.x+(x-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(I<=y&&I>E&&(E=I,h=g.x<g.next.x?g:g.next,I===y))return h}g=g.next}while(g!==l);if(!h)return null;var M,D=h,P=h.x,L=h.y,N=1/0;g=h;do y>=g.x&&g.x>=P&&y!==g.x&&md(x<L?y:E,x,P,L,x<L?E:y,x,g.x,g.y)&&(M=Math.abs(x-g.y)/(y-g.x),Wp(g,a)&&(M<N||M===N&&(g.x>h.x||g.x===h.x&&xA(h,g)))&&(h=g,N=M)),g=g.next;while(g!==D);return h}(t,e);if(!i)return e;var o=Xx(i,t);return ih(o,o.next),ih(i,i.next)}function xA(t,e){return vr(t.prev,t,e.prev)<0&&vr(e.next,t,t.next)<0}function Ny(t,e,i,o,a){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*a|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function wA(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function md(t,e,i,o,a,l,h,g){return(a-h)*(e-g)>=(t-h)*(l-g)&&(t-h)*(o-g)>=(i-h)*(e-g)&&(i-h)*(l-g)>=(a-h)*(o-g)}function TA(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,o){var a=i;do{if(a.i!==i.i&&a.next.i!==i.i&&a.i!==o.i&&a.next.i!==o.i&&Qx(a,a.next,i,o))return!0;a=a.next}while(a!==i);return!1}(t,e)&&(Wp(t,e)&&Wp(e,t)&&function(i,o){var a=i,l=!1,h=(i.x+o.x)/2,g=(i.y+o.y)/2;do a.y>g!=a.next.y>g&&a.next.y!==a.y&&h<(a.next.x-a.x)*(g-a.y)/(a.next.y-a.y)+a.x&&(l=!l),a=a.next;while(a!==i);return l}(t,e)&&(vr(t.prev,t,e.prev)||vr(t,e.prev,e))||Km(t,e)&&vr(t.prev,t,t.next)>0&&vr(e.prev,e,e.next)>0)}function vr(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Km(t,e){return t.x===e.x&&t.y===e.y}function Qx(t,e,i,o){var a=eg(vr(t,e,i)),l=eg(vr(t,e,o)),h=eg(vr(i,o,t)),g=eg(vr(i,o,e));return a!==l&&h!==g||!(a!==0||!Jm(t,i,e))||!(l!==0||!Jm(t,o,e))||!(h!==0||!Jm(i,t,o))||!(g!==0||!Jm(i,e,o))}function Jm(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function eg(t){return t>0?1:t<0?-1:0}function Wp(t,e){return vr(t.prev,t,t.next)<0?vr(t,e,t.next)>=0&&vr(t,t.prev,e)>=0:vr(t,e,t.prev)<0||vr(t,t.next,e)<0}function Xx(t,e){var i=new Vy(t.i,t.x,t.y),o=new Vy(e.i,e.x,e.y),a=t.next,l=e.prev;return t.next=e,e.prev=t,i.next=a,a.prev=i,o.next=i,i.prev=o,l.next=o,o.prev=l,o}function Yx(t,e,i,o){var a=new Vy(t,e,i);return o?(a.next=o.next,a.prev=o,o.next.prev=a,o.next=a):(a.prev=a,a.next=a),a}function Zp(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Vy(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function jy(t,e,i,o){for(var a=0,l=e,h=i-o;l<i;l+=o)a+=(t[h]-t[l])*(t[l+1]+t[h+1]),h=l;return a}By.exports=Ym,By.exports.default=Ym,Ym.deviation=function(t,e,i,o){var a=e&&e.length,l=Math.abs(jy(t,0,a?e[0]*i:t.length,i));if(a)for(var h=0,g=e.length;h<g;h++)l-=Math.abs(jy(t,e[h]*i,h<g-1?e[h+1]*i:t.length,i));var y=0;for(h=0;h<o.length;h+=3){var x=o[h]*i,E=o[h+1]*i,I=o[h+2]*i;y+=Math.abs((t[x]-t[I])*(t[E+1]-t[x+1])-(t[x]-t[E])*(t[I+1]-t[x+1]))}return l===0&&y===0?0:Math.abs((y-l)/l)},Ym.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},o=0,a=0;a<t.length;a++){for(var l=0;l<t[a].length;l++)for(var h=0;h<e;h++)i.vertices.push(t[a][l][h]);a>0&&i.holes.push(o+=t[a-1].length)}return i};var tg=sn(By.exports);function Uy(t,e){let i=t.length;if(i<=1)return[t];let o=[],a,l;for(let h=0;h<i;h++){let g=Nl(t[h]);g!==0&&(t[h].area=Math.abs(g),l===void 0&&(l=g<0),l===g<0?(a&&o.push(a),a=[t[h]]):a.push(t[h]))}if(a&&o.push(a),e>1)for(let h=0;h<o.length;h++)o[h].length<=e||(sm(o[h],e,1,o[h].length-1,EA),o[h]=o[h].slice(0,e));return o}function EA(t,e){return e.area-t.area}function Gy(t,e,i){let o=i.patternDependencies,a=!1;for(let l of e){let h=l.paint.get(`${t}-pattern`);h.isConstant()||(a=!0);let g=h.constantOr(null);g&&(a=!0,o[g]=!0)}return a}function qy(t,e,i,o,a){let l=a.patternDependencies;for(let h of e){let g=h.paint.get(`${t}-pattern`).value;if(g.kind!=="constant"){let y=g.evaluate({zoom:o},i,{},a.availableImages);y=y&&y.name?y.name:y,l[y]=!0,i.patterns[h.id]=y}}return i}class $y{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Yr,this.indexArray=new Mr,this.indexArray2=new bs,this.programConfigurations=new Fc(e.layers,e.zoom),this.segments=new er,this.segments2=new er,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,o,a){this.hasPattern=Gy("fill",this.layers,i);let l=this.layers[0].layout.get("fill-sort-key"),h=[];for(let{feature:g,id:y,index:x,sourceLayerIndex:E}of e){let I=this.layers[0]._featureFilter.needGeometry,M=Nc(g,I);if(!this.layers[0]._featureFilter.filter(new $(this.zoom),M,o))continue;let D=l?l.evaluate(M,{},o,i.availableImages):void 0,P={id:y,properties:g.properties,type:g.type,sourceLayerIndex:E,index:x,geometry:I?M.geometry:ic(g,o,a),patterns:{},sortKey:D};h.push(P)}l&&h.sort((g,y)=>g.sortKey-y.sortKey);for(let g of h){let{geometry:y,index:x,sourceLayerIndex:E}=g;if(this.hasPattern){let I=qy("fill",this.layers,g,this.zoom,i);this.patternFeatures.push(I)}else this.addFeature(g,y,x,o,{},i.availableImages,i.brightness);i.featureIndex.insert(e[x].feature,y,x,E,this.index)}}update(e,i,o,a,l){let h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,h?this.stateDependentLayers:this.layers,o,a,l)}addFeatures(e,i,o,a,l,h){for(let g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,o,a,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,fA),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,a,l,h=[],g){for(let y of Uy(i,500)){let x=0;for(let L of y)x+=L.length;let E=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),I=E.vertexLength,M=[],D=[];for(let L of y){if(L.length===0)continue;L!==y[0]&&D.push(M.length/2);let N=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),V=N.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack(V+L.length-1,V),M.push(L[0].x),M.push(L[0].y);for(let Z=1;Z<L.length;Z++)this.layoutVertexArray.emplaceBack(L[Z].x,L[Z].y),this.indexArray2.emplaceBack(V+Z-1,V+Z),M.push(L[Z].x),M.push(L[Z].y);N.vertexLength+=L.length,N.primitiveLength+=L.length}let P=tg(M,D);for(let L=0;L<P.length;L+=3)this.indexArray.emplaceBack(I+P[L],I+P[L+1],I+P[L+2]);E.vertexLength+=x,E.primitiveLength+=P.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,l,h,a,g)}}bt($y,"FillBucket",{omit:["layers","patternFeatures"]});let IA=new ye({"fill-sort-key":new xe(re.layout_fill["fill-sort-key"]),visibility:new pe(re.layout_fill.visibility)});var SA={paint:new ye({"fill-antialias":new pe(re.paint_fill["fill-antialias"]),"fill-opacity":new xe(re.paint_fill["fill-opacity"]),"fill-color":new xe(re.paint_fill["fill-color"]),"fill-outline-color":new xe(re.paint_fill["fill-outline-color"]),"fill-translate":new pe(re.paint_fill["fill-translate"]),"fill-translate-anchor":new pe(re.paint_fill["fill-translate-anchor"]),"fill-pattern":new xe(re.paint_fill["fill-pattern"]),"fill-emissive-strength":new pe(re.paint_fill["fill-emissive-strength"])}),layout:IA};let MA=oi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),CA=oi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),AA=oi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),DA=oi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),RA=oi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:PA}=MA;var ig={},kA=Sn,Kx=gd;function gd(t,e,i,o,a){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=o,this._values=a,t.readFields(OA,this,e)}function OA(t,e,i){t==1?e.id=i.readVarint():t==2?function(o,a){for(var l=o.readVarint()+o.pos;o.pos<l;){var h=a._keys[o.readVarint()],g=a._values[o.readVarint()];a.properties[h]=g}}(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function LA(t){for(var e,i,o=0,a=0,l=t.length,h=l-1;a<l;h=a++)o+=((i=t[h]).x-(e=t[a]).x)*(e.y+i.y);return o}gd.types=["Unknown","Point","LineString","Polygon"],gd.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,o=1,a=0,l=0,h=0,g=[];t.pos<i;){if(a<=0){var y=t.readVarint();o=7&y,a=y>>3}if(a--,o===1||o===2)l+=t.readSVarint(),h+=t.readSVarint(),o===1&&(e&&g.push(e),e=[]),e.push(new kA(l,h));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&g.push(e),g},gd.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,o=0,a=0,l=0,h=1/0,g=-1/0,y=1/0,x=-1/0;t.pos<e;){if(o<=0){var E=t.readVarint();i=7&E,o=E>>3}if(o--,i===1||i===2)(a+=t.readSVarint())<h&&(h=a),a>g&&(g=a),(l+=t.readSVarint())<y&&(y=l),l>x&&(x=l);else if(i!==7)throw new Error("unknown command "+i)}return[h,y,g,x]},gd.prototype.toGeoJSON=function(t,e,i){var o,a,l=this.extent*Math.pow(2,i),h=this.extent*t,g=this.extent*e,y=this.loadGeometry(),x=gd.types[this.type];function E(D){for(var P=0;P<D.length;P++){var L=D[P];D[P]=[360*(L.x+h)/l-180,360/Math.PI*Math.atan(Math.exp((180-360*(L.y+g)/l)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(o=0;o<y.length;o++)I[o]=y[o][0];E(y=I);break;case 2:for(o=0;o<y.length;o++)E(y[o]);break;case 3:for(y=function(D){var P=D.length;if(P<=1)return[D];for(var L,N,V=[],Z=0;Z<P;Z++){var Y=LA(D[Z]);Y!==0&&(N===void 0&&(N=Y<0),N===Y<0?(L&&V.push(L),L=[D[Z]]):L.push(D[Z]))}return L&&V.push(L),V}(y),o=0;o<y.length;o++)for(a=0;a<y[o].length;a++)E(y[o][a])}y.length===1?y=y[0]:x="Multi"+x;var M={type:"Feature",geometry:{type:x,coordinates:y},properties:this.properties};return"id"in this&&(M.id=this.id),M};var FA=Kx,Jx=e1;function e1(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(zA,this,e),this.length=this._features.length}function zA(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(function(o){for(var a=null,l=o.readVarint()+o.pos;o.pos<l;){var h=o.readVarint()>>3;a=h===1?o.readString():h===2?o.readFloat():h===3?o.readDouble():h===4?o.readVarint64():h===5?o.readVarint():h===6?o.readSVarint():h===7?o.readBoolean():null}return a}(i))}e1.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new FA(this._pbf,e,this.extent,this._keys,this._values)};var BA=Jx;function NA(t,e,i){if(t===3){var o=new BA(i,i.readVarint()+i.pos);o.length&&(e[o.name]=o)}}var Wy=ig.VectorTile=function(t,e){this.layers=t.readFields(NA,{},e)},ng=ig.VectorTileFeature=Kx;function rg(t,e,i,o){let a=[],l=o===0?(h,g,y,x,E,I)=>{h.push(new ct(I,y+(I-g)/(x-g)*(E-y)))}:(h,g,y,x,E,I)=>{h.push(new ct(g+(I-y)/(E-y)*(x-g),I))};for(let h of t){let g=[];for(let y of h){if(y.length<=2)continue;let x=[];for(let M=0;M<y.length-1;M++){let D=y[M].x,P=y[M].y,L=y[M+1].x,N=y[M+1].y,V=o===0?D:P,Z=o===0?L:N;V<e?Z>e&&l(x,D,P,L,N,e):V>i?Z<i&&l(x,D,P,L,N,i):x.push(y[M]),Z<e&&V>=e&&l(x,D,P,L,N,e),Z>i&&V<=i&&l(x,D,P,L,N,i)}let E=y[y.length-1],I=o===0?E.x:E.y;I>=e&&I<=i&&x.push(E),x.length&&(E=x[x.length-1],x[0].x===E.x&&x[0].y===E.y||x.push(x[0]),g.push(x))}g.length&&a.push(g)}return a}function og(t,e){return t.x-e.x||t.y-e.y}function t1(t,e){return og(t.min,e.min)===0&&og(t.max,e.max)===0}function i1(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function n1(t,e,i){let o=1/pt,a=1/(1<<i.canonical.z),l=(e.x*o+i.canonical.x)*a+i.wrap,h=(e.y*o+i.canonical.y)*a;return{min:new ct((t.x*o+i.canonical.x)*a+i.wrap,(t.y*o+i.canonical.y)*a),max:new ct(l,h)}}function VA(t,e,i){let o=1<<i.canonical.z,a=((e.x-i.wrap)*o-i.canonical.x)*pt,l=(e.y*o-i.canonical.y)*pt;return{min:new ct(((t.x-i.wrap)*o-i.canonical.x)*pt,(t.y*o-i.canonical.y)*pt),max:new ct(a,l)}}function r1(t,e,i,o,a,l,h){let g=t.indices,y=t.vertices,x=[];for(let E=o;E<o+a;E+=3){let I=e[i[E+0]+l],M=e[i[E+1]+l],D=e[i[E+2]+l],P=Math.min(I.x,M.x,D.x),L=Math.max(I.x,M.x,D.x),N=Math.min(I.y,M.y,D.y),V=Math.max(I.y,M.y,D.y);x.length=0,t.grid.query(new ct(P,N),new ct(L,V),x);for(let Z=0;Z<x.length;Z++){let Y=x[Z];if(Cy(y[g[3*Y+0]],y[g[3*Y+1]],y[g[3*Y+2]],I,M,D,h))return!0}}return!1}function o1(t,e,i,o){if(!t||!i)return!1;let a=t.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(i.vertices.length<t.vertices.length)return o1(i,o,t,e);let l=e.canonical,h=o.canonical,g=Math.pow(2,h.z-l.z);a=t.vertices.map(y=>new ct((y.x+l.x*pt)*g-h.x*pt,(y.y+l.y*pt)*g-h.y*pt))}return r1(i,a,t.indices,0,t.indices.length,0,0)}ig.VectorTileLayer=Jx;class s1{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){let o=this.toIdx(e,i);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function a1(t,e,i,o){let a=0,l=Number.MAX_VALUE;for(let h=0;h<3;h++)if(Math.abs(o[h])<1e-15){if(i[h]<t[h]||i[h]>e[h])return null}else{let g=1/o[h],y=(t[h]-i[h])*g,x=(e[h]-i[h])*g;if(y>x){let E=y;y=x,x=E}if(y>a&&(a=y),x<l&&(l=x),a>l)return null}return a}function l1(t,e,i,o,a,l,h,g,y,x,E){let I=o-t,M=a-e,D=l-i,P=h-t,L=g-e,N=y-i,V=E[1]*N-E[2]*L,Z=E[2]*P-E[0]*N,Y=E[0]*L-E[1]*P,Q=I*V+M*Z+D*Y;if(Math.abs(Q)<1e-15)return null;let ae=1/Q,te=x[0]-t,ce=x[1]-e,he=x[2]-i,be=(te*V+ce*Z+he*Y)*ae;if(be<0||be>1)return null;let Pe=ce*D-he*M,Te=he*I-te*D,Le=te*M-ce*I,Oe=(E[0]*Pe+E[1]*Te+E[2]*Le)*ae;return Oe<0||be+Oe>1?null:(P*Pe+L*Te+N*Le)*ae}function c1(t,e,i){return(t-e)/(i-e)}function u1(t,e,i,o,a,l,h,g,y){let x=1<<i,E=l-o,I=h-a,M=(t+1)/x*E+o,D=(e+0)/x*I+a,P=(e+1)/x*I+a;g[0]=(t+0)/x*E+o,g[1]=D,y[0]=M,y[1]=P}class h1{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let i=function(l){let h=Math.ceil(Math.log2(l.dim/8)),g=[],y=Math.ceil(Math.pow(2,h)),x=1/y,E=(D,P,L,N,V)=>{let Z=N?1:0,Y=(D+1)*L-Z,Q=P*L,ae=(P+1)*L-Z;V[0]=D*L,V[1]=Q,V[2]=Y,V[3]=ae},I=new s1(y),M=[];for(let D=0;D<y*y;D++){E(D%y,Math.floor(D/y),x,!1,M);let P=Uc(M[0],M[1],l),L=Uc(M[2],M[1],l),N=Uc(M[2],M[3],l),V=Uc(M[0],M[3],l);I.minimums.push(Math.min(P,L,N,V)),I.maximums.push(Math.max(P,L,N,V)),I.leaves.push(1)}for(g.push(I),y/=2;y>=1;y/=2){let D=g[g.length-1];I=new s1(y);for(let P=0;P<y*y;P++){E(P%y,Math.floor(P/y),2,!0,M);let L=D.getElevation(M[0],M[1]),N=D.getElevation(M[2],M[1]),V=D.getElevation(M[2],M[3]),Z=D.getElevation(M[0],M[3]),Y=D.isLeaf(M[0],M[1]),Q=D.isLeaf(M[2],M[1]),ae=D.isLeaf(M[2],M[3]),te=D.isLeaf(M[0],M[3]),ce=Math.min(L.min,N.min,V.min,Z.min),he=Math.max(L.max,N.max,V.max,Z.max),be=Y&&Q&&ae&&te;I.maximums.push(he),I.minimums.push(ce),I.leaves.push(he-ce<=5&&be?1:0)}g.push(I)}return g}(this.dem),o=i.length-1,a=i[o];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(i,0,0,o,0)}raycastRoot(e,i,o,a,l,h,g=1){return a1([e,i,-100],[o,a,this.maximums[0]*g],l,h)}raycast(e,i,o,a,l,h,g=1){if(!this.nodeCount)return null;let y=this.raycastRoot(e,i,o,a,l,h,g);if(y==null)return null;let x=[],E=[],I=[],M=[],D=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;D.length>0;){let{idx:P,t:L,nodex:N,nodey:V,depth:Z}=D.pop();if(this.leaves[P]){u1(N,V,Z,e,i,o,a,I,M);let Q=1<<Z,ae=(N+0)/Q,te=(N+1)/Q,ce=(V+0)/Q,he=(V+1)/Q,be=Uc(ae,ce,this.dem)*g,Pe=Uc(te,ce,this.dem)*g,Te=Uc(te,he,this.dem)*g,Le=Uc(ae,he,this.dem)*g,Oe=l1(I[0],I[1],be,M[0],I[1],Pe,M[0],M[1],Te,l,h),ke=l1(M[0],M[1],Te,I[0],M[1],Le,I[0],I[1],be,l,h),$e=Math.min(Oe!==null?Oe:Number.MAX_VALUE,ke!==null?ke:Number.MAX_VALUE);if($e!==Number.MAX_VALUE)return $e;{let qe=r.Q.scaleAndAdd([],l,h,L);if(d1(be,Pe,Le,Te,c1(qe[0],I[0],M[0]),c1(qe[1],I[1],M[1]))>=qe[2])return L}continue}let Y=0;for(let Q=0;Q<this._siblingOffset.length;Q++){u1((N<<1)+this._siblingOffset[Q][0],(V<<1)+this._siblingOffset[Q][1],Z+1,e,i,o,a,I,M),I[2]=-100,M[2]=this.maximums[this.childOffsets[P]+Q]*g;let ae=a1(I,M,l,h);if(ae!=null){let te=ae;x[Q]=te;let ce=!1;for(let he=0;he<Y&&!ce;he++)te>=x[E[he]]&&(E.splice(he,0,Q),ce=!0);ce||(E[Y]=Q),Y++}}for(let Q=0;Q<Y;Q++){let ae=E[Q];D.push({idx:this.childOffsets[P]+ae,t:x[ae],nodex:(N<<1)+this._siblingOffset[ae][0],nodey:(V<<1)+this._siblingOffset[ae][1],depth:Z+1})}}return null}_addNode(e,i,o){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,o,a,l){if(e[a].isLeaf(i,o)===1)return;this.childOffsets[l]||(this.childOffsets[l]=this.nodeCount);let h=a-1,g=e[h],y=0,x=0;for(let E=0;E<this._siblingOffset.length;E++){let I=2*i+this._siblingOffset[E][0],M=2*o+this._siblingOffset[E][1],D=g.getElevation(I,M),P=g.isLeaf(I,M),L=this._addNode(D.min,D.max,P);P&&(y|=1<<E),x||(x=L)}for(let E=0;E<this._siblingOffset.length;E++)y&1<<E||this._construct(e,2*i+this._siblingOffset[E][0],2*o+this._siblingOffset[E][1],h,x+E)}}function d1(t,e,i,o,a,l){return si(si(t,i,l),si(e,o,l),a)}function Uc(t,e,i){let o=i.dim,a=gi(t*o-.5,0,o-1),l=gi(e*o-.5,0,o-1),h=Math.floor(a),g=Math.floor(l),y=Math.min(h+1,o-1),x=Math.min(g+1,o-1);return d1(i.get(h,g),i.get(y,g),i.get(h,x),i.get(y,x),a-h,l-g)}let jA={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function UA(t,e,i){return(256*t*256+256*e+i)/10-1e4}function GA(t,e,i){return 256*t+e+i/256-32768}class sg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,o,a=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return Mn(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;let l=this.dim=i.height-2,h=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=a,this._modifiedForSources={},!a){for(let y=0;y<l;y++)h[this._idx(-1,y)]=h[this._idx(0,y)],h[this._idx(l,y)]=h[this._idx(l-1,y)],h[this._idx(y,-1)]=h[this._idx(y,0)],h[this._idx(y,l)]=h[this._idx(y,l-1)];h[this._idx(-1,-1)]=h[this._idx(0,0)],h[this._idx(l,-1)]=h[this._idx(l-1,0)],h[this._idx(-1,l)]=h[this._idx(0,l-1)],h[this._idx(l,l)]=h[this._idx(l-1,l-1)]}let g=o==="terrarium"?GA:UA;for(let y=0;y<h.length;++y){let x=4*y;this.floatView[y]=g(this.pixels[x],this.pixels[x+1],this.pixels[x+2])}this._timestamp=Br.now()}_buildQuadTree(){this._tree=new h1(this)}get(e,i,o=!1){o&&(e=gi(e,-1,this.dim),i=gi(i,-1,this.dim));let a=this._idx(e,i);return this.floatView[a]}set(e,i,o){let a=this._idx(e,i),l=this.floatView[a];return this.floatView[a]=o,o-l}static getUnpackVector(e){return jA[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){let o=[0,0,0,0],a=sg.getUnpackVector(i),l=Math.floor((e+a[3])/a[2]);return o[2]=l%256,l=Math.floor(l/256),o[1]=l%256,l=Math.floor(l/256),o[0]=l,o}getPixels(){return new Zx({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=i*this.dim,l=i*this.dim+this.dim,h=o*this.dim,g=o*this.dim+this.dim;switch(i){case-1:a=l-1;break;case 1:l=a+1}switch(o){case-1:h=g-1;break;case 1:g=h+1}let y=-i*this.dim,x=-o*this.dim;for(let E=h;E<g;E++)for(let I=a;I<l;I++){let M=4*this._idx(I,E),D=4*this._idx(I+y,E+x);this.pixels[M+0]=e.pixels[D+0],this.pixels[M+1]=e.pixels[D+1],this.pixels[M+2]=e.pixels[D+2],this.pixels[M+3]=e.pixels[D+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}bt(sg,"DEMData"),bt(h1,"DemMinMaxQuadTree",{omit:["dem"]});class _d{constructor(e,i,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=o}static create(e,i,o){let a=o||e.findDEMTileFor(i);if(!a||!a.dem)return;let l=a.dem,h=a.tileID,g=1<<i.canonical.z-h.canonical.z;return new _d(a,l.dim/pt/g,[(i.canonical.x/g-h.canonical.x)*l.dim,(i.canonical.y/g-h.canonical.y)*l.dim])}tileCoordToPixel(e,i){let o=i*this._scale+this._offset[1],a=Math.floor(e*this._scale+this._offset[0]),l=Math.floor(o);return new ct(a,l)}getElevationAt(e,i,o,a){let l=e*this._scale+this._offset[0],h=i*this._scale+this._offset[1],g=Math.floor(l),y=Math.floor(h),x=this._dem;return a=!!a,o?si(si(x.get(g,y,a),x.get(g,y+1,a),h-y),si(x.get(g+1,y,a),x.get(g+1,y+1,a),h-y),l-g):x.get(g,y,a)}getElevationAtPixel(e,i,o){return this._dem.get(e,i,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Bo(1,e)*this._dem.stride}}let qA=ng.types,$A=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],WA=["fill-extrusion-flood-light-ground-radius"],ZA=Math.pow(2,13),HA=Math.pow(2,15)-1,p1=new ct(0,1),Gc=2147483648;function Hp(t,e,i,o,a,l,h,g){t.emplaceBack((e<<1)+h,(i<<1)+l,(Math.floor(o*ZA)<<1)+a,Math.round(g))}function ag(t,e,i,o,a,l){t.emplaceBack(e.x,e.y,(i.x<<1)+o,(i.y<<1)+a,l)}function Qp(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class f1{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class m1{constructor(){this.centroidXY=new ct(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new ct(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new ct(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new ct(this.max.x-this.min.x,this.max.y-this.min.y)}}class g1{constructor(){this.acc=new ct(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,o){this.accCount++,this.acc._add(i);let a=!!this.borders;i.x<e.min.x?(e.min.x=i.x,a=!0):i.x>e.max.x&&(e.max.x=i.x,a=!0),i.y<e.min.y?(e.min.y=i.y,a=!0):i.y>e.max.y&&(e.max.y=i.y,a=!0),((i.x===0||i.x===pt)&&i.x===o.x)!=((i.y===0||i.y===pt)&&i.y===o.y)&&this.processBorderOverlap(i,o),a&&this.checkBorderIntersection(i,o)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,si(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>pt!=e.x>pt&&this.addBorderIntersection(1,si(i.y,e.y,(pt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,si(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>pt!=e.y>pt&&this.addBorderIntersection(3,si(i.x,e.x,(pt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let o=this.borders[e];i<o[0]&&(o[0]=i),i>o[1]&&(o[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;let o=e.x===0?0:1;this.addBorderIntersection(o,i.y),this.addBorderIntersection(o,e.y)}else{let o=e.y===0?2:3;this.addBorderIntersection(o,i.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new ct(0,0):new ct(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function _1(t,e){let i=t.add(e)._unit(),o=gi(t.x*i.x+t.y*i.y,-1,1);var a,l,h;return a=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(a)))/4*HA*((l=t).x*(h=e).y-l.y*h.x<0?-1:1)}let QA=[t=>t.x<0,t=>t.x>pt,t=>t.y<0,t=>t.y>pt];function XA(t,e,i,o){let a=[4];if(o===0)return a;i._mult(o);let l=t.sub(i),h=e.sub(i),g=[t,e,l,h];for(let y=0;y<4;y++)for(let x of g)if(QA[y](x)){a.push(y);break}return a}class y1{constructor(e){this.vertexArray=new To,this.indexArray=new Mr,this.programConfigurations=new Fc(e.layers,e.zoom,i=>WA.includes(i)),this._segments=new er,this.hiddenByLandmarkVertexArray=new dy,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new er}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,o,a=!1){let l=e.length;if(l>2){let h=Math.max(0,this._segments.get().length-1),g=this._segments._prepareSegment(4*l,this.vertexArray.length,2*this._segmentToGroundQuads[h].length),y;h!==this._segments.get().length-1&&(h++,this._segmentToGroundQuads[h]=[],this._segmentToRegionTriCounts[h]=[0,0,0,0,0]);{let x=e[0],E=e[1];y=_1(x.sub(e[l-1])._perp()._unit(),E.sub(x)._perp()._unit())}for(let x=0;x<l;x++){let E=x===l-1?0:x+1,I=e[x],M=e[E],D=e[E===l-1?0:E+1],P=M.sub(I)._perp()._unit(),L=_1(P,D.sub(M)._perp()._unit()),N=y,V=L;if(Zy(I,M,i)||a&&x1(I,i)&&x1(M,i)){y=L;continue}let Z=g.vertexLength;ag(this.vertexArray,I,M,1,1,N),ag(this.vertexArray,I,M,1,0,N),ag(this.vertexArray,I,M,0,1,V),ag(this.vertexArray,I,M,0,0,V),g.vertexLength+=4;let Y=XA(I,M,P,o);for(let Q of Y)this._segmentToGroundQuads[h].push({id:Z,region:Q}),this._segmentToRegionTriCounts[h][Q]+=2,g.primitiveLength+=2;y=L}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),i=e.length;for(let o=0;o<i;o++)this._segmentToGroundQuads[o].sort((a,l)=>a.region-l.region);for(let o=0;o<i;o++){let a=this._segmentToGroundQuads[o],l=e[o],h=this._segmentToRegionTriCounts[o];h.reduce((y,x)=>y+x,0);let g=0;for(let y=0;y<=4;y++){let x=h[y];if(x!==0){let E=this.regionSegments[y];E||(E=this.regionSegments[y]=new er);let I={vertexOffset:l.vertexOffset,primitiveOffset:l.primitiveOffset+g,vertexLength:l.vertexLength,primitiveLength:x};E.get().push(I)}g+=x}for(let y=0;y<a.length;y++){let x=a[y].id;this.indexArray.emplaceBack(x,x+1,x+3),this.indexArray.emplaceBack(x,x+3,x+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,o,a,l,h){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,o,a,l,h)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,CA.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,o,a,l,h){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,o,a,l,h)}updateHiddenByLandmark(e){if(!this.hasData())return;let i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let o=e.flags&Gc?1:0;for(let a=e.groundVertexArrayOffset;a<i;++a)this.hiddenByLandmarkVertexArray.emplace(a,o);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,DA.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let i=this.regionSegments[e];i&&i.destroy()}}}}class lg{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Mr,this.footprintVertices=new Yr,this.footprintSegments=[],this.layoutVertexArray=new Kr,this.centroidVertexArray=new cx,this.indexArray=new Mr,this.programConfigurations=new Fc(e.layers,e.zoom,i=>$A.includes(i)),this.segments=new er,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new y1(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,i,o,a){this.features=[],this.hasPattern=Gy("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Um(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:l,id:h,index:g,sourceLayerIndex:y}of e){let x=this.layers[0]._featureFilter.needGeometry,E=Nc(l,x);if(!this.layers[0]._featureFilter.filter(new $(this.zoom),E,o))continue;let I={id:h,sourceLayerIndex:y,index:g,geometry:x?E.geometry:ic(l,o,a),properties:l.properties,type:l.type,patterns:{}},M=this.layoutVertexArray.length;this.hasPattern?this.features.push(qy("fill-extrusion",this.layers,I,this.zoom,i)):this.addFeature(I,I.geometry,g,o,{},i.availableImages,a,i.brightness),i.featureIndex.insert(l,I.geometry,g,y,this.index,M)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,o,a,l,h){for(let g of this.features){let{geometry:y}=g;this.addFeature(g,y,g.index,i,o,a,l,h)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,o,a,l){let h=Object.keys(e).length!==0;if(h&&!this.stateDependentLayers.length)return;let g=h?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,i,g,o,a,l),this.groundEffect.update(e,i,g,o,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,PA),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,RA.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,AA.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,a,l,h,g,y){let x=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,E=[new ct(0,0),new ct(pt,pt)],I=g.projection,M=I.name==="globe",D=qA[e.type]==="Polygon",P=new g1;P.centroidDataIndex=this.centroidData.length;let L=new m1,N=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},a)<=0,V=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},a);L.height=V,L.vertexArrayOffset=this.layoutVertexArray.length,L.groundVertexArrayOffset=this.groundEffect.vertexArray.length,M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ns);let Z=Uy(i,500);for(let he=Z.length-1;he>=0;he--){let be=Z[he];(be.length===0||(Y=be[0]).every(Pe=>Pe.x<=0)||Y.every(Pe=>Pe.x>=pt)||Y.every(Pe=>Pe.y<=0)||Y.every(Pe=>Pe.y>=pt))&&Z.splice(he,1)}var Y;let Q;if(M)Q=I1(Z,E,a);else{Q=[];for(let he of Z)Q.push({polygon:he,bounds:E})}let ae=D?this.edgeRadius:0,te=ae>0&&this.zoom<17,ce=(he,be)=>{if(he.length===0)return!1;let Pe=he[he.length-1];return be.x===Pe.x&&be.y===Pe.y};for(let{polygon:he,bounds:be}of Q){let Pe=0,Te=0;for(let $e of he)D&&!$e[0].equals($e[$e.length-1])&&$e.push($e[0]),Te+=D?$e.length-1:$e.length;let Le=this.segments.prepareSegment((D?5:4)*Te,this.layoutVertexArray,this.indexArray);L.footprintSegIdx<0&&(L.footprintSegIdx=this.footprintSegments.length),L.polygonSegIdx<0&&(L.polygonSegIdx=this.polygonSegments.length);let Oe={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ke=new f1;if(ke.vertexOffset=this.footprintVertices.length,ke.indexOffset=3*this.footprintIndices.length,ke.ringIndices=[],D){let $e=[],qe=[];Pe=Le.vertexLength;for(let Qe=0;Qe<he.length;Qe++){let Fe=he[Qe];Fe.length&&Qe!==0&&qe.push($e.length/2);let It=[],yt,Ke;yt=Fe[1].sub(Fe[0])._perp()._unit(),ke.ringIndices.push(Fe.length-1);for(let Ut=1;Ut<Fe.length;Ut++){let Pt=Fe[Ut],St=Fe[Ut===Fe.length-1?1:Ut+1],Je=Pt.clone();if(ae){Ke=St.sub(Pt)._perp()._unit();let Bt=yt.add(Ke)._unit(),ai=ae*Math.min(4,1/(yt.x*Bt.x+yt.y*Bt.y));Je.x+=ai*Bt.x,Je.y+=ai*Bt.y,Je.x=Math.round(Je.x),Je.y=Math.round(Je.y),yt=Ke}!N||ae!==0&&!te||ce(It,Je)||It.push(Je),Hp(this.layoutVertexArray,Je.x,Je.y,0,0,1,1,0),Le.vertexLength++,this.footprintVertices.emplaceBack(Pt.x,Pt.y),$e.push(Pt.x,Pt.y),M&&Qp(this.layoutVertexExtArray,I.projectTilePoint(Je.x,Je.y,a),I.upVector(a,Je.x,Je.y))}N&&(ae===0||te)&&(It.length!==0&&ce(It,It[0])&&It.pop(),this.groundEffect.addData(It,be,x))}let Xe=tg($e,qe);for(let Qe=0;Qe<Xe.length;Qe+=3)this.footprintIndices.emplaceBack(ke.vertexOffset+Xe[Qe+0],ke.vertexOffset+Xe[Qe+1],ke.vertexOffset+Xe[Qe+2]),this.indexArray.emplaceBack(Pe+Xe[Qe],Pe+Xe[Qe+2],Pe+Xe[Qe+1]),Le.primitiveLength++;ke.indexCount+=Xe.length,ke.vertexCount+=this.footprintVertices.length-ke.vertexOffset}for(let $e=0;$e<he.length;$e++){let qe=he[$e];P.startRing(L,qe[0]);let Xe=qe.length>4&&w1(qe[qe.length-2],qe[0],qe[1]),Qe=ae?YA(qe[qe.length-2],qe[0],qe[1],ae):0,Fe=[],It,yt,Ke;yt=qe[1].sub(qe[0])._perp()._unit();let Ut=!0;for(let Pt=1,St=0;Pt<qe.length;Pt++){let Je=qe[Pt-1],Bt=qe[Pt],ai=qe[Pt===qe.length-1?1:Pt+1];if(P.appendEdge(L,Bt,Je),Zy(Bt,Je,be)){ae&&(yt=ai.sub(Bt)._perp()._unit(),Ut=!Ut);continue}let Qt=Bt.sub(Je)._perp(),hi=Qt.x/(Math.abs(Qt.x)+Math.abs(Qt.y)),li=Qt.y>0?1:0,vi=Je.dist(Bt);if(St+vi>32768&&(St=0),ae){Ke=ai.sub(Bt)._perp()._unit();let Ui=b1(Je,Bt,ai,v1(yt,Ke),ae);isNaN(Ui)&&(Ui=0);let Ri=Bt.sub(Je)._unit();Je=Je.add(Ri.mult(Qe))._round(),Bt=Bt.add(Ri.mult(-Ui))._round(),Qe=Ui,yt=Ke,N&&this.zoom>=17&&(ce(Fe,Je)||Fe.push(Je),ce(Fe,Bt)||Fe.push(Bt))}let $t=Le.vertexLength,ln=qe.length>4&&w1(Je,Bt,ai),on=T1(St,Xe,Ut);if(Hp(this.layoutVertexArray,Je.x,Je.y,hi,li,0,0,on),Hp(this.layoutVertexArray,Je.x,Je.y,hi,li,0,1,on),St+=vi,on=T1(St,ln,!Ut),Xe=ln,Hp(this.layoutVertexArray,Bt.x,Bt.y,hi,li,0,0,on),Hp(this.layoutVertexArray,Bt.x,Bt.y,hi,li,0,1,on),Le.vertexLength+=4,this.indexArray.emplaceBack($t+0,$t+1,$t+2),this.indexArray.emplaceBack($t+1,$t+3,$t+2),Le.primitiveLength+=2,ae){let Ui=Pe+(Pt===1?qe.length-2:Pt-2),Ri=Pt===1?Pe:Ui+1;if(this.indexArray.emplaceBack($t+1,Ui,$t+3),this.indexArray.emplaceBack(Ui,Ri,$t+3),Le.primitiveLength+=2,It===void 0&&(It=$t),!Zy(ai,qe[Pt],be)){let Gi=Pt===qe.length-1?It:Le.vertexLength;this.indexArray.emplaceBack($t+2,$t+3,Gi),this.indexArray.emplaceBack($t+3,Gi+1,Gi),this.indexArray.emplaceBack($t+3,Ri,Gi+1),Le.primitiveLength+=3}Ut=!Ut}if(M){let Ui=this.layoutVertexExtArray,Ri=I.projectTilePoint(Je.x,Je.y,a),Gi=I.projectTilePoint(Bt.x,Bt.y,a),Tn=I.upVector(a,Je.x,Je.y),gn=I.upVector(a,Bt.x,Bt.y);Qp(Ui,Ri,Tn),Qp(Ui,Ri,Tn),Qp(Ui,Gi,gn),Qp(Ui,Gi,gn)}}D&&(Pe+=qe.length-1),N&&ae&&this.zoom>=17&&(Fe.length!==0&&ce(Fe,Fe[0])&&Fe.pop(),this.groundEffect.addData(Fe,be,x,ae>0))}this.footprintSegments.push(ke),Oe.triangleCount=this.indexArray.length-Oe.triangleArrayOffset,this.polygonSegments.push(Oe),++L.footprintSegLen,++L.polygonSegLen}if(L.vertexCount=this.layoutVertexArray.length-L.vertexArrayOffset,L.groundVertexCount=this.groundEffect.vertexArray.length-L.groundVertexArrayOffset,L.vertexCount!==0){if(L.centroidXY=P.borders?p1:this.encodeCentroid(P,L),this.centroidData.push(L),P.borders){this.featuresOnBorder.push(P);let he=this.featuresOnBorder.length-1;for(let be=0;be<P.borders.length;be++)P.borders[be][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[be].push(he)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,l,h,a,y),this.groundEffect.addPaintPropertiesData(e,o,l,h,a,y),this.maxHeight=Math.max(this.maxHeight,V)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,o)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}splitToSubtiles(){let e=[];for(let g=0;g<this.centroidData.length;g++){let y=this.centroidData[g],x=+(y.min.y+y.max.y>pt),E=2*x+(+(y.min.x+y.max.x>pt)^x);for(let I=0;I<y.polygonSegLen;I++){let M=y.polygonSegIdx+I;e.push({centroidIdx:g,subtile:E,polygonSegmentIdx:M,triangleSegmentIdx:this.polygonSegments[M].triangleSegIdx})}}let i=new Mr;e.sort((g,y)=>g.triangleSegmentIdx===y.triangleSegmentIdx?g.subtile-y.subtile:g.triangleSegmentIdx-y.triangleSegmentIdx);let o=0,a=0,l=0;for(let g of e){if(g.triangleSegmentIdx!==o)break;l++}let h=e.length;for(;a!==e.length;){o=e[a].triangleSegmentIdx;let g=0,y=a,x=a;for(let E=y;E<l&&e[E].subtile===g;E++)x++;for(;y!==l;){let E=e[y];g=E.subtile;let I=this.centroidData[E.centroidIdx].min.clone(),M=this.centroidData[E.centroidIdx].max.clone(),D={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let P=y;P<x;P++){let L=e[P],N=this.polygonSegments[L.polygonSegmentIdx],V=this.centroidData[L.centroidIdx].min,Z=this.centroidData[L.centroidIdx].max,Y=this.indexArray.uint16;for(let Q=N.triangleArrayOffset;Q<N.triangleArrayOffset+N.triangleCount;Q++)i.emplaceBack(Y[3*Q],Y[3*Q+1],Y[3*Q+2]);D.primitiveLength+=N.triangleCount,I.x=Math.min(I.x,V.x),I.y=Math.min(I.y,V.y),M.x=Math.max(M.x,Z.x),M.y=Math.max(M.y,Z.y)}D.primitiveLength>0&&this.triangleSubSegments.push({segment:D,min:I,max:M}),y=x;for(let P=y;P<l&&e[P].subtile===e[y].subtile;P++)x++}a=l;for(let E=a;E<h&&e[E].triangleSegmentIdx===e[a].triangleSegmentIdx;E++)l++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,o){let a=0,l=0,h=1<<e.canonical.z;if(i){let L=i.getMinMaxForTile(e);L&&(a=L.min,l=L.max)}l+=this.maxHeight;let g=e.toUnwrapped(),y,x=[g.canonical.x/h+g.wrap,g.canonical.y/h],E=[(g.canonical.x+1)/h+g.wrap,(g.canonical.y+1)/h],I=new er,M=(L,N,V)=>[L[0]*(1-V[0])+N[0]*V[0],L[1]*(1-V[1])+N[1]*V[1]],D=[],P=[];for(let L of this.triangleSubSegments){D[0]=L.min.x/pt,D[1]=L.min.y/pt,P[0]=L.max.x/pt,P[1]=L.max.y/pt;let N=M(x,E,D),V=M(x,E,P);if(new On([N[0],N[1],a],[V[0],V[1],l]).intersectsPrecise(o)===0){y&&(I.segments.push(y),y=void 0);continue}let Z=L.segment;y&&y.vertexOffset!==Z.vertexOffset&&(I.segments.push(y),y=void 0),y?(y.vertexLength+=Z.vertexLength,y.primitiveLength+=Z.primitiveLength):y={vertexOffset:Z.vertexOffset,primitiveLength:Z.primitiveLength,vertexLength:Z.vertexLength,primitiveOffset:Z.primitiveOffset,sortKey:void 0,vaos:{}}}return y&&I.segments.push(y),I}encodeCentroid(e,i){let o=e.centroid(),a=i.span(),l=Math.min(7,Math.round(a.x*this.tileToMeter/10)),h=Math.min(7,Math.round(a.y*this.tileToMeter/10));return new ct(gi(o.x,1,pt-1)<<3|l,gi(o.y,1,pt-1)<<3|h)}encodeBorderCentroid(e){if(!e.borders)return new ct(0,0);let i=e.borders,o=Number.MAX_VALUE;if(i[0][0]!==o||i[1][0]!==o){let a=i[0][0]!==o?0:1;return new ct(6|(i[0][0]!==o?0:65528),(i[a][0]+i[a][1])/2<<3|6)}{let a=i[2][0]!==o?2:3;return new ct((i[a][0]+i[a][1])/2<<3|6,6|(i[2][0]!==o?0:65528))}}showCentroid(e){let i=this.centroidData[e.centroidDataIndex];i.flags&=Gc,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let i=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,a=e.flags&Gc?p1:e.centroidXY,l=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==a.y||l!==a.x){for(let h=i;h<o;++h)this.centroidVertexArray.emplace(h,a.x,a.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;let o=i.getReplacementRegionsForTile(e.toUnwrapped());if(function(l,h){if(l.length!==h.length)return!1;for(let g=0;g<l.length;g++)if(l[g].sourceId!==h[g].sourceId||!t1(l[g],h[g]))return!1;return!0}(this.activeReplacements,o))return;if(this.activeReplacements=o,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let l of this.centroidData)l.flags&=2147483647;let a=[];for(let l of this.activeReplacements){let h=Math.pow(2,l.footprintTileId.canonical.z-e.canonical.z);for(let g of this.centroidData)if(!(g.flags&Gc||l.min.x>g.max.x||g.min.x>l.max.x||l.min.y>g.max.y||g.min.y>l.max.y))for(let y=0;y<g.footprintSegLen;y++){let x=this.footprintSegments[g.footprintSegIdx+y];if(a.length=0,KA(this.footprintVertices,x.vertexOffset,x.vertexCount,l.footprintTileId.canonical,e.canonical,a),r1(l.footprint,a,this.footprintIndices.uint16,x.indexOffset,x.indexCount,-x.vertexOffset,-h)){g.flags|=Gc;break}}}for(let l of this.centroidData)this.writeCentroidToBuffer(l);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,o){let a=!1;for(let l=0;l<o.footprintSegLen;l++){let h=this.footprintSegments[o.footprintSegIdx+l],g=0;for(let y of h.ringIndices){for(let x=g,E=y+g-1;x<y+g;E=x++){let I=this.footprintVertices.int16[2*(x+h.vertexOffset)+0],M=this.footprintVertices.int16[2*(x+h.vertexOffset)+1],D=this.footprintVertices.int16[2*(E+h.vertexOffset)+1];M>i!=D>i&&e<(this.footprintVertices.int16[2*(E+h.vertexOffset)+0]-I)*(i-M)/(D-M)+I&&(a=!a)}g=y}}return a}getHeightAtTileCoord(e,i){let o=Number.NEGATIVE_INFINITY,a=!0,l=4*(e+pt)*pt+(i+pt);if(this.partLookup.hasOwnProperty(l)){let h=this.partLookup[l];return h?{height:h.height,hidden:!!(h.flags&Gc)}:void 0}for(let h of this.centroidData)e>h.max.x||h.min.x>e||i>h.max.y||h.min.y>i||this.footprintContainsPoint(e,i,h)&&h&&h.height>o&&(o=h.height,this.partLookup[l]=h,a=!!(h.flags&Gc));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:a};this.partLookup[l]=void 0}}function v1(t,e){let i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function YA(t,e,i,o){let a=e.sub(t)._perp()._unit(),l=i.sub(e)._perp()._unit();return b1(t,e,i,v1(a,l),o)}function b1(t,e,i,o,a){let l=Math.sqrt(1-o*o);return Math.min(t.dist(e)/3,e.dist(i)/3,a*l/o)}function Zy(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function x1(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function w1(t,e,i){if(t.x<0||t.x>=pt||e.x<0||e.x>=pt||i.x<0||i.x>=pt)return!1;let o=i.sub(e),a=o.perp(),l=t.sub(e);return(o.x*l.x+o.y*l.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(l.x*l.x+l.y*l.y))>-.866&&a.x*l.x+a.y*l.y<0}function T1(t,e,i){let o=e?2|t:-3&t;return i?1|o:-2&o}function E1(){let t=Math.PI/32,e=Math.tan(t),i=dd;return i*Math.sqrt(1+2*e*e)-i}function I1(t,e,i){let o=1<<i.z,a=xs(i.x/o),l=xs((i.x+1)/o),h=Jr(i.y/o),g=Jr((i.y+1)/o);return function(y,x,E,I,M=0,D){let P=[];if(!y.length||!E||!I)return P;let L=(te,ce)=>{for(let he of te)P.push({polygon:he,bounds:ce})},N=Math.ceil(Math.log2(E)),V=Math.ceil(Math.log2(I)),Z=N-V,Y=[];for(let te=0;te<Math.abs(Z);te++)Y.push(Z>0?0:1);for(let te=0;te<Math.min(N,V);te++)Y.push(0),Y.push(1);let Q=y;if(Q=rg(Q,x[0].y-M,x[1].y+M,1),Q=rg(Q,x[0].x-M,x[1].x+M,0),!Q.length)return P;let ae=[];for(Y.length?ae.push({polygons:Q,bounds:x,depth:0}):L(Q,x);ae.length;){let te=ae.pop(),ce=te.depth,he=Y[ce],be=te.bounds[0],Pe=te.bounds[1],Te=he===0?be.x:be.y,Le=he===0?Pe.x:Pe.y,Oe=D?D(he,Te,Le):.5*(Te+Le),ke=rg(te.polygons,Te-M,Oe+M,he),$e=rg(te.polygons,Oe-M,Le+M,he);if(ke.length){let qe=[be,new ct(he===0?Oe:Pe.x,he===1?Oe:Pe.y)];Y.length>ce+1?ae.push({polygons:ke,bounds:qe,depth:ce+1}):L(ke,qe)}if($e.length){let qe=[new ct(he===0?Oe:be.x,he===1?Oe:be.y),Pe];Y.length>ce+1?ae.push({polygons:$e,bounds:qe,depth:ce+1}):L($e,qe)}}return P}(t,e,Math.ceil((l-a)/11.25),Math.ceil((h-g)/11.25),1,(y,x,E)=>{if(y===0)return .5*(x+E);{let I=Jr((i.y+x/pt)/o);return(tc(.5*(Jr((i.y+E/pt)/o)+I))*o-i.y)*pt}})}function KA(t,e,i,o,a,l){let h=Math.pow(2,o.z-a.z);for(let g=0;g<i;g++){let y=t.int16[2*(g+e)+0],x=t.int16[2*(g+e)+1];y=(y+a.x*pt)*h-o.x*pt,x=(x+a.y*pt)*h-o.y*pt,l.push(new ct(y,x))}}bt(lg,"FillExtrusionBucket",{omit:["layers","features"]}),bt(m1,"PartData"),bt(f1,"FootprintSegment"),bt(g1,"BorderCentroidData"),bt(y1,"GroundEffect");let JA=new ye({visibility:new pe(re["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new pe(re["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var e2={paint:new ye({"fill-extrusion-opacity":new pe(re["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new xe(re["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new pe(re["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new pe(re["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new xe(re["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new xe(re["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new xe(re["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new pe(re["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new pe(re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new pe(re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new pe(re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new pe(re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new pe(re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new pe(re["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new pe(re["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new xe(re["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new xe(re["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new pe(re["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new pe(re["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new pe(re["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new pe(re["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new pe(re["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:JA};class yd extends ct{constructor(e,i,o){super(e,i),this.z=o}}function Xp(t,e){return t.x*e.x+t.y*e.y}function S1(t,e){if(t.length===1){let i=0,o=e[i++],a;for(;!a||o.equals(a);)if(a=e[i++],!a)return 1/0;for(;i<e.length;i++){let l=e[i],h=t[0],g=a.sub(o),y=l.sub(o),x=h.sub(o),E=Xp(g,g),I=Xp(g,y),M=Xp(y,y),D=Xp(x,g),P=Xp(x,y),L=E*M-I*I,N=(M*D-I*P)/L,V=(E*P-I*D)/L,Z=o.z*(1-N-V)+a.z*N+l.z*V;if(isFinite(Z))return Z}return 1/0}{let i=1/0;for(let o of e)i=Math.min(i,o.z);return i}}function M1(t,e,i,o,a,l,h,g){let y=h*a.getElevationAt(t,e,!0,!0),x=l[0]!==0,E=x?l[1]===0?h*(l[0]/7-450):h*function(I,M,D){let P=Math.floor(M[0]/8),L=Math.floor(M[1]/8),N=10*(M[0]-8*P),V=10*(M[1]-8*L),Z=I.getElevationAt(P,L,!0,!0),Y=I.getMeterToDEM(D),Q=Math.floor(.5*(N*Y-1)),ae=Math.floor(.5*(V*Y-1)),te=I.tileCoordToPixel(P,L),ce=2*Q+1,he=2*ae+1,be=function($e,qe,Xe,Qe,Fe){return[$e.getElevationAtPixel(qe,Xe,!0),$e.getElevationAtPixel(qe+Fe,Xe,!0),$e.getElevationAtPixel(qe,Xe+Fe,!0),$e.getElevationAtPixel(qe+Qe,Xe+Fe,!0)]}(I,te.x-Q,te.y-ae,ce,he),Pe=Math.abs(be[0]-be[1]),Te=Math.abs(be[2]-be[3]),Le=Math.abs(be[0]-be[2])+Math.abs(be[1]-be[3]),Oe=Math.min(.25,.5*Y*(Pe+Te)/ce),ke=Math.min(.25,.5*Y*Le/he);return Z+Math.max(Oe*N,ke*V)}(a,l,g):y;return{base:y+(i===0)?-1:i,top:x?Math.max(E+o,y+i+2):y+o}}let t2=oi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:i2}=t2,n2=oi([{name:"a_packed",components:4,type:"Float32"}]),{members:r2}=n2,o2=oi([{name:"a_pattern_data",components:2,type:"Float32"}]),{members:s2}=o2;class C1{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new jc({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){let o=this.getKey(e,i);return this.positions[o]}trim(){let e=this.width,i=this.height=zl(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,o){let a=[],l=e.length%2==1?-e[e.length-1]*o:0,h=e[0]*o,g=!0;a.push({left:l,right:h,isDash:g,zeroLength:e[0]===0});let y=e[0];for(let x=1;x<e.length;x++){g=!g;let E=e[x];l=y*o,y+=E,h=y*o,a.push({left:l,right:h,isDash:g,zeroLength:E===0})}return a}addRoundDash(e,i,o){let a=i/2;for(let l=-o;l<=o;l++){let h=this.width*(this.nextRow+o+l),g=0,y=e[g];for(let x=0;x<this.width;x++){x/y.right>1&&(y=e[++g]);let E=Math.abs(x-y.left),I=Math.abs(x-y.right),M=Math.min(E,I),D,P=l/o*(a+1);if(y.isDash){let L=a-Math.abs(P);D=Math.sqrt(M*M+L*L)}else D=a-Math.sqrt(M*M+P*P);this.image.data[h+x]=Math.max(0,Math.min(255,D+128))}}}addRegularDash(e,i){for(let y=e.length-1;y>=0;--y){let x=e[y],E=e[y+1];x.zeroLength?e.splice(y,1):E&&E.isDash===x.isDash&&(E.left=x.left,e.splice(y,1))}let o=e[0],a=e[e.length-1];o.isDash===a.isDash&&(o.left=a.left-this.width,a.right=o.right+this.width);let l=this.width*this.nextRow,h=0,g=e[h];for(let y=0;y<this.width;y++){y/g.right>1&&(g=e[++h]);let x=Math.abs(y-g.left),E=Math.abs(y-g.right),I=Math.min(x,E);this.image.data[l+y]=Math.max(0,Math.min(255,(g.isDash?I:-I)+i+128))}}addDash(e,i){let o=this.getKey(e,i);if(this.positions[o])return this.positions[o];let a=i==="round",l=a?7:0,h=2*l+1;if(this.nextRow+h>this.height)return Mn("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let E=0;E<e.length;E++)e[E]<0&&(Mn("Negative value is found in line dasharray, replacing values with 0"),e[E]=0),g+=e[E];if(g!==0){let E=this.width/g,I=this.getDashRanges(e,this.width,E);a?this.addRoundDash(I,E,l):this.addRegularDash(I,i==="square"?.5*E:0)}let y=this.nextRow+l;this.nextRow+=h;let x={tl:[y,l],br:[g,0]};return this.positions[o]=x,x}}bt(C1,"LineAtlas");let a2=ng.types,l2=Math.cos(Math.PI/180*37.5),c2=Math.cos(Math.PI/180*5);class Hy{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new ro,this.layoutVertexArray2=new Sr,this.patternVertexArray=new Nr,this.indexArray=new Mr,this.programConfigurations=new Fc(e.layers,e.zoom),this.segments=new er,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,o,a){this.hasPattern=Gy("line",this.layers,i);let l=this.layers[0].layout.get("line-sort-key"),h=[];for(let{feature:E,id:I,index:M,sourceLayerIndex:D}of e){let P=this.layers[0]._featureFilter.needGeometry,L=Nc(E,P);if(!this.layers[0]._featureFilter.filter(new $(this.zoom),L,o))continue;let N=l?l.evaluate(L,{},o):void 0,V={id:I,properties:E.properties,type:E.type,sourceLayerIndex:D,index:M,geometry:P?L.geometry:ic(E,o,a),patterns:{},sortKey:N};h.push(V)}l&&h.sort((E,I)=>E.sortKey-I.sortKey);let{lineAtlas:g,featureIndex:y}=i,x=this.addConstantDashes(g);for(let E of h){let{geometry:I,index:M,sourceLayerIndex:D}=E;if(x&&this.addFeatureDashes(E,g),this.hasPattern){let P=qy("line",this.layers,E,this.zoom,i);this.patternFeatures.push(P)}else this.addFeature(E,I,M,o,g.positions,i.availableImages,i.brightness);y.insert(e[M].feature,I,M,D,this.index)}}addConstantDashes(e){let i=!1;for(let o of this.layers){let a=o.paint.get("line-dasharray").value,l=o.layout.get("line-cap").value;if(a.kind!=="constant"||l.kind!=="constant")i=!0;else{let h=l.value,g=a.value;if(!g)continue;e.addDash(g,h)}}return i}addFeatureDashes(e,i){let o=this.zoom;for(let a of this.layers){let l=a.paint.get("line-dasharray").value,h=a.layout.get("line-cap").value;if(l.kind==="constant"&&h.kind==="constant")continue;let g,y;if(l.kind==="constant"){if(g=l.value,!g)continue}else g=l.evaluate({zoom:o},e);y=h.kind==="constant"?h.value:h.evaluate({zoom:o},e),i.addDash(g,y),e.patterns[a.id]=i.getKey(g,y)}}update(e,i,o,a,l){let h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,h?this.stateDependentLayers:this.layers,o,a,l)}addFeatures(e,i,o,a,l,h){for(let g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,o,a,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,r2)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,s2)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,i2),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,a,l,h,g){let y=this.layers[0].layout,x=y.get("line-join").evaluate(e,{}),E=y.get("line-cap").evaluate(e,{}),I=y.get("line-miter-limit"),M=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let D of i)this.addLine(D,e,x,E,I,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,l,h,a,g)}addLine(e,i,o,a,l,h){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0;let g=o==="none";if(this.patternJoinNone=this.hasPattern&&g,this.segmentStart=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Z=0;Z<e.length-1;Z++)this.totalDistance+=e[Z].dist(e[Z+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let y=a2[i.type]==="Polygon",x=e.length;for(;x>=2&&e[x-1].equals(e[x-2]);)x--;let E=0;for(;E<x-1&&e[E].equals(e[E+1]);)E++;if(x<(y?3:2))return;o==="bevel"&&(l=1.05);let I=this.overscaling<=16?15*pt/(512*this.overscaling):0,M=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray),D,P,L,N,V;this.e1=this.e2=-1,y&&(D=e[x-2],V=e[E].sub(D)._unit()._perp());for(let Z=E;Z<x;Z++){if(L=Z===x-1?y?e[E+1]:void 0:e[Z+1],L&&e[Z].equals(L))continue;V&&(N=V),D&&(P=D),D=e[Z],V=L?L.sub(D)._unit()._perp():N,N=N||V;let Y=P&&L,Q=Y?o:y||g?"butt":a,ae=N.x*V.x+N.y*V.y;if(g){let Le=function(Oe){if(Oe.patternJoinNone){let ke=Oe.segmentPoints.length/2,$e=Oe.lineSoFar-Oe.segmentStart;for(let qe=0;qe<ke;++qe){let Xe=Oe.segmentPoints[2*qe+1],Qe=Math.round(Oe.segmentPoints[2*qe])+.5+.25*Xe;Oe.patternVertexArray.emplaceBack(Qe,$e),Oe.patternVertexArray.emplaceBack(Qe,$e)}Oe.segmentPoints=[],Oe.segmentStart=Oe.lineSoFar}Oe.e1=Oe.e2=-1};if(Y&&ae<c2){this.updateDistance(P,D),this.addCurrentVertex(D,N,1,1,M),Le(this),this.addCurrentVertex(D,V,-1,-1,M);continue}if(P){if(!L){this.updateDistance(P,D),this.addCurrentVertex(D,N,1,1,M),Le(this);continue}Q="miter"}}let te=N.add(V);te.x===0&&te.y===0||te._unit();let ce=te.x*V.x+te.y*V.y,he=ce!==0?1/ce:1/0,be=2*Math.sqrt(2-2*ce),Pe=ce<l2&&P&&L,Te=N.x*V.y-N.y*V.x>0;if(Pe&&Z>E){let Le=D.dist(P);if(Le>2*I){let Oe=D.sub(D.sub(P)._mult(I/Le)._round());this.updateDistance(P,Oe),this.addCurrentVertex(Oe,N,0,0,M),P=Oe}}if(Y&&Q==="round"&&(he<h?Q="miter":he<=2&&(Q="fakeround")),Q==="miter"&&he>l&&(Q="bevel"),Q==="bevel"&&(he>2&&(Q="flipbevel"),he<l&&(Q="miter")),P&&this.updateDistance(P,D),Q==="miter")te._mult(he),this.addCurrentVertex(D,te,0,0,M);else if(Q==="flipbevel"){if(he>100)te=V.mult(-1);else{let Le=he*N.add(V).mag()/N.sub(V).mag();te._perp()._mult(Le*(Te?-1:1))}this.addCurrentVertex(D,te,0,0,M),this.addCurrentVertex(D,te.mult(-1),0,0,M)}else if(Q==="bevel"||Q==="fakeround"){let Le=-Math.sqrt(he*he-1),Oe=Te?Le:0,ke=Te?0:Le;if(P&&this.addCurrentVertex(D,N,Oe,ke,M),Q==="fakeround"){let $e=Math.round(180*be/Math.PI/20);for(let qe=1;qe<$e;qe++){let Xe=qe/$e;if(Xe!==.5){let Fe=Xe-.5;Xe+=Xe*Fe*(Xe-1)*((1.0904+ae*(ae*(3.55645-1.43519*ae)-3.2452))*Fe*Fe+(.848013+ae*(.215638*ae-1.06021)))}let Qe=V.sub(N)._mult(Xe)._add(N)._unit()._mult(Te?-1:1);this.addHalfVertex(D,Qe.x,Qe.y,!1,Te,0,M)}}L&&this.addCurrentVertex(D,V,-Oe,-ke,M)}else Q==="butt"?this.addCurrentVertex(D,te,0,0,M):Q==="square"?(P||this.addCurrentVertex(D,te,-1,-1,M),this.addCurrentVertex(D,te,0,0,M),P&&this.addCurrentVertex(D,te,1,1,M)):Q==="round"&&(P&&(this.addCurrentVertex(D,N,0,0,M),this.addCurrentVertex(D,N,1,1,M,!0)),L&&(this.addCurrentVertex(D,V,-1,-1,M,!0),this.addCurrentVertex(D,V,0,0,M)));if(Pe&&Z<x-1){let Le=D.dist(L);if(Le>2*I){let Oe=D.add(L.sub(D)._mult(I/Le)._round());this.updateDistance(D,Oe),this.addCurrentVertex(Oe,V,0,0,M),D=Oe}}}}addCurrentVertex(e,i,o,a,l,h=!1){let g=i.y*a-i.x,y=-i.y-i.x*a;this.addHalfVertex(e,i.x+i.y*o,i.y-i.x*o,h,!1,o,l),this.addHalfVertex(e,g,y,h,!0,-a,l),this.patternJoinNone&&this.segmentPoints.push(this.lineSoFar-this.segmentStart,o)}addHalfVertex({x:e,y:i},o,a,l,h,g,y){this.layoutVertexArray.emplaceBack((e<<1)+(l?1:0),(i<<1)+(h?1:0),Math.round(63*o)+128,Math.round(63*a)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let x=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),y.primitiveLength++),h?this.e2=x:this.e1=x}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}bt(Hy,"LineBucket",{omit:["layers","patternFeatures"]});let u2=new ye({"line-cap":new xe(re.layout_line["line-cap"]),"line-join":new xe(re.layout_line["line-join"]),"line-miter-limit":new pe(re.layout_line["line-miter-limit"]),"line-round-limit":new pe(re.layout_line["line-round-limit"]),"line-sort-key":new xe(re.layout_line["line-sort-key"]),visibility:new pe(re.layout_line.visibility)});var A1={paint:new ye({"line-opacity":new xe(re.paint_line["line-opacity"]),"line-color":new xe(re.paint_line["line-color"]),"line-translate":new pe(re.paint_line["line-translate"]),"line-translate-anchor":new pe(re.paint_line["line-translate-anchor"]),"line-width":new xe(re.paint_line["line-width"]),"line-gap-width":new xe(re.paint_line["line-gap-width"]),"line-offset":new xe(re.paint_line["line-offset"]),"line-blur":new xe(re.paint_line["line-blur"]),"line-dasharray":new xe(re.paint_line["line-dasharray"]),"line-pattern":new xe(re.paint_line["line-pattern"]),"line-gradient":new He(re.paint_line["line-gradient"]),"line-trim-offset":new pe(re.paint_line["line-trim-offset"]),"line-emissive-strength":new pe(re.paint_line["line-emissive-strength"]),"line-border-width":new xe(re.paint_line["line-border-width"]),"line-border-color":new xe(re.paint_line["line-border-color"])}),layout:u2};function D1(t,e,i){return e*(pt/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}function R1(t,e){return 1/D1(t,1,e.tileZoom)}function P1(t,e,i,o){return t.translatePosMatrix(o||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}let k1=t=>{let e=[];O1(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let i=t.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let o=t.layout.get("line-join").constantOr("miter")==="none",a=!!t.paint.get("line-pattern").constantOr(1);return o&&a&&e.push("LINE_JOIN_NONE"),e};function O1(t){let e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let L1=new class extends xe{possiblyEvaluate(t,e){return e=new $(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,o){return e=bo({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,o)}}(A1.paint.properties["line-width"].specification);function F1(t,e){return e>0?e+2*t:t}L1.useIntegerZoom=!0;let h2=oi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),d2=oi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),p2=oi([{name:"a_projected_pos",components:4,type:"Float32"}],4);oi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let f2=oi([{name:"a_z_offset",components:1,type:"Float32"}],4),m2=oi([{name:"a_texb",components:2,type:"Uint16"}]),g2=oi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),_2=oi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);oi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let z1=oi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),y2=oi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);oi([{name:"triangle",components:3,type:"Uint16"}]),oi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),oi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),oi([{type:"Float32",name:"offsetX"}]),oi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var eo=24;let Ha=128;function Qy(t,e){let{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new $(t+1))};if(i.kind==="source")return{kind:"source"};{let{zoomStops:o,interpolationType:a}=i,l=0;for(;l<o.length&&o[l]<=t;)l++;l=Math.max(0,l-1);let h=l;for(;h<o.length&&o[h]<t+1;)h++;h=Math.min(o.length-1,h);let g=o[l],y=o[h];return i.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:y,interpolationType:a}:{kind:"camera",minZoom:g,maxZoom:y,minSize:i.evaluate(new $(g)),maxSize:i.evaluate(new $(y)),interpolationType:a}}}function cg(t,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:a}){return t.kind==="source"?o/Ha:t.kind==="composite"?si(o/Ha,a/Ha,i):e}function vd(t,e){let i=0,o=0;if(t.kind==="constant")o=t.layoutSize;else if(t.kind!=="source"){let{interpolationType:a,minZoom:l,maxZoom:h}=t,g=a?gi(Jo.interpolationFactor(a,e,l,h),0,1):0;t.kind==="camera"?o=si(t.minSize,t.maxSize,g):i=g}return{uSizeT:i,uSize:o}}var v2=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ha,evaluateSizeForFeature:cg,evaluateSizeForZoom:vd,getSizeData:Qy});function b2(t,e,i){return t.sections.forEach(o=>{o.text=function(a,l,h){let g=l.layout.get("text-transform").evaluate(h,{});return g==="uppercase"?a=a.toLocaleUpperCase():g==="lowercase"&&(a=a.toLocaleLowerCase()),oe.applyArabicShaping&&(a=oe.applyArabicShaping(a)),a}(o.text,e,i)}),t}let Yp={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function x2(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function w2(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}var T2={read:function(t,e,i,o,a){var l,h,g=8*a-o-1,y=(1<<g)-1,x=y>>1,E=-7,I=i?a-1:0,M=i?-1:1,D=t[e+I];for(I+=M,l=D&(1<<-E)-1,D>>=-E,E+=g;E>0;l=256*l+t[e+I],I+=M,E-=8);for(h=l&(1<<-E)-1,l>>=-E,E+=o;E>0;h=256*h+t[e+I],I+=M,E-=8);if(l===0)l=1-x;else{if(l===y)return h?NaN:1/0*(D?-1:1);h+=Math.pow(2,o),l-=x}return(D?-1:1)*h*Math.pow(2,l-o)},write:function(t,e,i,o,a,l){var h,g,y,x=8*l-a-1,E=(1<<x)-1,I=E>>1,M=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,D=o?0:l-1,P=o?1:-1,L=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,h=E):(h=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-h))<1&&(h--,y*=2),(e+=h+I>=1?M/y:M*Math.pow(2,1-I))*y>=2&&(h++,y/=2),h+I>=E?(g=0,h=E):h+I>=1?(g=(e*y-1)*Math.pow(2,a),h+=I):(g=e*Math.pow(2,I-1)*Math.pow(2,a),h=0));a>=8;t[i+D]=255&g,D+=P,g/=256,a-=8);for(h=h<<a|g,x+=a;x>0;t[i+D]=255&h,D+=P,h/=256,x-=8);t[i+D-P]|=128*L}},B1=Ln,ug=T2;function Ln(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Ln.Varint=0,Ln.Fixed64=1,Ln.Bytes=2,Ln.Fixed32=5;var Xy=4294967296,N1=1/Xy,V1=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function rc(t){return t.type===Ln.Bytes?t.readVarint()+t.pos:t.pos+1}function bd(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function j1(t,e,i){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(o);for(var a=i.pos-1;a>=t;a--)i.buf[a+o]=i.buf[a]}function E2(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function I2(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function S2(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function M2(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function C2(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function A2(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function D2(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function R2(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function P2(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function hg(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function xd(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function U1(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Ln.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var o=this.readVarint(),a=o>>3,l=this.pos;this.type=7&o,t(a,e,this),this.pos===l&&this.skip(o)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=hg(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=U1(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=hg(this.buf,this.pos)+hg(this.buf,this.pos+4)*Xy;return this.pos+=8,t},readSFixed64:function(){var t=hg(this.buf,this.pos)+U1(this.buf,this.pos+4)*Xy;return this.pos+=8,t},readFloat:function(){var t=ug.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=ug.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,o=this.buf;return e=127&(i=o[this.pos++]),i<128?e:(e|=(127&(i=o[this.pos++]))<<7,i<128?e:(e|=(127&(i=o[this.pos++]))<<14,i<128?e:(e|=(127&(i=o[this.pos++]))<<21,i<128?e:function(a,l,h){var g,y,x=h.buf;if(g=(112&(y=x[h.pos++]))>>4,y<128||(g|=(127&(y=x[h.pos++]))<<3,y<128)||(g|=(127&(y=x[h.pos++]))<<10,y<128)||(g|=(127&(y=x[h.pos++]))<<17,y<128)||(g|=(127&(y=x[h.pos++]))<<24,y<128)||(g|=(1&(y=x[h.pos++]))<<31,y<128))return bd(a,g,l);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=o[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&V1?function(i,o,a){return V1.decode(i.subarray(o,a))}(this.buf,e,t):function(i,o,a){for(var l="",h=o;h<a;){var g,y,x,E=i[h],I=null,M=E>239?4:E>223?3:E>191?2:1;if(h+M>a)break;M===1?E<128&&(I=E):M===2?(192&(g=i[h+1]))==128&&(I=(31&E)<<6|63&g)<=127&&(I=null):M===3?(y=i[h+2],(192&(g=i[h+1]))==128&&(192&y)==128&&((I=(15&E)<<12|(63&g)<<6|63&y)<=2047||I>=55296&&I<=57343)&&(I=null)):M===4&&(y=i[h+2],x=i[h+3],(192&(g=i[h+1]))==128&&(192&y)==128&&(192&x)==128&&((I=(15&E)<<18|(63&g)<<12|(63&y)<<6|63&x)<=65535||I>=1114112)&&(I=null)),I===null?(I=65533,M=1):I>65535&&(I-=65536,l+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),l+=String.fromCharCode(I),h+=M}return l}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Ln.Bytes)return t.push(this.readVarint(e));var i=rc(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Ln.Bytes)return t.push(this.readSVarint());var e=rc(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Ln.Bytes)return t.push(this.readBoolean());var e=rc(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Ln.Bytes)return t.push(this.readFloat());var e=rc(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Ln.Bytes)return t.push(this.readDouble());var e=rc(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Ln.Bytes)return t.push(this.readFixed32());var e=rc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Ln.Bytes)return t.push(this.readSFixed32());var e=rc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Ln.Bytes)return t.push(this.readFixed64());var e=rc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Ln.Bytes)return t.push(this.readSFixed64());var e=rc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Ln.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ln.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ln.Fixed32)this.pos+=4;else{if(e!==Ln.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),xd(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),xd(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),xd(this.buf,-1&t,this.pos),xd(this.buf,Math.floor(t*N1),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),xd(this.buf,-1&t,this.pos),xd(this.buf,Math.floor(t*N1),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var o,a;if(e>=0?(o=e%4294967296|0,a=e/4294967296|0):(a=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,a=a+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(l,h,g){g.buf[g.pos++]=127&l|128,l>>>=7,g.buf[g.pos++]=127&l|128,l>>>=7,g.buf[g.pos++]=127&l|128,l>>>=7,g.buf[g.pos++]=127&l|128,g.buf[g.pos]=127&(l>>>=7)}(o,0,i),function(l,h){var g=(7&l)<<4;h.buf[h.pos++]|=g|((l>>>=3)?128:0),l&&(h.buf[h.pos++]=127&l|((l>>>=7)?128:0),l&&(h.buf[h.pos++]=127&l|((l>>>=7)?128:0),l&&(h.buf[h.pos++]=127&l|((l>>>=7)?128:0),l&&(h.buf[h.pos++]=127&l|((l>>>=7)?128:0),l&&(h.buf[h.pos++]=127&l)))))}(a,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(o,a,l){for(var h,g,y=0;y<a.length;y++){if((h=a.charCodeAt(y))>55295&&h<57344){if(!g){h>56319||y+1===a.length?(o[l++]=239,o[l++]=191,o[l++]=189):g=h;continue}if(h<56320){o[l++]=239,o[l++]=191,o[l++]=189,g=h;continue}h=g-55296<<10|h-56320|65536,g=null}else g&&(o[l++]=239,o[l++]=191,o[l++]=189,g=null);h<128?o[l++]=h:(h<2048?o[l++]=h>>6|192:(h<65536?o[l++]=h>>12|224:(o[l++]=h>>18|240,o[l++]=h>>12&63|128),o[l++]=h>>6&63|128),o[l++]=63&h|128)}return l}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&j1(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),ug.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),ug.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var o=this.pos-i;o>=128&&j1(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o},writeMessage:function(t,e,i){this.writeTag(t,Ln.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,E2,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,I2,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,C2,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,S2,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,M2,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,A2,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,D2,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,R2,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,P2,e)},writeBytesField:function(t,e){this.writeTag(t,Ln.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Ln.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Ln.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Ln.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Ln.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Ln.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Ln.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Ln.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Ln.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Ln.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var wd=sn(B1);let Yy=3;function k2(t,e,i){e.glyphs=[],t===1&&i.readMessage(O2,e)}function O2(t,e,i){if(t===3){let{id:o,bitmap:a,width:l,height:h,left:g,top:y,advance:x}=i.readMessage(L2,{});e.glyphs.push({id:o,bitmap:new jc({width:l+2*Yy,height:h+2*Yy},a),metrics:{width:l,height:h,left:g,top:y,advance:x}})}else t===4?e.ascender=i.readSVarint():t===5&&(e.descender=i.readSVarint())}function L2(t,e,i){t===1?e.id=i.readVarint():t===2?e.bitmap=i.readBytes():t===3?e.width=i.readVarint():t===4?e.height=i.readVarint():t===5?e.left=i.readSVarint():t===6?e.top=i.readSVarint():t===7&&(e.advance=i.readVarint())}let G1=Yy,js={horizontal:1,vertical:2,horizontalOnly:3};class Kp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){let o=new Kp;return o.scale=e||1,o.fontStack=i,o}static forImage(e){let i=new Kp;return i.imageName=e,i}}class Td{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){let o=new Td;for(let a=0;a<e.sections.length;a++){let l=e.sections[a];l.image?o.addImageSection(l):o.addTextSection(l,i)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,o){let a="";for(let l=0;l<i.length;l++){let h=i.charCodeAt(l+1)||null,g=i.charCodeAt(l-1)||null;a+=!o&&(h&&b(h)&&!Yp[i[l+1]]||g&&b(g)&&!Yp[i[l-1]])||!Yp[i[l]]?i[l]:Yp[i[l]]}return a}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&dg[this.text.charCodeAt(o)];o++)e++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&dg[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){let o=new Td;return o.text=this.text.substring(e,i),o.sectionIndex=this.sectionIndex.slice(e,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Kp.forText(e.scale,e.fontStack||i));let o=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(o)}addImageSection(e){let i=e.image?e.image.namePrimary:"";if(i.length===0)return void Mn("Can't add FormattedSection with an empty image.");let o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCodePoint(o),this.sections.push(Kp.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Mn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ky(t,e,i,o,a,l,h,g,y,x,E,I,M,D,P){let L=Td.fromFeature(t,a);I===js.vertical&&L.verticalizePunctuation(M);let N=[],V=function(te,ce,he,be,Pe,Te){if(!te)return[];let Le=[],Oe=function(Xe,Qe,Fe,It,yt,Ke){let Ut=0;for(let Pt=0;Pt<Xe.length();Pt++){let St=Xe.getSection(Pt);Ut+=q1(Xe.getCodePoint(Pt),St,It,yt,Qe,Ke)}return Ut/Math.max(1,Math.ceil(Ut/Fe))}(te,ce,he,be,Pe,Te),ke=te.text.indexOf("\u200B")>=0,$e=0;for(let Xe=0;Xe<te.length();Xe++){let Qe=te.getSection(Xe),Fe=te.getCodePoint(Xe);if(dg[Fe]||($e+=q1(Fe,Qe,be,Pe,ce,Te)),Xe<te.length()-1){let It=!((qe=Fe)<11904||!(n["Bopomofo Extended"](qe)||n.Bopomofo(qe)||n["CJK Compatibility Forms"](qe)||n["CJK Compatibility Ideographs"](qe)||n["CJK Compatibility"](qe)||n["CJK Radicals Supplement"](qe)||n["CJK Strokes"](qe)||n["CJK Symbols and Punctuation"](qe)||n["CJK Unified Ideographs Extension A"](qe)||n["CJK Unified Ideographs"](qe)||n["Enclosed CJK Letters and Months"](qe)||n["Halfwidth and Fullwidth Forms"](qe)||n.Hiragana(qe)||n["Ideographic Description Characters"](qe)||n["Kangxi Radicals"](qe)||n["Katakana Phonetic Extensions"](qe)||n.Katakana(qe)||n["Vertical Forms"](qe)||n["Yi Radicals"](qe)||n["Yi Syllables"](qe)));(F2[Fe]||It||Qe.imageName)&&Le.push(W1(Xe+1,$e,Oe,Le,z2(Fe,te.getCodePoint(Xe+1),It&&ke),!1))}}var qe;return Z1(W1(te.length(),$e,Oe,Le,0,!0))}(L,x,l,e,o,D),{processBidirectionalText:Z,processStyledBidirectionalText:Y}=oe;if(Z&&L.sections.length===1){let te=Z(L.toString(),V);for(let ce of te){let he=new Td;he.text=ce,he.sections=L.sections;for(let be=0;be<ce.length;be++)he.sectionIndex.push(0);N.push(he)}}else if(Y){let te=Y(L.text,L.sectionIndex,V);for(let ce of te){let he=new Td;he.text=ce[0],he.sectionIndex=ce[1],he.sections=L.sections,N.push(he)}}else N=function(te,ce){let he=[],be=te.text,Pe=0;for(let Te of ce)he.push(te.substring(Pe,Te)),Pe=Te;return Pe<be.length&&he.push(te.substring(Pe,be.length)),he}(L,V);let Q=[],ae={positionedLines:Q,text:L.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(te,ce,he,be,Pe,Te,Le,Oe,ke,$e,qe,Xe){let Qe=0,Fe=0,It=0,yt=Oe==="right"?1:Oe==="left"?0:.5,Ke=!1;for(let ai of Pe){let Qt=ai.getSections();for(let hi of Qt){if(hi.imageName)continue;let li=ce[hi.fontStack];if(li&&(Ke=li.ascender!==void 0&&li.descender!==void 0,!Ke))break}if(!Ke)break}let Ut=0;for(let ai of Pe){ai.trim();let Qt=ai.getMaxScale(),hi=(Qt-1)*eo,li={positionedGlyphs:[],lineOffset:0};te.positionedLines[Ut]=li;let vi=li.positionedGlyphs,$t=0;if(!ai.length()){Fe+=Te,++Ut;continue}let ln=0,on=0;for(let Ri=0;Ri<ai.length();Ri++){let Gi=ai.getSection(Ri),Tn=ai.getSectionIndex(Ri),gn=ai.getCodePoint(Ri),Gn=Gi.scale,Nn=null,ao=null,Hn=null,Fn=eo,pr=0,jr=!(ke===js.horizontal||!qe&&!_(gn)||qe&&(dg[gn]||(Pt=gn,n.Arabic(Pt)||n["Arabic Supplement"](Pt)||n["Arabic Extended-A"](Pt)||n["Arabic Presentation Forms-A"](Pt)||n["Arabic Presentation Forms-B"](Pt))));if(Gi.imageName){let Ur=be[Gi.imageName];if(!Ur)continue;Hn=Gi.imageName,te.iconsInText=te.iconsInText||!0,ao=Ur.paddedRect;let vn=Ur.displaySize;Gn=Gn*eo/Xe,Nn={width:vn[0],height:vn[1],left:0,top:-G1,advance:jr?vn[1]:vn[0],localGlyph:!1},pr=Ke?-Nn.height*Gn:Qt*eo-17-vn[1]*Gn,Fn=Nn.advance;let No=(jr?vn[0]:vn[1])*Gn-eo*Qt;No>0&&No>$t&&($t=No)}else{let Ur=he[Gi.fontStack];if(!Ur)continue;Ur[gn]&&(ao=Ur[gn]);let vn=ce[Gi.fontStack];if(!vn)continue;let No=vn.glyphs[gn];if(!No)continue;if(Nn=No.metrics,Fn=gn!==8203?eo:0,Ke){let sc=vn.ascender!==void 0?Math.abs(vn.ascender):0,ya=vn.descender!==void 0?Math.abs(vn.descender):0,el=(sc+ya)*Gn;ln<el&&(ln=el,on=(sc-ya)/2*Gn),pr=-sc*Gn}else pr=(Qt-Gn)*eo-17}jr?(te.verticalizable=!0,vi.push({glyph:gn,imageName:Hn,x:Qe,y:Fe+pr,vertical:jr,scale:Gn,localGlyph:Nn.localGlyph,fontStack:Gi.fontStack,sectionIndex:Tn,metrics:Nn,rect:ao}),Qe+=Fn*Gn+$e):(vi.push({glyph:gn,imageName:Hn,x:Qe,y:Fe+pr,vertical:jr,scale:Gn,localGlyph:Nn.localGlyph,fontStack:Gi.fontStack,sectionIndex:Tn,metrics:Nn,rect:ao}),Qe+=Nn.advance*Gn+$e)}vi.length!==0&&(It=Math.max(Qe-$e,It),Ke?H1(vi,yt,$t,on,Te*Qt/2):H1(vi,yt,$t,0,Te/2)),Qe=0;let Ui=Te*Qt+$t;li.lineOffset=Math.max($t,hi),Fe+=Ui,++Ut}var Pt;let St=Fe,{horizontalAlign:Je,verticalAlign:Bt}=Jy(Le);(function(ai,Qt,hi,li,vi,$t){let ln=(Qt-hi)*vi,on=-$t*li;for(let Ui of ai)for(let Ri of Ui.positionedGlyphs)Ri.x+=ln,Ri.y+=on})(te.positionedLines,yt,Je,Bt,It,St),te.top+=-Bt*St,te.bottom=te.top+St,te.left+=-Je*It,te.right=te.left+It,te.hasBaseline=Ke}(ae,e,i,o,N,h,g,y,I,x,M,P),!function(te){for(let ce of te)if(ce.positionedGlyphs.length!==0)return!1;return!0}(Q)&&ae}let dg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},F2={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function q1(t,e,i,o,a,l){if(e.imageName){let h=o[e.imageName];return h?h.displaySize[0]*e.scale*eo/l+a:0}{let h=i[e.fontStack],g=h&&h.glyphs[t];return g?g.metrics.advance*e.scale+a:0}}function $1(t,e,i,o){let a=Math.pow(t-e,2);return o?t<e?a/2:2*a:a+Math.abs(i)*i}function z2(t,e,i){let o=0;return t===10&&(o-=1e4),i&&(o+=150),t!==40&&t!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function W1(t,e,i,o,a,l){let h=null,g=$1(e,i,a,l);for(let y of o){let x=$1(e-y.x,i,a,l)+y.badness;x<=g&&(h=y,g=x)}return{index:t,x:e,priorBreak:h,badness:g}}function Z1(t){return t?Z1(t.priorBreak).concat(t.index):[]}function Jy(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function H1(t,e,i,o,a){if(!(e||i||o||a))return;let l=t.length-1,h=t[l],g=(h.x+h.metrics.advance*h.scale)*e;for(let y=0;y<=l;y++)t[y].x-=g,t[y].y+=i+o+a}function B2(t,e,i,o){let{horizontalAlign:a,verticalAlign:l}=Jy(o),h=i[0]-t.displaySize[0]*a,g=i[1]-t.displaySize[1]*l;return{imagePrimary:t,imageSecondary:e,top:g,bottom:g+t.displaySize[1],left:h,right:h+t.displaySize[0]}}function Q1(t,e,i,o,a,l){let h=t.imagePrimary,g;if(h.content){let N=h.content,V=h.pixelRatio||1;g=[N[0]/V,N[1]/V,h.displaySize[0]-N[2]/V,h.displaySize[1]-N[3]/V]}let y=e.left*l,x=e.right*l,E,I,M,D;i==="width"||i==="both"?(D=a[0]+y-o[3],I=a[0]+x+o[1]):(D=a[0]+(y+x-h.displaySize[0])/2,I=D+h.displaySize[0]);let P=e.top*l,L=e.bottom*l;return i==="height"||i==="both"?(E=a[1]+P-o[0],M=a[1]+L+o[2]):(E=a[1]+(P+L-h.displaySize[1])/2,M=E+h.displaySize[1]),{imagePrimary:h,imageSecondary:void 0,top:E,right:I,bottom:M,left:D,collisionPadding:g}}class oc extends ct{constructor(e,i,o,a,l){super(e,i),this.angle=a,this.z=o,l!==void 0&&(this.segment=l)}clone(){return new oc(this.x,this.y,this.z,this.angle,this.segment)}}function X1(t,e,i,o,a){if(e.segment===void 0)return!0;let l=e,h=e.segment+1,g=0;for(;g>-i/2;){if(h--,h<0)return!1;g-=t[h].dist(l),l=t[h]}g+=t[h].dist(t[h+1]),h++;let y=[],x=0;for(;g<i/2;){let E=t[h],I=t[h+1];if(!I)return!1;let M=t[h-1].angleTo(E)-E.angleTo(I);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:g,angleDelta:M}),x+=M;g-y[0].distance>o;)x-=y.shift().angleDelta;if(x>a)return!1;h++,g+=E.dist(I)}return!0}function Y1(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function K1(t,e,i){return t?.6*e*i:0}function J1(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function N2(t,e,i,o,a,l){let h=K1(i,a,l),g=J1(i,o)*l,y=0,x=Y1(t)/2;for(let E=0;E<t.length-1;E++){let I=t[E],M=t[E+1],D=I.dist(M);if(y+D>x){let P=(x-y)/D,L=si(I.x,M.x,P),N=si(I.y,M.y,P),V=new oc(L,N,0,M.angleTo(I),E);return!h||X1(t,V,g,h,e)?V:void 0}y+=D}}function V2(t,e,i,o,a,l,h,g,y){let x=K1(o,l,h),E=J1(o,a),I=E*h,M=t[0].x===0||t[0].x===y||t[0].y===0||t[0].y===y;return e-I<e/4&&(e=I+e/4),ew(t,M?e/2*g%e:(E/2+2*l)*h*g%e,e,x,i,I,M,!1,y)}function ew(t,e,i,o,a,l,h,g,y){let x=l/2,E=Y1(t),I=0,M=e-i,D=[];for(let P=0;P<t.length-1;P++){let L=t[P],N=t[P+1],V=L.dist(N),Z=N.angleTo(L);for(;M+i<I+V;){M+=i;let Y=(M-I)/V,Q=si(L.x,N.x,Y),ae=si(L.y,N.y,Y);if(Q>=0&&Q<y&&ae>=0&&ae<y&&M-x>=0&&M+x<=E){let te=new oc(Q,ae,0,Z,P);o&&!X1(t,te,l,o,a)||D.push(te)}}I+=V}return g||D.length||h||(D=ew(t,I/2,i,o,a,l,h,!0,y)),D}function tw(t,e,i,o,a){let l=[];for(let h=0;h<t.length;h++){let g=t[h],y;for(let x=0;x<g.length-1;x++){let E=g[x],I=g[x+1];E.x<e&&I.x<e||(E.x<e?E=new ct(e,E.y+(e-E.x)/(I.x-E.x)*(I.y-E.y))._round():I.x<e&&(I=new ct(e,E.y+(e-E.x)/(I.x-E.x)*(I.y-E.y))._round()),E.y<i&&I.y<i||(E.y<i?E=new ct(E.x+(i-E.y)/(I.y-E.y)*(I.x-E.x),i)._round():I.y<i&&(I=new ct(E.x+(i-E.y)/(I.y-E.y)*(I.x-E.x),i)._round()),E.x>=o&&I.x>=o||(E.x>=o?E=new ct(o,E.y+(o-E.x)/(I.x-E.x)*(I.y-E.y))._round():I.x>=o&&(I=new ct(o,E.y+(o-E.x)/(I.x-E.x)*(I.y-E.y))._round()),E.y>=a&&I.y>=a||(E.y>=a?E=new ct(E.x+(a-E.y)/(I.y-E.y)*(I.x-E.x),a)._round():I.y>=a&&(I=new ct(E.x+(a-E.y)/(I.y-E.y)*(I.x-E.x),a)._round()),y&&E.equals(y[y.length-1])||(y=[E],l.push(y)),y.push(I)))))}}return l}function iw(t){let e=0,i=0;for(let h of t)e+=h.w*h.h,i=Math.max(i,h.w);t.sort((h,g)=>g.h-h.h);let o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}],a=0,l=0;for(let h of t)for(let g=o.length-1;g>=0;g--){let y=o[g];if(!(h.w>y.w||h.h>y.h)){if(h.x=y.x,h.y=y.y,l=Math.max(l,h.y+h.h),a=Math.max(a,h.x+h.w),h.w===y.w&&h.h===y.h){let x=o.pop();g<o.length&&(o[g]=x)}else h.h===y.h?(y.x+=h.w,y.w-=h.w):h.w===y.w?(y.y+=h.h,y.h-=h.h):(o.push({x:y.x+h.w,y:y.y,w:y.w-h.w,h:h.h}),y.y+=h.h,y.h-=h.h);break}}return{w:a,h:l,fill:e/(a*l)||0}}bt(oc,"Anchor");let ws=1;class ev{constructor(e,{pixelRatio:i,version:o,stretchX:a,stretchY:l,content:h}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=a,this.stretchY=l,this.content=h,this.version=o}get tl(){return[this.paddedRect.x+ws,this.paddedRect.y+ws]}get br(){return[this.paddedRect.x+this.paddedRect.w-ws,this.paddedRect.y+this.paddedRect.h-ws]}get displaySize(){return[(this.paddedRect.w-2*ws)/this.pixelRatio,(this.paddedRect.h-2*ws)/this.pixelRatio]}}class nw{constructor(e,i){let o={},a={};this.haveRenderCallbacks=[];let l=[];this.addImages(e,o,l),this.addImages(i,a,l);let{w:h,h:g}=iw(l),y=new Vs({width:h||1,height:g||1});for(let x in e){let E=e[x],I=o[x].paddedRect;Vs.copy(E.data,y,{x:0,y:0},{x:I.x+ws,y:I.y+ws},E.data,E.sdf)}for(let x in i){let E=i[x],I=a[x].paddedRect,M=I.x+ws,D=I.y+ws,P=E.data.width,L=E.data.height;Vs.copy(E.data,y,{x:0,y:0},{x:M,y:D},E.data),Vs.copy(E.data,y,{x:0,y:L-1},{x:M,y:D-1},{width:P,height:1}),Vs.copy(E.data,y,{x:0,y:0},{x:M,y:D+L},{width:P,height:1}),Vs.copy(E.data,y,{x:P-1,y:0},{x:M-1,y:D},{width:1,height:L}),Vs.copy(E.data,y,{x:0,y:0},{x:M+P,y:D},{width:1,height:L})}this.image=y,this.iconPositions=o,this.patternPositions=a}addImages(e,i,o){for(let a in e){let l=e[a],h={x:0,y:0,w:l.data.width+2*ws,h:l.data.height+2*ws};o.push(h),i[a]=new ev(h,l),l.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(e,i,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>e.hasImage(a,o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(let a in e.getUpdatedImages(o))this.patchUpdatedImage(this.iconPositions[a],e.getImage(a,o),i),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a,o),i)}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;let[a,l]=e.tl,h=!!Object.keys(this.patternPositions).length;o.update(i.data,{useMipmap:h},{x:a,y:l})}}bt(ev,"ImagePosition"),bt(nw,"ImageAtlas");let Jp=1e20;function rw(t,e,i,o,a,l,h,g,y){for(let x=e;x<e+o;x++)ow(t,i*l+x,l,a,h,g,y);for(let x=i;x<i+a;x++)ow(t,x*l+e,1,o,h,g,y)}function ow(t,e,i,o,a,l,h){l[0]=0,h[0]=-Jp,h[1]=Jp,a[0]=t[e];for(let g=1,y=0,x=0;g<o;g++){a[g]=t[e+g*i];let E=g*g;do{let I=l[y];x=(a[g]-a[I]+E-I*I)/(g-I)/2}while(x<=h[y]&&--y>-1);y++,l[y]=g,h[y]=x,h[y+1]=Jp}for(let g=0,y=0;g<o;g++){for(;h[y+1]<g;)y++;let x=l[y],E=g-x;t[e+g*i]=a[x]+E*E}}let Qa=2,tv={none:0,ideographs:1,all:2};class Ed{constructor(e,i,o){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=o,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,o){let a=[],l=this.urls[i]||ee.GLYPHS_URL;for(let h in e)for(let g of e[h])a.push({stack:h,id:g});pc(a,({stack:h,id:g},y)=>{let x=this.entries[h];x||(x=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=x.glyphs[g];if(E!==void 0)return void y(null,{stack:h,id:g,glyph:E});if(E=this._tinySDF(x,h,g),E)return x.glyphs[g]=E,void y(null,{stack:h,id:g,glyph:E});let I=Math.floor(g/256);if(256*I>65535)return void y(new Error("glyphs > 65535 not supported"));if(x.ranges[I])return void y(null,{stack:h,id:g,glyph:E});let M=x.requests[I];M||(M=x.requests[I]=[],Ed.loadGlyphRange(h,I,l,this.requestManager,(D,P)=>{if(P){x.ascender=P.ascender,x.descender=P.descender;for(let L in P.glyphs)this._doesCharSupportLocalGlyph(+L)||(x.glyphs[+L]=P.glyphs[+L]);x.ranges[I]=!0}for(let L of M)L(D,P);delete x.requests[I]})),M.push((D,P)=>{D?y(D):P&&y(null,{stack:h,id:g,glyph:P.glyphs[g]||null})})},(h,g)=>{if(h)o(h);else if(g){let y={};for(let{stack:x,id:E,glyph:I}of g)y[x]===void 0&&(y[x]={}),y[x].glyphs===void 0&&(y[x].glyphs={}),y[x].glyphs[E]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},y[x].ascender=this.entries[x].ascender,y[x].descender=this.entries[x].descender;o(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==tv.none&&(this.localGlyphMode===tv.all?!!this.localFontFamily:!!this.localFontFamily&&(n["CJK Unified Ideographs"](e)||n["Hangul Syllables"](e)||n.Hiragana(e)||n.Katakana(e)||n["CJK Symbols and Punctuation"](e)||n["CJK Unified Ideographs Extension A"](e)||n["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,i,o){let a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(o))return;let l=e.tinySDF;if(!l){let L="400";/bold/i.test(i)?L="900":/medium/i.test(i)?L="500":/light/i.test(i)&&(L="200"),l=e.tinySDF=new Ed.TinySDF({fontFamily:a,fontWeight:L,fontSize:24*Qa,buffer:3*Qa,radius:8*Qa}),l.fontWeight=L}if(this.localGlyphs[l.fontWeight][o])return this.localGlyphs[l.fontWeight][o];let h=String.fromCodePoint(o),{data:g,width:y,height:x,glyphWidth:E,glyphHeight:I,glyphLeft:M,glyphTop:D,glyphAdvance:P}=l.draw(h);return this.localGlyphs[l.fontWeight][o]={id:o,bitmap:new jc({width:y,height:x},g),metrics:{width:E/Qa,height:I/Qa,left:M/Qa,top:D/Qa-27,advance:P/Qa,localGlyph:!0}}}}Ed.loadGlyphRange=function(t,e,i,o,a){let l=256*e,h=l+255,g=o.transformRequest(o.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${l}-${h}`),gc.Glyphs);la(g,(y,x)=>{if(y)a(y);else if(x){let E={},I=function(M){return new wd(M).readFields(k2,{})}(x);for(let M of I.glyphs)E[M.id]=M;a(null,{glyphs:E,ascender:I.ascender,descender:I.descender})}})},Ed.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:o=.25,fontFamily:a="sans-serif",fontWeight:l="normal",fontStyle:h="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=i;let g=this.size=t+4*e,y=this._createCanvas(g),x=this.ctx=y.getContext("2d",{willReadFrequently:!0});x.font=`${h} ${l} ${t}px ${a}`,x.textBaseline="alphabetic",x.textAlign="left",x.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(t){let e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){let{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:o,actualBoundingBoxLeft:a,actualBoundingBoxRight:l}=this.ctx.measureText(t),h=Math.ceil(i),g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-a))),y=Math.min(this.size-this.buffer,h+Math.ceil(o)),x=g+2*this.buffer,E=y+2*this.buffer,I=Math.max(x*E,0),M=new Uint8ClampedArray(I),D={data:M,width:x,height:E,glyphWidth:g,glyphHeight:y,glyphTop:h,glyphLeft:0,glyphAdvance:e};if(g===0||y===0)return D;let{ctx:P,buffer:L,gridInner:N,gridOuter:V}=this;P.clearRect(L,L,g,y),P.fillText(t,L,L+h);let Z=P.getImageData(L,L,g,y);V.fill(Jp,0,I),N.fill(0,0,I);for(let Y=0;Y<y;Y++)for(let Q=0;Q<g;Q++){let ae=Z.data[4*(Y*g+Q)+3]/255;if(ae===0)continue;let te=(Y+L)*x+Q+L;if(ae===1)V[te]=0,N[te]=Jp;else{let ce=.5-ae;V[te]=ce>0?ce*ce:0,N[te]=ce<0?ce*ce:0}}rw(V,0,0,x,E,x,this.f,this.v,this.z),rw(N,L,L,g,y,x,this.f,this.v,this.z);for(let Y=0;Y<I;Y++){let Q=Math.sqrt(V[Y])-Math.sqrt(N[Y]);M[Y]=Math.round(255-255*(Q/this.radius+this.cutoff))}return D}};let qc=ws;function sw(t,e,i,o){let a=[],l=t.imagePrimary,h=l.pixelRatio,g=l.paddedRect.w-2*qc,y=l.paddedRect.h-2*qc,x=t.right-t.left,E=t.bottom-t.top,I=l.stretchX||[[0,g]],M=l.stretchY||[[0,y]],D=(Te,Le)=>Te+Le[1]-Le[0],P=I.reduce(D,0),L=M.reduce(D,0),N=g-P,V=y-L,Z=0,Y=P,Q=0,ae=L,te=0,ce=N,he=0,be=V;if(l.content&&o){let Te=l.content;Z=pg(I,0,Te[0]),Q=pg(M,0,Te[1]),Y=pg(I,Te[0],Te[2]),ae=pg(M,Te[1],Te[3]),te=Te[0]-Z,he=Te[1]-Q,ce=Te[2]-Te[0]-Y,be=Te[3]-Te[1]-ae}let Pe=(Te,Le,Oe,ke)=>{let $e=fg(Te.stretch-Z,Y,x,t.left),qe=mg(Te.fixed-te,ce,Te.stretch,P),Xe=fg(Le.stretch-Q,ae,E,t.top),Qe=mg(Le.fixed-he,be,Le.stretch,L),Fe=fg(Oe.stretch-Z,Y,x,t.left),It=mg(Oe.fixed-te,ce,Oe.stretch,P),yt=fg(ke.stretch-Q,ae,E,t.top),Ke=mg(ke.fixed-he,be,ke.stretch,L),Ut=new ct($e,Xe),Pt=new ct(Fe,Xe),St=new ct(Fe,yt),Je=new ct($e,yt),Bt=new ct(qe/h,Qe/h),ai=new ct(It/h,Ke/h),Qt=e*Math.PI/180;if(Qt){let on=Math.sin(Qt),Ui=Math.cos(Qt),Ri=[Ui,-on,on,Ui];Ut._matMult(Ri),Pt._matMult(Ri),Je._matMult(Ri),St._matMult(Ri)}let hi=Te.stretch+Te.fixed,li=Oe.stretch+Oe.fixed,vi=Le.stretch+Le.fixed,$t=ke.stretch+ke.fixed,ln=t.imageSecondary;return{tl:Ut,tr:Pt,bl:Je,br:St,texPrimary:{x:l.paddedRect.x+qc+hi,y:l.paddedRect.y+qc+vi,w:li-hi,h:$t-vi},texSecondary:ln?{x:ln.paddedRect.x+qc+hi,y:ln.paddedRect.y+qc+vi,w:li-hi,h:$t-vi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Bt,pixelOffsetBR:ai,minFontScaleX:ce/h/x,minFontScaleY:be/h/E,isSDF:i}};if(o&&(l.stretchX||l.stretchY)){let Te=aw(I,N,P),Le=aw(M,V,L);for(let Oe=0;Oe<Te.length-1;Oe++){let ke=Te[Oe],$e=Te[Oe+1];for(let qe=0;qe<Le.length-1;qe++)a.push(Pe(ke,Le[qe],$e,Le[qe+1]))}}else a.push(Pe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:y+1}));return a}function pg(t,e,i){let o=0;for(let a of t)o+=Math.max(e,Math.min(i,a[1]))-Math.max(e,Math.min(i,a[0]));return o}function aw(t,e,i){let o=[{fixed:-qc,stretch:0}];for(let[a,l]of t){let h=o[o.length-1];o.push({fixed:a-h.stretch,stretch:h.stretch}),o.push({fixed:a-h.stretch,stretch:h.stretch+(l-a)})}return o.push({fixed:e+qc,stretch:i}),o}function fg(t,e,i,o){return t/e*i+o}function mg(t,e,i,o){return t-e*i/o}function j2(t,e,i,o){let a=e+t.positionedLines[o].lineOffset;return o===0?i+a/2:i+(a+(e+t.positionedLines[o-1].lineOffset))/2}function U2(t,e=1,i=!1){let o=1/0,a=1/0,l=-1/0,h=-1/0,g=t[0];for(let D=0;D<g.length;D++){let P=g[D];(!D||P.x<o)&&(o=P.x),(!D||P.y<a)&&(a=P.y),(!D||P.x>l)&&(l=P.x),(!D||P.y>h)&&(h=P.y)}let y=Math.min(l-o,h-a),x=y/2,E=new qh([],G2);if(y===0)return new ct(o,a);for(let D=o;D<l;D+=y)for(let P=a;P<h;P+=y)E.push(new Id(D+x,P+x,x,t));let I=function(D){let P=0,L=0,N=0,V=D[0];for(let Z=0,Y=V.length,Q=Y-1;Z<Y;Q=Z++){let ae=V[Z],te=V[Q],ce=ae.x*te.y-te.x*ae.y;L+=(ae.x+te.x)*ce,N+=(ae.y+te.y)*ce,P+=3*ce}return new Id(L/P,N/P,0,D)}(t),M=E.length;for(;E.length;){let D=E.pop();(D.d>I.d||!I.d)&&(I=D,i&&console.log("found best %d after %d probes",Math.round(1e4*D.d)/1e4,M)),D.max-I.d<=e||(x=D.h/2,E.push(new Id(D.p.x-x,D.p.y-x,x,t)),E.push(new Id(D.p.x+x,D.p.y-x,x,t)),E.push(new Id(D.p.x-x,D.p.y+x,x,t)),E.push(new Id(D.p.x+x,D.p.y+x,x,t)),M+=4)}return i&&(console.log(`num probes: ${M}`),console.log(`best distance: ${I.d}`)),I.p}function G2(t,e){return e.max-t.max}class Id{constructor(e,i,o,a){this.p=new ct(e,i),this.h=o,this.d=function(l,h){let g=!1,y=1/0;for(let x=0;x<h.length;x++){let E=h[x];for(let I=0,M=E.length,D=M-1;I<M;D=I++){let P=E[I],L=E[D];P.y>l.y!=L.y>l.y&&l.x<(L.x-P.x)*(l.y-P.y)/(L.y-P.y)+P.x&&(g=!g),y=Math.min(y,Ex(l,P,L))}}return(g?1:-1)*Math.sqrt(y)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}}let iv=Number.POSITIVE_INFINITY,q2=Math.sqrt(2);function lw(t,[e,i]){let o=0,a=0;if(i===iv){e<0&&(e=0);let l=e/q2;switch(t){case"top-right":case"top-left":a=l-7;break;case"bottom-right":case"bottom-left":a=7-l;break;case"bottom":a=7-e;break;case"top":a=e-7}switch(t){case"top-right":case"bottom-right":o=-l;break;case"top-left":case"bottom-left":o=l;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":a=i-7;break;case"bottom-right":case"bottom-left":case"bottom":a=7-i}switch(t){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,a]}function nv(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function $2(t,e,i,o,a,l,h,g,y,x,E,I,M,D,P){let L=l.textMaxSize.evaluate(e,{},I);L===void 0&&(L=h);let N=t.layers[0].layout,V=N.get("icon-offset").evaluate(e,{},I),Z=uw(i.horizontal)||i.vertical,Y=M.name==="globe",Q=eo,ae=h/Q,te=t.tilePixelRatio*L/Q,ce=($e=t.overscaling,t.zoom>18&&$e>2&&($e>>=1),Math.max(pt/(512*$e),1)*N.get("symbol-spacing")),he=N.get("text-padding")*t.tilePixelRatio,be=N.get("icon-padding")*t.tilePixelRatio,Pe=Si(N.get("text-max-angle")),Te=N.get("text-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",Le=N.get("icon-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",Oe=N.get("symbol-placement"),ke=ce/2;var $e;let qe=N.get("icon-text-fit").evaluate(e,{},I),Xe=N.get("icon-text-fit-padding").evaluate(e,{},I),Qe=qe!=="none",Fe;t.hasAnyIconTextFit===!1&&Qe&&(t.hasAnyIconTextFit=!0),o&&Qe&&(t.allowVerticalPlacement&&i.vertical&&(Fe=Q1(o,i.vertical,qe,Xe,V,ae)),Z&&(o=Q1(o,Z,qe,Xe,V,ae)));let It=(yt,Ke,Ut)=>{if(Ke.x<0||Ke.x>=pt||Ke.y<0||Ke.y>=pt)return;let Pt=null;if(Y){let{x:St,y:Je,z:Bt}=M.projectTilePoint(Ke.x,Ke.y,Ut);Pt={anchor:new oc(St,Je,Bt,0,void 0),up:M.upVector(Ut,Ke.x,Ke.y)}}(function(St,Je,Bt,ai,Qt,hi,li,vi,$t,ln,on,Ui,Ri,Gi,Tn,gn,Gn,Nn,ao,Hn,Fn,pr,jr,Ur,vn,No,sc){let ya=St.addToLineVertexArray(Je,ai),el,Xc,Yc,sh,hT,dT,pT,fT=0,mT=0,gT=0,_T=0,Cv=-1,Av=-1,Tl={},yT=dn(""),ah=Bt?Bt.anchor:Je,Dv=$t.layout.get("icon-text-fit").evaluate(Fn,{},vn)!=="none",Rv=0,Pv=0;if($t._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Rv,Pv]=$t.layout.get("text-offset").evaluate(Fn,{},vn).map(Ts=>Ts*eo):(Rv=$t.layout.get("text-radial-offset").evaluate(Fn,{},vn)*eo,Pv=iv),St.allowVerticalPlacement&&Qt.vertical){let Ts=Qt.vertical;if(Tn)dT=rv(Ts),vi&&(pT=rv(vi));else{let Es=$t.layout.get("text-rotate").evaluate(Fn,{},vn)+90;Yc=gg(ln,ah,Je,on,Ui,Ri,Ts,Gi,Es,gn),vi&&(sh=gg(ln,ah,Je,on,Ui,Ri,vi,Nn,Es))}}if(hi){let Ts=$t.layout.get("icon-rotate").evaluate(Fn,{},vn),Es=sw(hi,Ts,jr,Dv),Pd=vi?sw(vi,Ts,jr,Dv):void 0;Xc=gg(ln,ah,Je,on,Ui,Ri,hi,Nn,Ts),fT=4*Es.length;let vT=St.iconSizeData,lh=null;vT.kind==="source"?(lh=[Ha*$t.layout.get("icon-size").evaluate(Fn,{},vn)],lh[0]>$c&&Mn(`${St.layerIds[0]}: Value for "icon-size" is >= ${ef}. Reduce your "icon-size".`)):vT.kind==="composite"&&(lh=[Ha*pr.compositeIconSizes[0].evaluate(Fn,{},vn),Ha*pr.compositeIconSizes[1].evaluate(Fn,{},vn)],(lh[0]>$c||lh[1]>$c)&&Mn(`${St.layerIds[0]}: Value for "icon-size" is >= ${ef}. Reduce your "icon-size".`)),St.addSymbols(St.icon,Es,lh,Hn,ao,Fn,!1,Bt,Je,ya.lineStartIndex,ya.lineLength,-1,Ur,vn,No,sc),Cv=St.icon.placedSymbolArray.length-1,Pd&&(mT=4*Pd.length,St.addSymbols(St.icon,Pd,lh,Hn,ao,Fn,js.vertical,Bt,Je,ya.lineStartIndex,ya.lineLength,-1,Ur,vn,No,sc),Av=St.icon.placedSymbolArray.length-1)}for(let Ts in Qt.horizontal){let Es=Qt.horizontal[Ts];el||(yT=dn(Es.text),Tn?hT=rv(Es):el=gg(ln,ah,Je,on,Ui,Ri,Es,Gi,$t.layout.get("text-rotate").evaluate(Fn,{},vn),gn));let Pd=Es.positionedLines.length===1;if(gT+=cw(St,Bt,Je,Es,li,$t,Tn,Fn,gn,ya,Qt.vertical?js.horizontal:js.horizontalOnly,Pd?Object.keys(Qt.horizontal):[Ts],Tl,Cv,pr,Ur,vn,No),Pd)break}Qt.vertical&&(_T+=cw(St,Bt,Je,Qt.vertical,li,$t,Tn,Fn,gn,ya,js.vertical,["vertical"],Tl,Av,pr,Ur,vn,No));let Kc=-1,kv=(Ts,Es)=>Ts?Math.max(Ts,Es):Es;Kc=kv(hT,Kc),Kc=kv(dT,Kc),Kc=kv(pT,Kc);let cR=Kc>-1?1:0;St.glyphOffsetArray.length>=65535&&Mn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Fn.sortKey!==void 0&&St.addToSortKeyRanges(St.symbolInstances.length,Fn.sortKey),St.symbolInstances.emplaceBack(Je.x,Je.y,ah.x,ah.y,ah.z,Tl.right>=0?Tl.right:-1,Tl.center>=0?Tl.center:-1,Tl.left>=0?Tl.left:-1,Tl.vertical>=0?Tl.vertical:-1,Cv,Av,yT,el!==void 0?el:St.collisionBoxArray.length,el!==void 0?el+1:St.collisionBoxArray.length,Yc!==void 0?Yc:St.collisionBoxArray.length,Yc!==void 0?Yc+1:St.collisionBoxArray.length,Xc!==void 0?Xc:St.collisionBoxArray.length,Xc!==void 0?Xc+1:St.collisionBoxArray.length,sh||St.collisionBoxArray.length,sh?sh+1:St.collisionBoxArray.length,on,gT,_T,fT,mT,cR,0,Rv,Pv,Kc,0,Dv?1:0)})(t,Ke,Pt,yt,i,o,a,Fe,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,he,Te,y,0,be,Le,V,e,l,x,E,I,D,P)};if(Oe==="line")for(let yt of tw(e.geometry,0,0,pt,pt)){let Ke=V2(yt,ce,Pe,i.vertical||Z,o,Q,te,t.overscaling,pt);for(let Ut of Ke)Z&&W2(t,Z.text,ke,Ut)||It(yt,Ut,I)}else if(Oe==="line-center"){for(let yt of e.geometry)if(yt.length>1){let Ke=N2(yt,Pe,i.vertical||Z,o,Q,te);Ke&&It(yt,Ke,I)}}else if(e.type==="Polygon")for(let yt of Uy(e.geometry,0)){let Ke=U2(yt,16);It(yt[0],new oc(Ke.x,Ke.y,0,0,void 0),I)}else if(e.type==="LineString")for(let yt of e.geometry)It(yt,new oc(yt[0].x,yt[0].y,0,0,void 0),I);else if(e.type==="Point")for(let yt of e.geometry)for(let Ke of yt)It([Ke],new oc(Ke.x,Ke.y,0,0,void 0),I)}let ef=255,$c=ef*Ha;function cw(t,e,i,o,a,l,h,g,y,x,E,I,M,D,P,L,N,V){let Z=function(ae,te,ce,he,be,Pe,Te,Le){let Oe=[];if(te.positionedLines.length===0)return Oe;let ke=he.layout.get("text-rotate").evaluate(Pe,{})*Math.PI/180,$e=function(It){let yt=It[0],Ke=It[1],Ut=yt*Ke;return Ut>0?[yt,-Ke]:Ut<0?[-yt,Ke]:yt===0?[Ke,yt]:[Ke,-yt]}(ce),qe=Math.abs(te.top-te.bottom);for(let It of te.positionedLines)qe-=It.lineOffset;let Xe=te.positionedLines.length,Qe=qe/Xe,Fe=te.top-ce[1];for(let It=0;It<Xe;++It){let yt=te.positionedLines[It];Fe=j2(te,Qe,Fe,It);for(let Ke of yt.positionedGlyphs){if(!Ke.rect)continue;let Ut=Ke.rect||{},Pt=G1+1,St=!0,Je=1,Bt=0;if(Ke.imageName){let Hn=Te[Ke.imageName];if(!Hn)continue;if(Hn.sdf){Mn("SDF images are not supported in formatted text and will be ignored.");continue}St=!1,Je=Hn.pixelRatio,Pt=ws/Je}let ai=(be||Le)&&Ke.vertical,Qt=Ke.metrics.advance*Ke.scale/2,hi=Ke.metrics,li=Ke.rect;if(li===null)continue;Le&&te.verticalizable&&(Bt=Ke.imageName?Qt-Ke.metrics.width*Ke.scale/2:0);let vi=be?[Ke.x+Qt,Ke.y]:[0,0],$t=[0,0],ln=[0,0],on=!1;be||(ai?(ln=[Ke.x+Qt+$e[0],Ke.y+$e[1]-Bt],on=!0):$t=[Ke.x+Qt+ce[0],Ke.y+ce[1]-Bt]);let Ui=li.w*Ke.scale/(Je*(Ke.localGlyph?Qa:1)),Ri=li.h*Ke.scale/(Je*(Ke.localGlyph?Qa:1)),Gi,Tn,gn,Gn;if(ai){let Hn=Ke.y-Fe,Fn=new ct(-Qt,Qt-Hn),pr=-Math.PI/2,jr=new ct(...ln);Gi=new ct(-Qt+$t[0],$t[1]),Gi._rotateAround(pr,Fn)._add(jr),Gi.x+=-Hn+Qt,Gi.y-=(hi.left-Pt)*Ke.scale;let Ur=Ke.imageName?hi.advance*Ke.scale:eo*Ke.scale,vn=String.fromCodePoint(Ke.glyph);x2(vn)?Gi.x+=(1-Pt)*Ke.scale:w2(vn)?Gi.x+=Ur-hi.height*Ke.scale+(-Pt-1)*Ke.scale:Gi.x+=Ke.imageName||hi.width+2*Pt===li.w&&hi.height+2*Pt===li.h?(Ur-Ri)/2:(Ur-(hi.height+2*Pt)*Ke.scale)/2,Tn=new ct(Gi.x,Gi.y-Ui),gn=new ct(Gi.x+Ri,Gi.y),Gn=new ct(Gi.x+Ri,Gi.y-Ui)}else{let Hn=(hi.left-Pt)*Ke.scale-Qt+$t[0],Fn=(-hi.top-Pt)*Ke.scale+$t[1],pr=Hn+Ui,jr=Fn+Ri;Gi=new ct(Hn,Fn),Tn=new ct(pr,Fn),gn=new ct(Hn,jr),Gn=new ct(pr,jr)}if(ke){let Hn;Hn=be?new ct(0,0):on?new ct($e[0],$e[1]):new ct(ce[0],ce[1]),Gi._rotateAround(ke,Hn),Tn._rotateAround(ke,Hn),gn._rotateAround(ke,Hn),Gn._rotateAround(ke,Hn)}let Nn=new ct(0,0),ao=new ct(0,0);Oe.push({tl:Gi,tr:Tn,bl:gn,br:Gn,texPrimary:Ut,texSecondary:void 0,writingMode:te.writingMode,glyphOffset:vi,sectionIndex:Ke.sectionIndex,isSDF:St,pixelOffsetTL:Nn,pixelOffsetBR:ao,minFontScaleX:0,minFontScaleY:0})}}return Oe}(0,o,y,l,h,g,a,t.allowVerticalPlacement),Y=t.textSizeData,Q=null;Y.kind==="source"?(Q=[Ha*l.layout.get("text-size").evaluate(g,{},N)],Q[0]>$c&&Mn(`${t.layerIds[0]}: Value for "text-size" is >= ${ef}. Reduce your "text-size".`)):Y.kind==="composite"&&(Q=[Ha*P.compositeTextSizes[0].evaluate(g,{},N),Ha*P.compositeTextSizes[1].evaluate(g,{},N)],(Q[0]>$c||Q[1]>$c)&&Mn(`${t.layerIds[0]}: Value for "text-size" is >= ${ef}. Reduce your "text-size".`)),t.addSymbols(t.text,Z,Q,y,h,g,E,e,i,x.lineStartIndex,x.lineLength,D,L,N,V,!1);for(let ae of I)M[ae]=t.text.placedSymbolArray.length-1;return 4*Z.length}function uw(t){for(let e in t)return t[e];return null}function gg(t,e,i,o,a,l,h,g,y,x){let E=h.top,I=h.bottom,M=h.left,D=h.right,P=h.collisionPadding;if(P&&(M-=P[0],E-=P[1],D+=P[2],I+=P[3]),y){let L=new ct(M,E),N=new ct(D,E),V=new ct(M,I),Z=new ct(D,I),Y=Si(y),Q=new ct(0,0);x&&(Q=new ct(x[0],x[1])),L._rotateAround(Y,Q),N._rotateAround(Y,Q),V._rotateAround(Y,Q),Z._rotateAround(Y,Q),M=Math.min(L.x,N.x,V.x,Z.x),D=Math.max(L.x,N.x,V.x,Z.x),E=Math.min(L.y,N.y,V.y,Z.y),I=Math.max(L.y,N.y,V.y,Z.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,M,E,D,I,g,o,a,l),t.length-1}function rv(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);let e=t.bottom-t.top;return e>0?Math.max(10,e):null}function W2(t,e,i,o){let a=t.compareText;if(e in a){let l=a[e];for(let h=l.length-1;h>=0;h--)if(o.dist(l[h])<i)return!0}else a[e]=[];return a[e].push(o),!1}function hw(t,e){let i=t.fovAboveCenter,o=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,a=(t._camera.position[2]*t.worldSize-o)/Math.cos(t._pitch),l=Math.sin(i)*a/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),h=Math.sin(t._pitch)*l+a;return Math.min(1.01*h,a*(1/t._horizonShift))}function tf(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};let i=Math.pow(2,-t.z),o=t.x*i,a=(t.x+1)*i,l=t.y*i,h=(t.y+1)*i,g=xs(o),y=xs(a),x=Jr(l),E=Jr(h),I=e.project(g,x),M=e.project(y,x),D=e.project(y,E),P=e.project(g,E),L=Math.min(I.x,M.x,D.x,P.x),N=Math.min(I.y,M.y,D.y,P.y),V=Math.max(I.x,M.x,D.x,P.x),Z=Math.max(I.y,M.y,D.y,P.y),Y=i/16;function Q(te,ce,he,be,Pe,Te){let Le=(he+Pe)/2,Oe=(be+Te)/2,ke=e.project(xs(Le),Jr(Oe)),$e=Math.max(0,L-ke.x,N-ke.y,ke.x-V,ke.y-Z);L=Math.min(L,ke.x),V=Math.max(V,ke.x),N=Math.min(N,ke.y),Z=Math.max(Z,ke.y),$e>Y&&(Q(te,ke,he,be,Le,Oe),Q(ke,ce,Le,Oe,Pe,Te))}Q(I,M,o,l,a,l),Q(M,D,a,l,a,h),Q(D,P,a,h,o,h),Q(P,I,o,h,o,l),L-=Y,N-=Y,V+=Y,Z+=Y;let ae=1/Math.max(V-L,Z-N);return{scale:ae,x:L*ae,y:N*ae,x2:V*ae,y2:Z*ae,projection:e}}function dw(t,{x:e,y:i},o=0){return new ct(((e-o)*t.scale-t.x)*pt,(i*t.scale-t.y)*pt)}let Z2=r.a9.identity(new Float32Array(16));class Wc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new Bi(0,0)}projectTilePoint(e,i,o){return{x:e,y:i,z:0}}locationPoint(e,i,o=!0){return e._coordinatePoint(e.locationCoordinate(i),o)}pixelsPerMeter(e,i){return Bo(1,e)*i}pixelSpaceConversion(e,i,o){return 1}farthestPixelDistance(e){return hw(e,e.pixelsPerMeter)}pointCoordinate(e,i,o,a){let l=e.horizonLineFromTop(!1),h=new ct(i,Math.max(l,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(h,a))}pointCoordinate3D(e,i,o){let a=new ct(i,o);if(e.elevation)return e.elevation.pointCoordinate(a);{let l=this.pointCoordinate(e,a.x,a.y,0);return[l.x,l.y,l.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);let o=e.horizonLineFromTop();return i.y<o}createInversionMatrix(e,i){return Z2}createTileMatrix(e,i,o){let a,l,h,g=o.canonical,y=r.a9.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let x=tf(g,this);a=1,l=x.x+o.wrap*x.scale,h=x.y,r.a9.scale(y,y,[a/x.scale,a/x.scale,e.pixelsPerMeter/i])}else a=i/e.zoomScale(g.z),l=(g.x+Math.pow(2,g.z)*o.wrap)*a,h=g.y*a;return r.a9.translate(y,y,[l,h,0]),r.a9.scale(y,y,[a/pt,a/pt,1]),y}upVector(e,i,o){return[0,0,1]}upVectorScale(e,i,o){return{metersToTile:1}}}class H2 extends Wc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[i,o]=this.parallels=e.parallels||[29.5,45.5],a=Math.sin(Si(i));this.n=(a+Math.sin(Si(o)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(e,i){let{n:o,c:a,r0:l}=this,h=Si(e-this.center[0]),g=Si(i),y=Math.sqrt(a-2*o*Math.sin(g))/o;return{x:y*Math.sin(h*o),y:y*Math.cos(h*o)-l,z:0}}unproject(e,i){let{n:o,c:a,r0:l}=this,h=l+i,g=Math.atan2(e,Math.abs(h))*Math.sign(h);h*o<0&&(g-=Math.PI*Math.sign(e)*Math.sign(h));let y=Si(this.center[0])*o;g=as(g,-Math.PI-y,Math.PI-y);let x=gi(zr(g/o)+this.center[0],-180,180),E=Math.asin(gi((a-(e*e+h*h)*o*o)/(2*o),-1,1)),I=gi(zr(E),-tr,tr);return new Bi(x,I)}}let nf=1.340264,rf=-.081106,of=893e-6,sf=.003796,_g=Math.sqrt(3)/2;class Q2 extends Wc{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;let o=Math.asin(_g*Math.sin(i)),a=o*o,l=a*a*a;return{x:.5*(e*Math.cos(o)/(_g*(nf+3*rf*a+l*(7*of+9*sf*a)))/Math.PI+.5),y:1-.5*(o*(nf+rf*a+l*(of+sf*a))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,a=o*o,l=a*a*a;for(let E,I,M,D=0;D<12&&(I=o*(nf+rf*a+l*(of+sf*a))-i,M=nf+3*rf*a+l*(7*of+9*sf*a),E=I/M,o=gi(o-E,-Math.PI/3,Math.PI/3),a=o*o,l=a*a*a,!(Math.abs(E)<1e-12));++D);let h=_g*e*(nf+3*rf*a+l*(7*of+9*sf*a))/Math.cos(o),g=Math.asin(Math.sin(o)/_g),y=gi(180*h/Math.PI,-180,180),x=gi(180*g/Math.PI,-tr,tr);return new Bi(y,x)}}class X2 extends Wc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){let o=360*(e-.5),a=gi(360*(.5-i),-tr,tr);return new Bi(o,a)}}let Sd=Math.PI/2;function yg(t){return Math.tan((Sd+t)/2)}class Y2 extends Wc{constructor(e){super(e),this.center=e.center||[0,30];let[i,o]=this.parallels=e.parallels||[30,30],a=Si(i),l=Si(o);this.southernCenter=a+l<0,this.southernCenter&&(a=-a,l=-l);let h=Math.cos(a),g=yg(a);this.n=a===l?Math.sin(a):Math.log(h/Math.cos(l))/Math.log(yg(l)/g),this.f=h*Math.pow(yg(a),this.n)/this.n}project(e,i){i=Si(i),this.southernCenter&&(i=-i),e=Si(e-this.center[0]);let o=1e-6,{n:a,f:l}=this;l>0?i<-Sd+o&&(i=-Sd+o):i>Sd-o&&(i=Sd-o);let h=l/Math.pow(yg(i),a),g=h*Math.sin(a*e),y=l-h*Math.cos(a*e);return g=.5*(g/Math.PI+.5),y=.5*(y/Math.PI+.5),{x:g,y:this.southernCenter?y:1-y,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;let{n:o,f:a}=this,l=a-i,h=Math.sign(l),g=Math.sign(o)*Math.sqrt(e*e+l*l),y=Math.atan2(e,Math.abs(l))*h;l*o<0&&(y-=Math.PI*Math.sign(e)*h);let x=gi(zr(y/o)+this.center[0],-180,180),E=gi(zr(2*Math.atan(Math.pow(a/g,1/o))-Sd),-tr,tr);return new Bi(x,this.southernCenter?-E:E)}}class pw extends Wc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Bc(e),y:tc(i),z:0}}unproject(e,i){let o=xs(e),a=Jr(i);return new Bi(o,a)}}let fw=Si(tr);class K2 extends Wc{project(e,i){let o=(i=Si(i))*i,a=o*o;return{x:.5*((e=Si(e))*(.8707-.131979*o+a*(a*(.003971*o-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+o*(.015085+a*(.028874*o-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,a=25,l=0,h=o*o;do{h=o*o;let x=h*h;l=(o*(1.007226+h*(.015085+x*(.028874*h-.044475-.005916*x)))-i)/(1.007226+h*(.045255+x*(.259866*h-.311325-.005916*11*x))),o=gi(o-l,-fw,fw)}while(Math.abs(l)>1e-6&&--a>0);h=o*o;let g=gi(zr(e/(.8707+h*(h*(h*h*h*(.003971-.001529*h)-.013791)-.131979))),-180,180),y=zr(o);return new Bi(g,y)}}let mw=Si(tr);class J2 extends Wc{project(e,i){i=Si(i),e=Si(e);let o=Math.cos(i),a=2/Math.PI,l=Math.acos(o*Math.cos(e/2)),h=Math.sin(l)/l,g=.5*(e*a+2*o*Math.sin(e/2)/h)||0,y=.5*(i+Math.sin(i)/h)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,i){let o=e=(2*e-.5)*Math.PI,a=i=(2*(1-i)-1)*Math.PI,l=25,h=1e-6,g=0,y=0;do{let x=Math.cos(a),E=Math.sin(a),I=2*E*x,M=E*E,D=x*x,P=Math.cos(o/2),L=Math.sin(o/2),N=2*P*L,V=L*L,Z=1-D*P*P,Y=Z?1/Z:0,Q=Z?Math.acos(x*P)*Math.sqrt(1/Z):0,ae=.5*(2*Q*x*L+2*o/Math.PI)-e,te=.5*(Q*E+a)-i,ce=.5*Y*(D*V+Q*x*P*M)+1/Math.PI,he=Y*(N*I/4-Q*E*L),be=.125*Y*(I*L-Q*E*D*N),Pe=.5*Y*(M*P+Q*V*x)+.5,Te=he*be-Pe*ce;g=(te*he-ae*Pe)/Te,y=(ae*be-te*ce)/Te,o=gi(o-g,-Math.PI,Math.PI),a=gi(a-y,-mw,mw)}while((Math.abs(g)>h||Math.abs(y)>h)&&--l>0);return new Bi(zr(o),zr(a))}}class gw extends Wc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Si(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){let{scale:o,cosPhi:a}=this;return{x:Si(e)*a*o+.5,y:-Math.sin(Si(i))/a*o+.5,z:0}}unproject(e,i){let{scale:o,cosPhi:a}=this,l=-(i-.5)/o,h=gi(zr((e-.5)/o)/a,-180,180),g=Math.asin(gi(l*a,-1,1)),y=gi(zr(g),-tr,tr);return new Bi(h,y)}}class eD extends pw{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,o){let a=Gp(e,i,o),l=Xm(wl(o));return r.Q.transformMat4(a,a,l),{x:a[0],y:a[1],z:a[2]}}locationPoint(e,i){let o=Ku(i.lat,i.lng),a=r.Q.normalize([],o),l=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,h=Bo(1,0)*pt*l;r.Q.scaleAndAdd(o,o,a,h);let g=r.a9.identity(new Float64Array(16));return r.a9.multiply(g,e.pixelMatrix,e.globeMatrix),r.Q.transformMat4(o,o,g),new ct(o[0],o[1])}pixelsPerMeter(e,i){return Bo(1,0)*i}pixelSpaceConversion(e,i,o){let a=Bo(1,e)*i,l=si(Bo(1,45)*i,a,o);return this.pixelsPerMeter(e,i)/l}createTileMatrix(e,i,o){let a=Oy(wl(o.canonical));return r.a9.multiply(new Float64Array(16),e.globeMatrix,a)}createInversionMatrix(e,i){let{center:o}=e,a=Xm(wl(i));return r.a9.rotateY(a,a,Si(o.lng)),r.a9.rotateX(a,a,Si(o.lat)),r.a9.scale(a,a,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(e,i,o,a){return kx(e,i,o,!0)||new so(0,0)}pointCoordinate3D(e,i,o){let a=this.pointCoordinate(e,i,o,0);return[a.x,a.y,a.z]}isPointAboveHorizon(e,i){return!kx(e,i.x,i.y,!1)}farthestPixelDistance(e){let i=function(a,l){let h=a.cameraToCenterDistance,g=a._centerAltitude*l,y=a._camera,x=a._camera.forward(),E=r.Q.add([],r.Q.scale([],x,-h),[0,0,g]),I=a.worldSize/(2*Math.PI),M=[0,0,-I],D=a.width/a.height,P=Math.tan(a.fovAboveCenter),L=r.Q.scale([],y.up(),P),N=r.Q.scale([],y.right(),P*D),V=r.Q.normalize([],r.Q.add([],r.Q.add([],x,L),N)),Z=[],Y;if(new Ay(E,V).closestPointOnSphere(M,I,Z)){let Q=r.Q.add([],Z,M),ae=r.Q.sub([],Q,E);Y=Math.cos(a.fovAboveCenter)*r.Q.length(ae)}else{let Q=r.Q.sub([],E,M),ae=r.Q.sub([],M,E);r.Q.normalize(ae,ae);let te=r.Q.length(Q)-I;Y=Math.sqrt(te*(te+2*I));let ce=Math.acos(Y/(I+te))-Math.acos(r.Q.dot(x,ae));Y*=Math.cos(ce)}return 1.01*Y}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=Vc(e.zoom);if(o>0){let a=hw(e,Bo(1,e.center.lat)*e.worldSize),l=e.worldSize/(2*Math.PI),h=Math.max(e.width,e.height)/e.worldSize*Math.PI;return si(i,a+l*(1-Math.cos(h)),Math.pow(o,10))}return i}upVector(e,i,o){return Gp(i,o,e,1)}upVectorScale(e){return{metersToTile:Zm(Qm(wl(e)))}}}function _w(t){let e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new pw(t);case"equirectangular":return new X2(t);case"naturalEarth":return new K2(t);case"equalEarth":return new Q2(t);case"winkelTripel":return new J2(t);case"albers":return i?new gw(t):new H2(t);case"lambertConformalConic":return i?new gw(t):new Y2(t);case"globe":return new eD(t)}throw new Error(`Invalid projection name: ${t.name}`)}let tD=ng.types,iD=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function vg(t,e,i,o,a,l,h,g,y,x,E,I,M){let D=g?Math.min($c,Math.round(g[0])):0,P=g?Math.min($c,Math.round(g[1])):0;t.emplaceBack(e,i,Math.round(32*o),Math.round(32*a),l,h,(D<<1)+(y?1:0),P,16*x,16*E,256*I,256*M)}function bg(t,e,i){t.emplaceBack(e,i)}function xg(t,e,i,o,a,l,h){t.emplaceBack(e,i,o,a,l,h)}function wg(t,e,i,o,a){t.emplaceBack(e,i,o,a),t.emplaceBack(e,i,o,a),t.emplaceBack(e,i,o,a),t.emplaceBack(e,i,o,a)}function nD(t){for(let e of t.sections)if(C(e.text))return!0;return!1}class ov{constructor(e){this.layoutVertexArray=new fa,this.indexArray=new Mr,this.programConfigurations=e,this.segments=new er,this.dynamicLayoutVertexArray=new Sr,this.opacityVertexArray=new xl,this.placedSymbolArray=new ix,this.iconTransitioningVertexArray=new bs,this.globeExtVertexArray=new ma,this.zOffsetVertexArray=new zp}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,o,a,l){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,h2.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,p2.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,iD,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,m2.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,d2.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||l)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,f2.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}bt(ov,"SymbolBuffers");class sv{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new er,this.collisionVertexArray=new Wa,this.collisionVertexArrayExt=new Sr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,g2.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,_2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}bt(sv,"CollisionBuffers");class Tg{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(h=>h.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=r.a9.identity([]),this.placementViewportMatrix=r.a9.identity([]);let i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Qy(this.zoom,i["text-size"]),this.iconSizeData=Qy(this.zoom,i["icon-size"]);let o=this.layers[0].layout,a=o.get("symbol-sort-key"),l=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=l!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(l==="viewport-y"||l==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(h=>js[h]),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=o.get("symbol-z-elevate")}createArrays(){this.text=new ov(new Fc(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new ov(new Fc(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ox,this.lineVertexArray=new sx,this.symbolInstances=new rx}calculateGlyphDependencies(e,i,o,a,l){for(let h=0;h<e.length;h++){let g=e.codePointAt(h);if(g===void 0)break;if(i[g]=!0,a&&l&&g<=65535){let y=Yp[e.charAt(h)];y&&(i[y.charCodeAt(0)]=!0)}}}populate(e,i,o,a){let l=this.layers[0],h=l.layout,g=this.projection.name==="globe",y=h.get("text-font"),x=h.get("text-field"),E=h.get("icon-image"),I=(x.value.kind!=="constant"||x.value.value instanceof Qr&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),M=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,D=h.get("symbol-sort-key");if(this.features=[],!I&&!M)return;let P=i.iconDependencies,L=i.glyphDependencies,N=i.availableImages,V=new $(this.zoom);for(let{feature:Z,id:Y,index:Q,sourceLayerIndex:ae}of e){let te=l._featureFilter.needGeometry,ce=Nc(Z,te);if(!l._featureFilter.filter(V,ce,o))continue;if(te||(ce.geometry=ic(Z,o,a)),g&&Z.type!==1&&o.z<=5){let Te=ce.geometry,Le=.98078528056,Oe=(ke,$e)=>{let qe=Gp(ke.x,ke.y,o,1),Xe=Gp($e.x,$e.y,o,1);return r.Q.dot(qe,Xe)<Le};for(let ke=0;ke<Te.length;ke++)Te[ke]=$C(Te[ke],Oe)}let he,be;if(I){let Te=l.getValueAndResolveTokens("text-field",ce,o,N),Le=Qr.factory(Te);nD(Le)&&(this.hasRTLText=!0),(!this.hasRTLText||ne()==="unavailable"||this.hasRTLText&&oe.isParsed())&&(he=b2(Le,l,ce))}if(M){let Te=l.getValueAndResolveTokens("icon-image",ce,o,N);be=Te instanceof Yo?Te:Yo.fromString(Te)}if(!he&&!be)continue;let Pe=this.sortFeaturesByKey?D.evaluate(ce,{},o):void 0;if(this.features.push({id:Y,text:he,icon:be,index:Q,sourceLayerIndex:ae,geometry:ce.geometry,properties:Z.properties,type:tD[Z.type],sortKey:Pe}),be&&(P[be.namePrimary]=!0,be.nameSecondary&&(P[be.nameSecondary]=!0)),he){let Te=y.evaluate(ce,{},o).join(","),Le=h.get("text-rotation-alignment")==="map"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(js.vertical)>=0;for(let Oe of he.sections)if(Oe.image)P[Oe.image.namePrimary]=!0;else{let ke=s(he.toString()),$e=Oe.fontStack||Te,qe=L[$e]=L[$e]||{};this.calculateGlyphDependencies(Oe.text,qe,Le,this.allowVerticalPlacement,ke)}}}h.get("symbol-placement")==="line"&&(this.features=function(Z){let Y={},Q={},ae=[],te=0;function ce(Te){ae.push(Z[Te]),te++}function he(Te,Le,Oe){let ke=Q[Te];return delete Q[Te],Q[Le]=ke,ae[ke].geometry[0].pop(),ae[ke].geometry[0]=ae[ke].geometry[0].concat(Oe[0]),ke}function be(Te,Le,Oe){let ke=Y[Le];return delete Y[Le],Y[Te]=ke,ae[ke].geometry[0].shift(),ae[ke].geometry[0]=Oe[0].concat(ae[ke].geometry[0]),ke}function Pe(Te,Le,Oe){let ke=Oe?Le[0][Le[0].length-1]:Le[0][0];return`${Te}:${ke.x}:${ke.y}`}for(let Te=0;Te<Z.length;Te++){let Le=Z[Te],Oe=Le.geometry,ke=Le.text?Le.text.toString():null;if(!ke){ce(Te);continue}let $e=Pe(ke,Oe),qe=Pe(ke,Oe,!0);if($e in Q&&qe in Y&&Q[$e]!==Y[qe]){let Xe=be($e,qe,Oe),Qe=he($e,qe,ae[Xe].geometry);delete Y[$e],delete Q[qe],Q[Pe(ke,ae[Qe].geometry,!0)]=Qe,ae[Xe].geometry=null}else $e in Q?he($e,qe,Oe):qe in Y?be($e,qe,Oe):(ce(Te),Y[$e]=te-1,Q[qe]=te-1)}return ae.filter(Te=>Te.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Z,Y)=>Z.sortKey-Y.sortKey)}update(e,i,o,a,l){let h=Object.keys(e).length!==0;if(h&&!this.stateDependentLayers.length)return;let g=h?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,i,g,o,a,l),this.icon.programConfigurations.updatePaintArrays(e,i,g,o,a,l)}updateZOffset(){let e=(l,h,g)=>{o+=h,o>l.length&&l.resize(o);for(let y=-h;y<0;y++)l.emplace(y+o,g)},i=(l,h,g)=>{a+=h,a>l.length&&l.resize(a);for(let y=-h;y<0;y++)l.emplace(y+a,g)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,a=0;for(let l=0;l<this.symbolInstances.length;l++){let h=this.symbolInstances.get(l),{numHorizontalGlyphVertices:g,numVerticalGlyphVertices:y,numIconVertices:x}=h,E=h.zOffset,I=x>0;if((g>0||y>0)&&(e(this.text.zOffsetVertexArray,g,E),e(this.text.zOffsetVertexArray,y,E)),I){let{placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:D}=h;M>=0&&i(this.icon.zOffsetVertexArray,x,E),D>=0&&i(this.icon.zOffsetVertexArray,h.numVerticalIconVertices,E)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=_w(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){let o=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:a,y:l}of i)this.lineVertexArray.emplaceBack(a,l);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,a,l,h,g,y,x,E,I,M,D,P,L,N){let V=e.indexArray,Z=e.layoutVertexArray,Y=e.globeExtVertexArray,Q=e.segments.prepareSegment(4*i.length,Z,V,this.canOverlap?h.sortKey:void 0),ae=this.glyphOffsetArray.length,te=Q.vertexLength,ce=this.allowVerticalPlacement&&g===js.vertical?Math.PI/2:0,he=h.text&&h.text.sections;for(let Pe=0;Pe<i.length;Pe++){let{tl:Te,tr:Le,bl:Oe,br:ke,texPrimary:$e,texSecondary:qe,pixelOffsetTL:Xe,pixelOffsetBR:Qe,minFontScaleX:Fe,minFontScaleY:It,glyphOffset:yt,isSDF:Ke,sectionIndex:Ut}=i[Pe],Pt=Q.vertexLength,St=yt[1];if(vg(Z,x.x,x.y,Te.x,St+Te.y,$e.x,$e.y,o,Ke,Xe.x,Xe.y,Fe,It),vg(Z,x.x,x.y,Le.x,St+Le.y,$e.x+$e.w,$e.y,o,Ke,Qe.x,Xe.y,Fe,It),vg(Z,x.x,x.y,Oe.x,St+Oe.y,$e.x,$e.y+$e.h,o,Ke,Xe.x,Qe.y,Fe,It),vg(Z,x.x,x.y,ke.x,St+ke.y,$e.x+$e.w,$e.y+$e.h,o,Ke,Qe.x,Qe.y,Fe,It),y){let{x:Je,y:Bt,z:ai}=y.anchor,[Qt,hi,li]=y.up;xg(Y,Je,Bt,ai,Qt,hi,li),xg(Y,Je,Bt,ai,Qt,hi,li),xg(Y,Je,Bt,ai,Qt,hi,li),xg(Y,Je,Bt,ai,Qt,hi,li),wg(e.dynamicLayoutVertexArray,Je,Bt,ai,ce)}else wg(e.dynamicLayoutVertexArray,x.x,x.y,x.z,ce);if(N){let Je=qe||$e;bg(e.iconTransitioningVertexArray,Je.x,Je.y),bg(e.iconTransitioningVertexArray,Je.x+Je.w,Je.y),bg(e.iconTransitioningVertexArray,Je.x,Je.y+Je.h),bg(e.iconTransitioningVertexArray,Je.x+Je.w,Je.y+Je.h)}V.emplaceBack(Pt,Pt+1,Pt+2),V.emplaceBack(Pt+1,Pt+2,Pt+3),Q.vertexLength+=4,Q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(yt[0]),Pe!==i.length-1&&Ut===i[Pe+1].sectionIndex||e.programConfigurations.populatePaintArrays(Z.length,h,h.index,{},D,P,L,he&&he[Ut])}let be=y?y.anchor:x;e.placedSymbolArray.emplaceBack(be.x,be.y,be.z,x.x,x.y,ae,this.glyphOffsetArray.length-ae,te,E,I,x.segment,o?o[0]:0,o?o[1]:0,a[0],a[1],g,0,!1,0,M,0)}_commitLayoutVertex(e,i,o,a,l,h,g){e.emplaceBack(i,o,a,l,h,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,i,o,a,l,h,g){let y=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),x=y.vertexLength,E=g.tileAnchorX,I=g.tileAnchorY;for(let D=0;D<4;D++)o.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,i,e.padding,g.zOffset),this._commitLayoutVertex(o.layoutVertexArray,a,l,h,E,I,new ct(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,a,l,h,E,I,new ct(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,a,l,h,E,I,new ct(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,a,l,h,E,I,new ct(e.x1,e.y2)),y.vertexLength+=4;let M=o.indexArray;M.emplaceBack(x,x+1),M.emplaceBack(x+1,x+2),M.emplaceBack(x+2,x+3),M.emplaceBack(x+3,x),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,o,a,l,h){for(let g=a;g<l;g++){let y=o.get(g),x=this.getSymbolInstanceTextSize(e,h,i,g);this._addCollisionDebugVertices(y,x,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,h)}}_addIconDebugCollisionBoxes(e,i,o,a,l,h){for(let g=a;g<l;g++){let y=o.get(g),x=this.getSymbolInstanceIconSize(e,i,h.placedIconSymbolIndex);this._addCollisionDebugVertices(y,x,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,h)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new sv(kc,z1.members,bs),this.iconCollisionBox=new sv(kc,z1.members,bs);let o=vd(this.iconSizeData,e),a=vd(this.textSizeData,e);for(let l=0;l<this.symbolInstances.length;l++){let h=this.symbolInstances.get(l);this._addTextDebugCollisionBoxes(a,e,i,h.textBoxStartIndex,h.textBoxEndIndex,h),this._addTextDebugCollisionBoxes(a,e,i,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._addIconDebugCollisionBoxes(o,e,i,h.iconBoxStartIndex,h.iconBoxEndIndex,h),this._addIconDebugCollisionBoxes(o,e,i,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h)}}getSymbolInstanceTextSize(e,i,o,a){let l=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:a),h=cg(this.textSizeData,e,l)/eo;return this.tilePixelRatio*h}getSymbolInstanceIconSize(e,i,o){let a=this.icon.placedSymbolArray.get(o),l=cg(this.iconSizeData,e,a);return this.tilePixelRatio*l}_commitDebugCollisionVertexUpdate(e,i,o,a){e.emplaceBack(i,-o,-o,a),e.emplaceBack(i,o,-o,a),e.emplaceBack(i,o,o,a),e.emplaceBack(i,-o,o,a)}_updateTextDebugCollisionBoxes(e,i,o,a,l,h){for(let g=a;g<l;g++){let y=o.get(g),x=this.getSymbolInstanceTextSize(e,h,i,g);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,x,y.padding,h.zOffset)}}_updateIconDebugCollisionBoxes(e,i,o,a,l,h){for(let g=a;g<l;g++){let y=o.get(g),x=this.getSymbolInstanceIconSize(e,i,h.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,x,y.padding,h.zOffset)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let o=vd(this.iconSizeData,e),a=vd(this.textSizeData,e);for(let l=0;l<this.symbolInstances.length;l++){let h=this.symbolInstances.get(l);this._updateTextDebugCollisionBoxes(a,e,i,h.textBoxStartIndex,h.textBoxEndIndex,h),this._updateTextDebugCollisionBoxes(a,e,i,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._updateIconDebugCollisionBoxes(o,e,i,h.iconBoxStartIndex,h.iconBoxEndIndex,h),this._updateIconDebugCollisionBoxes(o,e,i,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,o,a,l,h,g,y,x){let E={};if(i<o){let{x1:I,y1:M,x2:D,y2:P,padding:L,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:Z,tileAnchorX:Y,tileAnchorY:Q,featureIndex:ae}=e.get(i);E.textBox={x1:I,y1:M,x2:D,y2:P,padding:L,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:Z,tileAnchorX:Y,tileAnchorY:Q},E.textFeatureIndex=ae}if(a<l){let{x1:I,y1:M,x2:D,y2:P,padding:L,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:Z,tileAnchorX:Y,tileAnchorY:Q,featureIndex:ae}=e.get(a);E.verticalTextBox={x1:I,y1:M,x2:D,y2:P,padding:L,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:Z,tileAnchorX:Y,tileAnchorY:Q},E.verticalTextFeatureIndex=ae}if(h<g){let{x1:I,y1:M,x2:D,y2:P,padding:L,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:Z,tileAnchorX:Y,tileAnchorY:Q,featureIndex:ae}=e.get(h);E.iconBox={x1:I,y1:M,x2:D,y2:P,padding:L,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:Z,tileAnchorX:Y,tileAnchorY:Q},E.iconFeatureIndex=ae}if(y<x){let{x1:I,y1:M,x2:D,y2:P,padding:L,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:Z,tileAnchorX:Y,tileAnchorY:Q,featureIndex:ae}=e.get(y);E.verticalIconBox={x1:I,y1:M,x2:D,y2:P,padding:L,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:Z,tileAnchorX:Y,tileAnchorY:Q},E.verticalIconFeatureIndex=ae}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){let o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){let o=e.placedSymbolArray.get(i),a=o.vertexStartIndex+4*o.numGlyphs;for(let l=o.vertexStartIndex;l<a;l+=4)e.indexArray.emplaceBack(l,l+1,l+2),e.indexArray.emplaceBack(l+1,l+2,l+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let i=Math.sin(e),o=Math.cos(e),a=[],l=[],h=[];for(let g=0;g<this.symbolInstances.length;++g){h.push(g);let y=this.symbolInstances.get(g);a.push(0|Math.round(i*y.tileAnchorX+o*y.tileAnchorY)),l.push(y.featureIndex)}return h.sort((g,y)=>a[g]-a[y]||l[y]-l[g]),h}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){let o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let i of this.symbolInstanceIndexes){let o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex);let{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:l,leftJustifiedTextSymbolIndex:h,verticalPlacedTextSymbolIndex:g,placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:x}=o;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),l>=0&&l!==a&&this.addIndicesForPlacedSymbol(this.text,l),h>=0&&h!==l&&h!==a&&this.addIndicesForPlacedSymbol(this.text,h),g>=0&&this.addIndicesForPlacedSymbol(this.text,g),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}bt(Tg,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Tg.addDynamicAttributes=wg;let rD=new ye({"symbol-placement":new pe(re.layout_symbol["symbol-placement"]),"symbol-spacing":new pe(re.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new pe(re.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new xe(re.layout_symbol["symbol-sort-key"]),"symbol-z-order":new pe(re.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new pe(re.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new pe(re.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new pe(re.layout_symbol["icon-ignore-placement"]),"icon-optional":new pe(re.layout_symbol["icon-optional"]),"icon-rotation-alignment":new pe(re.layout_symbol["icon-rotation-alignment"]),"icon-size":new xe(re.layout_symbol["icon-size"]),"icon-text-fit":new xe(re.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new xe(re.layout_symbol["icon-text-fit-padding"]),"icon-image":new xe(re.layout_symbol["icon-image"]),"icon-rotate":new xe(re.layout_symbol["icon-rotate"]),"icon-padding":new pe(re.layout_symbol["icon-padding"]),"icon-keep-upright":new pe(re.layout_symbol["icon-keep-upright"]),"icon-offset":new xe(re.layout_symbol["icon-offset"]),"icon-anchor":new xe(re.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new pe(re.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new pe(re.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new pe(re.layout_symbol["text-rotation-alignment"]),"text-field":new xe(re.layout_symbol["text-field"]),"text-font":new xe(re.layout_symbol["text-font"]),"text-size":new xe(re.layout_symbol["text-size"]),"text-max-width":new xe(re.layout_symbol["text-max-width"]),"text-line-height":new xe(re.layout_symbol["text-line-height"]),"text-letter-spacing":new xe(re.layout_symbol["text-letter-spacing"]),"text-justify":new xe(re.layout_symbol["text-justify"]),"text-radial-offset":new xe(re.layout_symbol["text-radial-offset"]),"text-variable-anchor":new pe(re.layout_symbol["text-variable-anchor"]),"text-anchor":new xe(re.layout_symbol["text-anchor"]),"text-max-angle":new pe(re.layout_symbol["text-max-angle"]),"text-writing-mode":new pe(re.layout_symbol["text-writing-mode"]),"text-rotate":new xe(re.layout_symbol["text-rotate"]),"text-padding":new pe(re.layout_symbol["text-padding"]),"text-keep-upright":new pe(re.layout_symbol["text-keep-upright"]),"text-transform":new xe(re.layout_symbol["text-transform"]),"text-offset":new xe(re.layout_symbol["text-offset"]),"text-allow-overlap":new pe(re.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new pe(re.layout_symbol["text-ignore-placement"]),"text-optional":new pe(re.layout_symbol["text-optional"]),visibility:new pe(re.layout_symbol.visibility)});var av={paint:new ye({"icon-opacity":new xe(re.paint_symbol["icon-opacity"]),"icon-emissive-strength":new xe(re.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new xe(re.paint_symbol["text-emissive-strength"]),"icon-color":new xe(re.paint_symbol["icon-color"]),"icon-halo-color":new xe(re.paint_symbol["icon-halo-color"]),"icon-halo-width":new xe(re.paint_symbol["icon-halo-width"]),"icon-halo-blur":new xe(re.paint_symbol["icon-halo-blur"]),"icon-translate":new pe(re.paint_symbol["icon-translate"]),"icon-translate-anchor":new pe(re.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new xe(re.paint_symbol["icon-image-cross-fade"]),"text-opacity":new xe(re.paint_symbol["text-opacity"]),"text-color":new xe(re.paint_symbol["text-color"],{runtimeType:Xo,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new xe(re.paint_symbol["text-halo-color"]),"text-halo-width":new xe(re.paint_symbol["text-halo-width"]),"text-halo-blur":new xe(re.paint_symbol["text-halo-blur"]),"text-translate":new pe(re.paint_symbol["text-translate"]),"text-translate-anchor":new pe(re.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new pe(re.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new pe(re.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new pe(re.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new pe(re.paint_symbol["icon-color-brightness-max"])}),layout:rD};class yw{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ci,this.defaultValue=e}evaluate(e){if(e.formattedSection){let i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}bt(yw,"FormatSectionOverride",{omit:["defaultValue"]});class Eg extends di{constructor(e,i,o){super(e,av,i,o),this._colorAdjustmentMatrix=r.a9.identity([])}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let o=this.layout.get("text-writing-mode");if(o){let a=[];for(let l of o)a.indexOf(l)<0&&a.push(l);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,o,a){return this._saturation===e&&this._contrast===i&&this._brightnessMin===o&&this._brightnessMax===a||(this._colorAdjustmentMatrix=function(l,h,g,y){l=yu(l),h=Wo(h);let x=r.a9.create(),E=l/3,I=1-2*E,M=[I,E,E,0,E,I,E,0,E,E,I,0,0,0,0,1],D=.5-.5*h,P=y-g;return r.a9.multiply(x,[P,0,0,0,0,P,0,0,0,0,P,0,g,g,g,1],[h,0,0,0,0,h,0,0,0,0,h,0,D,D,D,1]),r.a9.multiply(x,x,M),x}(e,i,o,a),this._saturation=e,this._contrast=i,this._brightnessMin=o,this._brightnessMax=a),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,o,a){let l=this.layout.get(e).evaluate(i,{},o,a),h=this._unevaluatedLayout._values[e];return h.isDataDriven()||sd(h.value)||!l?l:function(g,y){return y.replace(/{([^{}]+)}/g,(x,E)=>E in g?String(g[E]):"")}(i.properties,l)}createBucket(e){return new Tg(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of av.paint.overridableProperties){if(!Eg.hasPaintOverride(this.layout,e))continue;let i=this.paint.get(e),o=new yw(i),a=new od(o,i.property.specification,this.scope,this.options),l=null;l=i.value.kind==="constant"||i.value.kind==="source"?new Uu("source",a):new Gu("composite",a,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Ee(i.property,l,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&Eg.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){let o=e.get("text-field"),a=av.paint.properties[i],l=!1,h=g=>{for(let y of g)if(a.overrides&&a.overrides.hasOverride(y))return void(l=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Qr)h(o.value.value.sections);else if(o.value.kind==="source"){let g=x=>{l||(x instanceof ha&&hr(x.value)===vc?h(x.value.sections):x instanceof Su?h(x.sections):x.eachChild(g))},y=o.value;y._styleExpression&&g(y._styleExpression.expression)}return l}getProgramIds(){let e=this.paint.get("icon-opacity").constantOr(1)!==0,i=this.paint.get("text-opacity").constantOr(1)!==0,o=[];return e&&o.push("symbolIcon"),i&&o.push("symbolSDF"),o}getDefaultProgramParams(e,i){return{config:new Yu(this,i),overrideFog:!1}}}let oD=new ye({visibility:new pe(re.layout_background.visibility)});var sD={paint:new ye({"background-color":new pe(re.paint_background["background-color"]),"background-pattern":new pe(re.paint_background["background-pattern"]),"background-opacity":new pe(re.paint_background["background-opacity"]),"background-emissive-strength":new pe(re.paint_background["background-emissive-strength"])}),layout:oD};let aD=new ye({visibility:new pe(re.layout_raster.visibility)});var lD={paint:new ye({"raster-opacity":new pe(re.paint_raster["raster-opacity"]),"raster-color":new He(re.paint_raster["raster-color"]),"raster-color-mix":new pe(re.paint_raster["raster-color-mix"]),"raster-color-range":new pe(re.paint_raster["raster-color-range"]),"raster-hue-rotate":new pe(re.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new pe(re.paint_raster["raster-brightness-min"]),"raster-brightness-max":new pe(re.paint_raster["raster-brightness-max"]),"raster-saturation":new pe(re.paint_raster["raster-saturation"]),"raster-contrast":new pe(re.paint_raster["raster-contrast"]),"raster-resampling":new pe(re.paint_raster["raster-resampling"]),"raster-fade-duration":new pe(re.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new pe(re.paint_raster["raster-emissive-strength"]),"raster-array-band":new pe(re.paint_raster["raster-array-band"]),"raster-elevation":new pe(re.paint_raster["raster-elevation"])}),layout:aD},lv=oi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class cv{constructor(e,i,o,a){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(i,a)}update(e,i,o){let{width:a,height:l}=e,{context:h}=this,{gl:g}=h;if(g.bindTexture(g.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA&&(!i||i.premultiply!==!1)),o||this.size&&this.size[0]===a&&this.size[1]===l){let{x:y,y:x}=o||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)g.texSubImage2D(g.TEXTURE_2D,0,y,x,g.RGBA,g.UNSIGNED_BYTE,e);else{let E=this.format,I=g.UNSIGNED_BYTE;this.format===g.R32F&&(E=g.RED,I=g.FLOAT),g.texSubImage2D(g.TEXTURE_2D,0,y,x,a,l,E,I,e.data)}}else if(this.size=[a,l],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let y=this.format;this.format===g.R8&&(y=g.RED),g.texImage2D(g.TEXTURE_2D,0,this.format,y,g.UNSIGNED_BYTE,e)}else{let y=this.format,x=this.format,E=g.UNSIGNED_BYTE;this.format===g.DEPTH_COMPONENT&&(y=g.DEPTH_COMPONENT16,E=g.UNSIGNED_SHORT),this.format===g.R8&&(x=g.RED),this.format===g.R32F&&(E=g.FLOAT,x=g.RED),g.texImage2D(g.TEXTURE_2D,0,y,a,l,0,x,E,e.data)}this.useMipmap=!!(i&&i.useMipmap),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(e,i,o=!1){let{context:a}=this,{gl:l}=a;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap&&!o?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,i),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,o,a){let{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),i!==this.magFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),this.wrapS=o),a!==this.wrapT&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,a),this.wrapT=a)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Ig{constructor(e,i){this.context=e,this.texture=i}bind(e,i){let{context:o}=this,{gl:a}=o;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,i),this.wrapS=i)}}function Sg(t,e,i,o,a,l,h,g){let y=[t,e,1,i,o,1,a,l,1],x=[h,g,1],E=r.ct.adjoint([],y),[I,M,D]=r.Q.transformMat3(x,x,E);return r.ct.multiply(y,y,[I,0,0,0,M,0,0,0,D])}function vw(t,e,i,o,a,l,h,g){let y=function(x,E,I,M,D,P,L,N){let V=Sg(0,0,1,0,1,1,0,1),Z=Sg(x,E,I,M,D,P,L,N),Y=r.ct.adjoint([],V);return r.ct.multiply(Z,Z,Y)}(t,e,i,o,a,l,h,g);return[y[2]/y[8]/pt,y[5]/y[8]/pt]}function Mg(t){return[t[0],Math.min(Math.max(t[1],-tr),tr)]}class bw extends Hr{constructor(e,i,o,a){super(),this.id=e,this.dispatcher=o,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(a),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new ms("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Ba(this.map._requestManager.transformRequest(this.url,gc.Image),(o,a)=>{this._imageRequest=null,this._loaded=!0,o?this.fire(new Zr(o)):a&&(this.image=a instanceof HTMLImageElement?Br.getImageData(a):a,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Ig(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new ms("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Ig||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],o=e[0][1];for(let l of e)l[1]>o&&(o=l[1]),l[1]<i&&(i=l[1]);let a=(o+i)/2;if(a>tr?this.onNorthPole=!0:a<-tr&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let l=e.map(so.fromLngLat);this.tileID=function(h){let g=1/0,y=1/0,x=-1/0,E=-1/0;for(let L of h)g=Math.min(g,L.x),y=Math.min(y,L.y),x=Math.max(x,L.x),E=Math.max(E,L.y);let I=Math.max(x-g,E-y),M=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),D=Math.pow(2,M),P=Math.floor((g+x)/2*D);return P>1&&(P-=1),new Ju(M,P,Math.floor((y+E)/2*D))}(l),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new ms("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let V in this.tiles){let Z=this.tiles[V];Z.state!=="loaded"&&(Z.state="loaded",Z.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let i=tf(new Ju(0,0,0),this.map.transform.projection),o=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(V){let Z=V[1].x-V[0].x,Y=V[1].y-V[0].y,Q=V[2].x-V[1].x,ae=V[2].y-V[1].y,te=V[3].x-V[2].x,ce=V[3].y-V[2].y,he=V[0].x-V[3].x,be=V[0].y-V[3].y,Pe=Z*ae-Q*Y,Te=Q*ce-te*ae,Le=te*be-he*ce,Oe=he*Y-Z*be;return Pe>0&&Te>0&&Le>0&&Oe>0||Pe<0&&Te<0&&Le<0&&Oe<0}(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let a=tf(this.tileID,this.map.transform.projection),[l,h,g,y]=this.coordinates.map(V=>{let Z=a.projection.project(V[0],V[1]);return dw(a,Z)._round()});this.perspectiveTransform=vw(l.x,l.y,h.x,h.y,g.x,g.y,y.x,y.y);let x=this._boundsArray=new Kr;x.emplaceBack(l.x,l.y,0,0),x.emplaceBack(h.x,h.y,pt,0),x.emplaceBack(y.x,y.y,0,pt),x.emplaceBack(g.x,g.y,pt,pt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(x,lv.members),this.boundsSegments=er.simpleSegment(0,0,4,2);let E=[],I=[Mg((M=this.coordinates)[0]),Mg(M[1]),Mg(M[2]),Mg(M[3])];var M;let[D,P,L,N]=function(V){let Z=V[0][0],Y=Z,Q=V[0][1],ae=Q;for(let te=1;te<V.length;te++)V[te][0]<Z?Z=V[te][0]:V[te][0]>Y&&(Y=V[te][0]),V[te][1]<Q?Q=V[te][1]:V[te][1]>ae&&(ae=V[te][1]);return[Z,Q,Y-Z,ae-Q]}(I);{let V=new Kr,[Z,Y,Q,ae]=function(Xe){let Qe=Xe[0].x,Fe=Qe,It=Xe[0].y,yt=It;for(let Ke=1;Ke<Xe.length;Ke++)Xe[Ke].x<Qe?Qe=Xe[Ke].x:Xe[Ke].x>Fe&&(Fe=Xe[Ke].x),Xe[Ke].y<It?It=Xe[Ke].y:Xe[Ke].y>yt&&(yt=Xe[Ke].y);return[Qe,It,Fe-Qe,yt-It]}(o),te=Xe=>[(Xe.x-Z)/Q,(Xe.y-Y)/ae],[ce,he,be,Pe]=o.map(te),Te=function(Xe,Qe,Fe,It,yt,Ke,Ut,Pt){let St=Sg(0,0,1,0,1,1,0,1),Je=Sg(Xe,Qe,Fe,It,yt,Ke,Ut,Pt),Bt=r.ct.adjoint([],Je);return r.ct.multiply(St,St,Bt)}(ce[0],ce[1],he[0],he[1],be[0],be[1],Pe[0],Pe[1]);this.elevatedGlobePerspectiveTransform=vw(ce[0],ce[1],he[0],he[1],be[0],be[1],Pe[0],Pe[1]);let Le=(Xe,Qe)=>{E.push(Xe.lng);let Fe=Math.round((Xe.lng-D)/L*pt),It=Math.round((Xe.lat-P)/N*pt),yt=te(Qe),Ke=r.Q.transformMat3([],[yt[0],yt[1],1],Te),Ut=Math.round(Ke[0]/Ke[2]*pt),Pt=Math.round(Ke[1]/Ke[2]*pt);V.emplaceBack(Fe,It,Ut,Pt)},Oe=o[3].x-o[0].x,ke=o[3].y-o[0].y,$e=o[2].x-o[1].x,qe=o[2].y-o[1].y;for(let Xe=0;Xe<65;Xe++){let Qe=Xe/64,Fe=[o[0].x+Qe*Oe,o[0].y+Qe*ke],It=[o[1].x+Qe*$e,o[1].y+Qe*qe],yt=It[0]-Fe[0],Ke=It[1]-Fe[1];for(let Ut=0;Ut<65;Ut++){let Pt=Ut/64,St={x:Fe[0]+yt*Pt,y:Fe[1]+Ke*Pt,z:0};Le(i.projection.unproject(St.x,St.y),St)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(V,lv.members)}{this.maxLongitudeTriangleSize=0;let V=[],Z=new Mr,Y=(Q,ae,te)=>{Z.emplaceBack(Q,ae,te);let ce=E[Q],he=E[ae],be=E[te],Pe=Math.min(Math.min(ce,he),be),Te=Math.max(Math.max(ce,he),be)-Pe;Te>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Te),V.push(Pe+Te/2)};for(let Q=0;Q<64;Q++)for(let ae=0;ae<64;ae++){let te=65*Q+ae,ce=te+1,he=te+65,be=he+1;Y(te,he,ce),Y(ce,he,be)}[V,Z]=function(Q,ae){let te=Array.from({length:Q.length},(be,Pe)=>Pe);te.sort((be,Pe)=>Q[be]-Q[Pe]);let ce=[],he=new Mr;for(let be=0;be<te.length;be++){let Pe=te[be];ce.push(Q[Pe]);let Te=3*Pe,Le=Te+1;he.emplaceBack(ae.uint16[Te],ae.uint16[Le],ae.uint16[Le+1])}return[ce,he]}(V,Z),this.elevatedGlobeTrianglesCenterLongitudes=V,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(Z)}this.elevatedGlobeSegments=er.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,L/pt,0,N/pt,0,0,P,D,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let i=this.map.painter.context,o=i.gl;!this._dirty||this.texture instanceof Ig||(this.texture?this.texture.update(this.image):(this.texture=new cv(i,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;let o=this.elevatedGlobeTrianglesCenterLongitudes,a=((E,I)=>E+360*Math.round((I-E)/360))(e+180,o[0]),l=new er,h=(E,I)=>{l.segments.push({vertexOffset:0,primitiveOffset:E,vertexLength:i.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},g=.51*this.maxLongitudeTriangleSize;if(Math.abs(o[0]-a)<=g){let E=_u(o,0,o.length,a+g);return E===o.length||h(E,Pa(o,E+1,o.length,a+360-g)-E),l}a<o[0]&&(a+=360);let y=Pa(o,0,o.length,a-g);if(y===o.length)return h(0,o.length),l;h(0,y-0);let x=_u(o,y+1,o.length,a+g);return x!==o.length&&h(x,o.length-x),l}}let cD=(Math.pow(256,2)-1)/16907520;class xw extends di{constructor(e,i,o){super(e,lD,i,o),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof bw&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let i=this._transitionablePaint._values["raster-color"].value.expression,[o,a]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(o)&&isNaN(a)||o===this._curRampRange[0]&&a===this._curRampRange[1]||(this.colorRamp=qp({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:o,end:a}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[o,a])}}let uD=new ye({visibility:new pe(re["layout_raster-particle"].visibility)});var hD={paint:new ye({"raster-particle-array-band":new pe(re["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new pe(re["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new He(re["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new pe(re["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new pe(re["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new pe(re["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new pe(re["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:uD};class ww extends di{constructor(e,i,o){super(e,hD,i,o),this._updateColorRamp(),this.lastInvalidatedAt=Br.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=qp({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Br.now()}}class dD extends di{constructor(e,i){super(e,{},i),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}let pD=new ye({visibility:new pe(re.layout_sky.visibility)});var fD={paint:new ye({"sky-type":new pe(re.paint_sky["sky-type"]),"sky-atmosphere-sun":new pe(re.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new pe(re.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new pe(re.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new pe(re.paint_sky["sky-gradient-radius"]),"sky-gradient":new He(re.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new pe(re.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new pe(re.paint_sky["sky-atmosphere-color"]),"sky-opacity":new pe(re.paint_sky["sky-opacity"])}),layout:pD};function uv(t,e,i){let o=[0,0,1],a=r.bl.identity([]);return r.bl.rotateY(a,a,i?-Si(t)+Math.PI:Si(t)),r.bl.rotateX(a,a,-Si(e)),r.Q.transformQuat(o,o,a),r.Q.normalize(o,o)}var mD={paint:new ye({})};function Tw(t,e){let i=Cg(t.projection,t.zoom,t.width,t.height),o=function(l,h,g,y,x){let E=new Bi(g.lng-180*Zc,g.lat),I=new Bi(g.lng+180*Zc,g.lat),M=l.project(E.lng,E.lat),D=l.project(I.lng,I.lat),P=-Math.atan2(D.y-M.y,D.x-M.x),L=so.fromLngLat(g);L.y=gi(L.y,-1+Zc,1-Zc);let N=L.toLngLat(),V=l.project(N.lng,N.lat),Z=so.fromLngLat(N);Z.x+=Zc;let Y=Z.toLngLat(),Q=l.project(Y.lng,Y.lat),ae=Sw(Q.x-V.x,Q.y-V.y,P),te=so.fromLngLat(N);te.y+=Zc;let ce=te.toLngLat(),he=l.project(ce.lng,ce.lat),be=Sw(he.x-V.x,he.y-V.y,P),Pe=Math.abs(ae.x)/Math.abs(be.y),Te=r.a9.identity([]);r.a9.rotateZ(Te,Te,-P*(1-(x?0:y)));let Le=r.a9.identity([]);return r.a9.scale(Le,Le,[1,1-(1-Pe)*y,1]),Le[4]=-be.x/be.y*y,r.a9.rotateZ(Le,Le,P),r.a9.multiply(Le,Te,Le),Le}(t.projection,0,t.center,i,e),a=Ew(t);return r.a9.scale(o,o,[a,a,1]),o}function Ew(t){let e=t.projection,i=Cg(t.projection,t.zoom,t.width,t.height),o=Iw(e,t.center),a=Iw(e,Bi.convert(e.center));return Math.pow(2,o*i+(1-i)*a)}function Cg(t,e,i,o,a=1/0){let l=t.range;if(!l)return 0;let h=Math.min(a,Math.max(i,o)),g=Math.log(h/1024)/Math.LN2;return Fl(l[0]+g,l[1]+g,e)}let Zc=1/4e4;function Iw(t,e){let i=gi(e.lat,-tr,tr),o=new Bi(e.lng-180*Zc,i),a=new Bi(e.lng+180*Zc,i),l=t.project(o.lng,i),h=t.project(a.lng,i),g=so.fromLngLat(o),y=so.fromLngLat(a),x=h.x-l.x,E=h.y-l.y,I=y.x-g.x,M=y.y-g.y,D=Math.sqrt((I*I+M*M)/(x*x+E*E));return Math.log(D)/Math.LN2}function Sw(t,e,i){let o=Math.cos(i),a=Math.sin(i);return{x:t*o-e*a,y:t*a+e*o}}function Mw(t,e,i){r.a9.identity(t),r.a9.rotateZ(t,t,Si(e[2])),r.a9.rotateX(t,t,Si(e[0])),r.a9.rotateY(t,t,Si(e[1])),r.a9.scale(t,t,i),r.a9.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Ag(t,e,i,o,a,l,h,g){let y=[i[0]-e[0],i[1]-e[1],0],x=[o[0]-e[0],o[1]-e[1],0];if(r.Q.length(y)<1e-12||r.Q.length(x)<1e-12)return r.bl.identity(t);let E=r.Q.cross([],y,x);r.Q.normalize(E,E),r.Q.subtract(x,o,e),y[2]=(l-a)*g,x[2]=(h-a)*g;let I=y;return r.Q.cross(I,y,x),r.Q.normalize(I,I),r.bl.rotationTo(t,E,I)}function hv(t,e,i=!1){let o=Vc(e.zoom),a=function(l,h,g){let y=h.worldSize,x=[l[12],l[13],l[14]],E=Jr(x[1]/y),I=xs(x[0]/y),M=r.a9.identity([]),D=Bo(1,E)*y,P=Bo(1,0)*y*eh(E,h.zoom),L=1/Ly(y),N=P*L;if(g){let Q=Cg(h.projection,h.zoom,h.width,h.height,1024);N=L*h.projection.pixelSpaceConversion(h.center.lat,y,Q)}let V=Ku(E,I);r.Q.add(V,V,r.Q.scale([],r.Q.normalize([],V),D*N*x[2]));let Z=function(Q){let ae=[Q[0],Q[1],Q[2]],te=[0,1,0],ce=r.Q.cross([],te,ae);return r.Q.cross(te,ae,ce),r.Q.squaredLength(te)===0&&(te=[0,1,0],r.Q.cross(ce,ae,te)),r.Q.normalize(ce,ce),r.Q.normalize(te,te),r.Q.normalize(ae,ae),[ce[0],ce[1],ce[2],0,te[0],te[1],te[2],0,ae[0],ae[1],ae[2],0,Q[0],Q[1],Q[2],1]}(V);r.a9.scale(M,M,[N,N,N*D]),r.a9.translate(M,M,[-x[0],-x[1],-x[2]]);let Y=r.a9.multiply([],h.globeMatrix,Z);return r.a9.multiply(Y,Y,M),r.a9.multiply(Y,Y,l),Y}(t,e,i);if(o>0){let l=function(h,g){let y=g.worldSize,x=Bo(1,0)*y*eh(g.center.lat,g.zoom)/Ly(y),E=Bo(1,g.center.lat)*y,I=r.a9.identity([]);return r.a9.rotateY(I,I,Si(g.center.lng)),r.a9.rotateX(I,I,Si(g.center.lat)),r.a9.translate(I,I,[0,0,zo]),r.a9.scale(I,I,[x,x,x*E]),r.a9.translate(I,I,[g.point.x-.5*y,g.point.y-.5*y,0]),r.a9.multiply(I,I,h),r.a9.multiply(I,g.globeMatrix,I)}(t,e);return function(h,g,y){let x=(P,L,N)=>{let V=r.Q.length(P),Z=r.Q.length(L),Y=nc(P,L,N);return r.Q.scale(Y,Y,1/r.Q.length(Y)*si(V,Z,N))},E=x([h[0],h[1],h[2]],[g[0],g[1],g[2]],y),I=x([h[4],h[5],h[6]],[g[4],g[5],g[6]],y),M=x([h[8],h[9],h[10]],[g[8],g[9],g[10]],y),D=nc([h[12],h[13],h[14]],[g[12],g[13],g[14]],y);return[E[0],E[1],E[2],0,I[0],I[1],I[2],0,M[0],M[1],M[2],0,D[0],D[1],D[2],1]}(a,l,o)}return a}function Cw(t,e,i,o){let a=On.projectAabbCorners(o,i),l=Number.MAX_VALUE,h=-1;for(let x=0;x<a.length;++x){let E=a[x];E[0]=(.5*E[0]+.5)*e.width,E[1]=(.5-.5*E[1])*e.height,E[2]<l&&(h=x,l=E[2])}let g=x=>new ct(a[x][0],a[x][1]),y;switch(h){case 0:case 6:y=[g(1),g(5),g(4),g(7),g(3),g(2),g(1)];break;case 1:case 7:y=[g(0),g(4),g(5),g(6),g(2),g(3),g(0)];break;case 3:case 5:y=[g(1),g(0),g(4),g(7),g(6),g(2),g(1)];break;default:y=[g(1),g(5),g(6),g(7),g(3),g(0),g(1)]}if(Iy(t,y))return l}let gD=oi([{name:"a_pos_3f",components:3,type:"Float32"}]),_D=oi([{name:"a_color_3f",components:3,type:"Float32"}]),yD=oi([{name:"a_color_4f",components:4,type:"Float32"}]),vD=oi([{name:"a_uv_2f",components:2,type:"Float32"}]),bD=oi([{name:"a_normal_3f",components:3,type:"Float32"}]),xD=oi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),wD=oi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class Dg{constructor(e,i,o,a){this.message=(e?`${e}: `:"")+o,a&&(this.identifier=a),i!=null&&i.__line__&&(this.line=i.__line__)}}function Aw(t,e){let i=t.indexOf("://")===-1;try{return new URL(t,i&&e?"http://example.com":void 0),!0}catch{return!1}}class Dw{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Rw{constructor(){this.instancedDataArray=new uy,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class dv{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1}populate(e,i,o,a){this.tileToMeter=Um(o);let l=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:h,id:g,index:y,sourceLayerIndex:x}of e){let E=g??(h.properties&&h.properties.hasOwnProperty("id")?h.properties.id:void 0),I=Nc(h,l);if(!this.layers[0]._featureFilter.filter(new $(this.zoom),I,o))continue;let M={id:E,sourceLayerIndex:x,index:y,geometry:l?I.geometry:ic(h,o,a),properties:h.properties,type:h.type,patterns:{}},D=this.addFeature(M,M.geometry,I);D&&i.featureIndex.insert(h,M.geometry,y,x,this.index,this.instancesPerModel[D].instancedDataArray.length,pt/32)}this.lookup=null}update(e,i,o,a){for(let l in this.instancesPerModel){let h=this.instancesPerModel[l];for(let g in e)h.idToFeaturesIndex.hasOwnProperty(g)&&(this.evaluate(h.features[h.idToFeaturesIndex[g]],e[g],h,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let i in this.instancesPerModel){let o=this.instancesPerModel[i];for(let a of o.features){let l=this.layers[0],h=a.feature,g=this.canonical,y=l.paint.get("model-rotation").evaluate(h,{},g),x=l.paint.get("model-scale").evaluate(h,{},g),E=l.paint.get("model-translation").evaluate(h,{},g);r.Q.exactEquals(a.rotation,y)&&r.Q.exactEquals(a.scale,x)&&r.Q.exactEquals(a.translation,E)||(this.evaluate(a,a.featureStates,o,!0),e=!0)}}return e}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let i in this.instancesPerModel){let o=this.instancesPerModel[i];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,xD.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let i in this.instancesPerModel){let o=this.instancesPerModel[i];o.instancedDataArray.length!==0&&o.instancedDataBuffer&&o.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris)for(let i of this.modelUris)e.removeModel(i,"")}addFeature(e,i,o){let a=this.layers[0],l=a.layout.get("model-id").evaluate(o,{},this.canonical);if(!l)return Mn(`modelId is not evaluated for layer ${a.id} and it is not going to get rendered.`),l;Aw(l,!1)&&(this.modelUris.includes(l)||this.modelUris.push(l)),this.instancesPerModel[l]||(this.instancesPerModel[l]=new Rw);let h=this.instancesPerModel[l],g=h.instancedDataArray,y=new Dw(o,g.length);for(let x of i)for(let E of x){if(E.x<0||E.x>=pt||E.y<0||E.y>=pt)continue;let I=(this.lookupDim-1)/pt,M=this.lookupDim*(E.y*I|0)+E.x*I|0;if(this.lookup){if(this.lookup[M]!==0)continue;this.lookup[M]=1}this.instanceCount++;let D=g.length;g.resize(D+1),h.instancesEvaluatedElevation.push(0),g.float32[16*D]=E.x,g.float32[16*D+1]=E.y}return y.instancedDataCount=h.instancedDataArray.length-y.instancedDataOffset,y.instancedDataCount>0&&(e.id&&(h.idToFeaturesIndex[e.id]=h.features.length),h.features.push(y),this.evaluate(y,{},h,!1)),l}getModelUris(){return this.modelUris}evaluate(e,i,o,a){let l=this.layers[0],h=e.feature,g=this.canonical,y=e.rotation=l.paint.get("model-rotation").evaluate(h,i,g),x=e.scale=l.paint.get("model-scale").evaluate(h,i,g),E=e.translation=l.paint.get("model-translation").evaluate(h,i,g),I=l.paint.get("model-color").evaluate(h,i,g);I.a=l.paint.get("model-color-mix-intensity").evaluate(h,i,g);let M=[];this.maxVerticalOffset<E[2]&&(this.maxVerticalOffset=E[2]),this.maxScale=Math.max(Math.max(this.maxScale,x[0]),Math.max(x[1],x[2])),Mw(M,y,x);let D=Math.round(100*I.a)+I.b/1.05;for(let P=0;P<e.instancedDataCount;++P){let L=e.instancedDataOffset+P,N=16*L,V=o.instancedDataArray.float32,Z=0;a&&(Z=V[N+6]-o.instancesEvaluatedElevation[L]);let Y=0|V[N+1];V[N]=(0|V[N])+I.r/1.05,V[N+1]=Y+I.g/1.05,V[N+2]=D,V[N+3]=1/(g.z>10?this.tileToMeter:Um(g,Y)),V[N+4]=E[0],V[N+5]=E[1],V[N+6]=E[2]+Z,V[N+7]=M[0],V[N+8]=M[1],V[N+9]=M[2],V[N+10]=M[4],V[N+11]=M[5],V[N+12]=M[6],V[N+13]=M[8],V[N+14]=M[9],V[N+15]=M[10],o.instancesEvaluatedElevation[L]=E[2]}}}bt(dv,"ModelBucket",{omit:["layers"]}),bt(Rw,"PerModelAttributes"),bt(Dw,"ModelFeature");let TD=new ye({visibility:new pe(re.layout_model.visibility),"model-id":new xe(re.layout_model["model-id"])});var ED={paint:new ye({"model-opacity":new pe(re.paint_model["model-opacity"]),"model-rotation":new xe(re.paint_model["model-rotation"]),"model-scale":new xe(re.paint_model["model-scale"]),"model-translation":new xe(re.paint_model["model-translation"]),"model-color":new xe(re.paint_model["model-color"]),"model-color-mix-intensity":new xe(re.paint_model["model-color-mix-intensity"]),"model-type":new pe(re.paint_model["model-type"]),"model-cast-shadows":new pe(re.paint_model["model-cast-shadows"]),"model-receive-shadows":new pe(re.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new pe(re.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new xe(re.paint_model["model-emissive-strength"]),"model-roughness":new xe(re.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new xe(re.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new pe(re.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new pe(re.paint_model["model-front-cutoff"])}),layout:TD};let nh=64,Md={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Pw(t,e,i,o,a,l,h,g,y,x=!1){let E=i.zoom,I=i.project(o),M=eh(o.lat,E),D=1/M;r.a9.identity(t),r.a9.translate(t,t,[I.x+h[0]*D,I.y+h[1]*D,h[2]]);let P=1,L=1,N=i.worldSize;if(x){if(i.projection.name==="mercator"){let Q=0;i.elevation&&(Q=i.elevation.getAtPointOrZero(new so(I.x/N,I.y/N),0));let ae=r.aa.transformMat4([],[I.x,I.y,Q,1],i.projMatrix)[3]/i.cameraToCenterDistance;P=ae,L=ae*eh(i.center.lat,E)}else if(i.projection.name==="globe"){let Q=hv(t,i),ae=r.a9.multiply([],i.projMatrix,Q),te=[0,0,0,1];r.aa.transformMat4(te,te,ae);let ce=te[3]/i.cameraToCenterDistance,he=Vc(E),be=i.projection.pixelsPerMeter(o.lat,N)*eh(o.lat,E),Pe=i.projection.pixelsPerMeter(i.center.lat,N)*eh(i.center.lat,E);P=ce/si(be,vx(i.center.lat),he),L=ce*M/be,P*=Pe,L*=Pe}}else P=D;r.a9.scale(t,t,[P,P,L]);let V=[...t],Z=e.orientation,Y=[];if(Mw(Y,[Z[0]+a[0],Z[1]+a[1],Z[2]+a[2]],l),r.a9.multiply(t,V,Y),g&&i.elevation){let Q=0,ae=[];if(y&&i.elevation){Q=function(he,be,Pe,Te,Le){let Oe=be.elevation;if(!Oe)return 0;let ke=On.projectAabbCorners(Pe,Te),$e=Bo(1,Le.lat)*be.worldSize,qe=function(Bt,ai){let Qt=[0,0,1],hi=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let li of hi){let vi=Bt[li.corners[0]],$t=Bt[li.corners[1]],ln=Bt[li.corners[2]],on=[$t[0]-vi[0],$t[1]-vi[1],ai*($t[2]-vi[2])],Ui=r.Q.cross(on,on,[ln[0]-vi[0],ln[1]-vi[1],ai*(ln[2]-vi[2])]);r.Q.normalize(Ui,Ui),li.dotProductWithUp=r.Q.dot(Ui,Qt)}return hi.sort((li,vi)=>li.dotProductWithUp-vi.dotProductWithUp),hi[0].corners}(ke,$e),Xe=ke[qe[0]],Qe=ke[qe[1]],Fe=ke[qe[2]],It=ke[qe[3]],yt=Oe.getAtPointOrZero(new so(Xe[0]/be.worldSize,Xe[1]/be.worldSize),0),Ke=Oe.getAtPointOrZero(new so(Qe[0]/be.worldSize,Qe[1]/be.worldSize),0),Ut=Oe.getAtPointOrZero(new so(Fe[0]/be.worldSize,Fe[1]/be.worldSize),0),Pt=Oe.getAtPointOrZero(new so(It[0]/be.worldSize,It[1]/be.worldSize),0),St=(yt+Pt)/2,Je=(Ke+Ut)/2;return St>Je?Ke<Ut?Ag(he,Qe,It,Xe,Ke,Pt,yt,$e):Ag(he,Fe,Xe,It,Ut,yt,Pt,$e):yt<Pt?Ag(he,Xe,Qe,Fe,yt,Ke,Ut,$e):Ag(he,It,Fe,Qe,Pt,Ut,Ke,$e),Math.max(St,Je)}(ae,i,e.aabb,t,o);let te=r.a9.fromQuat([],ae),ce=r.a9.multiply([],te,Y);r.a9.multiply(t,V,ce)}else Q=i.elevation.getAtPointOrZero(new so(I.x/N,I.y/N),0);Q!==0&&(t[14]+=Q)}}function af(t,e,i=!1){t.uploaded||(t.gfxTexture=new cv(e,t.image,i?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function ID(t,e,i){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,gD.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,bD.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,vD.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?_D:yD).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,wD.members,!0)),t.segments=er.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);let o=t.material;o.pbrMetallicRoughness.baseColorTexture&&af(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&af(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&af(o.normalTexture,e),o.occlusionTexture&&af(o.occlusionTexture,e,i),o.emissionTexture&&af(o.emissionTexture,e)}function pv(t,e,i){if(t.meshes)for(let o of t.meshes)ID(o,e,i);if(t.children)for(let o of t.children)pv(o,e,i)}function Rg(t){if(t.meshes)for(let e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(let e of t.children)Rg(e)}function fv(t){if(t.meshes)for(let i of t.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(let i of t.children)fv(i)}class SD{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class MD{constructor(){this.tasks={},this.taskQueue=[],Do(["process"],this),this.invoker=new SD(this.process),this.nextId=0}add(e,i){let o=this.nextId++,a=function({type:l,isSymbolTile:h,zoom:g}){return g=g||0,l==="message"?0:l!=="maybePrepare"||h?l!=="parseTile"||h?l==="parseTile"&&h?300-g:l==="maybePrepare"&&h?400-g:500:200-g:100-g}(i);if(a===0){cs();try{e()}finally{}return null}return this.tasks[o]={fn:e,metadata:i,priority:a,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){cs();try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let a=0;a<this.taskQueue.length;a++){let l=this.tasks[this.taskQueue[a]];l.priority<i&&(i=l.priority,e=a)}if(e===null)return null;let o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class kw{constructor(e,i,o){this.target=e,this.parent=i,this.mapId=o,this.callbacks={},this.cancelCallbacks={},Do(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new MD}send(e,i,o,a,l=!1,h){let g=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=h,this.callbacks[g]=o);let y=new Set;return this.target.postMessage({id:g,type:e,hasCallback:!!o,targetMapId:a,mustQueue:l,sourceMapId:this.mapId,data:$u(i,y)},y),{cancel:()=>{o&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(e){let i=e.data,o=i.id;if(o&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){let a=this.cancelCallbacks[o];delete this.cancelCallbacks[o],a&&a.cancel()}else if(i.mustQueue||cs()){let a=this.callbacks[o],l=this.scheduler.add(()=>this.processTask(o,i),a&&a.metadata||{type:"message"});l&&(this.cancelCallbacks[o]=l)}else this.processTask(o,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){let o=this.callbacks[e];delete this.callbacks[e],o&&(i.error?o(c(i.error)):o(null,c(i.data)))}else{let o=new Set,a=i.hasCallback?(h,g)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:h?$u(h):null,data:$u(g,o)},o)}:h=>{},l=c(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,l,a);else if(this.parent.getWorkerSource){let h=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,h[0],l.source,l.scope)[h[1]](l,a)}else a(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let mv=(()=>{class t{constructor(i,o){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=zi();let a=this.workerPool.acquire(this.id);for(let l=0;l<a.length;l++){let h=new t.Actor(a[l],o,this.id);h.name=`Worker ${l}`,this.actors.push(h)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,o,a){pc(this.actors,(l,h)=>{l.send(i,o,h)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=kw,t})();var lf={workerUrl:"",workerClass:null,workerParams:void 0};function CD(){return lf.workerClass!=null?new lf.workerClass:new self.Worker(lf.workerUrl,lf.workerParams)}let gv="mapboxgl_preloaded_worker_pool";class cf{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<cf.workerCount;)this.workers.push(new CD);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[gv]}numActive(){return Object.keys(this.active).length}}let uf;function Pg(){return uf||(uf=new cf),uf}cf.workerCount=2;let kg,_v,Xa,Cd,yv,Ad=null;function Ow(){return cs()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:_v||ee.DRACO_URL}function Lw(){if(cs()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Cd)return Cd;let t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Cd=WebAssembly.validate(t)?ee.MESHOPT_SIMD_URL:ee.MESHOPT_URL,Cd}let Og={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},AD={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},hf={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Fw(t,e,i){let o=i.json.bufferViews.length,a=i.buffers.length;e.bufferView=o,i.json.bufferViews[o]={buffer:a,byteLength:t.byteLength},i.buffers[a]=t}let vv="KHR_draco_mesh_compression";function DD(t,e){let i=t.extensions&&t.extensions[vv];if(!i)return;let o=new Xa.Decoder,a=Vw(e,i.bufferView),l=new Xa.Mesh;if(!o.DecodeArrayToMesh(a,a.byteLength,l))throw new Error("Failed to decode Draco mesh");let h=e.json.accessors[t.indices],g=Og[h.componentType],y=h.count*g.BYTES_PER_ELEMENT,x=Xa._malloc(y);g===Uint16Array?o.GetTrianglesUInt16Array(l,y,x):o.GetTrianglesUInt32Array(l,y,x),Fw(Xa.memory.buffer.slice(x,x+y),h,e),Xa._free(x);for(let E of Object.keys(i.attributes)){let I=o.GetAttributeByUniqueId(l,i.attributes[E]),M=e.json.accessors[t.attributes[E]],D=AD[M.componentType],P=M.count*hf[M.type]*Og[M.componentType].BYTES_PER_ELEMENT,L=Xa._malloc(P);o.GetAttributeDataArrayForAllPoints(l,I,Xa[D],P,L),Fw(Xa.memory.buffer.slice(L,L+P),M,e),Xa._free(L)}o.destroy(),l.destroy(),delete t.extensions[vv]}let Lg="EXT_meshopt_compression";function RD(t,e){if(!t.extensions||!t.extensions[Lg])return;let i=t.extensions[Lg],o=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),a=new Uint8Array(i.count*i.byteStride);yv.decodeGltfBuffer(a,i.count,i.byteStride,o,i.mode,i.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=a.buffer,delete t.extensions[Lg]}let zw=1179937895,Bw=new TextDecoder("utf8");function Nw(t,e){return new URL(t,e).href}function PD(t,e,i,o){return fetch(Nw(t.uri,o)).then(a=>a.arrayBuffer()).then(a=>{e.buffers[i]=a})}function Vw(t,e){let i=t.json.bufferViews[e];return new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function kD(t,e,i,o){if(t.uri){let a=Nw(t.uri,o);return fetch(a).then(l=>l.blob()).then(l=>createImageBitmap(l)).then(l=>{e.images[i]=l})}if(t.bufferView!==void 0){let a=Vw(e,t.bufferView),l=new Blob([a],{type:t.mimeType});return createImageBitmap(l).then(h=>{e.images[i]=h})}}function jw(t,e=0,i){let o={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===zw){let E=new Uint32Array(t,e),I=2,M=(E[I++]>>2)-3,D=E[I++]>>2;if(I++,o.json=JSON.parse(Bw.decode(E.subarray(I,I+D))),I+=D,I<M){let P=E[I++];I++;let L=e+(I<<2);o.buffers[0]=t.slice(L,L+P)}}else o.json=JSON.parse(Bw.decode(new Uint8Array(t,e)));let{buffers:a,images:l,meshes:h,extensionsUsed:g,bufferViews:y}=o.json,x=Promise.resolve();if(a){let E=[];for(let I=0;I<a.length;I++){let M=a[I];M.uri?E.push(PD(M,o,I,i)):o.buffers[I]||(o.buffers[I]=null)}x=Promise.all(E)}return x.then(()=>{let E=[],I=g&&g.includes(vv),M=g&&g.includes(Lg);if(I&&E.push(function(){if(!Xa)return kg||(kg=function(D){let P,L=null;function N(){P=new Uint8Array(L.buffer)}function V(){throw new Error("Unexpected Draco error.")}let Z={a:{a:V,d:function(Y,Q,ae){return P.copyWithin(Y,Q,Q+ae)},c:function(Y){let Q=P.length,ae=Math.max(Y>>>0,Math.ceil(1.2*Q)),te=Math.ceil((ae-Q)/65536);try{return L.grow(te),N(),!0}catch{return!1}},b:V}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(D,Z):D.then(Y=>Y.arrayBuffer()).then(Y=>WebAssembly.instantiate(Y,Z))).then(Y=>{let{Rb:Q,Qb:ae,P:te,T:ce,X:he,Ja:be,La:Pe,Qa:Te,Va:Le,Wa:Oe,eb:ke,jb:$e,f:qe,e:Xe,yb:Qe,zb:Fe,Ab:It,Bb:yt,Db:Ke,Gb:Ut}=Y.instance.exports;L=Xe;let Pt=(()=>{let St=0,Je=0,Bt=0,ai=0;return Qt=>{Bt&&(Q(ai),Q(St),Je+=Bt,Bt=St=0),St||(Je+=128,St=ae(Je));let hi=Qt.length+7&-8,li=St;hi>=Je&&(Bt=hi,li=ai=ae(hi));for(let vi=0;vi<Qt.length;vi++)P[li+vi]=Qt[vi];return li}})();return N(),qe(),{memory:Xe,_free:Q,_malloc:ae,Mesh:class{constructor(){this.ptr=te()}destroy(){ce(this.ptr)}},Decoder:class{constructor(){this.ptr=be()}destroy(){$e(this.ptr)}DecodeArrayToMesh(St,Je,Bt){let ai=Pt(St),Qt=Pe(this.ptr,ai,Je,Bt.ptr);return!!he(Qt)}GetAttributeByUniqueId(St,Je){return{ptr:Te(this.ptr,St.ptr,Je)}}GetTrianglesUInt16Array(St,Je,Bt){Le(this.ptr,St.ptr,Je,Bt)}GetTrianglesUInt32Array(St,Je,Bt){Oe(this.ptr,St.ptr,Je,Bt)}GetAttributeDataArrayForAllPoints(St,Je,Bt,ai,Qt){ke(this.ptr,St.ptr,Je.ptr,Bt,ai,Qt)}},DT_INT8:Qe(),DT_UINT8:Fe(),DT_INT16:It(),DT_UINT16:yt(),DT_UINT32:Ke(),DT_FLOAT32:Ut()}})}(fetch(Ow())),kg.then(D=>{Xa=D,kg=void 0}))}()),M&&E.push(function(){if(yv)return;let D=function(P){let L,N=WebAssembly.instantiateStreaming(P,{}).then(Y=>{L=Y.instance,L.exports.__wasm_call_ctors()}),V={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Z={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:N,supported:!0,decodeGltfBuffer(Y,Q,ae,te,ce,he){(function(be,Pe,Te,Le,Oe,ke,$e){let qe=be.exports.sbrk,Xe=Le+3&-4,Qe=qe(Xe*Oe),Fe=qe(ke.length),It=new Uint8Array(be.exports.memory.buffer);It.set(ke,Fe);let yt=Pe(Qe,Le,Oe,Fe,ke.length);if(yt===0&&$e&&$e(Qe,Xe,Oe),Te.set(It.subarray(Qe,Qe+Le*Oe)),qe(Qe-qe(0)),yt!==0)throw new Error(`Malformed buffer data: ${yt}`)})(L,L.exports[Z[ce]],Y,Q,ae,te,L.exports[V[he]])}}}(fetch(Lw()));return D.ready.then(()=>{yv=D})}()),l)for(let D=0;D<l.length;D++)E.push(kD(l[D],o,D,i));return(E.length?Promise.all(E):Promise.resolve()).then(()=>{if(I&&h)for(let{primitives:D}of h)for(let P of D)DD(P,o);if(M&&h&&y)for(let D of y)RD(D,o);return o})})}class Uw{constructor(e,i,o,a){if(this.triangleCount=i.length/3,this.min=new ct(0,0),this.max=new ct(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[l,h]=[e[0].clone(),e[0].clone()];for(let I=1;I<e.length;++I){let M=e[I];l.x=Math.min(l.x,M.x),l.y=Math.min(l.y,M.y),h.x=Math.max(h.x,M.x),h.y=Math.max(h.y,M.y)}if(a){let I=Math.ceil(Math.max(h.x-l.x,h.y-l.y)/a);o=Math.max(o,I)}if(o===0)return;this.min=l,this.max=h;let g=this.max.sub(this.min);g.x=Math.max(g.x,1),g.y=Math.max(g.y,1);let y=Math.max(g.x,g.y)/o;this.cellsX=Math.max(1,Math.ceil(g.x/y)),this.cellsY=Math.max(1,Math.ceil(g.y/y)),this.xScale=1/y,this.yScale=1/y;let x=[];for(let I=0;I<this.triangleCount;I++){let M=e[i[3*I+0]].sub(this.min),D=e[i[3*I+1]].sub(this.min),P=e[i[3*I+2]].sub(this.min),L=Hc(Math.floor(Math.min(M.x,D.x,P.x)),this.xScale,this.cellsX),N=Hc(Math.floor(Math.max(M.x,D.x,P.x)),this.xScale,this.cellsX),V=Hc(Math.floor(Math.min(M.y,D.y,P.y)),this.yScale,this.cellsY),Z=Hc(Math.floor(Math.max(M.y,D.y,P.y)),this.yScale,this.cellsY),Y=new ct(0,0),Q=new ct(0,0),ae=new ct(0,0),te=new ct(0,0);for(let ce=V;ce<=Z;++ce){Y.y=Q.y=ce*y,ae.y=te.y=(ce+1)*y;for(let he=L;he<=N;++he)Y.x=ae.x=he*y,Q.x=te.x=(he+1)*y,(Cy(M,D,P,Y,Q,te)||Cy(M,D,P,Y,te,ae))&&x.push({cellIdx:ce*this.cellsX+he,triIdx:I})}}if(x.length===0)return;x.sort((I,M)=>I.cellIdx-M.cellIdx||I.triIdx-M.triIdx);let E=0;for(;E<x.length;){let I=x[E].cellIdx,M={start:this.payload.length,len:0};for(;E<x.length&&x[E].cellIdx===I;)++M.len,this.payload.push(x[E++].triIdx);this.cells[I]=M}}query(e,i,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let y=0;y<this.lookup.length;y++)this.lookup[y]=0;let a=Hc(e.x-this.min.x,this.xScale,this.cellsX),l=Hc(i.x-this.min.x,this.xScale,this.cellsX),h=Hc(e.y-this.min.y,this.yScale,this.cellsY),g=Hc(i.y-this.min.y,this.yScale,this.cellsY);for(let y=h;y<=g;y++)for(let x=a;x<=l;x++){let E=this.cells[y*this.cellsX+x];if(E)for(let I=0;I<E.len;I++){let M=this.payload[E.start+I],D=Math.floor(M/8),P=1<<M%8;if(!(this.lookup[D]&P)&&(this.lookup[D]|=P,o.push(M),o.length===this.triangleCount))return}}}}function Hc(t,e,i){return Math.max(0,Math.min(i-1,Math.floor(t*e)))}function rh(t,e){let i=t.json.bufferViews[e.bufferView],o=Og[e.componentType];return new o(t.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==hf[e.type]*o.BYTES_PER_ELEMENT?i.byteStride/o.BYTES_PER_ELEMENT:hf[e.type]))}function bv(t,e,i,o){let a=Og[e.componentType],l=function(E){switch(E){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(a),h=t.json.bufferViews[e.bufferView],g=h.byteStride?h.byteStride/a.BYTES_PER_ELEMENT:hf[e.type],y=i.float32,x=y.length/i.capacity;for(let E=0,I=0;E<e.count*g;E+=g,I+=x)for(let M=0;M<x;M++)y[I+M]=o[E+M]*l;i._trim()}function OD(t,e,i){let o=t.indices,a=t.attributes,l={};l.indexArray=new Mr;let h=e.json.accessors[o],g=h.count/3;l.indexArray.reserve(g);let y=rh(e,h);for(let M=0;M<g;M++)l.indexArray.emplaceBack(y[3*M],y[3*M+1],y[3*M+2]);l.indexArray._trim(),l.vertexArray=new Xu;let x=e.json.accessors[a.POSITION];l.vertexArray.reserve(x.count);let E=rh(e,x);for(let M=0;M<x.count;M++)l.vertexArray.emplaceBack(E[3*M],E[3*M+1],E[3*M+2]);if(l.vertexArray._trim(),l.aabb=new On(x.min,x.max),l.centroid=function(M,D){let P=[0,0,0],L=M.length;if(L>0){for(let N=0;N<L;N++){let V=3*M[N];P[0]+=D[V],P[1]+=D[V+1],P[2]+=D[V+2]}P[0]/=L,P[1]/=L,P[2]/=L}return P}(y,E),a.COLOR_0!==void 0){let M=e.json.accessors[a.COLOR_0],D=hf[M.type],P=rh(e,M);l.colorArray=D===3?new Xu:new Sr,l.colorArray.resize(M.count),bv(e,M,l.colorArray,P)}if(a.NORMAL!==void 0){l.normalArray=new Xu;let M=e.json.accessors[a.NORMAL];l.normalArray.resize(M.count);let D=rh(e,M);bv(e,M,l.normalArray,D)}if(a.TEXCOORD_0!==void 0&&i.length>0){l.texcoordArray=new Nr;let M=e.json.accessors[a.TEXCOORD_0];l.texcoordArray.resize(M.count);let D=rh(e,M);bv(e,M,l.texcoordArray,D)}if(a._FEATURE_ID_RGBA4444!==void 0){let M=e.json.accessors[a._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(l.featureData=rh(e,M))}a._FEATURE_RGBA4444!==void 0&&(l.featureData=new Uint32Array(rh(e,e.json.accessors[a._FEATURE_RGBA4444]).buffer));let I=t.material;return l.material=function(M,D){let{emissiveFactor:P=[0,0,0],alphaMode:L="OPAQUE",alphaCutoff:N=.5,normalTexture:V,occlusionTexture:Z,emissiveTexture:Y,doubleSided:Q}=M,{baseColorFactor:ae=[1,1,1,1],metallicFactor:te=1,roughnessFactor:ce=1,baseColorTexture:he,metallicRoughnessTexture:be}=M.pbrMetallicRoughness||{},Pe=Z?D[Z.index]:void 0;if(Z&&Z.extensions&&Z.extensions.KHR_texture_transform&&Pe){let Te=Z.extensions.KHR_texture_transform;Pe.offsetScale=[Te.offset[0],Te.offset[1],Te.scale[0],Te.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Wi(...ae),metallicFactor:te,roughnessFactor:ce,baseColorTexture:he?D[he.index]:void 0,metallicRoughnessTexture:be?D[be.index]:void 0},doubleSided:Q,emissiveFactor:P,alphaMode:L,alphaCutoff:N,normalTexture:V?D[V.index]:void 0,occlusionTexture:Pe,emissionTexture:Y?D[Y.index]:void 0,defined:M.defined===void 0}}(I!==void 0?e.json.materials[I]:{defined:!1},i),l}function Gw(t,e,i){let{matrix:o,rotation:a,translation:l,scale:h,mesh:g,extras:y,children:x}=t,E={};if(E.matrix=o||r.a9.fromRotationTranslationScale([],a||[0,0,0,1],l||[0,0,0],h||[1,1,1]),g!==void 0){E.meshes=i[g];let I=E.anchor=[0,0];for(let M of E.meshes){let{min:D,max:P}=M.aabb;I[0]+=D[0]+P[0],I[1]+=D[1]+P[1]}I[0]=Math.floor(I[0]/E.meshes.length/2),I[1]=Math.floor(I[1]/E.meshes.length/2)}if(y&&(y.id&&(E.id=y.id),y.lights&&(E.lights=function(I){if(!I.length)return[];let M=function(V){let Z=atob(V),Y=new Uint8Array(Z.length);for(let Q=0;Q<Z.length;Q++)Y[Q]=Z.codePointAt(Q);return Y}(I),D=[],P=M.length/24,L=new Uint16Array(M.buffer),N=new Float32Array(M.buffer);for(let V=0;V<P;V++){let Z=L[2*V*6]/30,Y=L[2*V*6+1]/30,Q=L[2*V*6+10]/100,ae=N[6*V+1],te=N[6*V+2],ce=N[6*V+3],he=N[6*V+4],be=ce-ae,Pe=he-te,Te=Math.hypot(be,Pe);D.push({pos:[ae+.5*be,te+.5*Pe,Y],normal:[Pe/Te,-be/Te,0],width:Te,height:Z,depth:Q,points:[ae,te,ce,he]})}return D}(y.lights))),x){let I=[];for(let M of x)I.push(Gw(e.json.nodes[M],e,i));E.children=I}return E}function LD(t){if(t.vertices.length===0||t.indices.length===0)return null;let e=new Uw(t.vertices,t.indices,8,256),[i,o]=[e.min.clone(),e.max.clone()];return{vertices:t.vertices,indices:t.indices,grid:e,min:i,max:o}}function FD(t){if(!t.extras||!t.extras.ground)return null;let e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;let o=[];for(let h of i){if(!Array.isArray(h)||h.length!==2)continue;let g=h[0],y=h[1];typeof g=="number"&&typeof y=="number"&&o.push(new ct(g,y))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let a=0;for(let h=0;h<o.length;h++){let g=o[h],y=o[(h+1)%o.length],x=o[(h+2)%o.length];a+=(g.x-y.x)*(x.y-y.y)-(x.x-y.x)*(g.y-y.y)}a>0&&o.reverse();let l=tg(o.flatMap(h=>[h.x,h.y]),[]);return l.length===0?null:{vertices:o,indices:l}}function zD(t,e){let i=[],o=[],a=0,l=[];for(let h of t){a=i.length;let g=h.vertexArray.float32,y=h.indexArray.uint16;for(let x=0;x<h.vertexArray.length;x++)l[0]=g[3*x+0],l[1]=g[3*x+1],l[2]=g[3*x+2],r.Q.transformMat4(l,l,e),i.push(new ct(l[0],l[1]));for(let x=0;x<3*h.indexArray.length;x++)o.push(y[x]+a)}if(o.length%3!=0)return null;for(let h=0;h<o.length;h+=3){let g=i[o[h+0]],y=i[o[h+1]],x=i[o[h+2]];(g.x-y.x)*(x.y-y.y)-(x.x-y.x)*(g.y-y.y)>0&&([o[h+1],o[h+2]]=[o[h+2],o[h+1]])}return{vertices:i,indices:o}}function qw(t){let e=function(y,x){let E=[],I=WebGL2RenderingContext;if(y.json.textures)for(let M of y.json.textures){let D={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};M.sampler!==void 0&&Object.assign(D,y.json.samplers[M.sampler]),E.push({image:x[M.source],sampler:D,uploaded:!1})}return E}(t,t.images),i=function(y,x){let E=[];for(let I of y.json.meshes){let M=[];for(let D of I.primitives)M.push(OD(D,y,x));E.push(M)}return E}(t,e),{scenes:o,scene:a,nodes:l}=t.json,h=o?o[a||0].nodes:l,g=[];for(let y of h)g.push(Gw(l[y],t,i));return function(y,x,E){let I={},M=new Set;for(let D=0;D<y.length;D++){let P=E[x[D]];if(!P.extras)continue;let L=P.extras["mapbox:footprint:version"],N=P.extras["mapbox:footprint:id"];(L||N)&&M.add(D),L==="1.0.0"&&N&&(I[N]=D)}for(let D=0;D<y.length;D++){if(M.has(D))continue;let P=y[D],L=E[x[D]];if(!L.extras)continue;let N=null;P.id in I&&(N=zD(y[I[P.id]].meshes,P.matrix)),N||(N=FD(L)),N&&(P.footprint=LD(N))}if(M.size>0){let D=Array.from(M.values()).sort((P,L)=>P-L);for(let P=D.length-1;P>=0;P--)y.splice(D[P],1)}}(g,h,t.json.nodes),g}function BD(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);let e=t.vertexArray.float32,i=t.aabb.min[0]-1,o=t.aabb.min[1]-1,a=nh/(t.aabb.max[0]-i+2),l=nh/(t.aabb.max[1]-o+2);for(let h=0;h<e.length;h+=3){let g=e[h+2],y=(e[h+0]-i)*a|0,x=(e[h+1]-o)*l|0;g>t.heightmap[x*nh+y]&&(t.heightmap[x*nh+y]=g)}}function ND(t,e){let i={};i.indexArray=new Mr,i.indexArray.reserve(4*t.length),i.vertexArray=new Xu,i.vertexArray.reserve(10*t.length),i.colorArray=new Sr,i.vertexArray.reserve(10*t.length);let o=0;for(let h of t){let g=Math.min(10,Math.max(4,1.3*h.height))*e,y=[-h.normal[1],h.normal[0],0],x=Math.min(.29,.1*h.width/h.depth),E=h.width-2*h.depth*e*(x+.01),I=r.Q.scaleAndAdd([],h.pos,y,E/2),M=r.Q.scaleAndAdd([],h.pos,y,-E/2),D=[I[0],I[1],I[2]+h.height],P=[M[0],M[1],M[2]+h.height],L=r.Q.scaleAndAdd([],h.normal,y,x);r.Q.scale(L,L,g);let N=r.Q.scaleAndAdd([],h.normal,y,-x);r.Q.scale(N,N,g),r.Q.add(L,I,L),r.Q.add(N,M,N),I[2]+=.1,M[2]+=.1,i.vertexArray.emplaceBack(L[0],L[1],L[2]),i.vertexArray.emplaceBack(N[0],N[1],N[2]),i.vertexArray.emplaceBack(I[0],I[1],I[2]),i.vertexArray.emplaceBack(M[0],M[1],M[2]),i.vertexArray.emplaceBack(D[0],D[1],D[2]),i.vertexArray.emplaceBack(P[0],P[1],P[2]),i.vertexArray.emplaceBack(I[0],I[1],I[2]),i.vertexArray.emplaceBack(M[0],M[1],M[2]),i.vertexArray.emplaceBack(L[0],L[1],L[2]),i.vertexArray.emplaceBack(N[0],N[1],N[2]);let V=E/g/2;i.colorArray.emplaceBack(-V-x,-1,V,.8),i.colorArray.emplaceBack(V+x,-1,V,.8),i.colorArray.emplaceBack(-V,0,V,1.3),i.colorArray.emplaceBack(V,0,V,1.3),i.colorArray.emplaceBack(V+x,-.8,V,.7),i.colorArray.emplaceBack(V+x,-.8,V,.7),i.colorArray.emplaceBack(0,0,V,1.3),i.colorArray.emplaceBack(0,0,V,1.3),i.colorArray.emplaceBack(V+x,-1.2,V,.8),i.colorArray.emplaceBack(V+x,-1.2,V,.8),i.indexArray.emplaceBack(6+o,4+o,8+o),i.indexArray.emplaceBack(7+o,9+o,5+o),i.indexArray.emplaceBack(0+o,1+o,2+o),i.indexArray.emplaceBack(1+o,3+o,2+o),o+=10}let a={defined:!0,emissiveFactor:[0,0,0]},l={};return l.baseColorFactor=Wi.white,a.pbrMetallicRoughness=l,i.material=a,i.aabb=new On([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}bt(Uw,"TriangleGridIndex");class $w{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){let o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}let VD=["tile","layer","source","sourceLayer","state"];class Ww{constructor(e,i,o,a,l){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=o,this._y=a,this.properties=e.properties,this.id=l}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(let i of VD)this[i]!==void 0&&(e[i]=this[i]);return e}}class Zw{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Pc(pt,16,0),this.featureIndexArray=new lx,this.promoteId=i,this.is3DTile=!1}insert(e,i,o,a,l,h=0,g=0){let y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,a,l,h);let x=this.grid;for(let E=0;E<i.length;E++){let I=i[E],M=[1/0,1/0,-1/0,-1/0];for(let D=0;D<I.length;D++){let P=I[D];M[0]=Math.min(M[0],P.x),M[1]=Math.min(M[1],P.y),M[2]=Math.max(M[2],P.x),M[3]=Math.max(M[3],P.y)}g!==0&&(M[0]-=g,M[1]-=g,M[2]+=g,M[3]+=g),M[0]<pt&&M[1]<pt&&M[2]>=0&&M[3]>=0&&x.insert(y,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Wy(new wd(this.rawTileData)).layers,this.sourceLayerCoder=new $w(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,o,a){this.loadVTLayers();let l=e.params||{},h=gt(l.filter),g=e.tileResult,y=e.transform,x=g.bufferedTilespaceBounds,E=this.grid.query(x.min.x,x.min.y,x.max.x,x.max.y,(P,L,N,V)=>Sx(g.bufferedTilespaceGeometry,P,L,N,V));E.sort(jD);let I=null;y.elevation&&E.length>0&&(I=_d.create(y.elevation,this.tileID));let M={},D;for(let P=0;P<E.length;P++){let L=E[P];if(L===D)continue;D=L;let N=this.featureIndexArray.get(L),V=null;if(this.is3DTile){let Z=this.bucketLayerIDs[0][0],Y=i[Z];if(Y.type!=="model")continue;let{queryFeature:Q,intersectionZ:ae}=Y.queryIntersectsMatchingFeature(g,N.featureIndex,h,y);Q&&this.appendToResult(M,Z,N.featureIndex,Q,ae)}else this.loadMatchingFeature(M,N,h,l.layers,l.availableImages,i,o,a,(Z,Y,Q,ae=0)=>(V||(V=ic(Z,this.tileID.canonical,e.tileTransform)),Y.queryIntersectsFeature(g,Z,Q,V,this.z,e.transform,e.pixelPosMatrix,I,ae)))}return M}loadMatchingFeature(e,i,o,a,l,h,g,y,x){let{featureIndex:E,bucketIndex:I,sourceLayerIndex:M,layoutVertexArrayOffset:D}=i,P=this.bucketLayerIDs[I];if(a&&!function(Z,Y){for(let Q=0;Q<Z.length;Q++)if(Y.indexOf(Z[Q])>=0)return!0;return!1}(a,P))return;let L=this.sourceLayerCoder.decode(M),N=this.vtLayers[L].feature(E);if(o.needGeometry){let Z=Nc(N,!0);if(!o.filter(new $(this.tileID.overscaledZ),Z,this.tileID.canonical))return}else if(!o.filter(new $(this.tileID.overscaledZ),N))return;let V=this.getId(N,L);for(let Z=0;Z<P.length;Z++){let Y=P[Z];if(a&&a.indexOf(Y)<0)continue;let Q=h[Y];if(!Q)continue;let ae={};V!==void 0&&y&&(ae=y.getState(Q.sourceLayer||"_geojsonTileLayer",V));let te=!x||x(N,Q,ae,D);if(!te)continue;let ce=new Ww(N,this.z,this.x,this.y,V),he=bo({},g[Y]);he.paint=Hw(he.paint,Q.paint,N,ae,l),he.layout=Hw(he.layout,Q.layout,N,ae,l),ce.layer=he,this.appendToResult(e,Y,E,ce,te)}}appendToResult(e,i,o,a,l){let h=e[i];h===void 0&&(h=e[i]=[]),h.push({featureIndex:o,feature:a,intersectionZ:l})}lookupSymbolFeatures(e,i,o,a,l,h,g,y){let x={};this.loadVTLayers();let E=gt(l);for(let I of e)this.loadMatchingFeature(x,{bucketIndex:o,sourceLayerIndex:a,featureIndex:I,layoutVertexArrayOffset:0},E,h,g,y,i);return x}loadFeature(e){let{featureIndex:i,sourceLayerIndex:o}=e;this.loadVTLayers();let a=this.sourceLayerCoder.decode(o),l=this.vtFeatures[a];if(l[i])return l[i];let h=this.vtLayers[a].feature(i);return l[i]=h,h}hasLayer(e){for(let i of this.bucketLayerIDs)for(let o of i)if(e===o)return!0;return!1}getId(e,i){let o=e.id;if(this.promoteId){let a=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];a!=null&&(o=e.properties[a]),typeof o=="boolean"&&(o=Number(o))}return o}}function Hw(t,e,i,o,a){return Aa(t,(l,h)=>{let g=e instanceof Re?e.get(h):null;return g&&g.evaluate?g.evaluate(i,o,a):g})}function jD(t,e){return e-t}bt(Zw,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let xv=new Float32Array(262144),oh=new Uint8Array(262144);function Qw(t){let e=0;if(t.meshes)for(let i of t.meshes)e=Math.max(e,i.aabb.max[2]);if(t.children)for(let i of t.children)e=Math.max(e,Qw(i));return e}function Xw(t,e,i){if(t.meshes)for(let o of t.meshes)o.aabb.min[0]!==1/0&&i.insert(e,o.aabb.min[0],o.aabb.min[1],o.aabb.max[0],o.aabb.max[1]);if(t.children)for(let o of t.children)Xw(o,e,i)}let Yw=["","wall","door","roof","window","lamp","logo"];class Kw{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Qw(e)}}}getLocalBounds(){if(!this.node.meshes)return new On([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,i=new On([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let o of this.node.meshes)this.node.lightMeshIndex!==e&&i.encapsulate(o.aabb),e++;this.aabb=On.applyTransform(i,this.node.matrix)}return this.aabb}}class Fg{constructor(e,i,o,a,l,h){this.id=i,this.modelTraits|=Md.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,o&&(this.modelTraits|=Md.HasMapboxMeshFeatures),a&&(this.modelTraits|=Md.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=l,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let g of e)this.nodesInfo.push(new Kw(g)),Xw(g,h.featureIndexArray.length,h.grid),h.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,h.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let i=this.getNodesInfo();for(let o of i){let a=o.node;this.uploaded?this.updatePbrBuffer(a):pv(a,e,!0)}for(let o of i)Rg(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(let o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),i=!0);return i}needsReEvaluation(e,i,o){let a=e.transform.projectionOptions,l=e.style.getBrightness(),h=this.brightness!==l;return!!(!this.uploaded||this.dirty||a.name!==this.projection.name||df(o.paint.get("model-color").value,h)||df(o.paint.get("model-color-mix-intensity").value,h)||df(o.paint.get("model-roughness").value,h)||df(o.paint.get("model-emissive-strength").value,h)||df(o.paint.get("model-height-based-emissive-strength-multiplier").value,h))&&(this.projection=a,this.brightness=l,!0)}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let o=this.getNodesInfo(),a=this.id.canonical;for(let l of o){let h=l.feature;l.evaluatedScale=i.paint.get("model-scale").evaluate(h,{},a)}}evaluate(e){let i=this.getNodesInfo();for(let o of i){if(!o.node.meshes)continue;let a=o.feature,l=o.node.meshes&&o.node.meshes[0].featureData,h=o.evaluatedColor[2],g=o.evaluatedRMEA[2],y=this.id.canonical;if(o.hasTranslucentParts=!1,l){for(let x=0;x<Yw.length;x++){let E=Yw[x];E.length&&(a.properties.part=E);let I=e.paint.get("model-color").evaluate(a,{},y),M=e.paint.get("model-color-mix-intensity").evaluate(a,{},y);o.evaluatedColor[x]=[I.r,I.g,I.b,M],o.evaluatedRMEA[x][0]=e.paint.get("model-roughness").evaluate(a,{},y),o.evaluatedRMEA[x][2]=e.paint.get("model-emissive-strength").evaluate(a,{},y),o.evaluatedRMEA[x][3]=I.a,o.emissionHeightBasedParams[x]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(a,{},y),!o.hasTranslucentParts&&I.a<1&&(o.hasTranslucentParts=!0)}delete a.properties.part,GD(o,h!==o.evaluatedColor[2]||g!==o.evaluatedRMEA[2],this.modelTraits)}else o.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(a,{},y);o.evaluatedScale=e.paint.get("model-scale").evaluate(a,{},y),this.updatePbrBuffer(o.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,o,a){let l=e.findDEMTileFor(o);if(l&&(l.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(l.dem&&l.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=l.tileID.overscaledZ;let h=_d.create(e,o,l);if(!h)return;this.modelTraits&Md.HasMapboxMeshFeatures&&this.updateDEM(e,h,o,a);for(let g of this.getNodesInfo()){let y=g.node;if(!y.footprint||!y.footprint.vertices||!y.footprint.vertices.length)continue;let x=y.footprint.vertices,E=h.getElevationAt(x[0].x,x[0].y,!0,!0);for(let I=1;I<x.length;I++)E=Math.min(E,h.getElevationAt(x[I].x,x[I].y,!0,!0));y.elevation=E}}this.terrainTile=l.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,o,a){let l=i._dem._modifiedForSources[a];if(l===void 0&&(i._dem._modifiedForSources[a]=[],l=i._dem._modifiedForSources[a]),l.includes(o.canonical))return;let h=i._dem.dim;l.push(o.canonical);let g=!1;for(let y of this.getNodesInfo()){let x=y.node;if(!x.footprint||!x.footprint.grid)continue;let E=x.footprint.grid,I=i.tileCoordToPixel(E.min.x,E.min.y),M=i.tileCoordToPixel(E.max.x,E.max.y),D=Math.min(Math.min(h-M.y,I.x),Math.min(I.y,h-M.x));if(D<0)continue;let P=gi(D,2,5),L=Math.max(0,I.x-P),N=Math.max(0,I.y-P),V=Math.min(M.x+P,h-1),Z=Math.min(M.y+P,h-1);for(let te=N;te<=Z;++te)for(let ce=L;ce<=V;++ce)oh[te*h+ce]=255;let Y=0,Q=0;for(let te=0;te<E.cellsY;++te)for(let ce=0;ce<E.cellsX;++ce){if(!E.cells[te*E.cellsX+ce])continue;let he=i.tileCoordToPixel(E.min.x+ce/E.xScale,E.min.y+te/E.yScale),be=i.tileCoordToPixel(E.min.x+(ce+1)/E.xScale,E.min.y+(te+1)/E.yScale);for(let Pe=he.y;Pe<=Math.min(be.y+1,h-1);++Pe)for(let Te=he.x;Te<=Math.min(be.x+1,h-1);++Te)oh[Pe*h+Te]===255&&(oh[Pe*h+Te]=0,Y+=i.getElevationAtPixel(Te,Pe),Q++)}let ae=Y/Q;L=Math.max(1,I.x-P),N=Math.max(1,I.y-P),V=Math.min(M.x+P,h-2),Z=Math.min(M.y+P,h-2),g=!0;for(let te=N;te<=Z;++te)for(let ce=L;ce<=V;++ce)oh[te*h+ce]===0&&(xv[te*h+ce]=i._dem.set(ce,te,ae));for(let te=1;te<P;++te){L=Math.max(1,I.x-te),N=Math.max(1,I.y-te),V=Math.min(M.x+te,h-2),Z=Math.min(M.y+te,h-2);for(let ce=N;ce<=Z;++ce)for(let he=L;he<=V;++he){let be=ce*h+he;if(oh[be]===255){let Pe=0,Te=0,Le=-1,Oe=-1;for(let ke=-1;ke<=1;++ke)for(let $e=-1;$e<=1;++$e){let qe=(ce+ke)*h+he+$e;if(oh[qe]>=te)continue;let Xe=xv[qe],Qe=Math.abs(Xe);Qe>Te&&(Pe=Xe,Te=Qe,Le=$e,Oe=ke)}if(Te>.1){let ke=1-(te+.5*Math.abs(Le*Oe))/P,$e=i._dem.get(he,ce)+Pe*ke,qe=i._dem.get(he+Le,ce+Oe),Xe=i._dem.get(he-Le,ce-Oe,!0);($e-qe)*($e-Xe)>0&&($e=(qe+Xe)/2),xv[be]=i._dem.set(he,ce,$e),oh[be]=te}}}}}g&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Br.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let i of e)Rg(i.node),fv(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;let o=i.getReplacementRegionsForTile(e.toUnwrapped()),a=this.getNodesInfo();for(let l=0;l<this.nodesInfo.length;l++){let h=a[l].node;a[l].hiddenByReplacement=!!h.footprint&&!o.find(g=>g.footprint===h.footprint)}}getHeightAtTileCoord(e,i){let o=this.getNodesInfo(),a=[],l=[0,0,0];for(let h=0;h<this.nodesInfo.length;h++){let g=o[h],y=g.node.meshes[0],x=On.applyTransform(y.aabb,g.node.matrix);if(e<x.min[0]||i<x.min[1]||e>x.max[0]||i>x.max[1])continue;let E=(e-y.aabb.min[0])/(y.aabb.max[0]-y.aabb.min[0])*nh|0,I=Math.min(63,(i-y.aabb.min[1])/(y.aabb.max[1]-y.aabb.min[1])*nh|0)*nh+Math.min(63,E);if(l[2]=y.heightmap[I],r.Q.transformMat4(l,l,g.node.matrix),!(y.heightmap[I]<0&&g.node.footprint))return g.hiddenByReplacement?void 0:{height:l[2],maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};if(g.node.footprint.grid.query(new ct(e,i),new ct(e,i),a),a.length>0)return{height:void 0,maxHeight:g.feature.properties.height,hidden:g.hiddenByReplacement,verticalScale:g.evaluatedScale[2]}}}}function df(t,e){return!t.isLightConstant&&e}function UD(t,e,i,o,a,l,h,g){let y=(61440&e|(61440&e)>>4)>>8,x=(3840&e|(3840&e)>>4)>>4,E=240&e|(240&e)>>4;i[3]>0&&(y=si(y,255*i[0],i[3]),x=si(x,255*i[1],i[3]),E=si(E,255*i[2],i[3]));let I=y<<8|x,M=E<<8|Math.floor(255*o[3]),D=function(te){let ce=gi(te,0,2);return Math.min(Math.round(.5*ce*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],P=gi(a[0],0,1),L=gi(a[1],0,1),N=gi(a[2],0,1),V=gi(a[3],0,1),Z,Y,Q,ae;if(P!==L&&h!==l&&L!==P){let te=h-l;Y=1/(te*(L-P)),Q=-(l+te*P)/(te*(L-P));let ce=gi(a[4],-1,1);ae=Math.pow(10,ce),Z=255*N<<8|255*V}else Z=65535,Y=0,Q=1,ae=1;if(t.emplaceBack(I,M,D,Z,Y,Q,ae),g){let te=g.length;g.clear();for(let ce=0;ce<te;ce++)g.emplaceBack(I,M,D,Z,Y,Q,ae)}}function GD(t,e,i){let o=t.node,a=0,l=i&Md.HasMeshoptCompression;for(let h of o.meshes){if(o.lights&&o.lightMeshIndex===a||!h.featureData)continue;h.featureArray=new Nm,h.featureArray.reserve(h.featureData.length);let g=e;for(let y of h.featureData){let x=l?65535&y:y>>16&65535,E=l?y>>16&65535:65535&y,I=(15&E)<8?15&E:0,M=t.evaluatedRMEA[I],D=t.evaluatedColor[I],P=t.emissionHeightBasedParams[I],L;if(g&&I===2&&o.lights&&(L=new Nm,L.resize(10*o.lights.length)),UD(h.featureArray,x,D,M,P,h.aabb.min[2],h.aabb.max[2],L),L&&g){g=!1;let N=o.meshes[o.lightMeshIndex];N.featureArray=L,N.featureArray._trim()}}h.featureArray._trim(),a++}}function Jw(t,e,i,o){let a=1<<t.z;e.lat=Jr((o/pt+t.y)/a),e.lng=xs((i/pt+t.x)/a)}bt(Fg,"Tiled3dModelBucket",{omit:["layers"]}),bt(Kw,"Tiled3dModelFeature");let qD={circle:class extends di{constructor(t,e,i){super(t,KC,e,i)}createBucket(t){return new Ey(t)}queryRadius(t){let e=t;return fd("circle-radius",this,e)+fd("circle-stroke-width",this,e)+$m(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,o,a,l,h,g){let y=Cx(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),x=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Ux(t,o,l,h,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,x)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){let i=jx(this);return{config:new Yu(this,e),defines:i,overrideFog:!1}}},heatmap:class extends di{createBucket(t){return new qx(t)}constructor(t,e,i){super(t,uA,e,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=qp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return fd("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,o,a,l,h,g){let y=this.paint.get("heatmap-radius").evaluate(e,i);return Ux(t,o,l,h,g,!0,!0,new ct(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return t==="heatmap"?{config:new Yu(this,e),overrideFog:!1}:{}}},hillshade:class extends di{constructor(t,e,i){super(t,dA,e,i)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends di{constructor(t,e,i){super(t,SA,e,i)}getProgramIds(){let t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(t,e){return{config:new Yu(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);let i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new $y(t)}queryRadius(){return $m(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,o,a,l){return!t.queryGeometry.isAboveHorizon&&Tx(Mx(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}},"fill-extrusion":class extends di{constructor(t,e,i){super(t,e2,e,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new lg(t)}queryRadius(){return $m(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,i,o,a,l,h,g,y){let x=Cx(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),E=this.paint.get("fill-extrusion-height").evaluate(e,i),I=this.paint.get("fill-extrusion-base").evaluate(e,i),M=[0,0],D=g&&l.elevation,P=l.elevation?l.elevation.exaggeration():1,L=t.tile.getBucket(this);if(D&&L instanceof lg){let Q=L.centroidVertexArray,ae=y+1;ae<Q.length&&(M[0]=Q.geta_centroid_pos0(ae),M[1]=Q.geta_centroid_pos1(ae))}if(M[0]===0&&M[1]===1)return!1;l.projection.name==="globe"&&(o=I1([o],[new ct(0,0),new ct(pt,pt)],t.tileID.canonical).map(Q=>Q.polygon).flat());let N=D?g:null,[V,Z]=function(Q,ae,te,ce,he,be,Pe,Te,Le,Oe,ke){return Q.projection.name==="globe"?function($e,qe,Xe,Qe,Fe,It,yt,Ke,Ut,Pt,St){let Je=[],Bt=[],ai=$e.projection.upVectorScale(St,$e.center.lat,$e.worldSize).metersToTile,Qt=[0,0,0,1],hi=[0,0,0,1],li=($t,ln,on,Ui)=>{$t[0]=ln,$t[1]=on,$t[2]=Ui,$t[3]=1},vi=E1();Xe>0&&(Xe+=vi),Qe+=vi;for(let $t of qe){let ln=[],on=[];for(let Ui of $t){let Ri=Ui.x+Fe.x,Gi=Ui.y+Fe.y,Tn=$e.projection.projectTilePoint(Ri,Gi,St),gn=$e.projection.upVector(St,Ui.x,Ui.y),Gn=Xe,Nn=Qe;if(yt){let ao=M1(Ri,Gi,Xe,Qe,yt,Ke,Ut,Pt);Gn+=ao.base,Nn+=ao.top}Xe!==0?li(Qt,Tn.x+gn[0]*ai*Gn,Tn.y+gn[1]*ai*Gn,Tn.z+gn[2]*ai*Gn):li(Qt,Tn.x,Tn.y,Tn.z),li(hi,Tn.x+gn[0]*ai*Nn,Tn.y+gn[1]*ai*Nn,Tn.z+gn[2]*ai*Nn),r.Q.transformMat4(Qt,Qt,It),r.Q.transformMat4(hi,hi,It),ln.push(new yd(Qt[0],Qt[1],Qt[2])),on.push(new yd(hi[0],hi[1],hi[2]))}Je.push(ln),Bt.push(on)}return[Je,Bt]}(Q,ae,te,ce,he,be,Pe,Te,Le,Oe,ke):Pe?function($e,qe,Xe,Qe,Fe,It,yt,Ke,Ut){let Pt=[],St=[],Je=[0,0,0,1];for(let Bt of $e){let ai=[],Qt=[];for(let hi of Bt){let li=hi.x+Qe.x,vi=hi.y+Qe.y,$t=M1(li,vi,qe,Xe,It,yt,Ke,Ut);Je[0]=li,Je[1]=vi,Je[2]=$t.base,Je[3]=1,r.aa.transformMat4(Je,Je,Fe),Je[3]=Math.max(Je[3],1e-5);let ln=new yd(Je[0]/Je[3],Je[1]/Je[3],Je[2]/Je[3]);Je[0]=li,Je[1]=vi,Je[2]=$t.top,Je[3]=1,r.aa.transformMat4(Je,Je,Fe),Je[3]=Math.max(Je[3],1e-5);let on=new yd(Je[0]/Je[3],Je[1]/Je[3],Je[2]/Je[3]);ai.push(ln),Qt.push(on)}Pt.push(ai),St.push(Qt)}return[Pt,St]}(ae,te,ce,he,be,Pe,Te,Le,Oe):function($e,qe,Xe,Qe,Fe){let It=[],yt=[],Ke=Fe[8]*qe,Ut=Fe[9]*qe,Pt=Fe[10]*qe,St=Fe[11]*qe,Je=Fe[8]*Xe,Bt=Fe[9]*Xe,ai=Fe[10]*Xe,Qt=Fe[11]*Xe;for(let hi of $e){let li=[],vi=[];for(let $t of hi){let ln=$t.x+Qe.x,on=$t.y+Qe.y,Ui=Fe[0]*ln+Fe[4]*on+Fe[12],Ri=Fe[1]*ln+Fe[5]*on+Fe[13],Gi=Fe[2]*ln+Fe[6]*on+Fe[14],Tn=Fe[3]*ln+Fe[7]*on+Fe[15],gn=Ui+Ke,Gn=Ri+Ut,Nn=Gi+Pt,ao=Math.max(Tn+St,1e-5),Hn=Ui+Je,Fn=Ri+Bt,pr=Gi+ai,jr=Math.max(Tn+Qt,1e-5);li.push(new yd(gn/ao,Gn/ao,Nn/ao)),vi.push(new yd(Hn/jr,Fn/jr,pr/jr))}It.push(li),yt.push(vi)}return[It,yt]}(ae,te,ce,he,be)}(l,o,I,E,x,h,N,M,P,l.center.lat,t.tileID.canonical),Y=t.queryGeometry;return function(Q,ae,te){let ce=1/0;Tx(te,ae)&&(ce=S1(te,ae[0]));for(let he=0;he<ae.length;he++){let be=ae[he],Pe=Q[he];for(let Te=0;Te<be.length-1;Te++){let Le=be[Te],Oe=[Le,be[Te+1],Pe[Te+1],Pe[Te],Le];Iy(te,Oe)&&(ce=Math.min(ce,S1(te,Oe)))}}return ce!==1/0&&ce}(V,Z,Y.isPointQuery()?Y.screenBounds:Y.screenGeometry)}},line:class extends di{constructor(t,e,i){super(t,A1,e,i),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Fu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=L1.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Hy(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){let i=k1(this);return{config:new Yu(this,e),defines:i,overrideFog:!1}}queryRadius(t){let e=t,i=F1(fd("line-width",this,e),fd("line-gap-width",this,e)),o=fd("line-offset",this,e);return i/2+Math.abs(o)+$m(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,o,a,l){if(t.queryGeometry.isAboveHorizon)return!1;let h=Mx(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),g=t.pixelToTileUnitsFactor/2*F1(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),y=this.paint.get("line-offset").evaluate(e,i);return y&&(o=function(x,E){let I=[],M=new ct(0,0);for(let D=0;D<x.length;D++){let P=x[D],L=[];for(let N=0;N<P.length;N++){let V=P[N],Z=P[N+1],Y=N===0?M:V.sub(P[N-1])._unit()._perp(),Q=N===P.length-1?M:Z.sub(V)._unit()._perp(),ae=Y._add(Q)._unit();ae._mult(1/(ae.x*Q.x+ae.y*Q.y)),L.push(ae._mult(E)._add(V))}I.push(L)}return I}(o,y*t.pixelToTileUnitsFactor)),function(x,E,I){for(let M=0;M<E.length;M++){let D=E[M];if(x.length>=3){for(let P=0;P<D.length;P++)if(th(x,D[P]))return!0}if(HC(x,D,I))return!0}return!1}(h,o,g)}isTileClipped(){return!0}},symbol:Eg,background:class extends di{constructor(t,e,i){super(t,sD,e,i)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:xw,"raster-particle":ww,sky:class extends di{constructor(t,e,i){super(t,fD,e,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=qp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){let o=this.paint.get("sky-atmosphere-sun"),a=!o,l=t.style.light,h=l.properties.get("position");return a&&l.properties.get("anchor")==="viewport"&&Mn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?uv(h.azimuthal,90-h.polar,e):uv(o[0],90-o[1],e)}let i=this.paint.get("sky-gradient-center");return uv(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends di{constructor(t,e,i){super(t,mD,e)}},model:class extends di{constructor(t,e,i){super(t,ED,e,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new dv(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof Fg?pt-1:0}queryIntersectsFeature(t,e,i,o,a,l){if(!this.modelManager)return!1;let h=this.modelManager,g=t.tile.getBucket(this);if(!(g&&g instanceof dv))return!1;let y=g;for(let x in y.instancesPerModel){let E=y.instancesPerModel[x],I=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(E.idToFeaturesIndex.hasOwnProperty(I)){let M=E.features[E.idToFeaturesIndex[I]],D=h.getModel(x,this.scope);if(!D)return!1;let P=r.a9.create(),L=new Bi(0,0),N=y.canonical,V=Number.MAX_VALUE;for(let Z=0;Z<M.instancedDataCount;++Z){let Y=16*(M.instancedDataOffset+Z),Q=E.instancedDataArray.float32,ae=[Q[Y+4],Q[Y+5],Q[Y+6]];Jw(N,L,Q[Y],0|Q[Y+1]),Pw(P,D,l,L,M.rotation,M.scale,ae,!1,!1,!1),l.projection.name==="globe"&&(P=hv(P,l));let te=r.a9.multiply([],l.projMatrix,P),ce=t.queryGeometry,he=Cw(ce.isPointQuery()?ce.screenBounds:ce.screenGeometry,l,te,D.aabb);he!=null&&(V=Math.min(he,V))}return V!==Number.MAX_VALUE&&V}}return!1}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){let e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Gu}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,i,o){let a=t.tile,l=a.getBucket(this),h=null,g=Number.MAX_VALUE;if(!(l&&l instanceof Fg))return{queryFeature:h,intersectionZ:g};let y=l.getNodesInfo()[e];if(y.hiddenByReplacement||!y.node.meshes||!i.filter(new $(a.tileID.overscaledZ),y.feature,a.tileID.canonical))return{queryFeature:h,intersectionZ:g};let x=y.node,E=o.calculatePosMatrix(a.tileID.toUnwrapped(),o.worldSize),I=y.evaluatedScale,M=0;o.elevation&&x.elevation&&(M=x.elevation*o.elevation.exaggeration()),r.a9.translate(E,E,[(x.anchor?x.anchor[0]:0)*(I[0]-1),(x.anchor?x.anchor[1]:0)*(I[1]-1),M]),r.a9.scale(E,E,I),r.a9.multiply(E,E,x.matrix);let D=t.queryGeometry,P=D.isPointQuery()?D.screenBounds:D.screenGeometry,L=function(V){let Z=r.a9.multiply([],E,V.matrix),Y=r.a9.multiply(Z,o.expandedFarZProjMatrix,Z);for(let Q=0;Q<V.meshes.length;++Q){let ae=V.meshes[Q];if(Q===V.lightMeshIndex)continue;let te=Cw(P,o,Y,ae.aabb);te!=null&&(g=Math.min(te,g))}if(V.children)for(let Q of V.children)L(Q)};if(L(x),g===Number.MAX_VALUE)return{queryFeature:h,intersectionZ:g};let N=new Bi(0,0);return Jw(a.tileID.canonical,N,y.node.anchor[0],y.node.anchor[1]),h={type:"Feature",geometry:{type:"Point",coordinates:[N.lng,N.lat]},properties:y.feature.properties,id:y.feature.id,state:{},layer:this.serialize()},{queryFeature:h,intersectionZ:g}}}},ii={read:function(t,e){return t.readFields(ii._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,i){t===1?e.header_length=i.readFixed32():t===2?e.x=i.readVarint():t===3?e.y=i.readVarint():t===4?e.z=i.readVarint():t===5&&e.layers.push(ii.Layer.read(i,i.readVarint()+i.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};ii.Filter.read=function(t,e){return t.readFields(ii.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},ii.Filter._readField=function(t,e,i){t===1?(e.delta_filter=ii.Filter.Delta.read(i,i.readVarint()+i.pos),e.filter="delta_filter"):t===2?(e.zigzag_filter=ii.Filter.Zigzag.read(i,i.readVarint()+i.pos),e.filter="zigzag_filter"):t===3?(e.bitshuffle_filter=ii.Filter.BitShuffle.read(i,i.readVarint()+i.pos),e.filter="bitshuffle_filter"):t===4&&(e.byteshuffle_filter=ii.Filter.ByteShuffle.read(i,i.readVarint()+i.pos),e.filter="byteshuffle_filter")},ii.Filter.Delta={},ii.Filter.Delta.read=function(t,e){return t.readFields(ii.Filter.Delta._readField,{block_size:0},e)},ii.Filter.Delta._readField=function(t,e,i){t===1&&(e.block_size=i.readVarint())},ii.Filter.Zigzag={},ii.Filter.Zigzag.read=function(t,e){return t.readFields(ii.Filter.Zigzag._readField,{},e)},ii.Filter.Zigzag._readField=function(t,e,i){},ii.Filter.BitShuffle={},ii.Filter.BitShuffle.read=function(t,e){return t.readFields(ii.Filter.BitShuffle._readField,{},e)},ii.Filter.BitShuffle._readField=function(t,e,i){},ii.Filter.ByteShuffle={},ii.Filter.ByteShuffle.read=function(t,e){return t.readFields(ii.Filter.ByteShuffle._readField,{},e)},ii.Filter.ByteShuffle._readField=function(t,e,i){},ii.Codec={},ii.Codec.read=function(t,e){return t.readFields(ii.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},ii.Codec._readField=function(t,e,i){t===1?(e.gzip_data=ii.Codec.GzipData.read(i,i.readVarint()+i.pos),e.codec="gzip_data"):t===2?(e.jpeg_image=ii.Codec.JpegImage.read(i,i.readVarint()+i.pos),e.codec="jpeg_image"):t===3?(e.webp_image=ii.Codec.WebpImage.read(i,i.readVarint()+i.pos),e.codec="webp_image"):t===4&&(e.png_image=ii.Codec.PngImage.read(i,i.readVarint()+i.pos),e.codec="png_image")},ii.Codec.GzipData={},ii.Codec.GzipData.read=function(t,e){return t.readFields(ii.Codec.GzipData._readField,{},e)},ii.Codec.GzipData._readField=function(t,e,i){},ii.Codec.JpegImage={},ii.Codec.JpegImage.read=function(t,e){return t.readFields(ii.Codec.JpegImage._readField,{},e)},ii.Codec.JpegImage._readField=function(t,e,i){},ii.Codec.WebpImage={},ii.Codec.WebpImage.read=function(t,e){return t.readFields(ii.Codec.WebpImage._readField,{},e)},ii.Codec.WebpImage._readField=function(t,e,i){},ii.Codec.PngImage={},ii.Codec.PngImage.read=function(t,e){return t.readFields(ii.Codec.PngImage._readField,{},e)},ii.Codec.PngImage._readField=function(t,e,i){},ii.DataIndexEntry={},ii.DataIndexEntry.read=function(t,e){return t.readFields(ii.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},ii.DataIndexEntry._readField=function(t,e,i){t===1?e.first_byte=i.readFixed64():t===2?e.last_byte=i.readFixed64():t===3?e.filters.push(ii.Filter.read(i,i.readVarint()+i.pos)):t===4?e.codec=ii.Codec.read(i,i.readVarint()+i.pos):t===5?e.offset=i.readFloat():t===6?e.scale=i.readFloat():t===7&&e.bands.push(i.readString())},ii.Layer={},ii.Layer.read=function(t,e){return t.readFields(ii.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},ii.Layer._readField=function(t,e,i){t===1?e.version=i.readVarint():t===2?e.name=i.readString():t===3?e.units=i.readString():t===4?e.tilesize=i.readVarint():t===5?e.buffer=i.readVarint():t===6?e.pixel_format=i.readVarint():t===7&&e.data_index.push(ii.DataIndexEntry.read(i,i.readVarint()+i.pos))};let Ya={read:function(t,e){return t.readFields(Ya._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,i){t===2?(e.uint32_values=Ya.Uint32Values.read(i,i.readVarint()+i.pos),e.values="uint32_values"):t===3&&(e.fixed32_values=Ya.Fixed32Values.read(i,i.readVarint()+i.pos),e.values="fixed32_values")},Uint32Values:{}};Ya.Uint32Values.read=function(t,e){return t.readFields(Ya.Uint32Values._readField,{values:[]},e)},Ya.Uint32Values._readField=function(t,e,i){t===1&&(e.readValuesInto=function(o){if(o.type!==2)throw new Error(`Unsupported pbf type "${o.type}"`);let a=function(h){return h.type===2?h.readVarint()+h.pos:h.pos+1}(o),l=o.pos;return o.pos=a,function(h){o.pos=l;let g=0;for(;o.pos<a;){let y=o.readVarint();h[g++]=y}return h}}(i))},Ya.Fixed32Values={},Ya.Fixed32Values.read=function(t,e){return t.readFields(Ya.Fixed32Values._readField,{values:[]},e)},Ya.Fixed32Values._readField=function(t,e,i){throw new Error("Not implemented")};class $D{constructor(e=0,i=0,o=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=o,this.size=0,this.ttl=i}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){let i=this.items[e];delete this.items[e],this.size--,i.prev!==null&&(i.prev.next=i.next),i.next!==null&&(i.next.prev=i.prev),this.first===i&&(this.first=i.next),this.last===i&&(this.last=i.prev)}return this}entries(e=this.keys()){return e.map(i=>[i,this.get(i)])}evict(e=!1){if(e||this.size>0){let i=this.first;delete this.items[i.key],--this.size==0?(this.first=null,this.last=null):(this.first=i.next,this.first.prev=null)}return this}expiresAt(e){let i;return this.has(e)&&(i=this.items[e].expiry),i}get(e){let i;if(this.has(e)){let o=this.items[e];this.ttl>0&&o.expiry<=Date.now()?this.delete(e):(i=o.value,this.set(e,i,!0))}return i}has(e){return e in this.items}keys(){let e=[],i=this.first;for(;i!==null;)e.push(i.key),i=i.next;return e}set(e,i,o=!1,a=this.resetTtl){let l;if(o||this.has(e)){if(l=this.items[e],l.value=i,o===!1&&a&&(l.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==l){let h=this.last,g=l.next,y=l.prev;this.first===l&&(this.first=l.next),l.next=null,l.prev=this.last,h.next=l,y!==null&&(y.next=g),g!==null&&(g.prev=y)}}else this.max>0&&this.size===this.max&&this.evict(!0),l=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:i},++this.size==1?this.first=l:this.last.next=l;return this.last=l,this}values(e=this.keys()){return e.map(i=>this.get(i))}}function WD(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let o=2;o>=1;o--){let a=o===1?1:0,l=o===2?1:0;for(let h=0;h<e[0];h++){let g=e[1]*h;for(let y=a;y<e[1];y++){let x=e[2]*(y+g);for(let E=l;E<e[2];E++){let I=e[3]*(E+x);for(let M=0;M<e[3];M++){let D=I+M;t[D]+=t[D-i]}}}}i*=e[o]}return t}function ZD(t){for(let e=0,i=t.length;e<i;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function HD(t,e){switch(e){case"uint32":return t;case"uint16":for(let i=0;i<t.length;i+=2){let o=t[i],a=t[i+1];t[i]=(240&o)>>4|(61440&o)>>8|(240&a)<<4|61440&a,t[i+1]=15&o|(3840&o)>>4|(15&a)<<8|(3840&a)<<4}return t;case"uint8":for(let i=0;i<t.length;i+=4){let o=t[i],a=t[i+1],l=t[i+2],h=t[i+3];t[i+0]=(192&o)>>6|(192&a)>>4|(192&l)>>2|192&h,t[i+1]=(48&o)>>4|(48&a)>>2|48&l|(48&h)<<2,t[i+2]=(12&o)>>2|12&a|(12&l)<<2|(12&h)<<4,t[i+3]=3&o|(3&a)<<2|(3&l)<<4|(3&h)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class Qc extends Error{constructor(e){super(e),this.name="MRTError"}}var Us=Uint8Array,Dd=Uint16Array,QD=Int32Array,eT=new Us([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),tT=new Us([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),XD=new Us([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),iT=function(t,e){for(var i=new Dd(31),o=0;o<31;++o)i[o]=e+=1<<t[o-1];var a=new QD(i[30]);for(o=1;o<30;++o)for(var l=i[o];l<i[o+1];++l)a[l]=l-i[o]<<5|o;return{b:i,r:a}},nT=iT(eT,2),rT=nT.b,YD=nT.r;rT[28]=258,YD[258]=28;for(var KD=iT(tT,0).b,wv=new Dd(32768),sr=0;sr<32768;++sr){var Rd=(43690&sr)>>1|(21845&sr)<<1;wv[sr]=((65280&(Rd=(61680&(Rd=(52428&Rd)>>2|(13107&Rd)<<2))>>4|(3855&Rd)<<4))>>8|(255&Rd)<<8)>>1}var pf=function(t,e,i){for(var o=t.length,a=0,l=new Dd(e);a<o;++a)t[a]&&++l[t[a]-1];var h,g=new Dd(e);for(a=1;a<e;++a)g[a]=g[a-1]+l[a-1]<<1;if(i){h=new Dd(1<<e);var y=15-e;for(a=0;a<o;++a)if(t[a])for(var x=a<<4|t[a],E=e-t[a],I=g[t[a]-1]++<<E,M=I|(1<<E)-1;I<=M;++I)h[wv[I]>>y]=x}else for(h=new Dd(o),a=0;a<o;++a)t[a]&&(h[a]=wv[g[t[a]-1]++]>>15-t[a]);return h},ff=new Us(288);for(sr=0;sr<144;++sr)ff[sr]=8;for(sr=144;sr<256;++sr)ff[sr]=9;for(sr=256;sr<280;++sr)ff[sr]=7;for(sr=280;sr<288;++sr)ff[sr]=8;var oT=new Us(32);for(sr=0;sr<32;++sr)oT[sr]=5;var JD=pf(ff,9,1),eR=pf(oT,5,1),Tv=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},Ka=function(t,e,i){var o=e/8|0;return(t[o]|t[o+1]<<8)>>(7&e)&i},Ev=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(7&e)},tR=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ja=function(t,e,i){var o=new Error(e||tR[t]);if(o.code=t,Error.captureStackTrace&&Error.captureStackTrace(o,Ja),!i)throw o;return o},iR=new Us(0),nR=typeof TextDecoder<"u"&&new TextDecoder;try{nR.decode(iR,{stream:!0})}catch{}let rR={gzip_data:"gzip"},oR={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},sR={uint32:1,uint16:2,uint8:4},aR={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class sT{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){let i=new Uint8Array(e),o=new DataView(e);if(i[0]!==13)throw new Qc("File is not a valid MRT.");return o.getUint32(1,!0)}parseHeader(e){let i=new Uint8Array(e),o=this.getHeaderLength(e);if(i.length<o)throw new Qc(`Expected header with length >= ${o} but got buffer of length ${i.length}`);let a=new wd(i.subarray(0,o)),l=ii.read(a);if(!isNaN(this.x)&&(this.x!==l.x||this.y!==l.y||this.z!==l.z))throw new Qc(`Invalid attempt to parse header ${l.z}/${l.x}/${l.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=l.x,this.y=l.y,this.z=l.z;for(let h of l.layers)this.layers[h.name]=new lR(h,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let i=[],o=this.getLayer(e.layerName);for(let a=0;a<o.dataIndex.length;a++){let l=o.dataIndex[a],h=l.first_byte-e.firstByte,g=l.last_byte+1-e.firstByte;if(a<e.firstBlock||a>e.lastBlock||o._blocksInProgress.has(a))continue;let y={layerName:o.name,firstByte:h,lastByte:g,pixelFormat:o.pixelFormat,blockIndex:a,blockShape:[l.bands.length].concat(o.bandShape),buffer:o.buffer,codec:l.codec.codec,filters:l.filters.map(x=>x.filter)};o._blocksInProgress.add(a),i.push(y)}return new aT(i,()=>{i.forEach(a=>o._blocksInProgress.delete(a.blockIndex))},(a,l)=>{if(i.forEach(h=>o._blocksInProgress.delete(h.blockIndex)),a)throw a;l.forEach(h=>{this.getLayer(h.layerName).processDecodedData(h)})})}}class lR{constructor({version:e,name:i,units:o,tilesize:a,pixel_format:l,buffer:h,data_index:g},y){if(this.version=e,this.version!==1)throw new Qc(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=o,this.tileSize=a,this.buffer=h,this.pixelFormat=oR[l],this.dataIndex=g,this.bandShape=[a+2*h,a+2*h,sR[this.pixelFormat]],this._decodedBlocks=function(x=1e3,E=0,I=!1){if(isNaN(x)||x<0)throw new TypeError("Invalid max value");if(isNaN(E)||E<0)throw new TypeError("Invalid ttl value");if(typeof I!="boolean")throw new TypeError("Invalid resetTtl value");return new $D(x,E,I)}(y?y.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){let i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.set(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(let[o,a]of this.dataIndex.entries()){for(let[l,h]of a.bands.entries())if(h===e)return{bandIndex:i+l,blockIndex:o,blockBandIndex:l};i+=a.bands.length}break;case"number":for(let[o,a]of this.dataIndex.entries()){if(e>=i&&e<i+a.bands.length)return{bandIndex:e,blockIndex:o,blockBandIndex:e-i};i+=a.bands.length}break;default:throw new Qc(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Qc(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let i=1/0,o=-1/0,a=1/0,l=-1/0;for(let h of e){let{blockIndex:g}=this.getBlockForBand(h);if(g<0)throw new Qc(`Invalid band: ${JSON.stringify(h)}`);let y=this.dataIndex[g];a=Math.min(a,g),l=Math.max(l,g),i=Math.min(i,y.first_byte),o=Math.max(o,y.last_byte)}return{layerName:this.name,firstByte:i,lastByte:o,firstBlock:a,lastBlock:l}}hasBand(e){let{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){let{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){let{blockIndex:i,blockBandIndex:o}=this.getBlockForBand(e),a=this._decodedBlocks.get(i.toString());if(!a)throw new Qc(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let l=this.dataIndex[i],h=this.bandShape.reduce((x,E)=>x*E,1),g=o*h,y=a.subarray(g,g+h);return{data:y,bytes:new Uint8Array(y.buffer).subarray(y.byteOffset,y.byteOffset+y.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:l.offset,scale:l.scale}}}class aT{constructor(e,i,o){this.tasks=e,this._onCancel=i,this._onComplete=o,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}sT.performDecoding=function(t,e){return Promise.all(e.tasks.map(i=>{let{layerName:o,firstByte:a,lastByte:l,pixelFormat:h,blockShape:g,blockIndex:y,filters:x,codec:E}=i,I=new Uint8Array(t).subarray(a,l+1),M=new Uint32Array(g[0]*g[1]*g[2]),D;if(E!=="gzip_data")throw new Error(`Unhandled codec: ${E}`);return D=function(P,L){if(!globalThis.DecompressionStream&&L==="gzip_data")return Promise.resolve(((Y=function(te){te[0]==31&&te[1]==139&&te[2]==8||Ja(6,"invalid gzip data");var ce=te[3],he=10;4&ce&&(he+=2+(te[10]|te[11]<<8));for(var be=(ce>>3&1)+(ce>>4&1);be>0;be-=!te[he++]);return he+(2&ce)}(Z=P))+8>Z.length&&Ja(6,"invalid gzip data"),function(te,ce,he,be){var Pe=te.length;if(!Pe||ce.f&&!ce.l)return he||new Us(0);var Te=!he,Le=Te||ce.i!=2,Oe=ce.i;Te&&(he=new Us(3*Pe));var ke,$e,qe=function(Xc){var Yc=he.length;if(Xc>Yc){var sh=new Us(Math.max(2*Yc,Xc));sh.set(he),he=sh}},Xe=ce.f||0,Qe=ce.p||0,Fe=ce.b||0,It=ce.l,yt=ce.d,Ke=ce.m,Ut=ce.n,Pt=8*Pe;do{if(!It){Xe=Ka(te,Qe,1);var St=Ka(te,Qe+1,3);if(Qe+=3,!St){var Je=te[(Ri=4+((Qe+7)/8|0))-4]|te[Ri-3]<<8,Bt=Ri+Je;if(Bt>Pe){Oe&&Ja(0);break}Le&&qe(Fe+Je),he.set(te.subarray(Ri,Bt),Fe),ce.b=Fe+=Je,ce.p=Qe=8*Bt,ce.f=Xe;continue}if(St==1)It=JD,yt=eR,Ke=9,Ut=5;else if(St==2){var ai=Ka(te,Qe,31)+257,Qt=Ka(te,Qe+10,15)+4,hi=ai+Ka(te,Qe+5,31)+1;Qe+=14;for(var li=new Us(hi),vi=new Us(19),$t=0;$t<Qt;++$t)vi[XD[$t]]=Ka(te,Qe+3*$t,7);Qe+=3*Qt;var ln=Tv(vi),on=(1<<ln)-1,Ui=pf(vi,ln,1);for($t=0;$t<hi;){var Ri,Gi=Ui[Ka(te,Qe,on)];if(Qe+=15&Gi,(Ri=Gi>>4)<16)li[$t++]=Ri;else{var Tn=0,gn=0;for(Ri==16?(gn=3+Ka(te,Qe,3),Qe+=2,Tn=li[$t-1]):Ri==17?(gn=3+Ka(te,Qe,7),Qe+=3):Ri==18&&(gn=11+Ka(te,Qe,127),Qe+=7);gn--;)li[$t++]=Tn}}var Gn=li.subarray(0,ai),Nn=li.subarray(ai);Ke=Tv(Gn),Ut=Tv(Nn),It=pf(Gn,Ke,1),yt=pf(Nn,Ut,1)}else Ja(1);if(Qe>Pt){Oe&&Ja(0);break}}Le&&qe(Fe+131072);for(var ao=(1<<Ke)-1,Hn=(1<<Ut)-1,Fn=Qe;;Fn=Qe){var pr=(Tn=It[Ev(te,Qe)&ao])>>4;if((Qe+=15&Tn)>Pt){Oe&&Ja(0);break}if(Tn||Ja(2),pr<256)he[Fe++]=pr;else{if(pr==256){Fn=Qe,It=null;break}var jr=pr-254;pr>264&&(jr=Ka(te,Qe,(1<<(No=eT[$t=pr-257]))-1)+rT[$t],Qe+=No);var Ur=yt[Ev(te,Qe)&Hn],vn=Ur>>4;if(Ur||Ja(3),Qe+=15&Ur,Nn=KD[vn],vn>3){var No=tT[vn];Nn+=Ev(te,Qe)&(1<<No)-1,Qe+=No}if(Qe>Pt){Oe&&Ja(0);break}Le&&qe(Fe+131072);var sc=Fe+jr;if(Fe<Nn){var ya=0-Nn,el=Math.min(Nn,sc);for(ya+Fe<0&&Ja(3);Fe<el;++Fe)he[Fe]=(void 0)[ya+Fe]}for(;Fe<sc;++Fe)he[Fe]=he[Fe-Nn]}}ce.l=It,ce.p=Fn,ce.b=Fe,ce.f=Xe,It&&(Xe=1,ce.m=Ke,ce.d=yt,ce.n=Ut)}while(!Xe);return Fe!=he.length&&Te?(ke=he,(($e=Fe)==null||$e>ke.length)&&($e=ke.length),new Us(ke.subarray(0,$e))):he.subarray(0,Fe)}(Z.subarray(Y,-8),{i:2},new Us(((N=Z)[(V=N.length)-4]|N[V-3]<<8|N[V-2]<<16|N[V-1]<<24)>>>0))));var N,V,Z,Y;let Q=rR[L];if(!Q)throw new Error(`Unhandled codec: ${L}`);let ae=new globalThis.DecompressionStream(Q);return new Response(new Blob([P]).stream().pipeThrough(ae)).arrayBuffer().then(te=>new Uint8Array(te))}(I,E).then(P=>{let L=Ya.read(new wd(P));if(L.values==="uint32_values")return L.uint32_values.readValuesInto(M),new aR[h](M.buffer);throw new Error(`Unhandled numeric data "${L.values}"`)}),D.then(P=>{for(let L=x.length-1;L>=0;L--)switch(x[L]){case"delta_filter":WD(P,g);break;case"zigzag_filter":ZD(P);break;case"bitshuffle_filter":HD(P,h);break;default:throw new Error(`Unhandled filter "${x[L]}"`)}return{layerName:o,blockIndex:y,data:P}}).catch(P=>{throw P})}))},bt(aT,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let lT=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Iv{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");let a=o>>4;if(a!==1)throw new Error(`Got v${a} data when expected v1.`);let l=lT[15&o];if(!l)throw new Error("Unrecognized array type.");let[h]=new Uint16Array(e,2,1),[g]=new Uint32Array(e,4,1);return new Iv(g,h,l,e)}constructor(e,i=64,o=Float64Array,a){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let l=lT.indexOf(this.ArrayType),h=2*e*this.ArrayType.BYTES_PER_ELEMENT,g=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-g%8)%8;if(l<0)throw new Error(`Unexpected typed array class: ${o}.`);a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+h+g+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+l]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){let o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Sv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:l,coords:h,nodeSize:g}=this,y=[0,l.length-1,0],x=[];for(;y.length;){let E=y.pop()||0,I=y.pop()||0,M=y.pop()||0;if(I-M<=g){for(let N=M;N<=I;N++){let V=h[2*N],Z=h[2*N+1];V>=e&&V<=o&&Z>=i&&Z<=a&&x.push(l[N])}continue}let D=M+I>>1,P=h[2*D],L=h[2*D+1];P>=e&&P<=o&&L>=i&&L<=a&&x.push(l[D]),(E===0?e<=P:i<=L)&&(y.push(M),y.push(D-1),y.push(1-E)),(E===0?o>=P:a>=L)&&(y.push(D+1),y.push(I),y.push(1-E))}return x}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:a,coords:l,nodeSize:h}=this,g=[0,a.length-1,0],y=[],x=o*o;for(;g.length;){let E=g.pop()||0,I=g.pop()||0,M=g.pop()||0;if(I-M<=h){for(let N=M;N<=I;N++)uT(l[2*N],l[2*N+1],e,i)<=x&&y.push(a[N]);continue}let D=M+I>>1,P=l[2*D],L=l[2*D+1];uT(P,L,e,i)<=x&&y.push(a[D]),(E===0?e-o<=P:i-o<=L)&&(g.push(M),g.push(D-1),g.push(1-E)),(E===0?e+o>=P:i+o>=L)&&(g.push(D+1),g.push(I),g.push(1-E))}return y}}function Sv(t,e,i,o,a,l){if(a-o<=i)return;let h=o+a>>1;cT(t,e,h,o,a,l),Sv(t,e,i,o,h-1,1-l),Sv(t,e,i,h+1,a,1-l)}function cT(t,e,i,o,a,l){for(;a>o;){if(a-o>600){let x=a-o+1,E=i-o+1,I=Math.log(x),M=.5*Math.exp(2*I/3),D=.5*Math.sqrt(I*M*(x-M)/x)*(E-x/2<0?-1:1);cT(t,e,i,Math.max(o,Math.floor(i-E*M/x+D)),Math.min(a,Math.floor(i+(x-E)*M/x+D)),l)}let h=e[2*i+l],g=o,y=a;for(mf(t,e,o,i),e[2*a+l]>h&&mf(t,e,o,a);g<y;){for(mf(t,e,g,y),g++,y--;e[2*g+l]<h;)g++;for(;e[2*y+l]>h;)y--}e[2*o+l]===h?mf(t,e,o,y):(y++,mf(t,e,y,a)),y<=i&&(o=y+1),i<=y&&(a=y-1)}}function mf(t,e,i,o){Mv(t,i,o),Mv(e,2*i,2*o),Mv(e,2*i+1,2*o+1)}function Mv(t,e,i){let o=t[e];t[e]=t[i],t[i]=o}function uT(t,e,i,o){let a=t-i,l=e-o;return a*a+l*l}r.$=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([i,o]){let a=$o([1,i,o]);return{x:a.x,y:a.y,z:a.z}}(t.expression.evaluate(e))}interpolate(t,e,i){return{x:si(t.x,e.x,i),y:si(t.y,e.y,i),z:si(t.z,e.z,i)}}},r.A=Ue,r.B=Lp,r.C=Lo,r.D=Rm,r.E=Hr,r.F=function(t){let e=t.value,i=[];if(!e)return i;let o=ml(e);return o!=="string"?(i=i.concat([new Dg(t.key,e,`string expected, "${o}" found`)]),i):(Aw(e,!0)||(i=i.concat([new Dg(t.key,e,`invalid url "${e}"`)])),i)},r.G=re,r.H=ye,r.I=ev,r.J=pe,r.K=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return $o(t.expression.evaluate(e))}interpolate(t,e,i){return{x:si(t.x,e.x,i),y:si(t.y,e.y,i),z:si(t.z,e.z,i),azimuthal:si(t.azimuthal,e.azimuthal,i),polar:si(t.polar,e.polar,i)}}},r.L=le,r.M=class{constructor(t,e,i,o){this.id=t,this.position=e!=null?new Bi(e[0],e[1]):new Bi(0,0),this.orientation=i??[0,0,0],this.nodes=o,this.uploaded=!1,this.aabb=new On([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(r.a9.multiply(t.matrix,e,t.matrix),t.meshes)for(let i of t.meshes){let o=On.applyTransform(i.aabb,t.matrix);this.aabb.encapsulate(o)}if(t.children)for(let i of t.children)this._applyTransformations(i,t.matrix)}computeBoundsAndApplyParent(){let t=r.a9.identity([]);for(let e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,i,o,a,l,h=!1){Pw(this.matrix,this,t.transform,this.position,e,i,o,a,l,h)}upload(t){if(!this.uploaded){for(let e of this.nodes)pv(e,t);for(let e of this.nodes)Rg(e);this.uploaded=!0}}destroy(){for(let t of this.nodes)fv(t)}},r.N=$,r.O=so,r.P=ct,r.R=gc,r.S=Fl,r.T=cv,r.U=Re,r.V=Dg,r.W=Vc,r.X=si,r.Y=pt,r.Z=Gu,r._=ja,r.a=Zr,r.a$=Do,r.a0=function(t,e,i=0,o=!0){let a=new ct(i,i),l=t.sub(a),h=e.add(a),g=[l,new ct(h.x,l.y),h,new ct(l.x,h.y)];return o&&g.push(l.clone()),g},r.a1=function(t,e){let i=[];for(let o=0;o<t.length;o++){let a=as(o-1,-1,t.length-1),l=as(o+1,-1,t.length-1),h=t[o],g=t[l],y=t[a].sub(h).unit(),x=g.sub(h).unit(),E=x.angleWithSep(y.x,y.y),I=y.add(x).unit().mult(-1*e/Math.sin(E/2));i.push(h.add(I))}return i},r.a2=dw,r.a3=Sx,r.a4=function(t,e,i=0){return r.Q.fromValues(((e.x-i)*t.scale-t.x)*pt,(e.y*t.scale-t.y)*pt,yx(e.z,e.y))},r.a5=Ay,r.a6=D1,r.a7=function(t){let e=1/0,i=1/0,o=-1/0,a=-1/0;for(let l of t)e=Math.min(e,l.x),i=Math.min(i,l.y),o=Math.max(o,l.x),a=Math.max(a,l.y);return{min:new ct(e,i),max:new ct(o,a)}},r.a8=Bc,r.aA=Wi,r.aB=oi,r.aC=Sm,r.aD=hy,r.aE=er,r.aF=zi,r.aG=ex,r.aH=Tg,r.aI=function(){oe.isLoading()||oe.isLoaded()||ne()!=="deferred"||ie()},r.aJ=gt,r.aK=Nc,r.aL=Ww,r.aM=xo,r.aN=Hy,r.aO=$y,r.aP=ic,r.aQ=Yr,r.aR=cy,r.aS=Px,r.aT=tg,r.aU=lv,r.aV=function(t,e){let i=Vc(e.zoom);if(i===0)return wl(t);let o=Hm(t),a=ky(o),l=Bc(o.getWest())*e.worldSize,h=Bc(o.getEast())*e.worldSize,g=tc(o.getNorth())*e.worldSize,y=tc(o.getSouth())*e.worldSize,x=[l,g,0],E=[h,g,0],I=[l,y,0],M=[h,y,0],D=r.a9.invert([],e.globeMatrix);return r.Q.transformMat4(x,x,D),r.Q.transformMat4(E,E,D),r.Q.transformMat4(I,I,D),r.Q.transformMat4(M,M,D),a[0]=nc(a[0],I,i),a[1]=nc(a[1],M,i),a[2]=nc(a[2],E,i),a[3]=nc(a[3],x,i),On.fromPoints(a)},r.aW=Xm,r.aX=Gp,r.aY=nc,r.aZ=Ir,r.a_=eA,r.ab=th,r.ac=xx,r.ad=gi,r.ae=zo,r.af=function(t,e){let i={};for(let o=0;o<e.length;o++){let a=e[o];a in t&&(i[a]=t[a])}return i},r.ag=zc,r.ah=tc,r.ai=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,i,o){let a=this.entries[t]=this.entries[t]||{callbacks:[]};if(a.result){let[l,h]=a.result;return this.scheduler?this.scheduler.add(()=>{o(l,h)},e):o(l,h),()=>{}}return a.callbacks.push(o),a.cancel||(a.cancel=i((l,h)=>{a.result=[l,h];for(let g of a.callbacks)this.scheduler?this.scheduler.add(()=>{g(l,h)},e):g(l,h);setTimeout(()=>delete this.entries[t],3e3)})),()=>{a.result||(a.callbacks=a.callbacks.filter(l=>l!==o),a.callbacks.length||(a.cancel(),delete this.entries[t]))}}},r.aj=fn,r.ak=function(t,e,i){let o=JSON.stringify(t.request);return t.data&&(this.deduped.entries[o]={result:[null,t.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},a=>{let l=la(t.request,(h,g,y,x)=>{h?a(h):g&&a(null,{vectorTile:i?void 0:new Wy(new wd(g)),rawData:g,cacheControl:y,expires:x})});return()=>{l.cancel(),a()}},e)},r.al=function(t){vu++,vu>zh&&(t.getActor().send("enforceCacheSizeLimit",Zo),vu=0)},r.am=hn,r.an=ll,r.ao=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},r.ap=oo,r.aq=xw,r.ar=ww,r.as=bw,r.at=function(t,e){let i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let o=0;o<t.length;o++){let a=document.createElement("source");jl(t[o])||(i.crossOrigin="Anonymous"),a.src=t[o],i.appendChild(a)}return{cancel:()=>{}}},r.au=Ig,r.av=tf,r.aw=xs,r.ax=Jr,r.ay=Kr,r.az=Mr,r.b=ms,r.b$=Ed,r.b0=sT,r.b1=la,r.b2=function(t){let e=[];for(let i in t)e.push(t[i]);return e},r.b3=function(t,e){let i=[];for(let o in t)o in e||i.push(o);return i},r.b4=pc,r.b5=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.b6=function(t,e){let{x:i,y:o}=t.point,a=Bx(i,o,t.worldSize/t._pixelsPerMercatorPixel,0,0);return r.a9.multiply(a,a,Oy(wl(e)))},r.b8=vd,r.b9=js,r.bA=mx,r.bB=function(t){let e=r.a9.identity(new Float64Array(16));r.a9.multiply(e,t.pixelMatrix,t.globeMatrix);let i=[0,ga,0],o=[0,_a,0];return r.Q.transformMat4(i,i,e),r.Q.transformMat4(o,o,e),[i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!Fy(t,new Bi(t.center.lat,90)),o[0]>0&&o[0]<=t.width&&o[1]>0&&o[1]<=t.height&&!Fy(t,new Bi(t.center.lat,-90))]},r.bC=function(t,e){let{scale:i}=t.tileTransform,o=i*pt/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return r.b7.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[o,o])},r.bD=Cg,r.bE=Tw,r.bF=function(t){let e=Tw(t,!0);return r.b7.invert([],[e[0],e[1],e[4],e[5]])},r.bG=Dy,r.bH=function(t){let{x:e,y:i}=t.point,{lng:o,lat:a}=t._center;return Bx(e,i,t.worldSize,o,a)},r.bI=zr,r.bJ=_y,r.bK=function(t){let e=Math.round((t+45+360)%360/90)%4;return dc[e]},r.bL=45,r.bM=by,r.bN=Np,r.bO=Oc,r.bP=fy,r.bQ=Fo,r.bR=jm,r.bS=dx,r.bT=function(t,e,i){let o=Math.sqrt(t*t+e*e+i*i),a=o>0?Math.acos(i/o)*hc:0,l=t!==0||e!==0?Math.atan2(-e,-t)*hc+90:0;return l<0&&(l+=360),[o,l,a]},r.bU=Um,r.bV=On,r.bW=$o,r.bX=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},r.bY=function(t){return t({pluginStatus:U,pluginURL:j}),H.on("pluginStateChange",t),t},r.bZ=mv,r.b_=Pg,r.ba=cg,r.bb=function(t,e,i,o,a){let l=5*e+2;t.float32[l+0]=i,t.float32[l+1]=o,t.float32[l+2]=a},r.bc=wg,r.bd=tw,r.be=Iy,r.bf=eo,r.bg=nv,r.bh=lw,r.bi=Jy,r.bj=Iv,r.bk=as,r.bm=Si,r.bn=Ra,r.bo=Bo,r.bp=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},r.bq=Bi,r.br=_w,r.bs=_x,r.bt=Ry,r.bu=Ew,r.bv=Ju,r.bw=Lx,r.bx=function(t,e,i,o,a,l,h,g,y){if(y.name==="globe")return Lx(t,e,new Ju(i,o,a),!1);let x=tf({z:i,x:o,y:a},y);return new On([(l+x.x/x.scale)*e,e*(x.y/x.scale),h],[(l+x.x2/x.scale)*e,e*(x.y2/x.scale),g])},r.by=function(t,e,i){let o=0;for(let a=0;a<2;++a)t[a]>0&&(o+=(t[a]-0)*(t[a]-0)),e[a]<0&&(o+=(0-e[a])*(0-e[a]));return o},r.bz=tr,r.c=qw,r.c$=[1,1,1],r.c0=tv,r.c1=za,r.c2=G,r.c3=Ie,r.c4=hs,r.c5=dn,r.c6=ls,r.c7=function(t,e,i){return t.type==="custom"?new dD(t,e):new qD[t.type](t,e,i)},r.c8=function(t){let e=t.indexOf(Jn);return e>=0?t.slice(0,e):t},r.c9=function(t){return t.indexOf(Jn)>=0},r.cA=t=>({u_matrix:new Np(t),u_pixels_to_tile_units:new my(t),u_device_pixel_ratio:new Fo(t),u_units_to_pixels:new Oc(t),u_dash_image:new jm(t),u_gradient_image:new jm(t),u_image_height:new Fo(t),u_texsize:new Oc(t),u_tile_units_to_pixels:new Fo(t),u_alpha_discard_threshold:new Fo(t),u_trim_offset:new Oc(t),u_emissive_strength:new Fo(t)}),r.cB=t=>({u_matrix:new Np(t),u_texsize:new Oc(t),u_pixels_to_tile_units:new my(t),u_device_pixel_ratio:new Fo(t),u_image:new jm(t),u_units_to_pixels:new Oc(t),u_tile_units_to_pixels:new Fo(t),u_alpha_discard_threshold:new Fo(t),u_trim_offset:new Oc(t)}),r.cC=Zu,r.cD=y2,r.cE=v2,r.cF=jx,r.cG=(t,e,i,o,a,l)=>{let h=t.transform,g=h.projection.name==="globe",y;if(l.paint.get("circle-pitch-alignment")==="map")if(g){let E=zx(h.zoom,e.canonical)*h._pixelsPerMercatorPixel;y=Float32Array.from([E,0,0,E])}else y=h.calculatePixelsToTileUnitsMatrix(i);else y=new Float32Array([h.pixelsToGLUnits[0],0,0,h.pixelsToGLUnits[1]]);let x={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(h.projection),u_matrix:t.translatePosMatrix(e.projMatrix,i,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Br.devicePixelRatio,u_extrude_scale:y,u_inv_rot_matrix:oA,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:l.paint.get("circle-emissive-strength")};if(g){x.u_inv_rot_matrix=o,x.u_merc_center=a,x.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],x.u_zoom_transition=Vc(h.zoom);let E=a[0]*pt,I=a[1]*pt;x.u_up_dir=h.projection.upVector(new Ju(0,0,0),E,I)}return x},r.cH=k1,r.cI=(t,e,i,o,a,l)=>{let h=t.transform;return{u_matrix:P1(t,e,i,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:h.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:a,u_image:0,u_tile_units_to_pixels:R1(e,h),u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:l}},r.cJ=(t,e,i,o,a,l,h)=>{let g=t.transform,y=g.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:P1(t,e,i,o),u_pixels_to_tile_units:y,u_device_pixel_ratio:l,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:a,u_texsize:O1(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:R1(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:h,u_emissive_strength:i.paint.get("line-emissive-strength")}},r.cK=zl,r.cL=qp,r.cM=E1,r.cN=UC,r.cO=lg,r.cP=Gc,r.cQ=450,r.cR=7,r.cS=cD,r.cT=256,r.cU=Oy,r.cV=Xu,r.cW=Qu,r.cX=ay,r.cY=function(t,e,i,o,a){return gi((t-e)/(i-e)*(a-o)+o,o,a)},r.cZ=eh,r.c_=hv,r.ca=function(t){let e=t.indexOf(Jn);return e>=0?t.slice(e+1):""},r.cb=function(t){let e=[],i=t.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},r.cc=Bl,r.cd=H,r.ce=Vl,r.cf=px,r.cg=class extends Jl{constructor(t){super(t),this.current=OC}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let o=0;o<9;o++)if(i[o]!==this.current[o]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},r.ch=Ll,r.ci=function(t,e,i){let o=Vc(i.zoom),a=t.style.map._antialias,l=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return o===0&&!a&&!l},r.cj=function(t){let e=t.pixelsPerMeter,i=e/Bo(1,t.center.lat),o=r.a9.identity(new Float64Array(16));return r.a9.translate(o,o,[t.point.x,t.point.y,0]),r.a9.scale(o,o,[i,i,e]),Float32Array.from(o)},r.ck=Hm,r.cl=function(t){let e=tr-5;t=gi(t,-e,e)/e*90;let i=Math.pow(Math.abs(Math.sin(Si(t))),3);return Math.round(i*(yy.length-1))},r.cm=function(t,e,i,o){let a=e.getNorth(),l=e.getSouth(),h=e.getWest(),g=e.getEast(),y=1<<t.z,x=g-h,E=a-l,I=x/ud,M=-E/yy[i],D=[0,I,0,M,0,0,a,h,0];if(t.z>0){let P=180/o;r.ct.multiply(D,D,[P/x+1,0,0,0,P/E+1,0,-.5*P/I,.5*P/M,1])}return D[2]=y,D[5]=t.x,D[8]=t.y,D},r.cn=wl,r.co=function(t,e,i){let o=r.a9.identity(new Float64Array(16)),a=(e/(1<<t)-.5)*Math.PI*2;return r.a9.rotateY(o,i.globeMatrix,a),Float32Array.from(o)},r.cp=class{isDataAvailableAtPoint(t){let e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;let i=e.getSource().maxzoom,o=1<<i,a=Math.floor(t.x),l=Math.floor((t.x-a)*o),h=Math.floor(t.y*o),g=this.findDEMTileFor(new oo(i,a,i,l,h));return!(!g||!g.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let o=this._source();if(!o||t.y<0||t.y>1)return e;let a=o.getSource().maxzoom,l=1<<a,h=Math.floor(t.x),g=t.x-h,y=new oo(a,h,a,Math.floor(g*l),Math.floor(t.y*l)),x=this.findDEMTileFor(y);if(!x||!x.dem)return e;let E=x.dem,I=1<<x.tileID.canonical.z,M=(g*I-x.tileID.canonical.x)*E.dim,D=(t.y*I-x.tileID.canonical.y)*E.dim,P=Math.floor(M),L=Math.floor(D);return(i?this.exaggeration():1)*si(si(E.get(P,L),E.get(P,L+1),D-L),si(E.get(P+1,L),E.get(P+1,L+1),D-L),M-P)}getAtTileOffset(t,e,i){let o=1<<t.canonical.z;return this.getAtPointOrZero(new so(t.wrap+(t.canonical.x+e/pt)/o,(t.canonical.y+i/pt)/o))}getAtTileOffsetFunc(t,e,i,o){return a=>{let l=this.getAtTileOffset(t,a.x,a.y),h=o.upVector(t.canonical,a.x,a.y),g=o.upVectorScale(t.canonical,e,i).metersToTile;return r.Q.scale(h,h,l*g),h}}getForTilePoints(t,e,i,o){if(this.isUsingMockSource())return!1;let a=_d.create(this,t,o);return!!a&&(e.forEach(l=>{l[2]=this.exaggeration()*a.getElevationAt(l[0],l[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(t);if(!e||!e.dem)return null;let i=e.dem.tree,o=e.tileID,a=1<<t.canonical.z-o.canonical.z,l=t.canonical.x/a-o.canonical.x,h=t.canonical.y/a-o.canonical.y,g=0;for(let y=0;y<t.canonical.z-o.canonical.z&&!i.leaves[g];y++){l*=2,h*=2;let x=2*Math.floor(h)+Math.floor(l);g=i.childOffsets[g]+x,l%=1,h%=1}return{min:this.exaggeration()*i.minimums[g],max:this.exaggeration()*i.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,i=Number.MAX_VALUE,o=Number.MIN_VALUE;for(let a of t){let l=this.getMinMaxForTile(a.tileID);l&&(i=Math.min(i,l.min),o=Math.max(o,l.max),e=!0)}return e?{min:i,max:o}:null}},r.cq=Zm,r.cr=Zx,r.cs=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},r.cu=zx,r.cv=yu,r.cw=Wo,r.cx=256,r.cy=function(t,e){let i=[0,0,0],o=Xm(wl(e.canonical));return r.Q.transformMat4(i,i,o),r.Q.transformMat4(i,i,t),i},r.cz=t=>({u_camera_to_center_distance:new Fo(t),u_extrude_scale:new my(t),u_device_pixel_ratio:new Fo(t),u_matrix:new Np(t),u_inv_rot_matrix:new Np(t),u_merc_center:new Oc(t),u_tile_id:new fy(t),u_zoom_transition:new Fo(t),u_up_dir:new fy(t),u_emissive_strength:new Fo(t)}),r.d=Ba,r.d$=kw,r.d0=_d,r.d1=Md,r.d2=bs,r.d3=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){let e=n1(new ct(0,0),new ct(pt,pt),t),i=[];for(let o of this._activeRegions){if(o.hiddenByOverlap||!i1(e,o))continue;let a=VA(o.min,o.max,t);i.push({min:a.min,max:a.max,sourceId:this._sourceIds[o.priority],footprint:o.footprint,footprintTileId:o.tileId})}return i}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let i=[];for(let o of e.cache.getVisibleCoordinates()){let a=e.cache.getTile(o).buckets[e.layer];if(a)for(let l of a.getNodesInfo()){let h=l.node;h.footprint&&i.push({footprint:h.footprint,id:o.toUnwrapped()})}}return i}})))}_addSource(t){let e=t.getFootprints();if(e.length!==0){for(let i of e){if(!i.footprint)continue;let o=n1(i.footprint.min,i.footprint.max,i.id);this._activeRegions.push({min:o.min,max:o.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:i.id,footprint:i.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||og(e.min,i.min)||og(e.max,i.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0,i=0;for(;!t&&e!==this._activeRegions.length;){let o=this._activeRegions[e],a=this._prevRegions[i];t=o.priority!==a.priority||!t1(o,a),++e,++i}}if(t){++this._updateTime;let e=i=>{let o=this._activeRegions;if(i>=o.length)return i;let a=o[i].priority;for(;i<o.length&&o[i].priority===a;)++i;return i};if(this._sourceIds.length>1){let i=0,o=e(i);for(;i!==o;){let a=i,l=i;for(;a!==o;){let h=this._activeRegions[a];h.hiddenByOverlap=!1;for(let g=0;g<l;g++){let y=this._activeRegions[g];if(!y.hiddenByOverlap&&i1(h,y)&&(h.hiddenByOverlap=o1(h.footprint,h.tileId,y.footprint,y.tileId),h.hiddenByOverlap))break}++a}i=o,o=e(i)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},r.d4=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let t of this._poleSegments)t.destroy();for(let t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){let i=new Yr,o=new Mr,a=[],l=t+1+2,h=e[0]+1,g=e[0]+1+(1+e.length),y=(x,E,I)=>{let M=x===l-1?x-2:x===0?x:x-1;return M+=I?24575:0,[M,E]};for(let x=0;x<l;++x)i.emplaceBack(...y(x,0,!0));for(let x=0;x<h;++x)for(let E=0;E<l;++E)i.emplaceBack(...y(E,x,(E===0||E===l-1)&&!0));for(let x=0;x<e.length;++x){let E=e[x];for(let I=0;I<l;++I)i.emplaceBack(...y(I,E,!0))}for(let x=0;x<e.length;++x){let E=o.length,I=e[x]+1+2,M=new Mr;for(let L=0;L<I-1;L++){let N=L===I-2,V=N?l*(g-e.length+x-L):l;for(let Z=0;Z<l-1;Z++){let Y=L*l+Z;L===0||N||Z===0||Z===l-2?(M.emplaceBack(Y+1,Y,Y+V),M.emplaceBack(Y+V,Y+V+1,Y+1)):(o.emplaceBack(Y+1,Y,Y+V),o.emplaceBack(Y+V,Y+V+1,Y+1))}}let D=er.simpleSegment(0,E,i.length,o.length-E);for(let L=0;L<M.uint16.length;L+=3)o.emplaceBack(M.uint16[L],M.uint16[L+1],M.uint16[L+2]);let P=er.simpleSegment(0,E,i.length,o.length-E);a.push({withoutSkirts:D,withSkirts:P})}return{vertices:i,indices:o,segments:a}}_createGrid(t){let e=this._fillGridMeshWithLods(ud,yy);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Px.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){let e=new Mr;for(let h=0;h<=ud;h++)e.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);let i=new Qu,o=new Qu,a=new Qu,l=new Qu;this._poleSegments=[];for(let h=0,g=0;h<_y;h++){let y=360/(1<<h);i.emplaceBack(0,-zo,0,.5,0),o.emplaceBack(0,-zo,0,.5,1),a.emplaceBack(0,-zo,0,.5,.5),l.emplaceBack(0,-zo,0,.5,.5);for(let x=0;x<=ud;x++){let E=x/ud,I=0,M=si(0,y,E),[D,P,L]=hd(nA,rA,M,zo);i.emplaceBack(D,P,L,E,I),o.emplaceBack(D,P,L,E,1-I);let N=Si(M);E=.5+.5*Math.sin(N),I=.5+.5*Math.cos(N),a.emplaceBack(D,P,L,E,I),l.emplaceBack(D,P,L,E,1-I)}this._poleSegments.push(er.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,Wm,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(o,Wm,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(a,Wm,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(l,Wm,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},r.d5=function(t){return Na.has(t)},r.d6=fu,r.d7=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.d8=qo,r.d9=bx,r.dA=cf,r.dB=function(t){let e=mc();if(!e)return;let i=e.delete(Os);t&&i.catch(t).then(()=>t())},r.dC=lf,r.dD=Ow,r.dE=function(t){_v=Br.resolveURL(t),Ad||(Ad=new mv(Pg(),new Hr)),Ad.broadcast("setDracoUrl",_v)},r.dF=Lw,r.dG=function(t){Cd=Br.resolveURL(t),Ad||(Ad=new mv(Pg(),new Hr)),Ad.broadcast("setMeshoptUrl",Cd)},r.dH=bt,r.dI=jc,r.dJ=Qa,r.dK=$w,r.dL=Zw,r.dM=C1,r.dN=Aa,r.dO=nw,r.dP=function(t,e,i,o,a,l,h,g,y,x,E){t.createArrays(),t.tilePixelRatio=pt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;let I=t.layers[0].layout,M=t.layers[0]._unevaluatedLayout._values,D={};if(t.textSizeData.kind==="composite"){let{minZoom:V,maxZoom:Z}=t.textSizeData;D.compositeTextSizes=[M["text-size"].possiblyEvaluate(new $(V),g),M["text-size"].possiblyEvaluate(new $(Z),g)]}if(t.iconSizeData.kind==="composite"){let{minZoom:V,maxZoom:Z}=t.iconSizeData;D.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new $(V),g),M["icon-size"].possiblyEvaluate(new $(Z),g)]}D.layoutTextSize=M["text-size"].possiblyEvaluate(new $(y+1),g),D.layoutIconSize=M["icon-size"].possiblyEvaluate(new $(y+1),g),D.textMaxSize=M["text-size"].possiblyEvaluate(new $(18),g);let P=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",L=I.get("text-size"),N=!1;for(let V of t.features)if(V.icon&&V.icon.nameSecondary){N=!0;break}for(let V of t.features){let Z=I.get("text-font").evaluate(V,{},g).join(","),Y=L.evaluate(V,{},g),Q=D.layoutTextSize.evaluate(V,{},g),ae=(D.layoutIconSize.evaluate(V,{},g),{horizontal:{},vertical:void 0}),te=V.text,ce,he=[0,0];if(te){let Te=te.toString(),Le=I.get("text-letter-spacing").evaluate(V,{},g)*eo,Oe=I.get("text-line-height").evaluate(V,{},g)*eo,ke=u(Te)?Le:0,$e=I.get("text-anchor").evaluate(V,{},g),qe=I.get("text-variable-anchor");if(!qe){let yt=I.get("text-radial-offset").evaluate(V,{},g);he=yt?lw($e,[yt*eo,iv]):I.get("text-offset").evaluate(V,{},g).map(Ke=>Ke*eo)}let Xe=P?"center":I.get("text-justify").evaluate(V,{},g),Qe=I.get("symbol-placement")==="point",Fe=Qe?I.get("text-max-width").evaluate(V,{},g)*eo:1/0,It=yt=>{t.allowVerticalPlacement&&s(Te)&&(ae.vertical=Ky(te,e,i,a,Z,Fe,Oe,$e,yt,ke,he,js.vertical,!0,Q,Y))};if(!P&&qe){let yt=Xe==="auto"?qe.map(Ut=>nv(Ut)):[Xe],Ke=!1;for(let Ut=0;Ut<yt.length;Ut++){let Pt=yt[Ut];if(!ae.horizontal[Pt])if(Ke)ae.horizontal[Pt]=ae.horizontal[0];else{let St=Ky(te,e,i,a,Z,Fe,Oe,"center",Pt,ke,he,js.horizontal,!1,Q,Y);St&&(ae.horizontal[Pt]=St,Ke=St.positionedLines.length===1)}}It("left")}else{if(Xe==="auto"&&(Xe=nv($e)),Qe||I.get("text-writing-mode").indexOf("horizontal")>=0||!s(Te)){let yt=Ky(te,e,i,a,Z,Fe,Oe,$e,Xe,ke,he,js.horizontal,!1,Q,Y);yt&&(ae.horizontal[Xe]=yt)}It(Qe?"left":Xe)}}let be=!1;if(V.icon&&V.icon.namePrimary){let Te=o[V.icon.namePrimary];Te&&(ce=B2(a[V.icon.namePrimary],V.icon.nameSecondary?a[V.icon.nameSecondary]:void 0,I.get("icon-offset").evaluate(V,{},g),I.get("icon-anchor").evaluate(V,{},g)),be=Te.sdf,t.sdfIcons===void 0?t.sdfIcons=Te.sdf:t.sdfIcons!==Te.sdf&&Mn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Te.pixelRatio!==t.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}let Pe=uw(ae.horizontal)||ae.vertical;t.iconsInText||(t.iconsInText=!!Pe&&Pe.iconsInText),(Pe||ce)&&$2(t,V,ae,ce,o,D,Q,0,he,be,h,g,x,E,N)}l&&t.generateCollisionDebugBuffers(y,t.collisionBoxArray)},r.dQ=Wy,r.dR=wd,r.dS=sg,r.dT=ng,r.dU=ig,r.dV=Sn,r.dW=B1,r.dX=sn,r.dY=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==zw){let i=new Uint32Array(t,0,7),[,,o,a,l,h]=i;e=i.byteLength+a+l+h+l,(o!==t.byteLength||e>=t.byteLength)&&Mn("Invalid b3dm header information.")}return jw(t,e)},r.dZ=function(t,e){let i=qw(t);for(let o of i){for(let a of o.meshes)BD(a);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(ND(o.lights,e)))}return i},r.d_=Fg,r.da=Ku,r.db=function([t,e,i]){let o=Math.hypot(t,e,i),a=Math.atan2(t,i),l=.5*Math.PI-Math.acos(-e/o);return new Bi(zr(a),zr(l))},r.dc=dd,r.dd=ee,r.de=Fy,r.df=Nx,r.dg=function(t){let e=[0,0,0],i=r.a9.identity(new Float64Array(16));return r.a9.multiply(i,t.pixelMatrix,t.globeMatrix),r.Q.transformMat4(e,e,i),new ct(e[0],e[1])},r.dh=function(t){let e=t.navigator?t.navigator.userAgent:null;return!!function(i){if(sa==null){let o=i.navigator?i.navigator.userAgent:null;sa=!!i.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return sa}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.di=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){let t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",dl,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Ie(t))return t;let i=We(t);return i.params.push(`sdk=js-${k}`),i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Ie(t))return t;let i=We(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeModelURL(t,e){if(!Ie(t))return t;let i=We(t);return i.path=`/models/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,o){if(!Ie(t))return t;let a=We(t);return a.path=`/v4/${a.authority}.json`,a.params.push("secure"),i&&a.params.push(`language=${i}`),o&&a.params.push(`worldview=${o}`),this._makeAPIURL(a,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,o){let a=We(t);return Ie(t)?(a.path=`/styles/v1${a.path}/sprite${e}${i}`,this._makeAPIURL(a,this._customAccessToken||o)):(a.path+=`${e}${i}`,Ct(a))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Ie(t))return t;let o=We(t);o.path=o.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&o.authority!=="raster"&&i===512?"@2x":""}${Oa.supported?".webp":"$1"}`),o.authority==="raster"?o.path=`/${ee.RASTER_URL_PREFIX}${o.path}`:o.authority==="rasterarrays"?o.path=`/${ee.RASTERARRAYS_URL_PREFIX}${o.path}`:(o.path=o.path.replace(/^.+\/v4\//,"/"),o.path=`/${ee.TILE_URL_VERSION}${o.path}`);let a=this._customAccessToken||function(l){for(let h of l){let g=h.match(/^access_token=(.*)$/);if(g)return g[1]}return null}(o.params)||ee.ACCESS_TOKEN;return ee.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&o.params.push(`sku=${this._skuToken}`),this._makeAPIURL(o,a)}canonicalizeTileURL(t,e){let i=We(t);if(!i.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let o="mapbox://";i.path.match(/^\/raster\/v1\//)?o+=`raster/${i.path.replace(`/${ee.RASTER_URL_PREFIX}/`,"")}`:i.path.match(/^\/rasterarrays\/v1\//)?o+=`rasterarrays/${i.path.replace(`/${ee.RASTERARRAYS_URL_PREFIX}/`,"")}`:o+=`tiles/${i.path.replace(`/${ee.TILE_URL_VERSION}/`,"")}`;let a=i.params;return e&&(a=a.filter(l=>!l.match(/^access_token=/))),a.length&&(o+=`?${a.join("&")}`),o}canonicalizeTileset(t,e){let i=!!e&&Ie(e),o=[];for(let a of t.tiles||[])de(a)?o.push(this.canonicalizeTileURL(a,i)):o.push(a);return o}_makeAPIURL(t,e){let i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",o=We(ee.API_URL);if(t.protocol=o.protocol,t.authority=o.authority,t.protocol==="http"){let a=t.params.indexOf("secure");a>=0&&t.params.splice(a,1)}if(o.path!=="/"&&(t.path=`${o.path}${t.path}`),!ee.REQUIRE_ACCESS_TOKEN)return Ct(t);if(e=e||ee.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(a=>a.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),Ct(t)}},r.dj=function(t,e){e?Na.add(t):Na.delete(t)},r.dk=Oa,r.dl=Tr,r.dm=ca,r.dn=_c,r.dp=pn,r.dq=ps,r.dr=function(t){Na.delete(t)},r.ds=ko,r.dt=wr,r.du=k,r.dv=function(t,e){Zo=t,zh=e},r.dw=function(t,e,i=!1){if(U===R||U===O||U===F)throw new Error("setRTLTextPlugin cannot be called multiple times.");j=Br.resolveURL(t),U=R,B=e,q(),i||ie()},r.dx=ne,r.dy=function(){Pg().acquire(gv)},r.dz=function(){let t=uf;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(gv),uf=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.e=bo,r.e0=oe,r.e1=function(t){ka(),Po&&Po.then(e=>{e.keys().then(i=>{for(let o=0;o<i.length-t;o++)e.delete(i[o])})})},r.f=Br,r.g=function(t,e){return Vl(bo(t,{type:"json"}),e)},r.h=Vs,r.i=class extends Dg{},r.j=ml,r.k=Ua,r.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>jw(e,0,t))},r.m=rd,r.n=Pm,r.o=sd,r.p=iw,r.q=De,r.r=Lm,r.s=Dc,r.t=Rc,r.u=Se,r.v=ku,r.w=Mn,r.x=Lu,r.y=yl}),f(["./shared"],function(r){"use strict";function k(et){let J=et?et.url.toString():void 0;return J?performance.getEntriesByName(J):[]}function W(et){if(typeof et=="number"||typeof et=="boolean"||typeof et=="string"||et==null)return JSON.stringify(et);if(Array.isArray(et)){let se="[";for(let _e of et)se+=`${W(_e)},`;return`${se}]`}let J="{";for(let se of Object.keys(et).sort())J+=`${se}:${W(et[se])},`;return`${J}}`}function ee(et){let J="";for(let se of r.b5)J+=`/${W(et[se])}`;return J}class de{constructor(J){this.keyCache={},this._layers={},this._layerConfigs={},J&&this.replace(J)}replace(J,se){this._layerConfigs={},this._layers={},this.update(J,[],se)}update(J,se,_e){this._options=_e;for(let Ze of J)this._layerConfigs[Ze.id]=Ze,(this._layers[Ze.id]=r.c7(Ze,this.scope,this._options)).compileFilter(),this.keyCache[Ze.id]&&delete this.keyCache[Ze.id];for(let Ze of se)delete this.keyCache[Ze],delete this._layerConfigs[Ze],delete this._layers[Ze];this.familiesBySource={};let Ge=function(Ze,nt){let Mt={};for(let _t=0;_t<Ze.length;_t++){let xt=nt&&nt[Ze[_t].id]||ee(Ze[_t]);nt&&(nt[Ze[_t].id]=xt);let Dt=Mt[xt];Dt||(Dt=Mt[xt]=[]),Dt.push(Ze[_t])}let Ve=[];for(let _t in Mt)Ve.push(Mt[_t]);return Ve}(r.b2(this._layerConfigs),this.keyCache);for(let Ze of Ge){let nt=Ze.map(mt=>this._layers[mt.id]),Mt=nt[0];if(Mt.visibility==="none")continue;let Ve=Mt.source||"",_t=this.familiesBySource[Ve];_t||(_t=this.familiesBySource[Ve]={});let xt=Mt.sourceLayer||"_geojsonTileLayer",Dt=_t[xt];Dt||(Dt=_t[xt]=[]),Dt.push(nt)}}}let Ie=1*r.dJ;class Ne{constructor(J){let se={},_e=[];for(let Mt in J){let Ve=J[Mt],_t=se[Mt]={};for(let xt in Ve.glyphs){let Dt=Ve.glyphs[+xt];if(!Dt||Dt.bitmap.width===0||Dt.bitmap.height===0)continue;let mt=Dt.metrics.localGlyph?Ie:1,tn={x:0,y:0,w:Dt.bitmap.width+2*mt,h:Dt.bitmap.height+2*mt};_e.push(tn),_t[xt]=tn}}let{w:Ge,h:Ze}=r.p(_e),nt=new r.dI({width:Ge||1,height:Ze||1});for(let Mt in J){let Ve=J[Mt];for(let _t in Ve.glyphs){let xt=Ve.glyphs[+_t];if(!xt||xt.bitmap.width===0||xt.bitmap.height===0)continue;let Dt=se[Mt][_t],mt=xt.metrics.localGlyph?Ie:1;r.dI.copy(xt.bitmap,nt,{x:0,y:0},{x:Dt.x+mt,y:Dt.y+mt},xt.bitmap)}}this.image=nt,this.positions=se}}r.dH(Ne,"GlyphAtlas");class lt{constructor(J){this.tileID=new r.ap(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.tileZoom=J.tileZoom,this.uid=J.uid,this.zoom=J.zoom,this.canonical=J.tileID.canonical,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.scope=J.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=J.showCollisionBoxes,this.collectResourceTiming=!!J.collectResourceTiming,this.promoteId=J.promoteId,this.isSymbolTile=J.isSymbolTile,this.tileTransform=r.av(J.tileID.canonical,J.projection),this.projection=J.projection,this.brightness=J.brightness,this.extraShadowCaster=!!J.extraShadowCaster}parse(J,se,_e,Ge,Ze){this.status="parsing",this.data=J,this.collisionBoxArray=new r.aG;let nt=new r.dK(Object.keys(J.layers).sort()),Mt=new r.dL(this.tileID,this.promoteId);Mt.bucketLayerIDs=[];let Ve={},_t=new r.dM(256,256),xt={featureIndex:Mt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:_t,availableImages:_e,brightness:this.brightness},Dt=se.familiesBySource[this.source];for(let Ji in Dt){let yn=J.layers[Ji];if(!yn)continue;let En=!1,an=!1,Lr=!1;for(let Yn of Dt[Ji])Yn[0].type==="symbol"?En=!0:an=!0,Yn[0].is3D()&&Yn[0].type!=="model"&&(Lr=!0);if(this.extraShadowCaster&&!Lr||this.isSymbolTile===!0&&!En||this.isSymbolTile===!1&&!an)continue;yn.version===1&&r.w(`Vector tile source "${this.source}" layer "${Ji}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let Fr=nt.encode(Ji),Uo=[];for(let Yn=0;Yn<yn.length;Yn++){let Dn=yn.feature(Yn),Be=Mt.getId(Dn,Ji);Uo.push({feature:Dn,id:Be,index:Yn,sourceLayerIndex:Fr})}for(let Yn of Dt[Ji]){let Dn=Yn[0];(!this.extraShadowCaster||Dn.is3D()&&Dn.type!=="model")&&(this.isSymbolTile!==void 0&&Dn.type==="symbol"!==this.isSymbolTile||Dn.minzoom&&this.zoom<Math.floor(Dn.minzoom)||Dn.maxzoom&&this.zoom>=Dn.maxzoom||Dn.visibility!=="none"&&(it(Yn,this.zoom,xt.brightness,_e),(Ve[Dn.id]=Dn.createBucket({index:Mt.bucketLayerIDs.length,layers:Yn,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Fr,sourceID:this.source,projection:this.projection.spec})).populate(Uo,xt,this.tileID.canonical,this.tileTransform),Mt.bucketLayerIDs.push(Yn.map(Be=>Be.id))))}}let mt,tn,Mi,Ki;_t.trim();let Fi={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ci=()=>{if(mt)return this.status="done",Ze(mt);if(this.extraShadowCaster)this.status="done",Ze(null,{buckets:r.b2(Ve).filter(Ji=>!Ji.isEmpty()),featureIndex:Mt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:xt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(tn&&Mi&&Ki){let Ji=new Ne(tn),yn=new r.dO(Mi,Ki);for(let En in Ve){let an=Ve[En];an instanceof r.aH?(it(an.layers,this.zoom,xt.brightness,_e),r.dP(an,tn,Ji.positions,Mi,yn.iconPositions,this.showCollisionBoxes,_e,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):an.hasPattern&&(an instanceof r.aN||an instanceof r.aO||an instanceof r.cO)&&(it(an.layers,this.zoom,xt.brightness,_e),an.addFeatures(xt,this.tileID.canonical,yn.patternPositions,_e,this.tileTransform,this.brightness))}this.status="done",Ze(null,{buckets:r.b2(Ve).filter(En=>!En.isEmpty()),featureIndex:Mt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ji.image,lineAtlas:_t,imageAtlas:yn,brightness:xt.brightness})}};if(!this.extraShadowCaster){let Ji=r.dN(xt.glyphDependencies,an=>Object.keys(an).map(Number));Object.keys(Ji).length?Ge.send("getGlyphs",{uid:this.uid,stacks:Ji,scope:this.scope},(an,Lr)=>{mt||(mt=an,tn=Lr,Ci())},void 0,!1,Fi):tn={};let yn=Object.keys(xt.iconDependencies);yn.length?Ge.send("getImages",{icons:yn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(an,Lr)=>{mt||(mt=an,Mi=Lr,Ci())},void 0,!1,Fi):Mi={};let En=Object.keys(xt.patternDependencies);En.length?Ge.send("getImages",{icons:En,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(an,Lr)=>{mt||(mt=an,Ki=Lr,Ci())},void 0,!1,Fi):Ki={}}Ci()}}function it(et,J,se,_e){let Ge=new r.N(J,{brightness:se});for(let Ze of et)Ze.recalculate(Ge,_e)}class Gt extends r.E{constructor(J,se,_e,Ge,Ze,nt){super(),this.actor=J,this.layerIndex=se,this.availableImages=_e,this.loadVectorData=Ze||r.ak,this.loading={},this.loaded={},this.deduped=new r.ai(J.scheduler),this.isSpriteLoaded=Ge,this.scheduler=J.scheduler,this.brightness=nt}loadTile(J,se){let _e=J.uid,Ge=J&&J.request,Ze=Ge&&Ge.collectResourceTiming,nt=this.loading[_e]=new lt(J);nt.abort=this.loadVectorData(J,(Mt,Ve)=>{let _t=!this.loading[_e];if(delete this.loading[_e],_t||Mt||!Ve)return nt.status="done",_t||(this.loaded[_e]=nt),se(Mt);let xt=Ve.rawData,Dt={};Ve.expires&&(Dt.expires=Ve.expires),Ve.cacheControl&&(Dt.cacheControl=Ve.cacheControl),nt.vectorTile=Ve.vectorTile||new r.dQ(new r.dR(xt));let mt=()=>{nt.parse(nt.vectorTile,this.layerIndex,this.availableImages,this.actor,(tn,Mi)=>{if(tn||!Mi)return se(tn);let Ki={};if(Ze){let Fi=k(Ge);Fi.length>0&&(Ki.resourceTiming=JSON.parse(JSON.stringify(Fi)))}se(null,r.e({rawTileData:xt.slice(0)},Mi,Dt,Ki))})};this.isSpriteLoaded?mt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(mt,{type:"parseTile",isSymbolTile:J.isSymbolTile,zoom:J.tileZoom}):mt()}),this.loaded=this.loaded||{},this.loaded[_e]=nt})}reloadTile(J,se){let _e=this.loaded,Ge=J.uid,Ze=this;if(_e&&_e[Ge]){let nt=_e[Ge];nt.showCollisionBoxes=J.showCollisionBoxes,nt.projection=J.projection,nt.brightness=J.brightness,nt.tileTransform=r.av(J.tileID.canonical,J.projection),nt.extraShadowCaster=J.extraShadowCaster;let Mt=(Ve,_t)=>{let xt=nt.reloadCallback;xt&&(delete nt.reloadCallback,nt.parse(nt.vectorTile,Ze.layerIndex,this.availableImages,Ze.actor,xt)),se(Ve,_t)};nt.status==="parsing"?nt.reloadCallback=Mt:nt.status==="done"&&(nt.vectorTile?nt.parse(nt.vectorTile,this.layerIndex,this.availableImages,this.actor,Mt):Mt())}else se(null,void 0)}abortTile(J,se){let _e=J.uid,Ge=this.loading[_e];Ge&&(Ge.abort&&Ge.abort(),delete this.loading[_e]),se()}removeTile(J,se){let _e=this.loaded,Ge=J.uid;_e&&_e[Ge]&&delete _e[Ge],se()}}class Ei{loadTile(J,se){let{uid:_e,encoding:Ge,rawImageData:Ze,padding:nt}=J,Mt=ImageBitmap&&Ze instanceof ImageBitmap?this.getImageData(Ze,nt):Ze;se(null,new r.dS(_e,Mt,Ge,nt<1))}getImageData(J,se){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(J.width,J.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=J.width,this.offscreenCanvas.height=J.height,this.offscreenCanvasContext.drawImage(J,0,0,J.width,J.height);let _e=this.offscreenCanvasContext.getImageData(-se,-se,J.width+2*se,J.height+2*se);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),_e}}class sn{decodeRasterArray({task:J,buffer:se},_e){r.b0.performDecoding(se,J).then(Ge=>{_e(null,Ge)},Ge=>{_e(Ge)})}}let Xt=r.dT.prototype.toGeoJSON,ni=class{constructor(et){this._feature=et,this.extent=r.Y,this.type=et.type,this.properties=et.tags,"id"in et&&!isNaN(et.id)&&(this.id=parseInt(et.id,10))}loadGeometry(){if(this._feature.type===1){let et=[];for(let J of this._feature.geometry)et.push([new r.P(J[0],J[1])]);return et}{let et=[];for(let J of this._feature.geometry){let se=[];for(let _e of J)se.push(new r.P(_e[0],_e[1]));et.push(se)}return et}}toGeoJSON(et,J,se){return Xt.call(this,et,J,se)}},Io=class{constructor(et){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.Y,this.length=et.length,this._features=et}feature(et){return new ni(this._features[et])}};var In={exports:{}},rs=r.dV,jn=r.dU.VectorTileFeature,Ni=_o;function _o(et,J){this.options=J||{},this.features=et,this.length=et.length}function Rr(et,J){this.id=typeof et.id=="number"?et.id:void 0,this.type=et.type,this.rawGeometry=et.type===1?[et.geometry]:et.geometry,this.properties=et.tags,this.extent=J||4096}_o.prototype.feature=function(et){return new Rr(this.features[et],this.options.extent)},Rr.prototype.loadGeometry=function(){var et=this.rawGeometry;this.geometry=[];for(var J=0;J<et.length;J++){for(var se=et[J],_e=[],Ge=0;Ge<se.length;Ge++)_e.push(new rs(se[Ge][0],se[Ge][1]));this.geometry.push(_e)}return this.geometry},Rr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var et=this.geometry,J=1/0,se=-1/0,_e=1/0,Ge=-1/0,Ze=0;Ze<et.length;Ze++)for(var nt=et[Ze],Mt=0;Mt<nt.length;Mt++){var Ve=nt[Mt];J=Math.min(J,Ve.x),se=Math.max(se,Ve.x),_e=Math.min(_e,Ve.y),Ge=Math.max(Ge,Ve.y)}return[J,_e,se,Ge]},Rr.prototype.toGeoJSON=jn.prototype.toGeoJSON;var Gr=r.dW,Rl=Ni;function Xn(et){var J=new Gr;return function(se,_e){for(var Ge in se.layers)_e.writeMessage(3,un,se.layers[Ge])}(et,J),J.finish()}function un(et,J){var se;J.writeVarintField(15,et.version||1),J.writeStringField(1,et.name||""),J.writeVarintField(5,et.extent||4096);var _e={keys:[],values:[],keycache:{},valuecache:{}};for(se=0;se<et.length;se++)_e.feature=et.feature(se),J.writeMessage(2,As,_e);var Ge=_e.keys;for(se=0;se<Ge.length;se++)J.writeStringField(3,Ge[se]);var Ze=_e.values;for(se=0;se<Ze.length;se++)J.writeMessage(4,Pi,Ze[se])}function As(et,J){var se=et.feature;se.id!==void 0&&J.writeVarintField(1,se.id),J.writeMessage(2,qr,et),J.writeVarintField(3,se.type),J.writeMessage(4,Ks,se)}function qr(et,J){var se=et.feature,_e=et.keys,Ge=et.values,Ze=et.keycache,nt=et.valuecache;for(var Mt in se.properties){var Ve=se.properties[Mt],_t=Ze[Mt];if(Ve!==null){_t===void 0&&(_e.push(Mt),Ze[Mt]=_t=_e.length-1),J.writeVarint(_t);var xt=typeof Ve;xt!=="string"&&xt!=="boolean"&&xt!=="number"&&(Ve=JSON.stringify(Ve));var Dt=xt+":"+Ve,mt=nt[Dt];mt===void 0&&(Ge.push(Ve),nt[Dt]=mt=Ge.length-1),J.writeVarint(mt)}}}function no(et,J){return(J<<3)+(7&et)}function Ys(et){return et<<1^et>>31}function Ks(et,J){for(var se=et.loadGeometry(),_e=et.type,Ge=0,Ze=0,nt=se.length,Mt=0;Mt<nt;Mt++){var Ve=se[Mt],_t=1;_e===1&&(_t=Ve.length),J.writeVarint(no(1,_t));for(var xt=_e===3?Ve.length-1:Ve.length,Dt=0;Dt<xt;Dt++){Dt===1&&_e!==1&&J.writeVarint(no(2,xt-1));var mt=Ve[Dt].x-Ge,tn=Ve[Dt].y-Ze;J.writeVarint(Ys(mt)),J.writeVarint(Ys(tn)),Ge+=mt,Ze+=tn}_e===3&&J.writeVarint(no(7,1))}}function Pi(et,J){var se=typeof et;se==="string"?J.writeStringField(1,et):se==="boolean"?J.writeBooleanField(7,et):se==="number"&&(et%1!=0?J.writeDoubleField(3,et):et<0?J.writeSVarintField(6,et):J.writeVarintField(5,et))}In.exports=Xn,In.exports.fromVectorTileJs=Xn,In.exports.fromGeojsonVt=function(et,J){J=J||{};var se={};for(var _e in et)se[_e]=new Rl(et[_e].features,J),se[_e].name=_e,se[_e].version=J.version,se[_e].extent=J.extent;return Xn({layers:se})},In.exports.GeoJSONWrapper=Rl;var Js=r.dX(In.exports);let xn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:et=>et},So=Math.fround||($r=new Float32Array(1),et=>($r[0]=+et,$r[0]));var $r;let Wn=3,jt=5,os=6;class ki{constructor(J){this.options=Object.assign(Object.create(xn),J),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(J){let{log:se,minZoom:_e,maxZoom:Ge}=this.options;se&&console.time("total time");let Ze=`prepare ${J.length} points`;se&&console.time(Ze),this.points=J;let nt=[];for(let Ve=0;Ve<J.length;Ve++){let _t=J[Ve];if(!_t.geometry)continue;let[xt,Dt]=_t.geometry.coordinates,mt=So(ea(xt)),tn=So(ta(Dt));nt.push(mt,tn,1/0,Ve,-1,1),this.options.reduce&&nt.push(0)}let Mt=this.trees[Ge+1]=this._createTree(nt);se&&console.timeEnd(Ze);for(let Ve=Ge;Ve>=_e;Ve--){let _t=+Date.now();Mt=this.trees[Ve]=this._createTree(this._cluster(Mt,Ve)),se&&console.log("z%d: %d clusters in %dms",Ve,Mt.numItems,+Date.now()-_t)}return se&&console.timeEnd("total time"),this}getClusters(J,se){let _e=((J[0]+180)%360+360)%360-180,Ge=Math.max(-90,Math.min(90,J[1])),Ze=J[2]===180?180:((J[2]+180)%360+360)%360-180,nt=Math.max(-90,Math.min(90,J[3]));if(J[2]-J[0]>=360)_e=-180,Ze=180;else if(_e>Ze){let Dt=this.getClusters([_e,Ge,180,nt],se),mt=this.getClusters([-180,Ge,Ze,nt],se);return Dt.concat(mt)}let Mt=this.trees[this._limitZoom(se)],Ve=Mt.range(ea(_e),ta(nt),ea(Ze),ta(Ge)),_t=Mt.data,xt=[];for(let Dt of Ve){let mt=this.stride*Dt;xt.push(_t[mt+jt]>1?Oi(_t,mt,this.clusterProps):this.points[_t[mt+Wn]])}return xt}getChildren(J){let se=this._getOriginId(J),_e=this._getOriginZoom(J),Ge="No cluster with the specified id.",Ze=this.trees[_e];if(!Ze)throw new Error(Ge);let nt=Ze.data;if(se*this.stride>=nt.length)throw new Error(Ge);let Mt=this.options.radius/(this.options.extent*Math.pow(2,_e-1)),Ve=Ze.within(nt[se*this.stride],nt[se*this.stride+1],Mt),_t=[];for(let xt of Ve){let Dt=xt*this.stride;nt[Dt+4]===J&&_t.push(nt[Dt+jt]>1?Oi(nt,Dt,this.clusterProps):this.points[nt[Dt+Wn]])}if(_t.length===0)throw new Error(Ge);return _t}getLeaves(J,se,_e){let Ge=[];return this._appendLeaves(Ge,J,se=se||10,_e=_e||0,0),Ge}getTile(J,se,_e){let Ge=this.trees[this._limitZoom(J)],Ze=Math.pow(2,J),{extent:nt,radius:Mt}=this.options,Ve=Mt/nt,_t=(_e-Ve)/Ze,xt=(_e+1+Ve)/Ze,Dt={features:[]};return this._addTileFeatures(Ge.range((se-Ve)/Ze,_t,(se+1+Ve)/Ze,xt),Ge.data,se,_e,Ze,Dt),se===0&&this._addTileFeatures(Ge.range(1-Ve/Ze,_t,1,xt),Ge.data,Ze,_e,Ze,Dt),se===Ze-1&&this._addTileFeatures(Ge.range(0,_t,Ve/Ze,xt),Ge.data,-1,_e,Ze,Dt),Dt.features.length?Dt:null}getClusterExpansionZoom(J){let se=this._getOriginZoom(J)-1;for(;se<=this.options.maxZoom;){let _e=this.getChildren(J);if(se++,_e.length!==1)break;J=_e[0].properties.cluster_id}return se}_appendLeaves(J,se,_e,Ge,Ze){let nt=this.getChildren(se);for(let Mt of nt){let Ve=Mt.properties;if(Ve&&Ve.cluster?Ze+Ve.point_count<=Ge?Ze+=Ve.point_count:Ze=this._appendLeaves(J,Ve.cluster_id,_e,Ge,Ze):Ze<Ge?Ze++:J.push(Mt),J.length===_e)break}return Ze}_createTree(J){let se=new r.bj(J.length/this.stride|0,this.options.nodeSize,Float32Array);for(let _e=0;_e<J.length;_e+=this.stride)se.add(J[_e],J[_e+1]);return se.finish(),se.data=J,se}_addTileFeatures(J,se,_e,Ge,Ze,nt){for(let Mt of J){let Ve=Mt*this.stride,_t=se[Ve+jt]>1,xt,Dt,mt;if(_t)xt=Ia(se,Ve,this.clusterProps),Dt=se[Ve],mt=se[Ve+1];else{let Ki=this.points[se[Ve+Wn]];xt=Ki.properties;let[Fi,Ci]=Ki.geometry.coordinates;Dt=ea(Fi),mt=ta(Ci)}let tn={type:1,geometry:[[Math.round(this.options.extent*(Dt*Ze-_e)),Math.round(this.options.extent*(mt*Ze-Ge))]],tags:xt},Mi;Mi=_t||this.options.generateId?se[Ve+Wn]:this.points[se[Ve+Wn]].id,Mi!==void 0&&(tn.id=Mi),nt.features.push(tn)}}_limitZoom(J){return Math.max(this.options.minZoom,Math.min(Math.floor(+J),this.options.maxZoom+1))}_cluster(J,se){let{radius:_e,extent:Ge,reduce:Ze,minPoints:nt}=this.options,Mt=_e/(Ge*Math.pow(2,se)),Ve=J.data,_t=[],xt=this.stride;for(let Dt=0;Dt<Ve.length;Dt+=xt){if(Ve[Dt+2]<=se)continue;Ve[Dt+2]=se;let mt=Ve[Dt],tn=Ve[Dt+1],Mi=J.within(Ve[Dt],Ve[Dt+1],Mt),Ki=Ve[Dt+jt],Fi=Ki;for(let Ci of Mi){let Ji=Ci*xt;Ve[Ji+2]>se&&(Fi+=Ve[Ji+jt])}if(Fi>Ki&&Fi>=nt){let Ci,Ji=mt*Ki,yn=tn*Ki,En=-1,an=(Dt/xt<<5)+(se+1)+this.points.length;for(let Lr of Mi){let Fr=Lr*xt;if(Ve[Fr+2]<=se)continue;Ve[Fr+2]=se;let Uo=Ve[Fr+jt];Ji+=Ve[Fr]*Uo,yn+=Ve[Fr+1]*Uo,Ve[Fr+4]=an,Ze&&(Ci||(Ci=this._map(Ve,Dt,!0),En=this.clusterProps.length,this.clusterProps.push(Ci)),Ze(Ci,this._map(Ve,Fr)))}Ve[Dt+4]=an,_t.push(Ji/Fi,yn/Fi,1/0,an,-1,Fi),Ze&&_t.push(En)}else{for(let Ci=0;Ci<xt;Ci++)_t.push(Ve[Dt+Ci]);if(Fi>1)for(let Ci of Mi){let Ji=Ci*xt;if(!(Ve[Ji+2]<=se)){Ve[Ji+2]=se;for(let yn=0;yn<xt;yn++)_t.push(Ve[Ji+yn])}}}}return _t}_getOriginId(J){return J-this.points.length>>5}_getOriginZoom(J){return(J-this.points.length)%32}_map(J,se,_e){if(J[se+jt]>1){let nt=this.clusterProps[J[se+os]];return _e?Object.assign({},nt):nt}let Ge=this.points[J[se+Wn]].properties,Ze=this.options.map(Ge);return _e&&Ze===Ge?Object.assign({},Ze):Ze}}function Oi(et,J,se){return{type:"Feature",id:et[J+Wn],properties:Ia(et,J,se),geometry:{type:"Point",coordinates:[(_e=et[J],360*(_e-.5)),Ds(et[J+1])]}};var _e}function Ia(et,J,se){let _e=et[J+jt],Ge=_e>=1e4?`${Math.round(_e/1e3)}k`:_e>=1e3?Math.round(_e/100)/10+"k":_e,Ze=et[J+os],nt=Ze===-1?{}:Object.assign({},se[Ze]);return Object.assign(nt,{cluster:!0,cluster_id:et[J+Wn],point_count:_e,point_count_abbreviated:Ge})}function ea(et){return et/360+.5}function ta(et){let J=Math.sin(et*Math.PI/180),se=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return se<0?0:se>1?1:se}function Ds(et){let J=(180-360*et)*Math.PI/180;return 360*Math.atan(Math.exp(J))/Math.PI-90}var rl={exports:{}};rl.exports=function(){function et(Be,je,Ye,st){for(var tt,ut=st,ht=Ye-je>>1,rt=Ye-je,ft=Be[je],at=Be[je+1],Ht=Be[Ye],mi=Be[Ye+1],Rt=je+3;Rt<Ye;Rt+=3){var nn=J(Be[Rt],Be[Rt+1],ft,at,Ht,mi);if(nn>ut)tt=Rt,ut=nn;else if(nn===ut){var Vi=Math.abs(Rt-ht);Vi<rt&&(tt=Rt,rt=Vi)}}ut>st&&(tt-je>3&&et(Be,je,tt,st),Be[tt+2]=ut,Ye-tt>3&&et(Be,tt,Ye,st))}function J(Be,je,Ye,st,tt,ut){var ht=tt-Ye,rt=ut-st;if(ht!==0||rt!==0){var ft=((Be-Ye)*ht+(je-st)*rt)/(ht*ht+rt*rt);ft>1?(Ye=tt,st=ut):ft>0&&(Ye+=ht*ft,st+=rt*ft)}return(ht=Be-Ye)*ht+(rt=je-st)*rt}function se(Be,je,Ye,st){var tt={id:Be===void 0?null:Be,type:je,geometry:Ye,tags:st,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ut){var ht=ut.geometry,rt=ut.type;if(rt==="Point"||rt==="MultiPoint"||rt==="LineString")_e(ut,ht);else if(rt==="Polygon"||rt==="MultiLineString")for(var ft=0;ft<ht.length;ft++)_e(ut,ht[ft]);else if(rt==="MultiPolygon")for(ft=0;ft<ht.length;ft++)for(var at=0;at<ht[ft].length;at++)_e(ut,ht[ft][at])}(tt),tt}function _e(Be,je){for(var Ye=0;Ye<je.length;Ye+=3)Be.minX=Math.min(Be.minX,je[Ye]),Be.minY=Math.min(Be.minY,je[Ye+1]),Be.maxX=Math.max(Be.maxX,je[Ye]),Be.maxY=Math.max(Be.maxY,je[Ye+1])}function Ge(Be,je,Ye,st){if(je.geometry){var tt=je.geometry.coordinates,ut=je.geometry.type,ht=Math.pow(Ye.tolerance/((1<<Ye.maxZoom)*Ye.extent),2),rt=[],ft=je.id;if(Ye.promoteId?ft=je.properties[Ye.promoteId]:Ye.generateId&&(ft=st||0),ut==="Point")Ze(tt,rt);else if(ut==="MultiPoint")for(var at=0;at<tt.length;at++)Ze(tt[at],rt);else if(ut==="LineString")nt(tt,rt,ht,!1);else if(ut==="MultiLineString"){if(Ye.lineMetrics){for(at=0;at<tt.length;at++)nt(tt[at],rt=[],ht,!1),Be.push(se(ft,"LineString",rt,je.properties));return}Mt(tt,rt,ht,!1)}else if(ut==="Polygon")Mt(tt,rt,ht,!0);else{if(ut!=="MultiPolygon"){if(ut==="GeometryCollection"){for(at=0;at<je.geometry.geometries.length;at++)Ge(Be,{id:ft,geometry:je.geometry.geometries[at],properties:je.properties},Ye,st);return}throw new Error("Input data is not a valid GeoJSON object.")}for(at=0;at<tt.length;at++){var Ht=[];Mt(tt[at],Ht,ht,!0),rt.push(Ht)}}Be.push(se(ft,ut,rt,je.properties))}}function Ze(Be,je){je.push(Ve(Be[0])),je.push(_t(Be[1])),je.push(0)}function nt(Be,je,Ye,st){for(var tt,ut,ht=0,rt=0;rt<Be.length;rt++){var ft=Ve(Be[rt][0]),at=_t(Be[rt][1]);je.push(ft),je.push(at),je.push(0),rt>0&&(ht+=st?(tt*at-ft*ut)/2:Math.sqrt(Math.pow(ft-tt,2)+Math.pow(at-ut,2))),tt=ft,ut=at}var Ht=je.length-3;je[2]=1,et(je,0,Ht,Ye),je[Ht+2]=1,je.size=Math.abs(ht),je.start=0,je.end=je.size}function Mt(Be,je,Ye,st){for(var tt=0;tt<Be.length;tt++){var ut=[];nt(Be[tt],ut,Ye,st),je.push(ut)}}function Ve(Be){return Be/360+.5}function _t(Be){var je=Math.sin(Be*Math.PI/180),Ye=.5-.25*Math.log((1+je)/(1-je))/Math.PI;return Ye<0?0:Ye>1?1:Ye}function xt(Be,je,Ye,st,tt,ut,ht,rt){if(st/=je,ut>=(Ye/=je)&&ht<st)return Be;if(ht<Ye||ut>=st)return null;for(var ft=[],at=0;at<Be.length;at++){var Ht=Be[at],mi=Ht.geometry,Rt=Ht.type,nn=tt===0?Ht.minX:Ht.minY,Vi=tt===0?Ht.maxX:Ht.maxY;if(nn>=Ye&&Vi<st)ft.push(Ht);else if(!(Vi<Ye||nn>=st)){var Rn=[];if(Rt==="Point"||Rt==="MultiPoint")Dt(mi,Rn,Ye,st,tt);else if(Rt==="LineString")mt(mi,Rn,Ye,st,tt,!1,rt.lineMetrics);else if(Rt==="MultiLineString")Mi(mi,Rn,Ye,st,tt,!1);else if(Rt==="Polygon")Mi(mi,Rn,Ye,st,tt,!0);else if(Rt==="MultiPolygon")for(var qn=0;qn<mi.length;qn++){var Bn=[];Mi(mi[qn],Bn,Ye,st,tt,!0),Bn.length&&Rn.push(Bn)}if(Rn.length){if(rt.lineMetrics&&Rt==="LineString"){for(qn=0;qn<Rn.length;qn++)ft.push(se(Ht.id,Rt,Rn[qn],Ht.tags));continue}Rt!=="LineString"&&Rt!=="MultiLineString"||(Rn.length===1?(Rt="LineString",Rn=Rn[0]):Rt="MultiLineString"),Rt!=="Point"&&Rt!=="MultiPoint"||(Rt=Rn.length===3?"Point":"MultiPoint"),ft.push(se(Ht.id,Rt,Rn,Ht.tags))}}}return ft.length?ft:null}function Dt(Be,je,Ye,st,tt){for(var ut=0;ut<Be.length;ut+=3){var ht=Be[ut+tt];ht>=Ye&&ht<=st&&(je.push(Be[ut]),je.push(Be[ut+1]),je.push(Be[ut+2]))}}function mt(Be,je,Ye,st,tt,ut,ht){for(var rt,ft,at=tn(Be),Ht=tt===0?Fi:Ci,mi=Be.start,Rt=0;Rt<Be.length-3;Rt+=3){var nn=Be[Rt],Vi=Be[Rt+1],Rn=Be[Rt+2],qn=Be[Rt+3],Bn=Be[Rt+4],Ai=tt===0?nn:Vi,yo=tt===0?qn:Bn,vo=!1;ht&&(rt=Math.sqrt(Math.pow(nn-qn,2)+Math.pow(Vi-Bn,2))),Ai<Ye?yo>Ye&&(ft=Ht(at,nn,Vi,qn,Bn,Ye),ht&&(at.start=mi+rt*ft)):Ai>st?yo<st&&(ft=Ht(at,nn,Vi,qn,Bn,st),ht&&(at.start=mi+rt*ft)):Ki(at,nn,Vi,Rn),yo<Ye&&Ai>=Ye&&(ft=Ht(at,nn,Vi,qn,Bn,Ye),vo=!0),yo>st&&Ai<=st&&(ft=Ht(at,nn,Vi,qn,Bn,st),vo=!0),!ut&&vo&&(ht&&(at.end=mi+rt*ft),je.push(at),at=tn(Be)),ht&&(mi+=rt)}var br=Be.length-3;nn=Be[br],Vi=Be[br+1],Rn=Be[br+2],(Ai=tt===0?nn:Vi)>=Ye&&Ai<=st&&Ki(at,nn,Vi,Rn),br=at.length-3,ut&&br>=3&&(at[br]!==at[0]||at[br+1]!==at[1])&&Ki(at,at[0],at[1],at[2]),at.length&&je.push(at)}function tn(Be){var je=[];return je.size=Be.size,je.start=Be.start,je.end=Be.end,je}function Mi(Be,je,Ye,st,tt,ut){for(var ht=0;ht<Be.length;ht++)mt(Be[ht],je,Ye,st,tt,ut,!1)}function Ki(Be,je,Ye,st){Be.push(je),Be.push(Ye),Be.push(st)}function Fi(Be,je,Ye,st,tt,ut){var ht=(ut-je)/(st-je);return Be.push(ut),Be.push(Ye+(tt-Ye)*ht),Be.push(1),ht}function Ci(Be,je,Ye,st,tt,ut){var ht=(ut-Ye)/(tt-Ye);return Be.push(je+(st-je)*ht),Be.push(ut),Be.push(1),ht}function Ji(Be,je){for(var Ye=[],st=0;st<Be.length;st++){var tt,ut=Be[st],ht=ut.type;if(ht==="Point"||ht==="MultiPoint"||ht==="LineString")tt=yn(ut.geometry,je);else if(ht==="MultiLineString"||ht==="Polygon"){tt=[];for(var rt=0;rt<ut.geometry.length;rt++)tt.push(yn(ut.geometry[rt],je))}else if(ht==="MultiPolygon")for(tt=[],rt=0;rt<ut.geometry.length;rt++){for(var ft=[],at=0;at<ut.geometry[rt].length;at++)ft.push(yn(ut.geometry[rt][at],je));tt.push(ft)}Ye.push(se(ut.id,ht,tt,ut.tags))}return Ye}function yn(Be,je){var Ye=[];Ye.size=Be.size,Be.start!==void 0&&(Ye.start=Be.start,Ye.end=Be.end);for(var st=0;st<Be.length;st+=3)Ye.push(Be[st]+je,Be[st+1],Be[st+2]);return Ye}function En(Be,je){if(Be.transformed)return Be;var Ye,st,tt,ut=1<<Be.z,ht=Be.x,rt=Be.y;for(Ye=0;Ye<Be.features.length;Ye++){var ft=Be.features[Ye],at=ft.geometry,Ht=ft.type;if(ft.geometry=[],Ht===1)for(st=0;st<at.length;st+=2)ft.geometry.push(an(at[st],at[st+1],je,ut,ht,rt));else for(st=0;st<at.length;st++){var mi=[];for(tt=0;tt<at[st].length;tt+=2)mi.push(an(at[st][tt],at[st][tt+1],je,ut,ht,rt));ft.geometry.push(mi)}}return Be.transformed=!0,Be}function an(Be,je,Ye,st,tt,ut){return[Math.round(Ye*(Be*st-tt)),Math.round(Ye*(je*st-ut))]}function Lr(Be,je,Ye,st,tt){for(var ut=je===tt.maxZoom?0:tt.tolerance/((1<<je)*tt.extent),ht={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Ye,y:st,z:je,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},rt=0;rt<Be.length;rt++){ht.numFeatures++,Fr(ht,Be[rt],ut,tt);var ft=Be[rt].minX,at=Be[rt].minY,Ht=Be[rt].maxX,mi=Be[rt].maxY;ft<ht.minX&&(ht.minX=ft),at<ht.minY&&(ht.minY=at),Ht>ht.maxX&&(ht.maxX=Ht),mi>ht.maxY&&(ht.maxY=mi)}return ht}function Fr(Be,je,Ye,st){var tt=je.geometry,ut=je.type,ht=[];if(ut==="Point"||ut==="MultiPoint")for(var rt=0;rt<tt.length;rt+=3)ht.push(tt[rt]),ht.push(tt[rt+1]),Be.numPoints++,Be.numSimplified++;else if(ut==="LineString")Uo(ht,tt,Be,Ye,!1,!1);else if(ut==="MultiLineString"||ut==="Polygon")for(rt=0;rt<tt.length;rt++)Uo(ht,tt[rt],Be,Ye,ut==="Polygon",rt===0);else if(ut==="MultiPolygon")for(var ft=0;ft<tt.length;ft++){var at=tt[ft];for(rt=0;rt<at.length;rt++)Uo(ht,at[rt],Be,Ye,!0,rt===0)}if(ht.length){var Ht=je.tags||null;if(ut==="LineString"&&st.lineMetrics){for(var mi in Ht={},je.tags)Ht[mi]=je.tags[mi];Ht.mapbox_clip_start=tt.start/tt.size,Ht.mapbox_clip_end=tt.end/tt.size}var Rt={geometry:ht,type:ut==="Polygon"||ut==="MultiPolygon"?3:ut==="LineString"||ut==="MultiLineString"?2:1,tags:Ht};je.id!==null&&(Rt.id=je.id),Be.features.push(Rt)}}function Uo(Be,je,Ye,st,tt,ut){var ht=st*st;if(st>0&&je.size<(tt?ht:st))Ye.numPoints+=je.length/3;else{for(var rt=[],ft=0;ft<je.length;ft+=3)(st===0||je[ft+2]>ht)&&(Ye.numSimplified++,rt.push(je[ft]),rt.push(je[ft+1])),Ye.numPoints++;tt&&function(at,Ht){for(var mi=0,Rt=0,nn=at.length,Vi=nn-2;Rt<nn;Vi=Rt,Rt+=2)mi+=(at[Rt]-at[Vi])*(at[Rt+1]+at[Vi+1]);if(mi>0===Ht)for(Rt=0,nn=at.length;Rt<nn/2;Rt+=2){var Rn=at[Rt],qn=at[Rt+1];at[Rt]=at[nn-2-Rt],at[Rt+1]=at[nn-1-Rt],at[nn-2-Rt]=Rn,at[nn-1-Rt]=qn}}(rt,ut),Be.push(rt)}}function Yn(Be,je){var Ye=(je=this.options=function(tt,ut){for(var ht in ut)tt[ht]=ut[ht];return tt}(Object.create(this.options),je)).debug;if(Ye&&console.time("preprocess data"),je.maxZoom<0||je.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(je.promoteId&&je.generateId)throw new Error("promoteId and generateId cannot be used together.");var st=function(tt,ut){var ht=[];if(tt.type==="FeatureCollection")for(var rt=0;rt<tt.features.length;rt++)Ge(ht,tt.features[rt],ut,rt);else Ge(ht,tt.type==="Feature"?tt:{geometry:tt},ut);return ht}(Be,je);this.tiles={},this.tileCoords=[],Ye&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",je.indexMaxZoom,je.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(st=function(tt,ut){var ht=ut.buffer/ut.extent,rt=tt,ft=xt(tt,1,-1-ht,ht,0,-1,2,ut),at=xt(tt,1,1-ht,2+ht,0,-1,2,ut);return(ft||at)&&(rt=xt(tt,1,-ht,1+ht,0,-1,2,ut)||[],ft&&(rt=Ji(ft,1).concat(rt)),at&&(rt=rt.concat(Ji(at,-1)))),rt}(st,je)).length&&this.splitTile(st,0,0,0),Ye&&(st.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Dn(Be,je,Ye){return 32*((1<<Be)*Ye+je)+Be}return Yn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Yn.prototype.splitTile=function(Be,je,Ye,st,tt,ut,ht){for(var rt=[Be,je,Ye,st],ft=this.options,at=ft.debug;rt.length;){st=rt.pop(),Ye=rt.pop(),je=rt.pop(),Be=rt.pop();var Ht=1<<je,mi=Dn(je,Ye,st),Rt=this.tiles[mi];if(!Rt&&(at>1&&console.time("creation"),Rt=this.tiles[mi]=Lr(Be,je,Ye,st,ft),this.tileCoords.push({z:je,x:Ye,y:st}),at)){at>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",je,Ye,st,Rt.numFeatures,Rt.numPoints,Rt.numSimplified),console.timeEnd("creation"));var nn="z"+je;this.stats[nn]=(this.stats[nn]||0)+1,this.total++}if(Rt.source=Be,tt){if(je===ft.maxZoom||je===tt)continue;var Vi=1<<tt-je;if(Ye!==Math.floor(ut/Vi)||st!==Math.floor(ht/Vi))continue}else if(je===ft.indexMaxZoom||Rt.numPoints<=ft.indexMaxPoints)continue;if(Rt.source=null,Be.length!==0){at>1&&console.time("clipping");var Rn,qn,Bn,Ai,yo,vo,br=.5*ft.buffer/ft.extent,ss=.5-br,Sa=.5+br,Pr=1+br;Rn=qn=Bn=Ai=null,yo=xt(Be,Ht,Ye-br,Ye+Sa,0,Rt.minX,Rt.maxX,ft),vo=xt(Be,Ht,Ye+ss,Ye+Pr,0,Rt.minX,Rt.maxX,ft),Be=null,yo&&(Rn=xt(yo,Ht,st-br,st+Sa,1,Rt.minY,Rt.maxY,ft),qn=xt(yo,Ht,st+ss,st+Pr,1,Rt.minY,Rt.maxY,ft),yo=null),vo&&(Bn=xt(vo,Ht,st-br,st+Sa,1,Rt.minY,Rt.maxY,ft),Ai=xt(vo,Ht,st+ss,st+Pr,1,Rt.minY,Rt.maxY,ft),vo=null),at>1&&console.timeEnd("clipping"),rt.push(Rn||[],je+1,2*Ye,2*st),rt.push(qn||[],je+1,2*Ye,2*st+1),rt.push(Bn||[],je+1,2*Ye+1,2*st),rt.push(Ai||[],je+1,2*Ye+1,2*st+1)}}},Yn.prototype.getTile=function(Be,je,Ye){var st=this.options,tt=st.extent,ut=st.debug;if(Be<0||Be>24)return null;var ht=1<<Be,rt=Dn(Be,je=(je%ht+ht)%ht,Ye);if(this.tiles[rt])return En(this.tiles[rt],tt);ut>1&&console.log("drilling down to z%d-%d-%d",Be,je,Ye);for(var ft,at=Be,Ht=je,mi=Ye;!ft&&at>0;)at--,Ht=Math.floor(Ht/2),mi=Math.floor(mi/2),ft=this.tiles[Dn(at,Ht,mi)];return ft&&ft.source?(ut>1&&console.log("found parent tile z%d-%d-%d",at,Ht,mi),ut>1&&console.time("drilling down"),this.splitTile(ft.source,at,Ht,mi,Be,je,Ye),ut>1&&console.timeEnd("drilling down"),this.tiles[rt]?En(this.tiles[rt],tt):null):null},function(Be,je){return new Yn(Be,je)}}();var Ii=r.dX(rl.exports);function Pl(et,J){let se=et.tileID.canonical;if(!this._geoJSONIndex)return J(null,null);let _e=this._geoJSONIndex.getTile(se.z,se.x,se.y);if(!_e)return J(null,null);let Ge=new Io(_e.features),Ze=Js(Ge);Ze.byteOffset===0&&Ze.byteLength===Ze.buffer.byteLength||(Ze=new Uint8Array(Ze)),J(null,{vectorTile:Ge,rawData:Ze.buffer})}class Yt extends Gt{constructor(J,se,_e,Ge,Ze,nt){super(J,se,_e,Ge,Pl,nt),Ze&&(this.loadGeoJSON=Ze),this._featureMap=new Map}loadData(J,se){let _e=J&&J.request,Ge=_e&&_e.collectResourceTiming;this.loadGeoJSON(J,(Ze,nt)=>{if(Ze||!nt)return se(Ze);if(typeof nt!="object")return se(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));{try{if(J.filter){let Ve=r.t(J.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ve.result==="error")throw new Error(Ve.value.map(_t=>`${_t.key}: ${_t.message}`).join(", "));nt.features=nt.features.filter(_t=>Ve.value.evaluate({zoom:0},_t))}if(J.dynamic){nt.type==="Feature"&&(nt={type:"FeatureCollection",features:[nt]}),J.append||this._featureMap.clear();for(let Ve of nt.features||[]){let _t=Ve.id;_t!==void 0&&(Ve.geometry?this._featureMap.set(_t,Ve):this._featureMap.delete(_t))}nt.features=[...this._featureMap.values()]}this._geoJSONIndex=J.cluster?new ki(function({superclusterOptions:Ve,clusterProperties:_t}){if(!_t||!Ve)return Ve;let xt={},Dt={},mt={accumulated:null,zoom:0},tn={properties:null},Mi=Object.keys(_t);for(let Ki of Mi){let[Fi,Ci]=_t[Ki],Ji=r.t(Ci),yn=r.t(typeof Fi=="string"?[Fi,["accumulated"],["get",Ki]]:Fi);xt[Ki]=Ji.value,Dt[Ki]=yn.value}return Ve.map=Ki=>{tn.properties=Ki;let Fi={};for(let Ci of Mi)Fi[Ci]=xt[Ci].evaluate(mt,tn);return Fi},Ve.reduce=(Ki,Fi)=>{tn.properties=Fi;for(let Ci of Mi)mt.accumulated=Ki[Ci],Ki[Ci]=Dt[Ci].evaluate(mt,tn)},Ve}(J)).load(nt.features):Ii(nt,J.geojsonVtOptions)}catch(Ve){return se(Ve)}this.loaded={};let Mt={};if(Ge){let Ve=k(_e);Ve&&(Mt.resourceTiming={},Mt.resourceTiming[J.source]=JSON.parse(JSON.stringify(Ve)))}se(null,Mt)}})}reloadTile(J,se){let _e=this.loaded;return _e&&_e[J.uid]?super.reloadTile(J,se):this.loadTile(J,se)}loadGeoJSON(J,se){if(J.request)r.g(J.request,se);else{if(typeof J.data!="string")return se(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));try{return se(null,JSON.parse(J.data))}catch{return se(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(J,se){try{se(null,this._geoJSONIndex.getClusterExpansionZoom(J.clusterId))}catch(_e){se(_e)}}getClusterChildren(J,se){try{se(null,this._geoJSONIndex.getChildren(J.clusterId))}catch(_e){se(_e)}}getClusterLeaves(J,se){try{se(null,this._geoJSONIndex.getLeaves(J.clusterId,J.limit,J.offset))}catch(_e){se(_e)}}}class Wt{constructor(J,se){this.tileID=new r.ap(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.tileZoom=J.tileZoom,this.uid=J.uid,this.zoom=J.zoom,this.canonical=J.tileID.canonical,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=J.projection,this.brightness=se}parse(J,se,_e,Ge){this.status="parsing";let Ze=new r.ap(_e.tileID.overscaledZ,_e.tileID.wrap,_e.tileID.canonical.z,_e.tileID.canonical.x,_e.tileID.canonical.y),nt={},Mt=se.familiesBySource[_e.source],Ve=new r.dL(Ze,_e.promoteId);return Ve.bucketLayerIDs=[],Ve.is3DTile=!0,r.dY(J).then(_t=>{if(!_t)return Ge(new Error("Could not parse tile"));let xt=r.dZ(_t,1/r.bU(_e.tileID.canonical)),Dt=_t.json.extensionsUsed&&_t.json.extensionsUsed.includes("MAPBOX_mesh_features")||_t.json.asset.extras&&_t.json.asset.extras.MAPBOX_mesh_features,mt=_t.json.extensionsUsed&&_t.json.extensionsUsed.includes("EXT_meshopt_compression"),tn=new r.N(this.zoom,{brightness:this.brightness});for(let Mi in Mt)for(let Ki of Mt[Mi]){let Fi=Ki[0];Ve.bucketLayerIDs.push(Ki.map(Ji=>Ji.id)),Fi.recalculate(tn,[]);let Ci=new r.d_(xt,Ze,Dt,mt,this.brightness,Ve);Dt||(Ci.needsUpload=!0),nt[Fi.fqid]=Ci,Ci.evaluate(Fi)}this.status="done",Ge(null,{buckets:nt,featureIndex:Ve})}).catch(_t=>Ge(new Error(_t.message)))}}class Mo{constructor(J,se,_e,Ge,Ze,nt){this.actor=J,this.layerIndex=se,this.brightness=nt,this.loading={},this.loaded={}}loadTile(J,se){let _e=J.uid,Ge=this.loading[_e]=new Wt(J,this.brightness);r.b1(J.request,(Ze,nt)=>{let Mt=!this.loading[_e];return delete this.loading[_e],Mt||Ze?(Ge.status="done",Mt||(this.loaded[_e]=Ge),se(Ze)):nt&&nt.byteLength!==0?void Ge.parse(nt,this.layerIndex,J,(Ve,_t)=>{Ge.status="done",this.loaded=this.loaded||{},this.loaded[_e]=Ge,Ve||!_t?se(Ve):se(null,_t)}):(Ge.status="done",this.loaded[_e]=Ge,se())})}reloadTile(J,se){let _e=this.loaded,Ge=J.uid;if(_e&&_e[Ge]){let Ze=_e[Ge];Ze.projection=J.projection,Ze.brightness=J.brightness;let nt=(Mt,Ve)=>{Ze.reloadCallback&&(delete Ze.reloadCallback,this.loadTile(J,se)),se(Mt,Ve)};Ze.status==="parsing"?Ze.reloadCallback=nt:Ze.status==="done"&&this.loadTile(J,se)}}abortTile(J,se){let _e=J.uid;this.loading[_e]&&delete this.loading[_e],se()}removeTile(J,se){let _e=this.loaded,Ge=J.uid;_e&&_e[Ge]&&delete _e[Ge],se()}}class Co{constructor(J){this.self=J,this.actor=new r.d$(J,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=r.br({name:"mercator"}),this.workerSourceTypes={vector:Gt,geojson:Yt,"batched-model":Mo},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(se,_e)=>{if(this.workerSourceTypes[se])throw new Error(`Worker source with name "${se}" already registered.`);this.workerSourceTypes[se]=_e},this.self.registerRTLTextPlugin=se=>{if(r.e0.isParsed())throw new Error("RTL text plugin already registered.");r.e0.applyArabicShaping=se.applyArabicShaping,r.e0.processBidirectionalText=se.processBidirectionalText,r.e0.processStyledBidirectionalText=se.processStyledBidirectionalText}}clearCaches(J,se,_e){delete this.layerIndexes[J],delete this.availableImages[J],delete this.workerSources[J],delete this.demWorkerSources[J],delete this.rasterArrayWorkerSource,_e()}checkIfReady(J,se,_e){_e()}setReferrer(J,se){this.referrer=se}spriteLoaded(J,{scope:se,isLoaded:_e}){if(this.isSpriteLoaded[J]||(this.isSpriteLoaded[J]={}),this.isSpriteLoaded[J][se]=_e,this.workerSources[J]&&this.workerSources[J][se])for(let Ge in this.workerSources[J][se]){let Ze=this.workerSources[J][se][Ge];for(let nt in Ze)Ze[nt]instanceof Gt&&(Ze[nt].isSpriteLoaded=_e,Ze[nt].fire(new r.b("isSpriteLoaded")))}}setImages(J,{scope:se,images:_e},Ge){if(this.availableImages[J]||(this.availableImages[J]={}),this.availableImages[J][se]=_e,this.workerSources[J]&&this.workerSources[J][se]){for(let Ze in this.workerSources[J][se]){let nt=this.workerSources[J][se][Ze];for(let Mt in nt)nt[Mt].availableImages=_e}Ge()}else Ge()}setProjection(J,se){this.projections[J]=r.br(se)}setBrightness(J,se,_e){this.brightness=se,_e()}setLayers(J,se,_e){this.getLayerIndex(J,se.scope).replace(se.layers,se.options),_e()}updateLayers(J,se,_e){this.getLayerIndex(J,se.scope).update(se.layers,se.removedIds,se.options),_e()}loadTile(J,se,_e){se.projection=this.projections[J]||this.defaultProjection,this.getWorkerSource(J,se.type,se.source,se.scope).loadTile(se,_e)}loadDEMTile(J,se,_e){this.getDEMWorkerSource(J,se.source,se.scope).loadTile(se,_e)}decodeRasterArray(J,se,_e){this.getRasterArrayWorkerSource().decodeRasterArray(se,_e)}reloadTile(J,se,_e){se.projection=this.projections[J]||this.defaultProjection,this.getWorkerSource(J,se.type,se.source,se.scope).reloadTile(se,_e)}abortTile(J,se,_e){this.getWorkerSource(J,se.type,se.source,se.scope).abortTile(se,_e)}removeTile(J,se,_e){this.getWorkerSource(J,se.type,se.source,se.scope).removeTile(se,_e)}removeSource(J,se,_e){if(!(this.workerSources[J]&&this.workerSources[J][se.scope]&&this.workerSources[J][se.scope][se.type]&&this.workerSources[J][se.scope][se.type][se.source]))return;let Ge=this.workerSources[J][se.scope][se.type][se.source];delete this.workerSources[J][se.scope][se.type][se.source],Ge.removeSource!==void 0?Ge.removeSource(se,_e):_e()}loadWorkerSource(J,se,_e){try{this.self.importScripts(se.url),_e()}catch(Ge){_e(Ge.toString())}}syncRTLPluginState(J,se,_e){try{r.e0.setState(se);let Ge=r.e0.getPluginURL();if(r.e0.isLoaded()&&!r.e0.isParsed()&&Ge!=null){this.self.importScripts(Ge);let Ze=r.e0.isParsed();_e(Ze?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ge}`),Ze)}}catch(Ge){_e(Ge.toString())}}setDracoUrl(J,se){this.dracoUrl=se}getAvailableImages(J,se){this.availableImages[J]||(this.availableImages[J]={});let _e=this.availableImages[J][se];return _e||(_e=[]),_e}getLayerIndex(J,se){this.layerIndexes[J]||(this.layerIndexes[J]={});let _e=this.layerIndexes[J][se];return _e||(_e=this.layerIndexes[J][se]=new de,_e.scope=se),_e}getWorkerSource(J,se,_e,Ge){if(this.workerSources[J]||(this.workerSources[J]={}),this.workerSources[J][Ge]||(this.workerSources[J][Ge]={}),this.workerSources[J][Ge][se]||(this.workerSources[J][Ge][se]={}),this.isSpriteLoaded[J]||(this.isSpriteLoaded[J]={}),!this.workerSources[J][Ge][se][_e]){let Ze={send:(nt,Mt,Ve,_t,xt,Dt)=>{this.actor.send(nt,Mt,Ve,J,xt,Dt)},scheduler:this.actor.scheduler};this.workerSources[J][Ge][se][_e]=new this.workerSourceTypes[se](Ze,this.getLayerIndex(J,Ge),this.getAvailableImages(J,Ge),this.isSpriteLoaded[J][Ge],void 0,this.brightness)}return this.workerSources[J][Ge][se][_e]}getDEMWorkerSource(J,se,_e){return this.demWorkerSources[J]||(this.demWorkerSources[J]={}),this.demWorkerSources[J][_e]||(this.demWorkerSources[J][_e]={}),this.demWorkerSources[J][_e][se]||(this.demWorkerSources[J][_e][se]=new Ei),this.demWorkerSources[J][_e][se]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new sn),this.rasterArrayWorkerSource}enforceCacheSizeLimit(J,se){r.e1(se)}getWorkerPerformanceMetrics(J,se,_e){_e(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Co(self)),Co}),f(["./shared"],function(r){"use strict";function k(c,n){if(Array.isArray(c)){if(!Array.isArray(n)||c.length!==n.length)return!1;for(let s=0;s<c.length;s++)if(!k(c[s],n[s]))return!1;return!0}if(typeof c=="object"&&c!==null&&n!==null){if(typeof n!="object"||Object.keys(c).length!==Object.keys(n).length)return!1;for(let s in c)if(!k(c[s],n[s]))return!1;return!0}return c===n}var W=ee;function ee(c){return!function(n){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var u,m,_=new Blob([""],{type:"text/javascript"}),b=URL.createObjectURL(_);try{m=new Worker(b),u=!0}catch{u=!1}return m&&m.terminate(),URL.revokeObjectURL(b),u}()?function(){var u=document.createElement("canvas");u.width=u.height=1;var m=u.getContext("2d");if(!m)return!1;var _=m.getImageData(0,0,1,1);return _&&_.width===u.width}()?(de[s=n&&n.failIfMajorPerformanceCaveat]===void 0&&(de[s]=function(u){var m,_=function(b){var w=document.createElement("canvas"),S=Object.create(ee.webGLContextAttributes);return S.failIfMajorPerformanceCaveat=b,w.getContext("webgl2",S)}(u);if(!_)return!1;try{m=_.createShader(_.VERTEX_SHADER)}catch{return!1}return!(!m||_.isContextLost())&&(_.shaderSource(m,"void main() {}"),_.compileShader(m),_.getShaderParameter(m,_.COMPILE_STATUS)===!0)}(s)),de[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var s}(c)}var de={};function Ie(c,n,s){let u=document.createElement(c);return n!=null&&(u.className=n),s&&s.appendChild(u),u}function Ne(c,n,s){let u=document.createElementNS("http://www.w3.org/2000/svg",c);for(let m of Object.keys(n))u.setAttributeNS(null,m,String(n[m]));return s&&s.appendChild(u),u}ee.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let lt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,it=lt&&lt.userSelect!==void 0?"userSelect":"WebkitUserSelect",Gt;function Ei(){lt&&it&&(Gt=lt[it],lt[it]="none")}function sn(){lt&&it&&(lt[it]=Gt)}function Xt(c){c.preventDefault(),c.stopPropagation(),window.removeEventListener("click",Xt,!0)}function ni(){window.addEventListener("click",Xt,!0),window.setTimeout(()=>{window.removeEventListener("click",Xt,!0)},0)}function Io(c,n){let s=c.getBoundingClientRect();return jn(c,s,n)}function In(c,n){let s=c.getBoundingClientRect(),u=[];for(let m=0;m<n.length;m++)u.push(jn(c,s,n[m]));return u}function rs(c){return window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button}function jn(c,n,s){let u=c.offsetWidth===n.width?1:c.offsetWidth/n.width;return new r.P((s.clientX-n.left)*u,(s.clientY-n.top)*u)}class Ni{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,s){this._updatedSourceCaches[n]=s,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){let s=n.scope;this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._updatedLayers[s].add(n.id),this.setDirty()}removeLayer(n){let s=n.scope;this._removedLayers[s]=this._removedLayers[s]||{},this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._removedLayers[s][n.id]=n,this._updatedLayers[s].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){let n={};for(let s in this._updatedLayers)n[s]=n[s]||{},n[s].updatedIds=Array.from(this._updatedLayers[s].values());for(let s in this._removedLayers)n[s]=n[s]||{},n[s].removedIds=Object.keys(this._removedLayers[s]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(n){this._updatedImages.add(n),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class _o extends r.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.numModelsLoading={}}loadModel(n,s){return r.l(this.requestManager.transformRequest(s,r.R.Model).url).then(u=>{if(!u)return;let m=r.c(u),_=new r.M(n,void 0,void 0,m);return _.computeBoundsAndApplyParent(),_}).catch(u=>{if(u&&u.status===404)return null;this.fire(new r.a(new Error(`Could not load model ${n} from ${s}: ${u.message}`)))})}load(n,s){this.models[s]||(this.models[s]={});let u=Object.keys(n);this.numModelsLoading[s]=(this.numModelsLoading[s]||0)+u.length;let m=[];for(let _ of u)m.push(this.loadModel(_,n[_]));Promise.allSettled(m).then(_=>{for(let b=0;b<_.length;b++){let{status:w,value:S}=_[b];w==="fulfilled"&&S&&(this.models[s][u[b]]={model:S,numReferences:1})}this.numModelsLoading[s]-=u.length,this.fire(new r.b("data",{dataType:"style"}))}).catch(_=>{this.fire(new r.a(new Error(`Could not load models: ${_.message}`)))})}isLoaded(){for(let n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,s){return!!this.getModel(n,s)}getModel(n,s){return this.models[s]||(this.models[s]={}),this.models[s][n]?this.models[s][n].model:void 0}addModel(n,s,u){this.models[u]||(this.models[u]={}),this.hasModel(n,u)&&this.models[u][n].numReferences++,this.load({[n]:this.requestManager.normalizeModelURL(s)},u)}addModels(n,s){this.models[s]||(this.models[s]={});let u={};for(let m in n)this.models[s][m]={},u[m]=this.requestManager.normalizeModelURL(n[m]);this.load(u,s)}addModelsFromBucket(n,s){this.models[s]||(this.models[s]={});let u={};for(let m of n)this.hasModel(m,s)?this.models[s][m].numReferences++:u[m]=this.requestManager.normalizeModelURL(m);this.load(u,s)}removeModel(n,s){if(this.models[s]&&this.models[s][n]&&(this.models[s][n].numReferences--,this.models[s][n].numReferences===0)){let u=this.models[s][n].model;delete this.models[s][n],u.destroy()}}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,s){this.models[s]||(this.models[s]={});for(let u in this.models[s])this.models[s][u].model&&this.models[s][u].model.upload(n.context)}}class Rr{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,s,u){let m=String(s);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][m]=this.stateChanges[n][m]||{},r.e(this.stateChanges[n][m],u),this.deletedStates[n]===null){this.deletedStates[n]={};for(let _ in this.state[n])_!==m&&(this.deletedStates[n][_]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][m]===null){this.deletedStates[n][m]={};for(let _ in this.state[n][m])u[_]||(this.deletedStates[n][m][_]=null)}else for(let _ in u)this.deletedStates[n]&&this.deletedStates[n][m]&&this.deletedStates[n][m][_]===null&&delete this.deletedStates[n][m][_]}removeFeatureState(n,s,u){if(this.deletedStates[n]===null)return;let m=String(s);if(this.deletedStates[n]=this.deletedStates[n]||{},u&&s!==void 0)this.deletedStates[n][m]!==null&&(this.deletedStates[n][m]=this.deletedStates[n][m]||{},this.deletedStates[n][m][u]=null);else if(s!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][m])for(u in this.deletedStates[n][m]={},this.stateChanges[n][m])this.deletedStates[n][m][u]=null;else this.deletedStates[n][m]=null;else this.deletedStates[n]=null}getState(n,s){let u=String(s),m=r.e({},(this.state[n]||{})[u],(this.stateChanges[n]||{})[u]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){let _=this.deletedStates[n][s];if(_===null)return{};for(let b in _)delete m[b]}return m}initializeTileState(n,s){n.setFeatureState(this.state,s)}coalesceChanges(n,s){let u={};for(let m in this.stateChanges){this.state[m]=this.state[m]||{};let _={};for(let b in this.stateChanges[m])this.state[m][b]||(this.state[m][b]={}),r.e(this.state[m][b],this.stateChanges[m][b]),_[b]=this.state[m][b];u[m]=_}for(let m in this.deletedStates){this.state[m]=this.state[m]||{};let _={};if(this.deletedStates[m]===null)for(let b in this.state[m])_[b]={},this.state[m][b]={};else for(let b in this.deletedStates[m]){if(this.deletedStates[m][b]===null)this.state[m][b]={};else if(this.state[m][b])for(let w of Object.keys(this.deletedStates[m][b]))delete this.state[m][b][w];_[b]=this.state[m][b]}u[m]=u[m]||{},r.e(u[m],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(let m in n)n[m].setFeatureState(u,s)}}function Gr(c){let{userImage:n}=c;return!!(n&&n.render&&n.render())&&(c.data.replace(new Uint8Array(n.data.buffer)),!0)}class Rl extends r.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(n){this.images[n]={},this.loaded[n]=!1,this.updatedImages[n]={},this.patterns[n]={},this.callbackDispatchedThisFrame[n]={},this.atlasImage[n]=new r.h({width:1,height:1})}isLoaded(){for(let n in this.loaded)if(!this.loaded[n])return!1;return!0}setLoaded(n,s){if(this.loaded[s]!==n&&(this.loaded[s]=n,n)){for(let{ids:u,callback:m}of this.requestors)this._notify(u,s,m);this.requestors=[]}}hasImage(n,s){return!!this.getImage(n,s)}getImage(n,s){return this.images[s][n]}addImage(n,s,u){this._validate(n,u)&&(this.images[s][n]=u)}_validate(n,s){let u=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new r.a(new Error(`Image "${n}" has invalid "stretchX" value`))),u=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new r.a(new Error(`Image "${n}" has invalid "stretchY" value`))),u=!1),this._validateContent(s.content,s)||(this.fire(new r.a(new Error(`Image "${n}" has invalid "content" value`))),u=!1),u}_validateStretch(n,s){if(!n)return!0;let u=0;for(let m of n){if(m[0]<u||m[1]<m[0]||s<m[1])return!1;u=m[1]}return!0}_validateContent(n,s){return!(n&&(n.length!==4||n[0]<0||s.data.width<n[0]||n[1]<0||s.data.height<n[1]||n[2]<0||s.data.width<n[2]||n[3]<0||s.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,s,u){u.version=this.images[s][n].version+1,this.images[s][n]=u,this.updatedImages[s][n]=!0}removeImage(n,s){let u=this.images[s][n];delete this.images[s][n],delete this.patterns[s][n],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(n){return Object.keys(this.images[n])}getImages(n,s,u){let m=!0,_=!!this.loaded[s];if(!_)for(let b of n)this.images[s][b]||(m=!1);_||m?this._notify(n,s,u):this.requestors.push({ids:n,scope:s,callback:u})}getUpdatedImages(n){return this.updatedImages[n]}_notify(n,s,u){let m={};for(let _ of n){this.images[s][_]||this.fire(new r.b("styleimagemissing",{id:_}));let b=this.images[s][_];b?m[_]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:r.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,m)}getPixelSize(n){let{width:s,height:u}=this.atlasImage[n];return{width:s,height:u}}getPattern(n,s){let u=this.patterns[s][n],m=this.getImage(n,s);if(!m)return null;if(u&&u.position.version===m.version)return u.position;if(u)u.position.version=m.version;else{let _={w:m.data.width+2,h:m.data.height+2,x:0,y:0},b=new r.I(_,m);this.patterns[s][n]={bin:_,position:b}}return this._updatePatternAtlas(s),this.patterns[s][n].position}bind(n,s){let u=n.gl,m=this.atlasTexture[s];m?this.dirty&&(m.update(this.atlasImage[s]),this.dirty=!1):(m=new r.T(n,this.atlasImage[s],u.RGBA),this.atlasTexture[s]=m),m.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(n){let s=[];for(let b in this.patterns[n])s.push(this.patterns[n][b].bin);let{w:u,h:m}=r.p(s),_=this.atlasImage[n];_.resize({width:u||1,height:m||1});for(let b in this.patterns[n]){let{bin:w}=this.patterns[n][b],S=w.x+1,C=w.y+1,R=this.images[n][b].data,O=R.width,F=R.height;r.h.copy(R,_,{x:0,y:0},{x:S,y:C},{width:O,height:F}),r.h.copy(R,_,{x:0,y:F-1},{x:S,y:C-1},{width:O,height:1}),r.h.copy(R,_,{x:0,y:0},{x:S,y:C+F},{width:O,height:1}),r.h.copy(R,_,{x:O-1,y:0},{x:S-1,y:C},{width:1,height:F}),r.h.copy(R,_,{x:0,y:0},{x:S+O,y:C},{width:1,height:F})}this.dirty=!0}beginFrame(){for(let n in this.images)this.callbackDispatchedThisFrame[n]={}}dispatchRenderCallbacks(n,s){for(let u of n){if(this.callbackDispatchedThisFrame[s][u])continue;this.callbackDispatchedThisFrame[s][u]=!0;let m=this.images[s][u];Gr(m)&&this.updateImage(u,s,m)}}}function Xn(c){let n=c.key,s=c.value,u=c.valueSpec||{},m=c.objectElementValidators||{},_=c.style,b=c.styleSpec,w=[],S=r.j(s);if(S!=="object")return[new r.V(n,s,`object expected, ${S} found`)];for(let C in s){let R=C.split(".")[0],O;m[R]?O=m[R]:u[R]?O=Ii:m["*"]?O=m["*"]:u["*"]&&(O=Ii),O?w=w.concat(O({key:(n&&`${n}.`)+C,value:s[C],valueSpec:u[R]||u["*"],style:_,styleSpec:b,object:s,objectKey:C},s)):w.push(new r.i(n,s[C],`unknown property "${C}"`))}for(let C in u)m[C]||u[C].required&&u[C].default===void 0&&s[C]===void 0&&w.push(new r.V(n,s,`missing required property "${C}"`));return w}function un(c){let n=c.value,s=c.valueSpec,u=c.style,m=c.styleSpec,_=c.key,b=c.arrayElementValidator||Ii;if(r.j(n)!=="array")return[new r.V(_,n,`array expected, ${r.j(n)} found`)];if(s.length&&n.length!==s.length)return[new r.V(_,n,`array length ${s.length} expected, length ${n.length} found`)];if(s["min-length"]&&n.length<s["min-length"])return[new r.V(_,n,`array length at least ${s["min-length"]} expected, length ${n.length} found`)];let w={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};m.$version<7&&(w.function=s.function),r.j(s.value)==="object"&&(w=s.value);let S=[];for(let C=0;C<n.length;C++)S=S.concat(b({array:n,arrayIndex:C,value:n[C],valueSpec:w,style:u,styleSpec:m,key:`${_}[${C}]`},!0));return S}function As(c){let n=c.key,s=c.value,u=c.valueSpec,m=r.j(s);if(m==="number"&&s!=s&&(m="NaN"),m!=="number")return[new r.V(n,s,`number expected, ${m} found`)];if("minimum"in u){let _=u.minimum;if(r.j(u.minimum)==="array"&&(_=u.minimum[c.arrayIndex]),s<_)return[new r.V(n,s,`${s} is less than the minimum value ${_}`)]}if("maximum"in u){let _=u.maximum;if(r.j(u.maximum)==="array"&&(_=u.maximum[c.arrayIndex]),s>_)return[new r.V(n,s,`${s} is greater than the maximum value ${_}`)]}return[]}function qr(c){let n=c.valueSpec,s=r.u(c.value.type),u,m,_,b={},w=s!=="categorical"&&c.value.property===void 0,S=!w,C=r.j(c.value.stops)==="array"&&r.j(c.value.stops[0])==="array"&&r.j(c.value.stops[0][0])==="object",R=Xn({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(B){if(s==="identity")return[new r.V(B.key,B.value,'identity function may not have a "stops" property')];let U=[],j=B.value;return U=U.concat(un({key:B.key,value:j,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:O})),r.j(j)==="array"&&j.length===0&&U.push(new r.V(B.key,j,"array must have at least one stop")),U},default:function(B){return Ii({key:B.key,value:B.value,valueSpec:n,style:B.style,styleSpec:B.styleSpec})}}});return s==="identity"&&w&&R.push(new r.V(c.key,c.value,'missing required property "property"')),s==="identity"||c.value.stops||R.push(new r.V(c.key,c.value,'missing required property "stops"')),s==="exponential"&&c.valueSpec.expression&&!r.s(c.valueSpec)&&R.push(new r.V(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(S&&!r.m(c.valueSpec)?R.push(new r.V(c.key,c.value,"property functions not supported")):w&&!r.n(c.valueSpec)&&R.push(new r.V(c.key,c.value,"zoom functions not supported"))),s!=="categorical"&&!C||c.value.property!==void 0||R.push(new r.V(c.key,c.value,'"property" property is required')),R;function O(B){let U=[],j=B.value,G=B.key;if(r.j(j)!=="array")return[new r.V(G,j,`array expected, ${r.j(j)} found`)];if(j.length!==2)return[new r.V(G,j,`array length 2 expected, length ${j.length} found`)];if(C){if(r.j(j[0])!=="object")return[new r.V(G,j,`object expected, ${r.j(j[0])} found`)];if(j[0].zoom===void 0)return[new r.V(G,j,"object stop key must have zoom")];if(j[0].value===void 0)return[new r.V(G,j,"object stop key must have value")];let q=r.u(j[0].zoom);if(typeof q!="number")return[new r.V(G,j[0].zoom,"stop zoom values must be numbers")];if(_&&_>q)return[new r.V(G,j[0].zoom,"stop zoom values must appear in ascending order")];q!==_&&(_=q,m=void 0,b={}),U=U.concat(Xn({key:`${G}[0]`,value:j[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:As,value:F}}))}else U=U.concat(F({key:`${G}[0]`,value:j[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},j));return r.o(r.q(j[1]))?U.concat([new r.V(`${G}[1]`,j[1],"expressions are not allowed in function stops.")]):U.concat(Ii({key:`${G}[1]`,value:j[1],valueSpec:n,style:B.style,styleSpec:B.styleSpec}))}function F(B,U){let j=r.j(B.value),G=r.u(B.value),q=B.value!==null?B.value:U;if(u){if(j!==u)return[new r.V(B.key,q,`${j} stop domain type must match previous stop domain type ${u}`)]}else u=j;if(j!=="number"&&j!=="string"&&j!=="boolean"&&typeof G!="number"&&typeof G!="string"&&typeof G!="boolean")return[new r.V(B.key,q,"stop domain value must be a number, string, or boolean")];if(j!=="number"&&s!=="categorical"){let H=`number expected, ${j} found`;return r.m(n)&&s===void 0&&(H+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(B.key,q,H)]}return s!=="categorical"||j!=="number"||typeof G=="number"&&isFinite(G)&&Math.floor(G)===G?s!=="categorical"&&j==="number"&&typeof G=="number"&&typeof m=="number"&&m!==void 0&&G<m?[new r.V(B.key,q,"stop domain values must appear in ascending order")]:(m=G,s==="categorical"&&G in b?[new r.V(B.key,q,"stop domain values must be unique")]:(b[G]=!0,[])):[new r.V(B.key,q,`integer expected, found ${String(G)}`)]}}function no(c){let n=(c.expressionContext==="property"?r.r:r.t)(r.q(c.value),c.valueSpec);if(n.result==="error")return n.value.map(u=>new r.V(`${c.key}${u.key}`,c.value,u.message));let s=n.value.expression||n.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!s.outputDefined())return[new r.V(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!r.v(s))return[new r.V(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter")return Ys(s,c);if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!r.x(s,["zoom","feature-state"]))return[new r.V(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!r.y(s))return[new r.V(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ys(c,n){let s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(let m of n.valueSpec.expression.parameters)s.delete(m);if(s.size===0)return[];let u=[];return c instanceof r.C&&s.has(c.name)?[new r.V(n.key,n.value,`["${c.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(c.eachChild(m=>{u.push(...Ys(m,n))}),u)}function Ks(c){let n=c.key,s=c.value,u=c.valueSpec,m=[];return Array.isArray(u.values)?u.values.indexOf(r.u(s))===-1&&m.push(new r.V(n,s,`expected one of [${u.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(u.values).indexOf(r.u(s))===-1&&m.push(new r.V(n,s,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(s)} found`)),m}function Pi(c){return r.A(r.q(c.value))?no(r.k({},c,{expressionContext:"filter",valueSpec:c.styleSpec[`filter_${c.layerType||"fill"}`]})):Js(c)}function Js(c){let n=c.value,s=c.key;if(r.j(n)!=="array")return[new r.V(s,n,`array expected, ${r.j(n)} found`)];let u=c.styleSpec,m,_=[];if(n.length<1)return[new r.V(s,n,"filter array must have at least 1 element")];switch(_=_.concat(Ks({key:`${s}[0]`,value:n[0],valueSpec:u.filter_operator,style:c.style,styleSpec:c.styleSpec})),r.u(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&r.u(n[1])==="$type"&&_.push(new r.V(s,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&_.push(new r.V(s,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(m=r.j(n[1]),m!=="string"&&_.push(new r.V(`${s}[1]`,n[1],`string expected, ${m} found`)));for(let b=2;b<n.length;b++)m=r.j(n[b]),r.u(n[1])==="$type"?_=_.concat(Ks({key:`${s}[${b}]`,value:n[b],valueSpec:u.geometry_type,style:c.style,styleSpec:c.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&_.push(new r.V(`${s}[${b}]`,n[b],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let b=1;b<n.length;b++)_=_.concat(Js({key:`${s}[${b}]`,value:n[b],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":m=r.j(n[1]),n.length!==2?_.push(new r.V(s,n,`filter array for "${n[0]}" operator must have 2 elements`)):m!=="string"&&_.push(new r.V(`${s}[1]`,n[1],`string expected, ${m} found`))}return _}function xn(c,n){let s=c.key,u=c.style,m=c.layer,_=c.styleSpec,b=c.value,w=c.objectKey,S=_[`${n}_${c.layerType}`];if(!S)return[];let C=w.match(/^(.*)-transition$/);if(n==="paint"&&C&&S[C[1]]&&S[C[1]].transition)return Ii({key:s,value:b,valueSpec:_.transition,style:u,styleSpec:_});let R=c.valueSpec||S[w];if(!R)return[new r.i(s,b,`unknown property "${w}"`)];let O;if(r.j(b)==="string"&&r.m(R)&&!R.tokens&&(O=/^{([^}]+)}$/.exec(b))){let B=`\`{ "type": "identity", "property": ${O?JSON.stringify(O[1]):'"_"'} }\``;return[new r.V(s,b,`"${w}" does not support interpolation syntax
Use an identity property function instead: ${B}.`)]}let F=[];if(c.layerType==="symbol")w!=="text-field"||!u||u.glyphs||u.imports||F.push(new r.V(s,b,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&r.B(r.q(b))&&r.u(b.type)==="identity"&&F.push(new r.V(s,b,'"text-font" does not support identity functions'));else if(c.layerType==="model"&&n==="paint"&&m&&m.layout&&m.layout.hasOwnProperty("model-id")&&r.m(R)&&(r.D(R)||r.n(R))){let B=r.r(r.q(b),R),U=B.value.expression||B.value._styleExpression.expression;U&&!r.x(U,["measure-light"])&&(w==="model-emissive-strength"&&r.y(U)&&r.v(U)||F.push(new r.V(s,b,`${w} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return F.concat(Ii({key:c.key,value:b,valueSpec:R,style:u,styleSpec:_,expressionContext:"property",propertyType:n,propertyKey:w}))}function So(c){return xn(c,"paint")}function $r(c){return xn(c,"layout")}function Wn(c){let n=[],s=c.value,u=c.key,m=c.style,_=c.styleSpec;s.type||s.ref||n.push(new r.V(u,s,'either "type" or "ref" is required'));let b=r.u(s.type),w=r.u(s.ref);if(s.id){let S=r.u(s.id);for(let C=0;C<c.arrayIndex;C++){let R=m.layers[C];r.u(R.id)===S&&n.push(new r.V(u,s.id,`duplicate layer id "${s.id}", previously used at line ${R.id.__line__}`))}}if("ref"in s){let S;["type","source","source-layer","filter","layout"].forEach(C=>{C in s&&n.push(new r.V(u,s[C],`"${C}" is prohibited for ref layers`))}),m.layers.forEach(C=>{r.u(C.id)===w&&(S=C)}),S?S.ref?n.push(new r.V(u,s.ref,"ref cannot reference another ref layer")):b=r.u(S.type):typeof w=="string"&&n.push(new r.V(u,s.ref,`ref layer "${w}" not found`))}else if(b!=="background"&&b!=="sky"&&b!=="slot")if(s.source){let S=m.sources&&m.sources[s.source],C=S&&r.u(S.type);S?C==="vector"&&b==="raster"?n.push(new r.V(u,s.source,`layer "${s.id}" requires a raster source`)):C==="raster"&&b!=="raster"?n.push(new r.V(u,s.source,`layer "${s.id}" requires a vector source`)):C!=="vector"||s["source-layer"]?C==="raster-dem"&&b!=="hillshade"?n.push(new r.V(u,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):C!=="raster-array"||["raster","raster-particle"].includes(b)?b!=="line"||!s.paint||!s.paint["line-gradient"]&&!s.paint["line-trim-offset"]||C==="geojson"&&S.lineMetrics?b==="raster-particle"&&C!=="raster-array"&&n.push(new r.V(u,s.source,`layer "${s.id}" requires a 'raster-array' source.`)):n.push(new r.V(u,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new r.V(u,s.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new r.V(u,s,`layer "${s.id}" must specify a "source-layer"`)):n.push(new r.V(u,s.source,`source "${s.source}" not found`))}else n.push(new r.V(u,s,'missing required property "source"'));return n=n.concat(Xn({key:u,value:s,valueSpec:_.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ii({key:`${u}.type`,value:s.type,valueSpec:_.layer.type,style:c.style,styleSpec:c.styleSpec,object:s,objectKey:"type"}),filter:S=>Pi(r.k({layerType:b},S)),layout:S=>Xn({layer:s,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":C=>$r(r.k({layerType:b},C))}}),paint:S=>Xn({layer:s,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":C=>So(r.k({layerType:b,layer:s},C))}})}})),n}function jt(c){let n=c.value,s=c.key,u=r.j(n);return u!=="string"?[new r.V(s,n,`string expected, ${u} found`)]:[]}let os={promoteId:function({key:c,value:n}){if(r.j(n)==="string")return jt({key:c,value:n});{let s=[];for(let u in n)s.push(...jt({key:`${c}.${u}`,value:n[u]}));return s}}};function ki(c){let n=c.value,s=c.key,u=c.styleSpec,m=c.style;if(!n.type)return[new r.V(s,n,'"type" is required')];let _=r.u(n.type),b=[];switch(["vector","raster","raster-dem","raster-array"].includes(_)&&(n.url||n.tiles||b.push(new r.i(s,n,'Either "url" or "tiles" is required.'))),_){case"vector":case"raster":case"raster-dem":case"raster-array":return b=b.concat(Xn({key:s,value:n,valueSpec:u[`source_${_.replace("-","_")}`],style:c.style,styleSpec:u,objectElementValidators:os})),b;case"geojson":if(b=Xn({key:s,value:n,valueSpec:u.source_geojson,style:m,styleSpec:u,objectElementValidators:os}),n.cluster)for(let w in n.clusterProperties){let[S,C]=n.clusterProperties[w],R=typeof S=="string"?[S,["accumulated"],["get",w]]:S;b.push(...no({key:`${s}.${w}.map`,value:C,expressionContext:"cluster-map"})),b.push(...no({key:`${s}.${w}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return b;case"video":return Xn({key:s,value:n,valueSpec:u.source_video,style:m,styleSpec:u});case"image":return Xn({key:s,value:n,valueSpec:u.source_image,style:m,styleSpec:u});case"canvas":return[new r.V(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ks({key:`${s}.type`,value:n.type,valueSpec:{values:Oi(u)},style:m,styleSpec:u})}}function Oi(c){return c.source.reduce((n,s)=>{let u=c[s];return u.type.type==="enum"&&(n=n.concat(Object.keys(u.type.values))),n},[])}function Ia(c){let n=c.value,s=c.styleSpec,u=s.light,m=c.style,_=[],b=r.j(n);if(n===void 0)return _;if(b!=="object")return _=_.concat([new r.V("light",n,`object expected, ${b} found`)]),_;for(let w in n){let S=w.match(/^(.*)-transition$/);_=_.concat(S&&u[S[1]]&&u[S[1]].transition?Ii({key:w,value:n[w],valueSpec:s.transition,style:m,styleSpec:s}):u[w]?Ii({key:w,value:n[w],valueSpec:u[w],style:m,styleSpec:s}):[new r.V(w,n[w],`unknown property "${w}"`)])}return _}function ea(c){let n=c.value,s=[];if(!n)return s;let u=r.j(n);if(u!=="object")return s=s.concat([new r.V("light-3d",n,`object expected, ${u} found`)]),s;let m=c.styleSpec,_=m["light-3d"],b=c.key,w=c.style,S=c.style.lights;for(let O of["type","id"])if(!(O in n))return s=s.concat([new r.V("light-3d",n,`missing property ${O} on light`)]),s;if(n.type&&S)for(let O=0;O<c.arrayIndex;O++){let F=r.u(n.type),B=S[O];r.u(B.type)===F&&s.push(new r.V(b,n.id,`duplicate light type "${n.type}", previously defined at line ${B.id.__line__}`))}let C=`properties_light_${n.type}`;if(!(C in m))return s=s.concat([new r.V("light-3d",n,`Invalid light type ${n.type}`)]),s;let R=m[C];for(let O in n)if(O==="properties"){let F=n[O],B=r.j(F);if(B!=="object")return s=s.concat([new r.V("properties",F,`object expected, ${B} found`)]),s;for(let U in F)s=s.concat(R[U]?Ii({key:U,value:F[U],valueSpec:R[U],style:w,styleSpec:m}):[new r.i(c.key,F[U],`unknown property "${U}"`)])}else{let F=O.match(/^(.*)-transition$/);s=s.concat(F&&_[F[1]]&&_[F[1]].transition?Ii({key:O,value:n[O],valueSpec:m.transition,style:w,styleSpec:m}):_[O]?Ii({key:O,value:n[O],valueSpec:_[O],style:w,styleSpec:m}):[new r.i(O,n[O],`unknown property "${O}"`)])}return s}function ta(c){let n=c.value,s=c.key,u=c.style,m=c.styleSpec,_=m.terrain,b=[],w=r.j(n);if(n===void 0||w==="null")return b;if(w!=="object")return b=b.concat([new r.V("terrain",n,`object expected, ${w} found`)]),b;for(let S in n){let C=S.match(/^(.*)-transition$/);b=b.concat(C&&_[C[1]]&&_[C[1]].transition?Ii({key:S,value:n[S],valueSpec:m.transition,style:u,styleSpec:m}):_[S]?Ii({key:S,value:n[S],valueSpec:_[S],style:u,styleSpec:m}):[new r.i(S,n[S],`unknown property "${S}"`)])}if(n.source){let S=u.sources&&u.sources[n.source],C=S&&r.u(S.type);S?C!=="raster-dem"&&b.push(new r.V(s,n.source,`terrain cannot be used with a source of type ${String(C)}, it only be used with a "raster-dem" source type`)):b.push(new r.V(s,n.source,`source "${n.source}" not found`))}else b.push(new r.V(s,n,'terrain is missing required property "source"'));return b}function Ds(c){let n=c.value,s=c.style,u=c.styleSpec,m=u.fog,_=[],b=r.j(n);if(n===void 0)return _;if(b!=="object")return _=_.concat([new r.V("fog",n,`object expected, ${b} found`)]),_;for(let w in n){let S=w.match(/^(.*)-transition$/);_=_.concat(S&&m[S[1]]&&m[S[1]].transition?Ii({key:w,value:n[w],valueSpec:u.transition,style:s,styleSpec:u}):m[w]?Ii({key:w,value:n[w],valueSpec:m[w],style:s,styleSpec:u}):[new r.i(w,n[w],`unknown property "${w}"`)])}return _}let rl={"*":()=>[],array:un,boolean:function(c){let n=c.value,s=c.key,u=r.j(n);return u!=="boolean"?[new r.V(s,n,`boolean expected, ${u} found`)]:[]},number:As,color:function(c){let n=c.key,s=c.value,u=r.j(s);return u!=="string"?[new r.V(n,s,`color expected, ${u} found`)]:r.z(s)===null?[new r.V(n,s,`color expected, "${s}" found`)]:[]},enum:Ks,filter:Pi,function:qr,layer:Wn,object:Xn,source:ki,model:r.F,light:Ia,"light-3d":ea,terrain:ta,fog:Ds,string:jt,formatted:function(c){return jt(c).length===0?[]:no(c)},resolvedImage:function(c){return jt(c).length===0?[]:no(c)},projection:function(c){let n=c.value,s=c.styleSpec,u=s.projection,m=c.style,_=[],b=r.j(n);if(b==="object")for(let w in n)_=_.concat(Ii({key:w,value:n[w],valueSpec:u[w],style:m,styleSpec:s}));else b!=="string"&&(_=_.concat([new r.V("projection",n,`object or string expected, ${b} found`)]));return _},import:function(c){let{value:n,styleSpec:s}=c,b=n,{data:u}=b,m=Ov(b,["data"]);Object.defineProperty(m,"__line__",{value:n.__line__,enumerable:!1});let _=Xn(r.k({},c,{value:m,valueSpec:s.import}));return r.u(m.id)===""&&_.push(new r.V(`${c.key}.id`,m,"import id can't be an empty string")),u&&(_=_.concat(Yt(u,s,{key:`${c.key}.data`}))),_}};function Ii(c,n=!1){let s=c.value,u=c.valueSpec,m=c.styleSpec;if(u.expression&&r.B(r.u(s)))return qr(c);if(u.expression&&r.o(r.q(s)))return no(c);if(u.type&&rl[u.type]){let _=rl[u.type](c);return n===!0&&_.length>0&&r.j(c.value)==="array"?no(c):_}return Xn(r.k({},c,{valueSpec:u.type?m[u.type]:u}))}function Pl(c){let n=c.value,s=c.key,u=jt(c);return u.length||(n.indexOf("{fontstack}")===-1&&u.push(new r.V(s,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&u.push(new r.V(s,n,'"glyphs" url must include a "{range}" token'))),u}function Yt(c,n=r.G,s={}){return Ii({key:s.key||"",value:c,valueSpec:n.$root,styleSpec:n,style:c,objectElementValidators:{glyphs:Pl,"*":()=>[]}})}function Wt(c,n=r.G){return Ve(Yt(c,n))}let Mo=c=>Ve(ki(c)),Co=c=>Ve(Ia(c)),et=c=>Ve(ea(c)),J=c=>Ve(ta(c)),se=c=>Ve(Ds(c)),_e=c=>Ve(Wn(c)),Ge=c=>Ve(Pi(c)),Ze=c=>Ve(So(c)),nt=c=>Ve($r(c)),Mt=c=>Ve(r.F(c));function Ve(c){return c.slice().sort((n,s)=>n.line&&s.line?n.line-s.line:0)}function _t(c,n){let s=!1;if(n&&n.length)for(let u of n)u instanceof r.i?r.w(u.message):(c.fire(new r.a(new Error(u.message))),s=!0);return s}let xt=new r.H({anchor:new r.J(r.G.light.anchor),position:new r.K(r.G.light.position),color:new r.J(r.G.light.color),intensity:new r.J(r.G.light.intensity)});class Dt extends r.E{constructor(n,s="flat"){super(),this._transitionable=new r.L(xt),this.setLight(n,s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,s,u={}){this._validate(Co,n,u)||(this._transitionable.setTransitionOrValue(n),this.id=s)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,s,u){return(!u||u.validate!==!1)&&_t(this,n.call(Wt,r.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:r.G})))}}let mt=new r.H({source:new r.J(r.G.terrain.source),exaggeration:new r.J(r.G.terrain.exaggeration)}),tn=class extends r.E{constructor(c,n,s,u){super(),this.scope=s,this._transitionable=new r.L(mt,s,u),this._transitionable.setTransitionOrValue(c,u),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(c,n){this._transitionable.setTransitionOrValue(c,n)}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}getExaggeration(c){return this._transitioning.possiblyEvaluate(new r.N(c)).get("exaggeration")}isZoomDependent(){let c=this._transitionable._values.exaggeration;return c!=null&&c.value!=null&&c.value.expression!=null&&c.value.expression instanceof r.Z}},Mi=45,Ki=65,Fi=.05;function Ci(c,n,s,u){let m=r.S(Mi,Ki,s),[_,b]=Ji(c,u),w=1-Math.min(1,Math.exp((n-_)/(b-_)*-6));return w*=w*w,w=Math.min(1,1.00747*w),w*m*c.alpha}function Ji(c,n){let s=.5/Math.tan(.5*n);return[c.range[0]+s,c.range[1]+s]}function yn(c,n,s,u,m){let _=r.Q.transformMat4([],[n,s,u],m.mercatorFogMatrix);return Ci(c,r.Q.length(_),m.pitch,m._fov)}function En(c,n,s,u,m,_,b){let w=[[s,u,0],[m,u,0],[m,_,0],[s,_,0]],S=Number.MAX_VALUE,C=-Number.MAX_VALUE;for(let R of w){let O=r.Q.transformMat4([],R,n),F=r.Q.length(O);S=Math.min(S,F),C=Math.max(C,F)}return[Ci(c,S,b.pitch,b._fov),Ci(c,C,b.pitch,b._fov)]}let an=new r.H({range:new r.J(r.G.fog.range),color:new r.J(r.G.fog.color),"high-color":new r.J(r.G.fog["high-color"]),"space-color":new r.J(r.G.fog["space-color"]),"horizon-blend":new r.J(r.G.fog["horizon-blend"]),"star-intensity":new r.J(r.G.fog["star-intensity"]),"vertical-range":new r.J(r.G.fog["vertical-range"])});class Lr extends r.E{constructor(n,s,u,m){super(),this._transitionable=new r.L(an,u,new Map(m)),this.set(n,m),this._transitioning=this._transitionable.untransitioned(),this._transform=s,this.properties=new r.U(an)}get state(){let n=this._transform,s=n.projection.name==="globe",u=r.W(n.zoom),m=this.properties.get("range"),_=[.5,3];return{range:s?[r.X(_[0],m[0],u),r.X(_[1],m[1],u)]:m,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,s,u={}){if(this._validate(se,n,u))return;let m=r.e({},n);for(let _ of Object.keys(r.G.fog))m[_]===void 0&&(m[_]=r.G.fog[_].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,s)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;let s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.S(Mi,Ki,n))*s.a}getOpacityAtLatLng(n,s){return this._transform.projection.supportsFog?function(u,m,_){let b=r.O.fromLngLat(m),w=_.elevation?_.elevation.getAtPointOrZero(b):0;return yn(u,b.x,b.y,w,_)}(this.state,n,s):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];let s=this._transform.calculateFogTileMatrix(n.toUnwrapped());return En(this.state,s,0,0,r.Y,r.Y,this._transform)}getOpacityForBounds(n,s,u,m,_){return this._transform.projection.supportsFog?En(this.state,n,s,u,m,_,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Ji(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;let s=[4,5,6,7];for(let u of s){let m=n.points[u],_;if(m[2]>=0)_=m;else{let b=n.points[u-4];_=r._(b,m,b[2]/(b[2]-m[2]))}if(yn(this.state,_[0],_[1],0,this._transform)>=Fi)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,s,u){return(!u||u.validate!==!1)&&_t(this,n.call(Wt,r.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:r.G})))}}class Fr extends r.E{constructor(n,s,u,m){super(),this.scope=u,this._options=n,this.properties=new r.U(s),this._transitionable=new r.L(s,u,new Map(m)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,s){this._options=n,this._transitionable.setTransitionOrValue(n.properties,s)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let Uo=new r.H({color:new r.J(r.G.properties_light_ambient.color),intensity:new r.J(r.G.properties_light_ambient.intensity)}),Yn=new r.H({direction:new r.$(r.G.properties_light_directional.direction),color:new r.J(r.G.properties_light_directional.color),intensity:new r.J(r.G.properties_light_directional.intensity),"cast-shadows":new r.J(r.G.properties_light_directional["cast-shadows"]),"shadow-intensity":new r.J(r.G.properties_light_directional["shadow-intensity"])});class Dn{constructor(n,s,u,m){this.screenBounds=n,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,m)}static createFromScreenPoints(n,s){let u,m;if(n instanceof r.P||typeof n[0]=="number"){let _=r.P.convert(n);u=[_],m=s.isPointAboveHorizon(_)}else{let _=r.P.convert(n[0]),b=r.P.convert(n[1]);u=[_,b],m=r.a0(_,b).every(w=>s.isPointAboveHorizon(w))}return new Dn(u,s.getCameraPoint(),m,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return r.a0(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){let s=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],m=r.a0(s,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<u.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?m[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(m[3]=this.cameraPoint)),r.a1(m,n)}bufferedCameraGeometryGlobe(n){let s=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],m=r.a0(s,u,n),_=this.cameraPoint.clone();switch(3*((_.y>s.y)+(_.y>u.y))+((_.x>s.x)+(_.x>u.x))){case 0:m[0]=_,m[4]=_.clone();break;case 1:m.splice(1,0,_);break;case 2:m[1]=_;break;case 3:m.splice(4,0,_);break;case 5:m.splice(2,0,_);break;case 6:m[3]=_;break;case 7:m.splice(3,0,_);break;case 8:m[2]=_}return m}containsTile(n,s,u,m=0){let _=n.queryPadding/s._pixelsPerMercatorPixel+1,b=u?this._bufferedCameraMercator(_,s):this._bufferedScreenMercator(_,s),w=n.tileID.wrap+(b.unwrapped?m:0),S=b.polygon.map(G=>r.a2(n.tileTransform,G,w));if(!r.a3(S,0,0,r.Y,r.Y))return;w=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?m:0);let C=this.screenGeometryMercator.polygon.map(G=>r.a4(n.tileTransform,G,w)),R=C.map(G=>new r.P(G[0],G[1])),O=s.getFreeCameraOptions().position||new r.O(0,0,0),F=r.a4(n.tileTransform,O,w),B=C.map(G=>{let q=r.Q.sub(G,G,F);return r.Q.normalize(q,q),new r.a5(F,q)}),U=r.a6(n,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:R,tilespaceRays:B,bufferedTilespaceGeometry:S,bufferedTilespaceBounds:(j=r.a7(S),j.min.x=r.ad(j.min.x,0,r.Y),j.min.y=r.ad(j.min.y,0,r.Y),j.max.x=r.ad(j.max.x,0,r.Y),j.max.y=r.ad(j.max.y,0,r.Y),j),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:U};var j}_bufferedScreenMercator(n,s){let u=Ye(n);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{let m;return m=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),s):{polygon:this.bufferedScreenGeometry(n).map(_=>s.pointCoordinate3D(_)),unwrapped:!0},this._screenRaycastCache[u]=m,m}}_bufferedCameraMercator(n,s){let u=Ye(n);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{let m;return m=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),s):{polygon:this.bufferedCameraGeometry(n).map(_=>s.pointCoordinate3D(_)),unwrapped:!0},this._cameraRaycastCache[u]=m,m}}_projectAndResample(n,s){let u=function(_,b){let w=r.a9.multiply([],b.pixelMatrix,b.globeMatrix),S=[0,-r.ae,0,1],C=[0,r.ae,0,1],R=[0,0,0,1];r.aa.transformMat4(S,S,w),r.aa.transformMat4(C,C,w),r.aa.transformMat4(R,R,w);let O=new r.P(S[0]/S[3],S[1]/S[3]),F=new r.P(C[0]/C[3],C[1]/C[3]),B=r.ab(_,O)&&S[3]<R[3],U=r.ab(_,F)&&C[3]<R[3];if(!B&&!U)return null;let j=function(X,ue,le){for(let ge=1;ge<X.length;ge++){let Me=je(ue.pointCoordinate3D(X[ge-1]).x),me=je(ue.pointCoordinate3D(X[ge]).x);if(le<0){if(Me<me)return{idx:ge,t:-Me/(me-1-Me)}}else if(me<Me)return{idx:ge,t:(1-Me)/(me+1-Me)}}return null}(_,b,B?-1:1);if(!j)return null;let{idx:G,t:q}=j,H=G>1?Be(_.slice(0,G),b):[],ne=G<_.length?Be(_.slice(G),b):[];H=H.map(X=>new r.P(je(X.x),X.y)),ne=ne.map(X=>new r.P(je(X.x),X.y));let ie=[...H];ie.length===0&&ie.push(ne[ne.length-1]);let oe=r.X(ie[ie.length-1].y,(ne.length===0?H[0]:ne[0]).y,q),$;return $=B?[new r.P(0,oe),new r.P(0,0),new r.P(1,0),new r.P(1,oe)]:[new r.P(1,oe),new r.P(1,1),new r.P(0,1),new r.P(0,oe)],ie.push(...$),ne.length===0?ie.push(H[0]):ie.push(...ne),{polygon:ie.map(X=>new r.O(X.x,X.y)),unwrapped:!1}}(n,s);if(u)return u;let m=function(_,b){let w=!1,S=-1/0,C=0;for(let O=0;O<_.length-1;O++)_[O].x>S&&(S=_[O].x,C=O);for(let O=0;O<_.length-1;O++){let F=(C+O)%(_.length-1),B=_[F],U=_[F+1];Math.abs(B.x-U.x)>.5&&(B.x<U.x?(B.x+=1,F===0&&(_[_.length-1].x+=1)):(U.x+=1,F+1===_.length-1&&(_[0].x+=1)),w=!0)}let R=r.a8(b.center.lng);return w&&R<Math.abs(R-1)&&_.forEach(O=>{O.x-=1}),{polygon:_,unwrapped:w}}(Be(n,s).map(_=>new r.P(je(_.x),_.y)),s);return{polygon:m.polygon.map(_=>new r.O(_.x,_.y)),unwrapped:m.unwrapped}}}function Be(c,n){return r.ac(c,s=>{let u=n.pointCoordinate3D(s);s.x=u.x,s.y=u.y},1/256)}function je(c){return c<0?1+c%1:c%1}function Ye(c){return 100*c|0}function st(c,n,s,u,m){let _=function(b,w){if(b)return m(b);if(w){c.url&&w.tiles&&c.tiles&&delete c.tiles;let S=r.af(r.e(w,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(S.vectorLayers=w.vector_layers,S.vectorLayerIds=S.vectorLayers.map(C=>C.id)),w.raster_layers&&(S.rasterLayers=w.raster_layers,S.rasterLayerIds=S.rasterLayers.map(C=>C.id)),S.tiles=n.canonicalizeTileset(S,c.url),m(null,S)}};return c.url?r.g(n.transformRequest(n.normalizeSourceURL(c.url,null,s,u),r.R.Source),_):r.f.frame(()=>_(null,c))}class tt{constructor(n,s,u){this.bounds=r.ag.convert(this.validateBounds(n)),this.minzoom=s||0,this.maxzoom=u||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){let s=Math.pow(2,n.z),u=Math.floor(r.a8(this.bounds.getWest())*s),m=Math.floor(r.ah(this.bounds.getNorth())*s),_=Math.ceil(r.a8(this.bounds.getEast())*s),b=Math.ceil(r.ah(this.bounds.getSouth())*s);return n.x>=u&&n.x<_&&n.y>=m&&n.y<b}}class ut extends r.E{constructor(n,s,u,m){if(super(),this.id=n,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.e(this,r.af(s,["url","scheme","tileSize","promoteId"])),this._options=r.e({type:"vector"},s),this._collectResourceTiming=!!s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new r.ai}load(n){this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"}));let s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map._worldview;this._tileJSONRequest=st(this._options,this.map._requestManager,s,u,(m,_)=>{this._tileJSONRequest=null,this._loaded=!0,m?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),u&&u.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new r.a(m))):_&&(r.e(this,_),_.bounds&&(this.tileBounds=new tt(_.bounds,this.minzoom,this.maxzoom)),r.am(_.tiles,this.map._requestManager._customAccessToken),this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))),n&&n(m)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();let n=r.aj(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.e({},this._options)}loadTile(n,s){let u=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(u,r.R.Tile),data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster};if(m.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=s:n.request=n.actor.send("reloadTile",m,_.bind(this));else if(n.actor=this._tileWorkers[u]=this._tileWorkers[u]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",m,_.bind(this),void 0,!0);else{let b=r.ak.call({deduped:this._deduped},m,(w,S)=>{w||!S?_.call(this,w):(m.data={cacheControl:S.cacheControl,expires:S.expires,rawData:S.rawData.slice(0)},n.actor&&n.actor.send("loadTile",m,_.bind(this),void 0,!0))},!0);n.request={cancel:b}}function _(b,w){return delete n.request,n.aborted?s(null):b&&b.status!==404?s(b):(w&&w.resourceTiming&&(n.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&w&&n.setExpiryData(w),n.loadVectorData(w,this.map.painter),r.al(this.dispatcher),s(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ht extends r.E{constructor(n,s,u,m){super(),this.id=n,this.dispatcher=u,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.e({type:"raster"},s),r.e(this,r.af(s,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"})),this._tileJSONRequest=st(this._options,this.map._requestManager,null,null,(s,u)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new r.a(s)):u&&(r.e(this,u),u.bounds&&(this.tileBounds=new tt(u.bounds,this.minzoom,this.maxzoom)),r.am(u.tiles),this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))),n&&n(s)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();let n=r.aj(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.e({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,s){let u=r.f.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);n.request=r.d(this.map._requestManager.transformRequest(m,r.R.Tile),(_,b,w,S)=>(delete n.request,n.aborted?(n.state="unloaded",s(null)):_?(n.state="errored",s(_)):b?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:w,expires:S}),n.setTexture(b,this.map.painter),n.state="loaded",r.al(this.dispatcher),void s(null)):s(null)))}abortTile(n,s){n.request&&(n.request.cancel(),delete n.request),s()}unloadTile(n,s){n.texture&&n.texture instanceof r.T?(n.destroy(!0),n.texture&&n.texture instanceof r.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),s()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class rt extends ht{constructor(n,s,u,m){super(n,s,u,m),this.type="raster-array",this.maxzoom=22,this._options=r.e({type:"raster-array"},s)}triggerRepaint(n){let s=this.map.painter._terrain,u=this.map.style.getSourceCache(this.id);s&&s.enabled&&u&&s._clearRenderCacheForTile(u.id,n.tileID),this.map.triggerRepaint()}loadTile(n,s){let u=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),m=this.map._requestManager.transformRequest(u,r.R.Tile);n.requestParams=m,n.actor||(n.actor=this.dispatcher.getActor()),n.request=n.fetchHeader(void 0,(_,b,w,S)=>{if(delete n.request,n.aborted)return n.state="unloaded",s(null);if(_)return _.code===20?void 0:(n.state="errored",s(_));this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:w,expires:S}),n.state="empty",s(null)})}unloadTile(n){let s=n.texture;s&&s instanceof r.T?(n.destroy(!0),this.map.painter.saveTileTexture(s)):(n.destroy(),n.flushQueues(),n._isHeaderLoaded=!1,delete n._mrt,delete n.textureDescriptor),n.fbo&&(n.fbo.destroy(),delete n.fbo),delete n.request,delete n.requestParams,delete n.neighboringTiles,n.state="unloaded"}prepareTile(n,s,u){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBand(s,u,(m,_)=>{if(m)return n.state="errored",this.fire(new r.a(m)),void this.triggerRepaint(n);_&&(n.setTexture(_,this.map.painter),n.state="loaded",this.triggerRepaint(n))}))}getInitialBand(n){if(!this.rasterLayers)return 0;let s=this.rasterLayers.find(({id:_})=>_===n),u=s&&s.fields,m=u&&u.bands&&u.bands;return m?m[0]:0}getTextureDescriptor(n,s,u){if(!n)return;let m=s.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!m)return;let _=null;s instanceof r.aq?_=s.paint.get("raster-array-band"):s instanceof r.ar&&(_=s.paint.get("raster-particle-array-band"));let b=_||this.getInitialBand(m);if(b!=null)if(n.textureDescriptor){if(!n.updateNeeded(m,b)||u)return Object.assign({},n.textureDescriptor,{texture:n.texture})}else this.prepareTile(n,m,b)}}let ft=32,at=33,Ht=new Uint16Array(8184);for(let c=0;c<2046;c++){let n=c+2,s=0,u=0,m=0,_=0,b=0,w=0;for(1&n?m=_=b=ft:s=u=w=ft;(n>>=1)>1;){let C=s+m>>1,R=u+_>>1;1&n?(m=s,_=u,s=b,u=w):(s=m,u=_,m=b,_=w),b=C,w=R}let S=4*c;Ht[S+0]=s,Ht[S+1]=u,Ht[S+2]=m,Ht[S+3]=_}let mi=new Uint16Array(2178),Rt=new Uint8Array(1089),nn=new Uint16Array(1089);function Vi(c){return c===0?-.03125:c===32?.03125:0}let Rn=(()=>{class c{constructor(s,u,m,_){this.id=c.uniqueIdxCounter,c.uniqueIdxCounter++,this.context=s;let b=s.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||_||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){this.id=c.uniqueIdxCounter,c.uniqueIdxCounter++;let u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return c.uniqueIdxCounter=0,c})(),qn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Bn{constructor(n,s,u,m,_,b){this.length=s.length,this.attributes=u,this.itemSize=s.bytesPerElement,this.dynamicDraw=m,this.instanceCount=b,this.context=n;let w=n.gl;this.buffer=w.createBuffer(),n.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||_||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){let s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,s){for(let u=0;u<this.attributes.length;u++){let m=s.attributes[this.attributes[u].name];m!==void 0&&n.enableVertexAttribArray(m)}}setVertexAttribPointers(n,s,u){for(let m=0;m<this.attributes.length;m++){let _=this.attributes[m],b=s.attributes[_.name];b!==void 0&&n.vertexAttribPointer(b,_.components,n[qn[_.type]],!1,this.itemSize,_.offset+this.itemSize*(u||0))}}setVertexAttribDivisor(n,s,u){for(let m=0;m<this.attributes.length;m++){let _=s.attributes[this.attributes[m].name];_!==void 0&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(_,u)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ai{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class yo extends Ai{getDefault(){return r.aA.transparent}set(n){let s=this.current;(n.r!==s.r||n.g!==s.g||n.b!==s.b||n.a!==s.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class vo extends Ai{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class br extends Ai{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class ss extends Ai{getDefault(){return[!0,!0,!0,!0]}set(n){let s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||n[3]!==s[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Sa extends Ai{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Pr extends Ai{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class yr extends Ai{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){let s=this.current;(n.func!==s.func||n.ref!==s.ref||n.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class pi extends Ai{getDefault(){let n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){let s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class cc extends Ai{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;let s=this.gl;n?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=n,this.dirty=!1}}class Kn extends Ai{getDefault(){return[0,1]}set(n){let s=this.current;(n[0]!==s[0]||n[1]!==s[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class xr extends Ai{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;let s=this.gl;n?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=n,this.dirty=!1}}class kl extends Ai{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class ia extends Ai{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;let s=this.gl;n?s.enable(s.BLEND):s.disable(s.BLEND),this.current=n,this.dirty=!1}}class Rs extends Ai{getDefault(){let n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){let s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||n[3]!==s[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class du extends Ai{getDefault(){return r.aA.transparent}set(n){let s=this.current;(n.r!==s.r||n.g!==s.g||n.b!==s.b||n.a!==s.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Dh extends Ai{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class Rh extends Ai{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;let s=this.gl;n?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=n,this.dirty=!1}}class Ph extends Ai{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class pu extends Ai{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let ol=class extends Ai{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}};class ri extends Ai{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class uc extends Ai{getDefault(){let n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){let s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||n[3]!==s[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Ma extends Ai{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;let s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class kh extends Ai{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;let s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Oh extends Ai{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;let s=this.gl;s.bindTexture(s.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Ol extends Ai{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;let s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class A extends Ai{getDefault(){return null}set(n){let s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class z extends Ai{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class K extends Ai{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;let s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class fe extends Ai{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;let s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class ve extends Ai{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;let s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class we extends Ai{constructor(n,s){super(n),this.context=n,this.parent=s}getDefault(){return null}}class Ae extends we{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class dt extends we{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class wt extends we{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,this.attachment(),s.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Lt extends dt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ft{constructor(n,s,u,m,_){this.context=n,this.width=s,this.height=u;let b=this.framebuffer=n.gl.createFramebuffer();m&&(this.colorAttachment=new Ae(n,b)),_&&(this.depthAttachmentType=_,this.depthAttachment=_==="renderbuffer"?new dt(n,b):new wt(n,b))}destroy(){let n=this.context.gl;if(this.colorAttachment){let s=this.colorAttachment.get();s&&n.deleteTexture(s)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let s=this.depthAttachment.get();s&&n.deleteRenderbuffer(s)}else{let s=this.depthAttachment.get();s&&n.deleteTexture(s)}n.deleteFramebuffer(this.framebuffer)}}class ze{constructor(n,s,u){this.func=n,this.mask=s,this.range=u}}ze.ReadOnly=!1,ze.ReadWrite=!0,ze.disabled=new ze(519,ze.ReadOnly,[0,1]);let fi=7680;class kt{constructor(n,s,u,m,_,b){this.test=n,this.ref=s,this.mask=u,this.fail=m,this.depthFail=_,this.pass=b}}kt.disabled=new kt({func:519,mask:0},0,0,fi,fi,fi);let bi=771;class qt{constructor(n,s,u,m){this.blendFunction=n,this.blendColor=s,this.mask=u,this.blendEquation=m}}qt.Replace=[1,0,1,0],qt.disabled=new qt(qt.Replace,r.aA.transparent,[!1,!1,!1,!1]),qt.unblended=new qt(qt.Replace,r.aA.transparent,[!0,!0,!0,!0]),qt.alphaBlended=new qt([1,bi,1,bi],r.aA.transparent,[!0,!0,!0,!0]),qt.multiply=new qt([774,0,774,0],r.aA.transparent,[!0,!0,!0,!0]);let ot=1029,Zt=2305;class Tt{constructor(n,s,u){this.enable=n,this.mode=s,this.frontFace=u}}Tt.disabled=new Tt(!1,ot,Zt),Tt.backCCW=new Tt(!0,ot,Zt),Tt.backCW=new Tt(!0,ot,2304),Tt.frontCW=new Tt(!0,1028,2304),Tt.frontCCW=new Tt(!0,1028,Zt);class Pn{constructor(n,s){this.gl=n,this.clearColor=new yo(this),this.clearDepth=new vo(this),this.clearStencil=new br(this),this.colorMask=new ss(this),this.depthMask=new Sa(this),this.stencilMask=new Pr(this),this.stencilFunc=new yr(this),this.stencilOp=new pi(this),this.stencilTest=new cc(this),this.depthRange=new Kn(this),this.depthTest=new xr(this),this.depthFunc=new kl(this),this.blend=new ia(this),this.blendFunc=new Rs(this),this.blendColor=new du(this),this.blendEquation=new Dh(this),this.cullFace=new Rh(this),this.cullFaceSide=new Ph(this),this.frontFace=new pu(this),this.program=new ol(this),this.activeTexture=new ri(this),this.viewport=new uc(this),this.bindFramebuffer=new Ma(this),this.bindRenderbuffer=new kh(this),this.bindTexture=new Oh(this),this.bindVertexBuffer=new Ol(this),this.bindElementBuffer=new A(this),this.bindVertexArrayOES=new z(this),this.pixelStoreUnpack=new K(this),this.pixelStoreUnpackPremultiplyAlpha=new fe(this),this.pixelStoreUnpackFlipY=new ve(this),this.options=s?Vt({},s):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.maxPointSize=n.getParameter(n.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,s,u){return new Rn(this,n,s,u)}createVertexBuffer(n,s,u,m,_){return new Bn(this,n,s,u,m,_)}createRenderbuffer(n,s,u){let m=this.gl,_=m.createRenderbuffer();return this.bindRenderbuffer.set(_),m.renderbufferStorage(m.RENDERBUFFER,n,s,u),this.bindRenderbuffer.set(null),_}createFramebuffer(n,s,u,m){return new Ft(this,n,s,u,m)}clear({color:n,depth:s,stencil:u,colorMask:m}){let _=this.gl,b=0;n&&(b|=_.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set(m||[!0,!0,!0,!0])),s!==void 0&&(b|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),u!==void 0&&(b|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),_.clear(b)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){k(n.blendFunction,qt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var cr=r.aB([{name:"a_index",type:"Int16",components:1}]);let Ps=.15000000000000002;class Lh{constructor(n,s,u,m){let _={width:u[0],height:u[1],data:null},b=n.gl;this.targetColorTexture=new r.T(n,_,b.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new r.T(n,_,b.RGBA,{useMipmap:!1}),this.context=n,this.setParticleTextureDimension(s,m),this.lastInvalidatedAt=0}setParticleTextureDimension(n,s){if(this.particleTextureDimension===s)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let u=this.context.gl,m=s*s,_=new Uint8Array(4*m),b=.7692307692307692,w=r.aC(n.key);for(let R=0;R<_.length;R+=4){let O=b*(w()+Ps),F=b*(w()+Ps),B=255*O%1,U=255*F%1,j=B,G=F-U/255,q=U;_[R+0]=Math.floor(255*(O-B/255)),_[R+1]=Math.floor(255*j),_[R+2]=Math.floor(255*G),_[R+3]=Math.floor(255*q)}let S=new r.h({width:s,height:s},_);this.particleTexture0=new r.T(this.context,S,u.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,S,u.RGBA,{premultiply:!1,useMipmap:!1});let C=new r.aD;C.reserve(m);for(let R=0;R<m;R++)C.emplaceBack(R);this.particleIndexBuffer=this.context.createVertexBuffer(C,cr.members,!0),this.particleSegment=r.aE.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=s}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=r.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}let Sn={type:2,extent:r.Y,loadGeometry:()=>[[new r.P(0,0),new r.P(r.Y+1,0),new r.P(r.Y+1,r.Y+1),new r.P(0,r.Y+1),new r.P(0,0)]]};class Ao{constructor(n,s,u,m,_){this.tileID=n,this.uid=r.aF(),this.uses=0,this.tileSize=s,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,m&&m.style&&(this._lastUpdatedBrightness=m.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection)}registerFadeDuration(n){let s=n+this.timeAdded;s<r.f.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.av(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,s,u){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(m,_){let b={};if(!_)return b;for(let w of m){let S=w.layerIds.map(C=>_.getLayer(C)).filter(Boolean);if(S.length!==0){w.layers=S,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(C=>S.filter(R=>R.id===C)[0]));for(let C of S)b[C.fqid]=w}}return b}(n.buckets,s.style),this.hasSymbolBuckets=!1;for(let m in this.buckets){let _=this.buckets[m];if(_ instanceof r.aH){if(this.hasSymbolBuckets=!0,!u)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let m in this.buckets){let _=this.buckets[m];if(_ instanceof r.aH&&_.hasRTLText){this.hasRTLText=!0,r.aI();break}}this.queryPadding=0;for(let m in this.buckets){let _=this.buckets[m],b=s.style.getOwnLayer(m);if(!b)continue;let w=b.queryRadius(_);this.queryPadding=Math.max(this.queryPadding,w)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new r.aG}unloadVectorData(){if(this.hasData()){for(let n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(n){return this.buckets[n.fqid]}upload(n){for(let m in this.buckets){let _=this.buckets[m];_.uploadPending()&&_.upload(n)}let s=n.gl,u=this.imageAtlas;if(u&&!u.uploaded){let m=!!Object.keys(u.patternPositions).length;this.imageAtlasTexture=new r.T(n,u.image,s.RGBA,{useMipmap:m}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(n,this.glyphAtlasImage,s.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(n,this.lineAtlas.image,s.R8),this.lineAtlas.uploaded=!0)}prepare(n,s,u){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,u),!s||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let m=s.style.getBrightness();(this._lastUpdatedBrightness||m)&&(this._lastUpdatedBrightness&&m&&Math.abs(this._lastUpdatedBrightness-m)<.001||(this._lastUpdatedBrightness=m,this.updateBuckets(void 0,s)))}queryRenderedFeatures(n,s,u,m,_,b,w,S){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:m,pixelPosMatrix:w,transform:b,params:_,tileTransform:this.tileTransform},n,s,u):{}}querySourceFeatures(n,s){let u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;let m=u.loadVTLayers(),_=s?s.sourceLayer:"",b=m._geojsonTileLayer||m[_];if(!b)return;let w=r.aJ(s&&s.filter),{z:S,x:C,y:R}=this.tileID.canonical,O={z:S,x:C,y:R};for(let F=0;F<b.length;F++){let B=b.feature(F);if(w.needGeometry){let G=r.aK(B,!0);if(!w.filter(new r.N(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!w.filter(new r.N(this.tileID.overscaledZ),B))continue;let U=u.getId(B,_),j=new r.aL(B,S,C,R,U);j.tile=O,n.push(j)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let n in this.buckets)if(this.buckets[n].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){let s=this.expirationTime;if(n.cacheControl){let u=r.aM(n.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){let u=Date.now(),m=!1;if(this.expirationTime>u)m=!1;else if(s)if(this.expirationTime<s)m=!0;else{let _=this.expirationTime-s;_?this.expirationTime=u+Math.max(_,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,s){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(n).length!==0&&s&&this.updateBuckets(n,s)}updateBuckets(n,s){if(!this.latestFeatureIndex)return;let u=this.latestFeatureIndex.loadVTLayers(),m=s.style.listImages(),_=s.style.getBrightness();for(let b in this.buckets){if(!s.style.hasLayer(b))continue;let w=this.buckets[b],S=w.layers[0].sourceLayer||"_geojsonTileLayer",C=u[S],R={};if(n&&(R=n[S],!C||!R||Object.keys(R).length===0))continue;if(w.update(R,C,m,this.imageAtlas&&this.imageAtlas.patternPositions||{},_),w instanceof r.aN||w instanceof r.aO){let F=s.style.getOwnSourceCache(w.layers[0].source);s._terrain&&s._terrain.enabled&&F&&w.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(F.id,this.tileID)}let O=s&&s.style&&s.style.getOwnLayer(b);O&&(this.queryPadding=Math.max(this.queryPadding,O.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=r.f.now()+n}setTexture(n,s){let u=s.context,m=u.gl;this.texture=this.texture||s.getTileTexture(n.width),this.texture&&this.texture instanceof r.T?this.texture.update(n,{useMipmap:!0}):(this.texture=new r.T(u,n,m.RGBA,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE))}setDependencies(n,s){let u={};for(let m of s)u[m]=!0;this.dependencies[n]=u}hasDependency(n,s){for(let u of n){let m=this.dependencies[u];if(m){for(let _ of s)if(m[_])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;let u=r.aP(Sn,this.tileID.canonical,this.tileTransform)[0],m=new r.aQ,_=new r.aR;for(let b=0;b<u.length;b++){let{x:w,y:S}=u[b];m.emplaceBack(w,S),_.emplaceBack(b)}_.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(_),this._tileDebugBuffer=n.createVertexBuffer(m,r.aS.members),this._tileDebugSegments=r.aE.simpleSegment(0,0,m.length,_.length)}_makeTileBoundsBuffers(n,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;let u=r.aP(Sn,this.tileID.canonical,this.tileTransform)[0],m,_;if(this.isRaster){let b=function(w,S){let C=r.av(w,S),R=Math.pow(2,w.z);for(let G=0;G<at;G++)for(let q=0;q<at;q++){let H=r.aw((w.x+(q+Vi(q))/ft)/R),ne=r.ax((w.y+(G+Vi(G))/ft)/R),ie=S.project(H,ne),oe=G*at+q;mi[2*oe+0]=Math.round((ie.x*C.scale-C.x)*r.Y),mi[2*oe+1]=Math.round((ie.y*C.scale-C.y)*r.Y)}Rt.fill(0),nn.fill(0);for(let G=2045;G>=0;G--){let q=4*G,H=Ht[q+0],ne=Ht[q+1],ie=Ht[q+2],oe=Ht[q+3],$=H+ie>>1,X=ne+oe>>1,ue=$+X-ne,le=X+H-$,ge=ne*at+H,Me=oe*at+ie,me=X*at+$,Ee=Math.hypot((mi[2*ge+0]+mi[2*Me+0])/2-mi[2*me+0],(mi[2*ge+1]+mi[2*Me+1])/2-mi[2*me+1])>=16;Rt[me]=Rt[me]||(Ee?1:0),G<1022&&(Rt[me]=Rt[me]||Rt[(ne+le>>1)*at+(H+ue>>1)]||Rt[(oe+le>>1)*at+(ie+ue>>1)])}let O=new r.ay,F=new r.az,B=0;function U(G,q){let H=q*at+G;return nn[H]===0&&(O.emplaceBack(mi[2*H+0],mi[2*H+1],G*r.Y/ft,q*r.Y/ft),nn[H]=++B),nn[H]-1}function j(G,q,H,ne,ie,oe){let $=G+H>>1,X=q+ne>>1;if(Math.abs(G-ie)+Math.abs(q-oe)>1&&Rt[X*at+$])j(ie,oe,G,q,$,X),j(H,ne,ie,oe,$,X);else{let ue=U(G,q),le=U(H,ne),ge=U(ie,oe);F.emplaceBack(ue,le,ge)}}return j(0,0,ft,ft,ft,0),j(ft,ft,0,0,0,ft),{vertices:O,indices:F}}(this.tileID.canonical,s);m=b.vertices,_=b.indices}else{m=new r.ay,_=new r.az;for(let{x:w,y:S}of u)m.emplaceBack(w,S,0,0);let b=r.aT(m.int16,void 0,4);for(let w=0;w<b.length;w+=3)_.emplaceBack(b[w],b[w+1],b[w+2])}this._tileBoundsBuffer=n.createVertexBuffer(m,r.aU.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(_),this._tileBoundsSegments=r.aE.simpleSegment(0,0,m.length,_.length)}_makeGlobeTileDebugBuffers(n,s){let u=s.projection;if(!u||u.name!=="globe"||s.freezeTileCoverage)return;let m=this.tileID.canonical,_=r.aV(m,s),b=r.aW(_),w=r.W(s.zoom),S;w>0&&(S=r.a9.invert(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,m,s,b,S,w),this._makeGlobeTileDebugTextBuffer(n,m,s,b,S,w)}_globePoint(n,s,u,m,_,b,w){let S=r.aX(n,s,u);if(b){let C=1<<u.z,R=r.a8(m.center.lng),O=r.ah(m.center.lat),F=(u.x+.5)/C-R,B=0;F>.5?B=-1:F<-.5&&(B=1);let U=(n/r.Y+u.x)/C+B,j=(s/r.Y+u.y)/C;U=(U-R)*m._pixelsPerMercatorPixel+R,j=(j-O)*m._pixelsPerMercatorPixel+O;let G=[U*m.worldSize,j*m.worldSize,0];r.Q.transformMat4(G,G,b),S=r.aY(S,G,w)}return r.Q.transformMat4(S,S,_)}_makeGlobeTileDebugBorderBuffer(n,s,u,m,_,b){let w=new r.aQ,S=new r.aR,C=new r.aZ,R=(F,B,U,j,G)=>{let q=(U-F)/(G-1),H=(j-B)/(G-1),ne=w.length;for(let ie=0;ie<G;ie++){let oe=F+ie*q,$=B+ie*H;w.emplaceBack(oe,$);let X=this._globePoint(oe,$,s,u,m,_,b);C.emplaceBack(X[0],X[1],X[2]),S.emplaceBack(ne+ie)}},O=r.Y;R(0,0,O,0,16),R(O,0,O,O,16),R(O,O,0,O,16),R(0,O,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(S),this._tileDebugBuffer=n.createVertexBuffer(w,r.aS.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(C,r.a_.members),this._tileDebugSegments=r.aE.simpleSegment(0,0,w.length,S.length)}_makeGlobeTileDebugTextBuffer(n,s,u,m,_,b){let w=r.Y/4,S=new r.aQ,C=new r.az,R=new r.aZ,O=25;C.reserve(32),S.reserve(O),R.reserve(O);let F=(B,U)=>O*B+U;for(let B=0;B<O;B++){let U=B*w;for(let j=0;j<O;j++){let G=j*w;S.emplaceBack(G,U);let q=this._globePoint(G,U,s,u,m,_,b);R.emplaceBack(q[0],q[1],q[2])}}for(let B=0;B<4;B++)for(let U=0;U<4;U++){let j=F(B,U),G=F(B,U+1),q=F(B+1,U),H=F(B+1,U+1);C.emplaceBack(j,G,q),C.emplaceBack(q,G,H)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(C),this._tileDebugTextBuffer=n.createVertexBuffer(S,r.aS.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(R,r.a_.members),this._tileDebugTextSegments=r.aE.simpleSegment(0,0,O,32)}destroy(n=!1){for(let s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}let ct={vector:ut,raster:ht,"raster-dem":class extends ht{constructor(c,n,s,u){super(c,n,s,u),this.type="raster-dem",this.maxzoom=22,this._options=r.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(c,n){let s=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(m,_){m&&(c.state="errored",n(m)),_&&(c.dem=_,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",n(null))}c.request=r.d(this.map._requestManager.transformRequest(s,r.R.Tile),(function(m,_,b,w){if(delete c.request,c.aborted)c.state="unloaded",n(null);else if(m)c.state="errored",n(m);else if(_){this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:b,expires:w});let S=ImageBitmap&&_ instanceof ImageBitmap&&r.an(),C=1-(_.width-r.ao(_.width))/2;C<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));let R=S?_:r.f.getImageData(_,C),O={uid:c.uid,coord:c.tileID,source:this.id,scope:this.scope,rawImageData:R,encoding:this.encoding,padding:C};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",O,u.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(c){let n=c.canonical,s=Math.pow(2,n.z),u=(n.x-1+s)%s,m=n.x===0?c.wrap-1:c.wrap,_=(n.x+1+s)%s,b=n.x+1===s?c.wrap+1:c.wrap,w={};return w[new r.ap(c.overscaledZ,m,n.z,u,n.y).key]={backfilled:!1},w[new r.ap(c.overscaledZ,b,n.z,_,n.y).key]={backfilled:!1},n.y>0&&(w[new r.ap(c.overscaledZ,m,n.z,u,n.y-1).key]={backfilled:!1},w[new r.ap(c.overscaledZ,c.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},w[new r.ap(c.overscaledZ,b,n.z,_,n.y-1).key]={backfilled:!1}),n.y+1<s&&(w[new r.ap(c.overscaledZ,m,n.z,u,n.y+1).key]={backfilled:!1},w[new r.ap(c.overscaledZ,c.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},w[new r.ap(c.overscaledZ,b,n.z,_,n.y+1).key]={backfilled:!1}),w}},"raster-array":rt,geojson:class extends r.E{constructor(c,n,s,u){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(u),this._data=n.data,this._options=r.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.minzoom!==void 0&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;let m=r.Y/this.tileSize;this.workerOptions=r.e({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*m,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*m,extent:r.Y,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:r.Y,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*m,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}updateData(c){return this._options.dynamic?(this._data=c,this._updateWorkerData(!0),this):this.fire(new r.a(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(c,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id,scope:this.scope},n),this}getClusterChildren(c,n){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id,scope:this.scope},n),this}getClusterLeaves(c,n,s,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:c,limit:n,offset:s},u),this}_updateWorkerData(c=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.b("dataloading",{dataType:"source"})),this._loaded=!1;let n=r.e({append:c},this.workerOptions);n.scope=this.scope;let s=this._data;typeof s=="string"?(n.request=this.map._requestManager.transformRequest(r.f.resolveURL(s),r.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,(u,m)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new r.a(u));else{let _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(_.resourceTiming=m.resourceTiming[this.id]),this.fire(new r.b("data",_)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(c),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(c,n){let s=c.actor?"reloadTile":"loadTile";c.actor=this.actor;let u={type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:r.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};c.request=this.actor.send(s,u,(m,_)=>(delete c.request,c.destroy(),c.aborted?n(null):m?n(m):(c.loadVectorData(_,this.map.painter,s==="reloadTile"),n(null))),void 0,s==="loadTile")}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c){this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope}),c.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.as{constructor(c,n,s,u){super(c,n,s,u),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;let c=this.options;this.urls=[];for(let n of c.urls)this.urls.push(this.map._requestManager.transformRequest(n,r.R.Source).url);r.at(this.urls,(n,s)=>{this._loaded=!0,n?this.fire(new r.a(n)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){let n=this.video.seekable;c<n.start(0)||c>n.end(0)?this.fire(new r.a(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let c=this.map.painter.context,n=c.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(c,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.as,model:class extends r.E{constructor(c,n,s,u){super(),this.id=c,this.type="model",this.models=[],this._loaded=!1,this._options=n}load(){let c=[];for(let n in this._options.models){let s=this._options.models[n],u=r.l(this.map._requestManager.transformRequest(s.uri,r.R.Model).url).then(m=>{if(!m)return;let _=r.c(m),b=new r.M(n,s.position,s.orientation,_);b.computeBoundsAndApplyParent(),this.models.push(b)}).catch(m=>{this.fire(new r.a(new Error(`Could not load model ${n} from ${s.uri}: ${m.message}`)))});c.push(u)}return Promise.allSettled(c).then(()=>{this._loaded=!0,this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(n=>{this.fire(new r.a(new Error(`Could not load models: ${n.message}`)))})}onAdd(c){this.map=c,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(c,n){}serialize(){return{type:"model"}}},"batched-model":class extends r.E{constructor(c,n,s,u){super(),this.type="batched-model",this.id=c,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=s,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(u)}onAdd(c){this.map=c,this.load()}load(c){this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"}));let n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map._worldview;this._tileJSONRequest=st(this._options,this.map._requestManager,n,s,(u,m)=>{this._tileJSONRequest=null,this._loaded=!0,u?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new r.a(u))):m&&(r.e(this,m),m.bounds&&(this.tileBounds=new tt(m.bounds,this.minzoom,this.maxzoom)),r.am(m.tiles,this.map._requestManager._customAccessToken),this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))),c&&c(u)})}hasTransition(){return!1}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loaded(){return this._loaded}loadTile(c,n){let s=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),u={request:this.map._requestManager.transformRequest(s,r.R.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:c.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(c.actor&&c.state!=="expired")if(c.state==="loading")c.reloadCallback=n;else{if(c.buckets){let _=Object.values(c.buckets);for(let b of _)b.dirty=!0;return void(c.state="loaded")}c.request=c.actor.send("reloadTile",u,m.bind(this))}else c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",u,m.bind(this),void 0,!0);function m(_,b){return c.aborted?n(null):_&&_.status!==404?n(_):(b&&(b.resourceTiming&&(c.resourceTiming=b.resourceTiming),this.map._refreshExpiredTiles&&c.setExpiryData(b),c.buckets=Vt(Vt({},c.buckets),b.buckets),b.featureIndex&&(c.latestFeatureIndex=b.featureIndex)),c.state="loaded",void n(null))}}serialize(){return r.e({},this._options)}},canvas:class extends r.as{constructor(c,n,s,u){super(c,n,s,u),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(_=>typeof _!="number"))||this.fire(new r.a(new r.V(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.a(new r.V(`sources.${c}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new r.a(new r.V(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new r.a(new r.V(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.a(new r.V(`sources.${c}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let n=this.map.painter.context;this.texture?!c&&!this._playing||this.texture instanceof r.au||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends r.E{constructor(c,n,s,u){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=n,this.setEventedParent(u),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new tt(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),r.e(this,r.af(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.af(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this._map=c,this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){let{x:n,y:s,z:u}=c.canonical;return this._implementation.hasTile({x:n,y:s,z:u})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,n){let{x:s,y:u,z:m}=c.tileID.canonical,_=new AbortController;c.request=Promise.resolve(this._implementation.loadTile({x:s,y:u,z:m},{signal:_.signal})).then((function(b){return delete c.request,c.aborted?(c.state="unloaded",n(null)):b===void 0?(c.state="errored",n(null)):b===null?(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",n(null)):function(w){return w instanceof ImageData||w instanceof HTMLCanvasElement||w instanceof ImageBitmap||w instanceof HTMLImageElement}(b)?(this.loadTileData(c,b),c.state="loaded",void n(null)):(c.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(b=>{b.code!==20&&(c.state="errored",n(b))}),c.request.cancel=()=>_.abort()}loadTileData(c,n){c.setTexture(n,this._map.painter)}unloadTile(c,n){if(c.texture&&c.texture instanceof r.T?(c.destroy(!0),c.texture&&c.texture instanceof r.T&&this._map.painter.saveTileTexture(c.texture)):c.destroy(),this._implementation.unloadTile){let{x:s,y:u,z:m}=c.tileID.canonical;this._implementation.unloadTile({x:s,y:u,z:m})}n()}abortTile(c,n){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z}))}_clearTiles(){let c=r.aj(this.id,this.scope);this._map.style.clearSource(c)}_update(){this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))}}},Go=function(c,n,s,u){let m=new ct[n.type](c,n,s,u);if(m.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${m.id}`);return r.a$(["load","abort","unload","serialize","prepare"],m),m};function hc(c,n){let s=r.a9.identity([]);return r.a9.scale(s,s,[.5*c.width,.5*-c.height,1]),r.a9.translate(s,s,[1,-1,0]),r.a9.multiply(s,s,c.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(s)}function Si(c,n,s,u,m,_,b,w=!1){let S=c.tilesIn(u,b,w);S.sort(dc);let C=[];for(let O of S)C.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(n,s,c._state,O,m,_,hc(c.transform,O.tile.tileID),w)});let R=function(O){let F={},B={};for(let U of O){let j=U.queryResults,G=U.wrappedTileID,q=B[G]=B[G]||{};for(let H in j){let ne=j[H],ie=q[H]=q[H]||{},oe=F[H]=F[H]||[];for(let $ of ne)ie[$.featureIndex]||(ie[$.featureIndex]=!0,oe.push($))}}return F}(C);for(let O in R)R[O].forEach(F=>{let B=F.feature,U=B.layer;U&&U.type!=="background"&&U.type!=="sky"&&U.type!=="slot"&&(B.source=U.source,U["source-layer"]&&(B.sourceLayer=U["source-layer"]),B.state=B.id!==void 0?c.getFeatureState(U["source-layer"],B.id):{})});return R}function zr(c,n){let s=c.getRenderableIds().map(_=>c.getTileByID(_)),u=[],m={};for(let _=0;_<s.length;_++){let b=s[_],w=b.tileID.canonical.key;m[w]||(m[w]=!0,b.querySourceFeatures(u,n))}return u}function dc(c,n){let s=c.tileID,u=n.tileID;return s.overscaledZ-u.overscaledZ||s.canonical.y-u.canonical.y||s.wrap-u.wrap||s.canonical.x-u.canonical.x}class Ll extends Ao{constructor(n,s,u,m,_){super(n,s,u,m,_),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(n,s){let u=s.context,m=u.gl;this.texture=this.texture||s.getTileTexture(n.width),this.texture&&this.texture instanceof r.T?this.texture.update(n,{useMipmap:!1,premultiply:!1}):this.texture=new r.T(u,n,m.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(n=16384,s){let u=this._mrt=new r.b0(30),m=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=r.b1(m,(_,b,w,S)=>{if(_)s(_);else try{let C=u.getHeaderLength(b);if(C>n)return void(this.request=this.fetchHeader(C,s));u.parseHeader(b),this._isHeaderLoaded=!0;let R=0;for(let O of Object.values(u.layers))R=Math.max(R,O.dataIndex[O.dataIndex.length-1].last_byte);b.byteLength>=R&&(this.entireBuffer=b),s(null,this.entireBuffer||b,w,S)}catch(C){s(C)}}),this.request}fetchBand(n,s,u){let m=this._mrt;if(!this._isHeaderLoaded||!m)return void u(new Error("Tile header is not ready"));let _=this.actor;if(!_)return void u(new Error("Can't fetch tile band without an actor"));let b,w=(O,F)=>{b.complete(O,F),O?u(O):(this.updateTextureDescriptor(n,s),u(null,this.textureDescriptor&&this.textureDescriptor.img))},S=(O,F)=>{if(O)return u(O);let B=_.send("decodeRasterArray",{buffer:F,task:b},w,void 0,!0);this._workQueue.push(()=>{B&&B.cancel(),b.cancel()})},C=m.getLayer(n);if(!C)return void u(new Error(`Unknown sourceLayer "${n}"`));if(C.hasDataForBand(s))return this.updateTextureDescriptor(n,s),void u(null,this.textureDescriptor?this.textureDescriptor.img:null);let R=C.getDataRange([s]);if(b=m.createDecodingTask(R),!b||b.tasks.length)if(this.flushQueues(),this.entireBuffer)S(null,this.entireBuffer.slice(R.firstByte,R.lastByte+1));else{let O=Object.assign({},this.requestParams,{headers:{Range:`bytes=${R.firstByte}-${R.lastByte}`}}),F=r.b1(O,S);this._fetchQueue.push(()=>{F.cancel(),b.cancel()})}else u(null)}updateNeeded(n,s){return(!this.textureDescriptor||this.textureDescriptor.band!==s||this.textureDescriptor.layer!==n)&&this.state!=="errored"}updateTextureDescriptor(n,s){if(!this._mrt)return;let u=this._mrt.getLayer(n);if(!u||!u.hasBand(s)||!u.hasDataForBand(s))return;let{bytes:m,tileSize:_,buffer:b,offset:w,scale:S}=u.getBandView(s),C=_+2*b,R={data:m,width:C,height:C},O=this.texture;O&&O instanceof r.T&&O.update(R,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:n,band:s,img:R,buffer:b,offset:w,tileSize:_,format:u.pixelFormat,mix:[S,256*S,65536*S,16777216*S]}}}class fu{constructor(n,s){this.max=n,this.onRemove=s,this.reset()}reset(){for(let n in this.data)for(let s of this.data[n])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(n,s,u){let m=n.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);let _={value:s,timeout:void 0};if(u!==void 0&&(_.timeout=setTimeout(()=>{this.remove(n,_)},u)),this.data[m].push(_),this.order.push(m),this.order.length>this.max){let b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){let s=this.data[n].shift();return s.timeout&&clearTimeout(s.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),s.value}getByKey(n){let s=this.data[n];return s?s[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,s){if(!this.has(n))return this;let u=n.wrapped().key,m=s===void 0?0:this.data[u].indexOf(s),_=this.data[u][m];return this.data[u].splice(m,1),_.timeout&&clearTimeout(_.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(_.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){let s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(n){let s=[];for(let u in this.data)for(let m of this.data[u])n(m.value)||s.push(m);for(let u of s)this.remove(u.value.tileID,u)}}class qo extends r.E{constructor(n,s,u){super(),this.id=n,this._onlySymbols=u,s.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new fu(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Rr,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let n in this._tiles){let s=this._tiles[n];if(s.state!=="errored"&&(s.state!=="loaded"||!s.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,s){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,s)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n,()=>{})}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n,()=>{})}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let s in this._tiles){let u=this._tiles[s];u.upload(n),u.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return r.b2(this._tiles).map(n=>n.tileID).sort(gi).map(n=>n.key)}getRenderableIds(n,s){let u=[];for(let m in this._tiles)this._isIdRenderable(+m,n,s)&&u.push(this._tiles[m]);return n?u.sort((m,_)=>{let b=m.tileID,w=_.tileID,S=new r.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),C=new r.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-w.overscaledZ||C.y-S.y||C.x-S.x}).map(m=>m.tileID.key):u.map(m=>m.tileID).sort(gi).map(m=>m.key)}hasRenderableParent(n){let s=this.findLoadedParent(n,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(n,s,u){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(s||!this._tiles[n].holdingForFade())&&(u||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,s){let u=this._tiles[n];u&&(u.state!=="loading"&&(u.state=s),this._loadTile(u,this._tileLoaded.bind(this,u,n,s)))}_tileLoaded(n,s,u,m){if(m)if(n.state="errored",m.status!==404)this._source.fire(new r.a(m,{tile:n}));else{if(!(n.tileID.key in this._loadedParentTiles))return void this._source.fire(new r.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let _=this.map.painter.terrain;this.update(this.transform,_.getScaledDemTileSize(),!0),_.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=r.f.now(),u==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(s,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new r.b("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){let s=this.getRenderableIds();for(let m=0;m<s.length;m++){let _=s[m];if(n.neighboringTiles&&n.neighboringTiles[_]){let b=this.getTileByID(_);u(n,b),u(b,n)}}function u(m,_){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let b=_.tileID.canonical.x-m.tileID.canonical.x,w=_.tileID.canonical.y-m.tileID.canonical.y,S=Math.pow(2,m.tileID.canonical.z),C=_.tileID.key;b===0&&w===0||Math.abs(w)>1||(Math.abs(b)>1&&(Math.abs(b+S)===1?b+=S:Math.abs(b-S)===1&&(b-=S)),_.dem&&m.dem&&(m.dem.backfillBorder(_.dem,b,w),m.neighboringTiles&&m.neighboringTiles[C]&&(m.neighboringTiles[C].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,s,u,m){for(let _ in this._tiles){let b=this._tiles[_];if(m[_]||!b.hasData()||b.tileID.overscaledZ<=s||b.tileID.overscaledZ>u)continue;let w=b.tileID;for(;b&&b.tileID.overscaledZ>s+1;){let C=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[C.key],b&&b.hasData()&&(w=C)}let S=w;for(;S.overscaledZ>s;)if(S=S.scaledTo(S.overscaledZ-1),n[S.key]){m[w.key]=w;break}}}findLoadedParent(n,s){if(n.key in this._loadedParentTiles){let u=this._loadedParentTiles[n.key];return u&&u.tileID.overscaledZ>=s?u:null}for(let u=n.overscaledZ-1;u>=s;u--){let m=n.scaledTo(u),_=this._getLoadedTile(m);if(_)return _}}_getLoadedTile(n){let s=this._tiles[n.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,s){s=s||this._source.tileSize;let u=Math.ceil(n.width/s)+1,m=Math.ceil(n.height/s)+1,_=Math.floor(u*m*5),b=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,_):_,w=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(w)}handleWrapJump(n){let s=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,s){let u={};for(let m in this._tiles){let _=this._tiles[m];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+s),u[_.tileID.key]=_}this._tiles=u;for(let m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(let m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(n,s,u,m){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let _;if(this.updateCacheSize(n,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)_=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(S=>new r.ap(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y));else if(this.tileCoverLift!==0){let S=n.clone();S.tileCoverLift=this.tileCoverLift,_=S.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&n.projection.name==="globe"&&(_.push(new r.ap(1,0,1,0,0)),_.push(new r.ap(1,0,1,1,0)),_.push(new r.ap(1,0,1,0,1)),_.push(new r.ap(1,0,1,1,1)))}else _=n.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(_=_.filter(S=>this._source.hasTile(S)));else _=[];if(_.length>0&&this.castsShadows&&m&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Fl(this._source.type)){let S=n.coveringZoomLevel({tileSize:s||this._source.tileSize,roundZoom:this._source.roundZoom&&!u}),C=Math.min(S,this._source.maxzoom),R=n.extendTileCoverForShadows(_,m,C);for(let O of R)this._shadowCasterTiles[O.key]=!0,_.push(O)}let b=this._updateRetainedTiles(_);if(Fl(this._source.type)&&_.length!==0){let S={},C={},R=Object.keys(b);for(let F of R){let B=b[F],U=this._tiles[F];if(!U||U.fadeEndTime&&U.fadeEndTime<=r.f.now())continue;let j=this.findLoadedParent(B,Math.max(B.overscaledZ-qo.maxOverzooming,this._source.minzoom));j&&(this._addTile(j.tileID),S[j.tileID.key]=j.tileID),C[F]=B}let O=_[_.length-1].overscaledZ;for(let F in this._tiles){let B=this._tiles[F];if(b[F]||!B.hasData())continue;let U=B.tileID;for(;U.overscaledZ>O;){U=U.scaledTo(U.overscaledZ-1);let j=this._tiles[U.key];if(j&&j.hasData()&&C[U.key]){b[F]=B.tileID;break}}}for(let F in S)b[F]||(this._coveredTiles[F]=!0,b[F]=S[F])}for(let S in b)this._tiles[S].clearFadeHold();let w=r.b3(this._tiles,b);for(let S of w){let C=this._tiles[S];C.hasSymbolBuckets&&!C.holdingForFade()?C.setHoldDuration(this.map._fadeDuration):C.hasSymbolBuckets&&!C.symbolFadeFinished()||this._removeTile(+S)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){let s={};if(n.length===0)return s;let u={},m=n.reduce((C,R)=>Math.min(C,R.overscaledZ),1/0),_=n[0].overscaledZ,b=Math.max(_-qo.maxOverzooming,this._source.minzoom),w=Math.max(_+qo.maxUnderzooming,this._source.minzoom),S={};for(let C of n){let R=this._addTile(C);s[C.key]=C,R.hasData()||m<this._source.maxzoom&&(S[C.key]=C)}this._retainLoadedChildren(S,m,w,s);for(let C of n){let R=this._tiles[C.key];if(R.hasData())continue;if(C.canonical.z>=this._source.maxzoom){let F=C.children(this._source.maxzoom)[0],B=this.getTile(F);if(B&&B.hasData()){s[F.key]=F;continue}}else{let F=C.children(this._source.maxzoom);if(s[F[0].key]&&s[F[1].key]&&s[F[2].key]&&s[F[3].key])continue}let O=R.wasRequested();for(let F=C.overscaledZ-1;F>=b;--F){let B=C.scaledTo(F);if(u[B.key]||(u[B.key]=!0,R=this.getTile(B),!R&&O&&(R=this._addTile(B)),R&&(s[B.key]=B,O=R.wasRequested(),R.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let n in this._tiles){let s=[],u,m=this._tiles[n].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){u=this._loadedParentTiles[m.key];break}s.push(m.key);let _=m.scaledTo(m.overscaledZ-1);if(u=this._getLoadedTile(_),u)break;m=_}for(let _ of s)this._loadedParentTiles[_]=u}}_addTile(n){let s=this._tiles[n.key];if(s)return s.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),s;s=this._cache.getAndRemove(n),s&&(this._setTileReloadTimer(n.key,s),s.tileID=n,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,s)));let u=!!s;if(!u){let m=this.map?this.map.painter:null,_=this._source.tileSize*n.overscaleFactor();s=this._source.type==="raster-array"?new Ll(n,_,this.transform.tileZoom,m,this._isRaster):new Ao(n,_,this.transform.tileZoom,m,this._isRaster),this._loadTile(s,this._tileLoaded.bind(this,s,n.key,s.state))}return s?(s.uses++,this._tiles[n.key]=s,u||this._source.fire(new r.b("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(n,s){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);let u=s.getExpiryTimeout();u&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},u))}_removeTile(n){let s=this._tiles[n];s&&(s.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),s.uses>0||(s.hasData()&&s.state!=="reloading"||s.state==="empty"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,s,u){let m=[],_=this.transform;if(!_)return m;let b=_.projection.name==="globe",w=r.a8(_.center.lng);for(let S in this._tiles){let C=this._tiles[S];if(u&&C.clearQueryDebugViz(),C.holdingForFade())continue;let R;if(b){let O=C.tileID.canonical;if(O.z===0){let F=[Math.abs(r.ad(w,...as(O,-1))-w),Math.abs(r.ad(w,...as(O,1))-w)];R=[0,2*F.indexOf(Math.min(...F))-1]}else{let F=[Math.abs(r.ad(w,...as(O,-1))-w),Math.abs(r.ad(w,...as(O,0))-w),Math.abs(r.ad(w,...as(O,1))-w)];R=[F.indexOf(Math.min(...F))-1]}}else R=[0];for(let O of R){let F=n.containsTile(C,_,s,O);F&&m.push(F)}}return m}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,s){let u=this.getRenderableIds(n,s).map(_=>this._tiles[_].tileID),m=this.transform.projection.name==="globe";for(let _ of u)_.projMatrix=this.transform.calculateProjMatrix(_.toUnwrapped()),_.expandedProjMatrix=m?this.transform.calculateProjMatrix(_.toUnwrapped(),!1,!0):_.projMatrix;return u}sortCoordinatesByDistance(n){let s=n.slice(),u=this.transform._camera.position,m=this.transform._camera.forward(),_={};for(let b of s){let w=1/(1<<b.canonical.z);_[b.key]=((b.canonical.x+.5)*w+b.wrap-u[0])*m[0]+((b.canonical.y+.5)*w-u[1])*m[1]-u[2]*m[2]}return s.sort((b,w)=>_[b.key]-_[w.key]),s}hasTransition(){if(this._source.hasTransition())return!0;if(Fl(this._source.type))for(let n in this._tiles){let s=this._tiles[n];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=r.f.now())return!0}return!1}setFeatureState(n,s,u){this._state.updateState(n=n||"_geojsonTileLayer",s,u)}removeFeatureState(n,s,u){this._state.removeFeatureState(n=n||"_geojsonTileLayer",s,u)}getFeatureState(n,s){return this._state.getState(n=n||"_geojsonTileLayer",s)}setDependencies(n,s,u){let m=this._tiles[n];m&&m.setDependencies(s,u)}reloadTilesForDependencies(n,s){for(let u in this._tiles)this._tiles[u].hasDependency(n,s)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(n,s))}_preloadTiles(n,s){if(!this._sourceLoaded){let S=()=>{this._sourceLoaded&&(this._source.off("data",S),this._preloadTiles(n,s))};return void this._source.on("data",S)}let u=new Map,m=Array.isArray(n)?n:[n],_=this.map.painter.terrain,b=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(let S of m){let C=S.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let R of C)u.set(R.key,R);this.usedForTerrain&&S.updateElevation(!1)}let w=Array.from(u.values());r.b4(w,(S,C)=>{let R=new Ao(S,this._source.tileSize*S.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(R,O=>{this._source.type==="raster-dem"&&R.dem&&this._backfillDEM(R),C(O,R)})},s)}}function gi(c,n){let s=Math.abs(2*c.wrap)-+(c.wrap<0),u=Math.abs(2*n.wrap)-+(n.wrap<0);return c.overscaledZ-n.overscaledZ||u-s||n.canonical.y-c.canonical.y||n.canonical.x-c.canonical.x}function Fl(c){return c==="raster"||c==="image"||c==="video"||c==="custom"}function as(c,n){let s=1<<c.z;return[c.x/s+n,(c.x+1)/s+n]}qo.maxOverzooming=10,qo.maxUnderzooming=3;class pc{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let n=!1,s=!1;for(let u in this.style._mergedLayers){let m=this.style._mergedLayers[u];if(m.type==="fill-extrusion")this.layers.push({layer:m,visible:n,visibilityChanged:s});else if(m.type==="model"){let _=this.style.getLayerSource(m);_&&_.type==="batched-model"&&this.layers.push({layer:m,visible:n,visibilityChanged:s})}}}onNewFrame(n){this.layersGotHidden=!1;for(let s of this.layers){let u=s.layer,m=!1;u.type==="fill-extrusion"?m=!u.isHidden(n)&&u.paint.get("fill-extrusion-opacity")>0:u.type==="model"&&(m=!u.isHidden(n)&&u.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!m&&s.visible,s.visible=m}}updateZOffset(n,s){this.currentBuildingBuckets=[];for(let m of this.layers){let _=m.layer,b=this.style.getLayerSourceCache(_),w=1;_.type==="fill-extrusion"&&(w=m.visible?_.paint.get("fill-extrusion-vertical-scale"):0);let S=b?b.getTile(s):null;if(!S&&b&&s.canonical.z>b.getSource().minzoom){let C=s.scaledTo(Math.min(b.getSource().maxzoom,s.overscaledZ-1));for(;C.overscaledZ>=b.getSource().minzoom&&(S=b.getTile(C),!S&&C.overscaledZ!==0);)C=C.scaledTo(C.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:S?S.getBucket(_):null,tileID:S?S.tileID:s,verticalScale:w})}n.hasAnyZOffset=!1;let u=!1;for(let m=0;m<n.symbolInstances.length;m++){let _=n.symbolInstances.get(m),b=_.zOffset,w=this._getHeightAtTileOffset(s,_.tileAnchorX,_.tileAnchorY);_.zOffset=w!==Number.NEGATIVE_INFINITY?w:b,u||b===_.zOffset||(u=!0),n.hasAnyZOffset||_.zOffset===0||(n.hasAnyZOffset=!0)}u&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,s,u,m){let _=s,b=u;if(n.canonical.z!==m.canonical.z){let w=m.canonical,S=1/(1<<n.canonical.z-w.z);_=(s+n.canonical.x*r.Y)*S-w.x*r.Y|0,b=(u+n.canonical.y*r.Y)*S-w.y*r.Y|0}return{tileX:_,tileY:b}}_getHeightAtTileOffset(n,s,u){let m,_;for(let b=0;b<this.layers.length;++b){if(this.layers[b].layer.type!=="fill-extrusion")continue;let{bucket:w,tileID:S,verticalScale:C}=this.currentBuildingBuckets[b];if(!w)continue;let{tileX:R,tileY:O}=this._mapCoordToOverlappingTile(n,s,u,S),F=w.getHeightAtTileCoord(R,O);F&&F.height!==void 0&&(F.hidden?m=F.height:_=Math.max(F.height*C,_||0))}if(_!==void 0)return _;for(let b=0;b<this.layers.length;++b){let w=this.layers[b];if(w.layer.type!=="model"||!w.visible)continue;let{bucket:S,tileID:C}=this.currentBuildingBuckets[b];if(!S)continue;let{tileX:R,tileY:O}=this._mapCoordToOverlappingTile(n,s,u,C),F=S.getHeightAtTileCoord(R,O);if(F&&!F.hidden)return F.height===void 0&&m!==void 0?Math.min(F.maxHeight,m)*F.verticalScale:F.height?F.height*F.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function bo(c,n){let s={};for(let u in c)u!=="ref"&&(s[u]=c[u]);return r.b5.forEach(u=>{u in n&&(s[u]=n[u])}),s}function Fh(c){c=c.slice();let n=Object.create(null);for(let s=0;s<c.length;s++)n[c[s].id]=c[s];for(let s=0;s<c.length;s++)"ref"in c[s]&&(c[s]=bo(c[s],n[c[s].ref]));return c}let zi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Ca(c,n,s){s.push({command:zi.addSource,args:[c,n[c]]})}function zl(c,n,s){n.push({command:zi.removeSource,args:[c]}),s[c]=!0}function mu(c,n,s,u){zl(c,s,u),Ca(c,n,s)}function Do(c,n,s){let u;for(u in c[s])if(c[s].hasOwnProperty(u)&&u!=="data"&&!k(c[s][u],n[s][u]))return!1;for(u in n[s])if(n[s].hasOwnProperty(u)&&u!=="data"&&!k(c[s][u],n[s][u]))return!1;return!0}function na(c,n,s,u,m,_){let b;for(b in n=n||{},c=c||{})c.hasOwnProperty(b)&&(k(c[b],n[b])||s.push({command:_,args:[u,b,n[b],m]}));for(b in n)n.hasOwnProperty(b)&&!c.hasOwnProperty(b)&&(k(c[b],n[b])||s.push({command:_,args:[u,b,n[b],m]}))}function Aa(c){return c.id}function Bl(c,n){return c[n.id]=n,c}class ls{constructor(n,s){this.reset(n,s)}reset(n,s){this.points=n||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=r.ad(n,0,1);let s=1,u=this._distances[s],m=n*this.paddedLength+this.padding;for(;u<m&&s<this._distances.length;)u=this._distances[++s];let _=s-1,b=this._distances[_],w=u-b,S=w>0?(m-b)/w:0;return this.points[_].mult(1-S).add(this.points[s].mult(S))}}class sl{constructor(n,s,u){let m=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(n/u),this.yCellCount=Math.ceil(s/u);for(let b=0;b<this.xCellCount*this.yCellCount;b++)m.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=s,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,s,u,m,_){this._forEachCell(s,u,m,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(_)}insertCircle(n,s,u,m){this._forEachCell(s-m,u-m,s+m,u+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(s),this.circles.push(u),this.circles.push(m)}_insertBoxCell(n,s,u,m,_,b){this.boxCells[_].push(b)}_insertCircleCell(n,s,u,m,_,b){this.circleCells[_].push(b)}_query(n,s,u,m,_,b){if(u<0||n>this.width||m<0||s>this.height)return!_&&[];let w=[];if(n<=0&&s<=0&&this.width<=u&&this.height<=m){if(_)return!0;for(let S=0;S<this.boxKeys.length;S++)w.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(let S=0;S<this.circleKeys.length;S++){let C=this.circles[3*S],R=this.circles[3*S+1],O=this.circles[3*S+2];w.push({key:this.circleKeys[S],x1:C-O,y1:R-O,x2:C+O,y2:R+O})}return b?w.filter(b):w}return this._forEachCell(n,s,u,m,this._queryCell,w,{hitTest:_,seenUids:{box:{},circle:{}}},b),_?w.length>0:w}_queryCircle(n,s,u,m,_){let b=n-u,w=n+u,S=s-u,C=s+u;if(w<0||b>this.width||C<0||S>this.height)return!m&&[];let R=[];return this._forEachCell(b,S,w,C,this._queryCellCircle,R,{hitTest:m,circle:{x:n,y:s,radius:u},seenUids:{box:{},circle:{}}},_),m?R.length>0:R}query(n,s,u,m,_){return this._query(n,s,u,m,!1,_)}hitTest(n,s,u,m,_){return this._query(n,s,u,m,!0,_)}hitTestCircle(n,s,u,m){return this._queryCircle(n,s,u,!0,m)}_queryCell(n,s,u,m,_,b,w,S){let C=w.seenUids,R=this.boxCells[_];if(R!==null){let F=this.bboxes;for(let B of R)if(!C.box[B]){C.box[B]=!0;let U=4*B;if(n<=F[U+2]&&s<=F[U+3]&&u>=F[U+0]&&m>=F[U+1]&&(!S||S(this.boxKeys[B]))){if(w.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[B],x1:F[U],y1:F[U+1],x2:F[U+2],y2:F[U+3]})}}}let O=this.circleCells[_];if(O!==null){let F=this.circles;for(let B of O)if(!C.circle[B]){C.circle[B]=!0;let U=3*B;if(this._circleAndRectCollide(F[U],F[U+1],F[U+2],n,s,u,m)&&(!S||S(this.circleKeys[B]))){if(w.hitTest)return b.push(!0),!0;{let j=F[U],G=F[U+1],q=F[U+2];b.push({key:this.circleKeys[B],x1:j-q,y1:G-q,x2:j+q,y2:G+q})}}}}}_queryCellCircle(n,s,u,m,_,b,w,S){let C=w.circle,R=w.seenUids,O=this.boxCells[_];if(O!==null){let B=this.bboxes;for(let U of O)if(!R.box[U]){R.box[U]=!0;let j=4*U;if(this._circleAndRectCollide(C.x,C.y,C.radius,B[j+0],B[j+1],B[j+2],B[j+3])&&(!S||S(this.boxKeys[U])))return b.push(!0),!0}}let F=this.circleCells[_];if(F!==null){let B=this.circles;for(let U of F)if(!R.circle[U]){R.circle[U]=!0;let j=3*U;if(this._circlesCollide(B[j],B[j+1],B[j+2],C.x,C.y,C.radius)&&(!S||S(this.circleKeys[U])))return b.push(!0),!0}}}_forEachCell(n,s,u,m,_,b,w,S){let C=this._convertToXCellCoord(n),R=this._convertToYCellCoord(s),O=this._convertToXCellCoord(u),F=this._convertToYCellCoord(m);for(let B=C;B<=O;B++)for(let U=R;U<=F;U++)if(_.call(this,n,s,u,m,this.xCellCount*U+B,b,w,S))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,s,u,m,_,b){let w=m-n,S=_-s,C=u+b;return C*C>w*w+S*S}_circleAndRectCollide(n,s,u,m,_,b,w){let S=(b-m)/2,C=Math.abs(n-(m+S));if(C>S+u)return!1;let R=(w-_)/2,O=Math.abs(s-(_+R));if(O>R+u)return!1;if(C<=S||O<=R)return!0;let F=C-S,B=O-R;return F*F+B*B<=u*u}}let Mn={unknown:0,flipRequired:1,flipNotRequired:2},ks=Math.tan(85*Math.PI/180);function Nl(c,n,s,u,m,_,b){let w=r.a9.create();if(s)if(_.name==="globe"){let S=r.b6(m,n);r.a9.multiply(w,w,S)}else{let S=r.b7.invert([],b);w[0]=S[0],w[1]=S[1],w[4]=S[2],w[5]=S[3],u||r.a9.rotateZ(w,w,m.angle)}else r.a9.multiply(w,m.labelPlaneMatrix,c);return w}function $o(c,n,s,u,m,_,b){let w=Nl(c,n,s,u,m,_,b);return _.name==="globe"&&s||(w[2]=w[6]=w[10]=w[14]=0),w}function cs(c,n,s,u,m,_,b){if(s){if(_.name==="globe"){let w=Nl(c,n,s,u,m,_,b);return r.a9.invert(w,w),r.a9.multiply(w,c,w),w}{let w=r.a9.clone(c),S=r.a9.identity([]);return S[0]=b[0],S[1]=b[1],S[4]=b[2],S[5]=b[3],r.a9.multiply(w,w,S),u||r.a9.rotateZ(w,w,-m.angle),w}}return m.glCoordMatrix}function xo(c,n,s,u){let m=[c,n,s,1];s?r.aa.transformMat4(m,m,u):_u(m,m,u);let _=m[3];return m[0]/=_,m[1]/=_,m[2]/=_,m}function fc(c,n){return Math.min(.5+c/n*.5,1.5)}function al(c,n){let s=c[0]/c[3],u=c[1]/c[3];return s>=-n[0]&&s<=n[0]&&u>=-n[1]&&u<=n[1]}function ra(c,n,s,u,m,_,b,w,S,C){let R=s.transform,O=u?c.textSizeData:c.iconSizeData,F=r.b8(O,s.transform.zoom),B=R.projection.name==="globe",U=[256/s.width*2+1,256/s.height*2+1],j=u?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;j.clear();let G=null;B&&(G=u?c.text.globeExtVertexArray:c.icon.globeExtVertexArray);let q=c.lineVertexArray,H=u?c.text.placedSymbolArray:c.icon.placedSymbolArray,ne=s.transform.width/s.transform.height,ie,oe=!1;for(let $=0;$<H.length;$++){let X=H.get($),{numGlyphs:ue,writingMode:le}=X;if(le!==r.b9.vertical||oe||ie===r.b9.horizontal||(oe=!0),ie=le,(X.hidden||le===r.b9.vertical)&&!oe){Pa(ue,j);continue}oe=!1;let ge=new r.P(X.tileAnchorX,X.tileAnchorY),{x:Me,y:me,z:Ee}=R.projection.projectTilePoint(ge.x,ge.y,C.canonical);if(S){let[gt,Et,Ot]=S(ge);Me+=gt,me+=Et,Ee+=Ot}let Re=[Me,me,Ee,1];if(r.aa.transformMat4(Re,Re,n),!al(Re,U)){Pa(ue,j);continue}let pe=Re[3],xe=fc(s.transform.getCameraToCenterDistance(R.projection),pe),He=r.ba(O,F,X),ye=b?He/xe:He*xe,Se=xo(Me,me,Ee,m);if(Se[3]<=0){Pa(ue,j);continue}let De={},re=b?null:S,Ue=oa(X,ye,!1,w,n,m,_,c.glyphOffsetArray,q,j,G,Se,ge,De,ne,re,R.projection,C,b);oe=Ue.useVertical,re&&Ue.needsFlipping&&(De={}),(Ue.notEnoughRoom||oe||Ue.needsFlipping&&oa(X,ye,!0,w,n,m,_,c.glyphOffsetArray,q,j,G,Se,ge,De,ne,re,R.projection,C,b).notEnoughRoom)&&Pa(ue,j)}u?(c.text.dynamicLayoutVertexBuffer.updateData(j),G&&c.text.globeExtVertexBuffer&&c.text.globeExtVertexBuffer.updateData(G)):(c.icon.dynamicLayoutVertexBuffer.updateData(j),G&&c.icon.globeExtVertexBuffer&&c.icon.globeExtVertexBuffer.updateData(G))}function Da(c,n,s,u,m,_,b,w,S,C,R,O,F,B,U,j){let{lineStartIndex:G,glyphStartIndex:q,segment:H}=w,ne=q+w.numGlyphs,ie=G+w.lineLength,oe=n.getoffsetX(q),$=n.getoffsetX(ne-1),X=Ra(c*oe,s,u,m,_,b,H,G,ie,S,C,R,O,F,!0,B,U,j);if(!X)return null;let ue=Ra(c*$,s,u,m,_,b,H,G,ie,S,C,R,O,F,!0,B,U,j);return ue?{first:X,last:ue}:null}function us(c,n,s,u){return c===r.b9.horizontal&&Math.abs(u)>Math.abs(s)?{useVertical:!0}:c===r.b9.vertical?u>0?{needsFlipping:!0}:null:n!==Mn.unknown&&function(m,_){return m===0||Math.abs(_/m)>ks}(s,u)?n===Mn.flipRequired?{needsFlipping:!0}:null:s<0?{needsFlipping:!0}:null}function oa(c,n,s,u,m,_,b,w,S,C,R,O,F,B,U,j,G,q,H){let ne=n/24,ie=c.lineOffsetX*ne,oe=c.lineOffsetY*ne,{lineStartIndex:$,glyphStartIndex:X,numGlyphs:ue,segment:le,writingMode:ge,flipState:Me}=c,me=$+c.lineLength,Ee=Re=>{if(R){let[ye,Se,De]=Re.up,re=C.length;r.bb(R,re+0,ye,Se,De),r.bb(R,re+1,ye,Se,De),r.bb(R,re+2,ye,Se,De),r.bb(R,re+3,ye,Se,De)}let[pe,xe,He]=Re.point;r.bc(C,pe,xe,He,Re.angle)};if(ue>1){let Re=Da(ne,w,ie,oe,s,O,F,c,S,_,B,j,!1,G,q,H);if(!Re)return{notEnoughRoom:!0};if(u&&!s){let[pe,xe,He]=Re.first.point,[ye,Se,De]=Re.last.point;[pe,xe]=xo(pe,xe,He,b),[ye,Se]=xo(ye,Se,De,b);let re=us(ge,Me,(ye-pe)*U,Se-xe);if(c.flipState=re&&re.needsFlipping?Mn.flipRequired:Mn.flipNotRequired,re)return re}Ee(Re.first);for(let pe=X+1;pe<X+ue-1;pe++){let xe=Ra(ne*w.getoffsetX(pe),ie,oe,s,O,F,le,$,me,S,_,B,j,!1,!1,G,q,H);if(!xe)return C.length-=4*(pe-X),{notEnoughRoom:!0};Ee(xe)}Ee(Re.last)}else{if(u&&!s){let pe=xo(F.x,F.y,0,m),xe=$+le+1,He=new r.P(S.getx(xe),S.gety(xe)),ye=xo(He.x,He.y,0,m),Se=ye[3]>0?ye:gu(F,He,pe,1,m,void 0,G,q.canonical),De=us(ge,Me,(Se[0]-pe[0])*U,Se[1]-pe[1]);if(c.flipState=De&&De.needsFlipping?Mn.flipRequired:Mn.flipNotRequired,De)return De}let Re=Ra(ne*w.getoffsetX(X),ie,oe,s,O,F,le,$,me,S,_,B,j,!1,!1,G,q,H);if(!Re)return{notEnoughRoom:!0};Ee(Re)}return{}}function sa(c,n,s,u,m){let{x:_,y:b,z:w}=u.projectTilePoint(c.x,c.y,n);if(!m)return xo(_,b,w,s);let[S,C,R]=m(c);return xo(_+S,b+C,w+R,s)}function gu(c,n,s,u,m,_,b,w){let S=sa(c.sub(n)._unit()._add(c),w,m,b,_);return r.Q.sub(S,s,S),r.Q.normalize(S,S),r.Q.scaleAndAdd(S,s,S,u)}function Ra(c,n,s,u,m,_,b,w,S,C,R,O,F,B,U,j,G,q){let H=u?c-n:c+n,ne=H>0?1:-1,ie=0;u&&(ne*=-1,ie=Math.PI),ne<0&&(ie+=Math.PI);let oe=w+b+(ne>0?0:1)|0,$=m,X=m,ue=0,le=0,ge=Math.abs(H),Me=[],me=[],Ee=_,Re=Ee,pe=()=>gu(Re,Ee,X,ge-ue+1,R,F,j,G.canonical);for(;ue+le<=ge;){if(oe+=ne,oe<w||oe>=S)return null;if(X=$,Re=Ee,Me.push(X),B&&me.push(Re),Ee=new r.P(C.getx(oe),C.gety(oe)),$=O[oe],!$){let Et=sa(Ee,G.canonical,R,j,F);$=Et[3]>0?O[oe]=Et:pe()}ue+=le,le=r.Q.distance(X,$)}U&&F&&(O[oe]&&($=pe(),le=r.Q.distance(X,$)),O[oe]=$);let xe=(ge-ue)/le,He=Ee.sub(Re)._mult(xe)._add(Re),ye=r.Q.sub([],$,X),Se=r.Q.scaleAndAdd([],X,ye,xe),De=[0,0,1],re=ye[0],Ue=ye[1];if(q&&(De=j.upVector(G.canonical,He.x,He.y),De[0]!==0||De[1]!==0||De[2]!==1)){let Et=[De[2],0,-De[0]],Ot=r.Q.cross([],De,Et);r.Q.normalize(Et,Et),r.Q.normalize(Ot,Ot),re=r.Q.dot(ye,Et),Ue=r.Q.dot(ye,Ot)}if(s){let Et=r.Q.cross([],De,ye);r.Q.normalize(Et,Et),r.Q.scaleAndAdd(Se,Se,Et,s*ne)}let gt=ie+Math.atan2(Ue,re);return Me.push(Se),B&&me.push(He),{point:Se,angle:gt,path:Me,tilePath:me,up:De}}function Pa(c,n){let s=n.length,u=s+4*c;n.resize(u),n.float32.fill(-1/0,4*s,4*u)}function _u(c,n,s){let u=n[0],m=n[1];return c[0]=s[0]*u+s[4]*m+s[12],c[1]=s[1]*u+s[5]*m+s[13],c[3]=s[3]*u+s[7]*m+s[15],c}let Wo=100;class yu{constructor(n,s,u=new sl(n.width+200,n.height+200,25),m=new sl(n.width+200,n.height+200,25)){this.transform=n,this.grid=u,this.ignoredGrid=m,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Wo,this.screenBottomBoundary=n.height+Wo,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=s}placeCollisionBox(n,s,u,m,_,b,w,S){let C=u.projectedAnchorX,R=u.projectedAnchorY,O=u.projectedAnchorZ,F=u.elevation,B=u.tileID,U=n.getProjection();if(F&&B){let[$,X,ue]=U.upVector(B.canonical,u.tileAnchorX,u.tileAnchorY),le=U.upVectorScale(B.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;C+=$*F*le,R+=X*F*le,O+=ue*F*le}let j=this.projectAndGetPerspectiveRatio(w,C,R,O,u.tileID,U.name==="globe"||!!F||this.transform.pitch>0,U),G=b*j.perspectiveRatio,q=(u.x1*s+m.x-u.padding)*G+j.point.x,H=(u.y1*s+m.y-u.padding)*G+j.point.y,ne=(u.x2*s+m.x+u.padding)*G+j.point.x,ie=(u.y2*s+m.y+u.padding)*G+j.point.y,oe=j.perspectiveRatio<=.55||j.occluded;return!this.isInsideGrid(q,H,ne,ie)||!_&&this.grid.hitTest(q,H,ne,ie,S)||oe?{box:[],offscreen:!1,occluded:j.occluded}:{box:[q,H,ne,ie],offscreen:this.isOffscreen(q,H,ne,ie),occluded:!1}}placeCollisionCircles(n,s,u,m,_,b,w,S,C,R,O,F,B,U,j){let G=[],q=this.transform.elevation,H=n.getProjection(),ne=q?q.getAtTileOffsetFunc(j,this.transform.center.lat,this.transform.worldSize,H):null,ie=new r.P(u.tileAnchorX,u.tileAnchorY),{x:oe,y:$,z:X}=H.projectTilePoint(ie.x,ie.y,j.canonical);if(ne){let[He,ye,Se]=ne(ie);oe+=He,$+=ye,X+=Se}let ue=H.name==="globe",le=this.projectAndGetPerspectiveRatio(w,oe,$,X,j,ue||!!q||this.transform.pitch>0,H),{perspectiveRatio:ge}=le,Me=(O?b/ge:b*ge)/r.bf,me=xo(oe,$,X,S),Ee=le.signedDistanceFromCamera>0?Da(Me,_,u.lineOffsetX*Me,u.lineOffsetY*Me,!1,me,ie,u,m,S,{},q&&!O?ne:null,O&&!!q,H,j,O):null,Re=!1,pe=!1,xe=!0;if(Ee&&!le.occluded){let He=.5*B*ge+U,ye=new r.P(-100,-100),Se=new r.P(this.screenRightBoundary,this.screenBottomBoundary),De=new ls,{first:re,last:Ue}=Ee,gt=re.path.length,Et=[];for(let Nt=gt-1;Nt>=1;Nt--)Et.push(re.path[Nt]);for(let Nt=1;Nt<Ue.path.length;Nt++)Et.push(Ue.path[Nt]);let Ot=2.5*He;C&&(Et=Et.map(([Nt,xi,ei],Di)=>(ne&&!ue&&(ei=ne(Di<gt-1?re.tilePath[gt-1-Di]:Ue.tilePath[Di-gt+2])[2]),xo(Nt,xi,ei,C))),Et.some(Nt=>Nt[3]<=0)&&(Et=[]));let At=[];if(Et.length>0){let Nt=1/0,xi=-1/0,ei=1/0,Di=-1/0;for(let wi of Et)Nt=Math.min(Nt,wi[0]),ei=Math.min(ei,wi[1]),xi=Math.max(xi,wi[0]),Di=Math.max(Di,wi[1]);xi>=ye.x&&Nt<=Se.x&&Di>=ye.y&&ei<=Se.y&&(At=[Et.map(wi=>new r.P(wi[0],wi[1]))],(Nt<ye.x||xi>Se.x||ei<ye.y||Di>Se.y)&&(At=r.bd(At,ye.x,ye.y,Se.x,Se.y)))}for(let Nt of At){De.reset(Nt,.25*He);let xi=0;xi=De.length<=.5*He?1:Math.ceil(De.paddedLength/Ot)+1;for(let ei=0;ei<xi;ei++){let Di=ei/Math.max(xi-1,1),wi=De.lerp(Di),Cn=wi.x+Wo,Xi=wi.y+Wo;G.push(Cn,Xi,He,0);let dr=Cn-He,Jn=Xi-He,fn=Cn+He,rn=Xi+He;if(xe=xe&&this.isOffscreen(dr,Jn,fn,rn),pe=pe||this.isInsideGrid(dr,Jn,fn,rn),!s&&this.grid.hitTestCircle(Cn,Xi,He,F)&&(Re=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Re,occluded:!1}}}}return{circles:!R&&Re||!pe?[]:G,offscreen:xe,collisionDetected:Re,occluded:le.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let s=[],u=1/0,m=1/0,_=-1/0,b=-1/0;for(let R of n){let O=new r.P(R.x+Wo,R.y+Wo);u=Math.min(u,O.x),m=Math.min(m,O.y),_=Math.max(_,O.x),b=Math.max(b,O.y),s.push(O)}let w=this.grid.query(u,m,_,b).concat(this.ignoredGrid.query(u,m,_,b)),S={},C={};for(let R of w){let O=R.key;if(S[O.bucketInstanceId]===void 0&&(S[O.bucketInstanceId]={}),S[O.bucketInstanceId][O.featureIndex])continue;let F=[new r.P(R.x1,R.y1),new r.P(R.x2,R.y1),new r.P(R.x2,R.y2),new r.P(R.x1,R.y2)];r.be(s,F)&&(S[O.bucketInstanceId][O.featureIndex]=!0,C[O.bucketInstanceId]===void 0&&(C[O.bucketInstanceId]=[]),C[O.bucketInstanceId].push(O.featureIndex))}return C}insertCollisionBox(n,s,u,m,_){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:m,collisionGroupID:_},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,s,u,m,_){let b=s?this.ignoredGrid:this.grid,w={bucketInstanceId:u,featureIndex:m,collisionGroupID:_};for(let S=0;S<n.length;S+=4)b.insertCircle(w,n[S],n[S+1],n[S+2])}projectAndGetPerspectiveRatio(n,s,u,m,_,b,w){let S=[s,u,m,1],C=!1;m||this.transform.pitch>0?(r.aa.transformMat4(S,S,n),this.fogState&&_&&w.name!=="globe"&&(C=function(F,B,U,j,G,q){let H=q.calculateFogTileMatrix(G),ne=[B,U,j];return r.Q.transformMat4(ne,ne,H),Ci(F,r.Q.length(ne),q.pitch,q._fov)}(this.fogState,s,u,m,_.toUnwrapped(),this.transform)>.9)):_u(S,S,n);let R=S[3];return{point:new r.P((S[0]/R+1)/2*this.transform.width+Wo,(-S[1]/R+1)/2*this.transform.height+Wo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(w)/R*.5,1.5),signedDistanceFromCamera:R,occluded:b&&S[2]>R||C}}isOffscreen(n,s,u,m){return u<Wo||n>=this.screenRightBoundary||m<Wo||s>this.screenBottomBoundary}isInsideGrid(n,s,u,m){return u>=0&&n<this.gridRightBoundary&&m>=0&&s<this.gridBottomBoundary}getViewportMatrix(){let n=r.a9.identity([]);return r.a9.translate(n,n,[-100,-100,0]),n}}function ll(c,n,s){let u=n.createTileMatrix(c,c.worldSize,s.toUnwrapped());return r.a9.multiply(new Float32Array(16),c.projMatrix,u)}function Br(c,n,s){if(n.projection.name===s.projection.name)return c.projMatrix;let u=s.clone();return u.setProjection(n.projection),ll(u,n.getProjection(),c)}function Ro(c,n,s){return n.name===s.projection.name?c.projMatrix:ll(s,n,c)}class hs{constructor(n,s,u,m){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?s:-s))):m&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class Os{constructor(n,s,u,m,_,b=!1){this.text=new hs(n?n.text:null,s,u,_),this.icon=new hs(n?n.icon:null,s,m,_),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Zo{constructor(n,s,u,m=!1){this.text=n,this.icon=s,this.skipFade=u,this.clipped=m}}class zh{constructor(){this.invProjMatrix=r.a9.create(),this.viewportMatrix=r.a9.create(),this.circles=[]}}class Po{constructor(n,s,u,m,_){this.bucketInstanceId=n,this.featureIndex=s,this.sourceLayerIndex=u,this.bucketIndex=m,this.tileID=_}}class aa{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){let s=++this.maxGroupID;this.collisionGroups[n]={ID:s,predicate:u=>u.collisionGroupID===s}}return this.collisionGroups[n]}}function mc(c,n,s,u,m){let{horizontalAlign:_,verticalAlign:b}=r.bi(c),w=-(_-.5)*n,S=-(b-.5)*s,C=r.bh(c,u);return new r.P(w+C[0]*m,S+C[1]*m)}function ka(c,n,s,u,m){let _=new r.P(c,n);return s&&_._rotate(u?m:-m),_}class vu{constructor(n,s,u,m,_,b){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new yu(this.transform,_),this.buildingIndex=b,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new aa(u),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,s,u,m){let _=u.getBucket(s),b=u.latestFeatureIndex;if(!_||!b||s.fqid!==_.layerIds[0])return;let w=_.layers[0].layout,S=u.collisionBoxArray,C=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),R=u.tileSize/r.Y,O=u.tileID.toUnwrapped();this.transform.setProjection(_.projection);let F=(B=u.tileID,U=_.getProjection(),j=this.transform,U.name===this.projection?j.calculateProjMatrix(B.toUnwrapped()):ll(j,U,B));var B,U,j;let G=w.get("text-pitch-alignment")==="map",q=w.get("text-rotation-alignment")==="map";s.compileFilter();let H=s.dynamicFilter(),ne=s.dynamicFilterNeedsFeature(),ie=this.transform.calculatePixelsToTileUnitsMatrix(u),oe=$o(F,u.tileID.canonical,G,q,this.transform,_.getProjection(),ie),$=null;if(G){let le=cs(F,u.tileID.canonical,G,q,this.transform,_.getProjection(),ie);$=r.a9.multiply([],this.transform.labelPlaneMatrix,le)}let X=null;H&&u.latestFeatureIndex&&(X={unwrappedTileID:O,dynamicFilter:H,dynamicFilterNeedsFeature:ne,featureIndex:u.latestFeatureIndex}),this.retainedQueryData[_.bucketInstanceId]=new Po(_.bucketInstanceId,b,_.sourceLayerIndex,_.index,u.tileID);let ue={bucket:_,layout:w,posMatrix:F,textLabelPlaneMatrix:oe,labelToScreenMatrix:$,clippingData:X,scale:C,textPixelRatio:R,holdingForFade:u.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:r.b8(_.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:r.b8(_.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(m)for(let le of _.sortKeyRanges){let{sortKey:ge,symbolInstanceStart:Me,symbolInstanceEnd:me}=le;n.push({sortKey:ge,symbolInstanceStart:Me,symbolInstanceEnd:me,parameters:ue})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:ue})}attemptAnchorPlacement(n,s,u,m,_,b,w,S,C,R,O,F,B,U,j,G,q,H){let{textOffset0:ne,textOffset1:ie,crossTileID:oe}=F,$=[ne,ie],X=mc(n,u,m,$,_),ue=this.collisionIndex.placeCollisionBox(U,_,s,ka(X.x,X.y,b,w,this.transform.angle),O,S,C,R.predicate);if(G){let le=U.getSymbolInstanceIconSize(H,this.transform.zoom,F.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(U,le,G,ka(X.x,X.y,b,w,this.transform.angle),O,S,C,R.predicate).box.length===0)return}if(ue.box.length>0){let le;return this.prevPlacement&&this.prevPlacement.variableOffsets[oe]&&this.prevPlacement.placements[oe]&&this.prevPlacement.placements[oe].text&&(le=this.prevPlacement.variableOffsets[oe].anchor),this.variableOffsets[oe]={textOffset:$,width:u,height:m,anchor:n,textScale:_,prevAnchor:le},this.markUsedJustification(U,n,F,j),U.allowVerticalPlacement&&(this.markUsedOrientation(U,j,F),this.placedOrientations[oe]=j),{shift:X,placedGlyphBoxes:ue}}}placeLayerBucketPart(n,s,u,m){let{bucket:_,layout:b,posMatrix:w,textLabelPlaneMatrix:S,labelToScreenMatrix:C,clippingData:R,textPixelRatio:O,holdingForFade:F,collisionBoxArray:B,partiallyEvaluatedTextSize:U,partiallyEvaluatedIconSize:j,collisionGroup:G}=n.parameters,q=b.get("text-optional"),H=b.get("icon-optional"),ne=b.get("text-allow-overlap"),ie=b.get("icon-allow-overlap"),oe=b.get("text-rotation-alignment")==="map",$=b.get("text-pitch-alignment")==="map",X=b.get("symbol-z-order")==="viewport-y",ue=b.get("symbol-z-elevate");this.transform.setProjection(_.projection);let le=ne&&(ie||!_.hasIconData()||H),ge=ie&&(ne||!_.hasTextData()||q);!_.collisionArrays&&B&&_.deserializeCollisionBoxes(B),u&&m&&_.updateCollisionDebugBuffers(this.transform.zoom,B);let Me=(me,Ee,Re)=>{let{crossTileID:pe,numVerticalGlyphVertices:xe}=me;if(R){let fn={zoom:this.transform.zoom,pitch:this.transform.pitch},rn=null;if(R.dynamicFilterNeedsFeature){let ui=this.retainedQueryData[_.bucketInstanceId];rn=R.featureIndex.loadFeature({featureIndex:me.featureIndex,bucketIndex:ui.bucketIndex,sourceLayerIndex:ui.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,R.dynamicFilter)(fn,rn,this.retainedQueryData[_.bucketInstanceId].tileID.canonical,new r.P(me.tileAnchorX,me.tileAnchorY),this.transform.calculateDistanceTileData(R.unwrappedTileID)))return this.placements[pe]=new Zo(!1,!1,!1,!0),void s.add(pe)}if(s.has(pe))return;if(F)return void(this.placements[pe]=new Zo(!1,!1,!1));let He=!1,ye=!1,Se=!0,De=!1,re=!1,Ue=null,gt={box:null,offscreen:null,occluded:null},Et={box:null,offscreen:null,occluded:null},Ot=null,At=null,Nt=null,xi=0,ei=0,Di=0;Re.textFeatureIndex?xi=Re.textFeatureIndex:me.useRuntimeCollisionCircles&&(xi=me.featureIndex),Re.verticalTextFeatureIndex&&(ei=Re.verticalTextFeatureIndex);let wi=fn=>{fn.tileID=this.retainedQueryData[_.bucketInstanceId].tileID;let rn=this.transform.elevation;fn.elevation=me.zOffset+(rn?rn.getAtTileOffset(fn.tileID,fn.tileAnchorX,fn.tileAnchorY):0)},Cn=Re.textBox;if(Cn){wi(Cn);let fn=ui=>{let di=r.b9.horizontal;if(_.allowVerticalPlacement&&!ui&&this.prevPlacement){let wn=this.prevPlacement.placedOrientations[pe];wn&&(this.placedOrientations[pe]=wn,di=wn,this.markUsedOrientation(_,di,me))}return di},rn=(ui,di)=>{if(_.allowVerticalPlacement&&xe>0&&Re.verticalTextBox){for(let wn of _.writingModes)if(wn===r.b9.vertical?(gt=di(),Et=gt):gt=ui(),gt&&gt.box&&gt.box.length)break}else gt=ui()};if(b.get("text-variable-anchor")){let ui=b.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[pe]){let mn=this.prevPlacement.variableOffsets[pe];ui.indexOf(mn.anchor)>0&&(ui=ui.filter(yi=>yi!==mn.anchor),ui.unshift(mn.anchor))}let di=(mn,yi,oi)=>{let wo=_.getSymbolInstanceTextSize(U,me,this.transform.zoom,Ee),Yr=(mn.x2-mn.x1)*wo+2*mn.padding,Ir=(mn.y2-mn.y1)*wo+2*mn.padding,Kr=me.hasIconTextFit&&!ie?yi:null;Kr&&wi(Kr);let To={box:[],offscreen:!1,occluded:!1},ro=ne?2*ui.length:ui.length;for(let Sr=0;Sr<ro;++Sr){let Nr=this.attemptAnchorPlacement(ui[Sr%ui.length],mn,Yr,Ir,wo,oe,$,O,w,G,Sr>=ui.length,me,Ee,_,oi,Kr,U,j);if(Nr&&(To=Nr.placedGlyphBoxes,To&&To.box&&To.box.length)){He=!0,Ue=Nr.shift;break}}return To};rn(()=>di(Cn,Re.iconBox,r.b9.horizontal),()=>{let mn=Re.verticalTextBox;return mn&&wi(mn),_.allowVerticalPlacement&&!(gt&&gt.box&&gt.box.length)&&xe>0&&mn?di(mn,Re.verticalIconBox,r.b9.vertical):{box:null,offscreen:null,occluded:null}}),gt&&(He=gt.box,Se=gt.offscreen,De=gt.occluded);let wn=fn(!(!gt||!gt.box));if(!He&&this.prevPlacement){let mn=this.prevPlacement.variableOffsets[pe];mn&&(this.variableOffsets[pe]=mn,this.markUsedJustification(_,mn.anchor,me,wn))}}else{let ui=(di,wn)=>{let mn=_.getSymbolInstanceTextSize(U,me,this.transform.zoom,Ee),yi=this.collisionIndex.placeCollisionBox(_,mn,di,new r.P(0,0),ne,O,w,G.predicate);return yi&&yi.box&&yi.box.length&&(this.markUsedOrientation(_,wn,me),this.placedOrientations[pe]=wn),yi};rn(()=>ui(Cn,r.b9.horizontal),()=>{let di=Re.verticalTextBox;return _.allowVerticalPlacement&&xe>0&&di?(wi(di),ui(di,r.b9.vertical)):{box:null,offscreen:null,occluded:null}}),fn(!!(gt&&gt.box&&gt.box.length))}}if(Ot=gt,He=Ot&&Ot.box&&Ot.box.length>0,Se=Ot&&Ot.offscreen,De=Ot&&Ot.occluded,me.useRuntimeCollisionCircles){let fn=_.text.placedSymbolArray.get(me.centerJustifiedTextSymbolIndex>=0?me.centerJustifiedTextSymbolIndex:me.verticalPlacedTextSymbolIndex),rn=r.ba(_.textSizeData,U,fn),ui=b.get("text-padding");At=this.collisionIndex.placeCollisionCircles(_,ne,fn,_.lineVertexArray,_.glyphOffsetArray,rn,w,S,C,u,$,G.predicate,me.collisionCircleDiameter*rn/r.bf,ui,this.retainedQueryData[_.bucketInstanceId].tileID),He=ne||At.circles.length>0&&!At.collisionDetected,Se=Se&&At.offscreen,De=At.occluded}if(Re.iconFeatureIndex&&(Di=Re.iconFeatureIndex),Re.iconBox){let fn=rn=>{wi(rn);let ui=me.hasIconTextFit&&Ue?ka(Ue.x,Ue.y,oe,$,this.transform.angle):new r.P(0,0),di=_.getSymbolInstanceIconSize(j,this.transform.zoom,me.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(_,di,rn,ui,ie,O,w,G.predicate)};Et&&Et.box&&Et.box.length&&Re.verticalIconBox?(Nt=fn(Re.verticalIconBox),ye=Nt.box.length>0):(Nt=fn(Re.iconBox),ye=Nt.box.length>0),Se=Se&&Nt.offscreen,re=Nt.occluded}let Xi=q||me.numHorizontalGlyphVertices===0&&xe===0,dr=H||me.numIconVertices===0;if(Xi||dr?dr?Xi||(ye=ye&&He):He=ye&&He:ye=He=ye&&He,He&&Ot&&Ot.box&&this.collisionIndex.insertCollisionBox(Ot.box,b.get("text-ignore-placement"),_.bucketInstanceId,Et&&Et.box&&ei?ei:xi,G.ID),ye&&Nt&&this.collisionIndex.insertCollisionBox(Nt.box,b.get("icon-ignore-placement"),_.bucketInstanceId,Di,G.ID),At&&(He&&this.collisionIndex.insertCollisionCircles(At.circles,b.get("text-ignore-placement"),_.bucketInstanceId,xi,G.ID),u)){let fn=_.bucketInstanceId,rn=this.collisionCircleArrays[fn];rn===void 0&&(rn=this.collisionCircleArrays[fn]=new zh);for(let ui=0;ui<At.circles.length;ui+=4)rn.circles.push(At.circles[ui+0]),rn.circles.push(At.circles[ui+1]),rn.circles.push(At.circles[ui+2]),rn.circles.push(At.collisionDetected?1:0)}let Jn=_.projection.name!=="globe";le=le&&(Jn||!De),ge=ge&&(Jn||!re),this.placements[pe]=new Zo(He||le,ye||ge,Se||_.justReloaded),s.add(pe)};if(ue&&this.buildingIndex&&(this.buildingIndex.updateZOffset(_,this.retainedQueryData[_.bucketInstanceId].tileID),_.updateZOffset()),X){let me=_.getSortedSymbolIndexes(this.transform.angle);for(let Ee=me.length-1;Ee>=0;--Ee){let Re=me[Ee];Me(_.symbolInstances.get(Re),Re,_.collisionArrays[Re])}_.hasAnyZOffset&&r.w(`${_.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(_.hasAnyZOffset){let me=_.getSortedIndexesByZOffset();for(let Ee=0;Ee<me.length;++Ee){let Re=me[Ee];Me(_.symbolInstances.get(Re),Re,_.collisionArrays[Re])}}else for(let me=n.symbolInstanceStart;me<n.symbolInstanceEnd;me++)Me(_.symbolInstances.get(me),me,_.collisionArrays[me]);if(u&&_.bucketInstanceId in this.collisionCircleArrays){let me=this.collisionCircleArrays[_.bucketInstanceId];r.a9.invert(me.invProjMatrix,w),me.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(n,s,u,m){let{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:w,verticalPlacedTextSymbolIndex:S,crossTileID:C}=u,R=r.bg(s),O=m===r.b9.vertical?S:R==="left"?_:R==="center"?b:R==="right"?w:-1;_>=0&&(n.text.placedSymbolArray.get(_).crossTileID=O>=0&&_!==O?0:C),b>=0&&(n.text.placedSymbolArray.get(b).crossTileID=O>=0&&b!==O?0:C),w>=0&&(n.text.placedSymbolArray.get(w).crossTileID=O>=0&&w!==O?0:C),S>=0&&(n.text.placedSymbolArray.get(S).crossTileID=O>=0&&S!==O?0:C)}markUsedOrientation(n,s,u){let m=s===r.b9.horizontal||s===r.b9.horizontalOnly?s:0,_=s===r.b9.vertical?s:0,{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:C}=u,R=n.text.placedSymbolArray;b>=0&&(R.get(b).placedOrientation=m),w>=0&&(R.get(w).placedOrientation=m),S>=0&&(R.get(S).placedOrientation=m),C>=0&&(R.get(C).placedOrientation=_)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;let s=this.prevPlacement,u=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;let m=s?s.symbolFadeChange(n):1,_=s?s.opacities:{},b=s?s.variableOffsets:{},w=s?s.placedOrientations:{};for(let S in this.placements){let C=this.placements[S],R=_[S];R?(this.opacities[S]=new Os(R,m,C.text,C.icon,null,C.clipped),u=u||C.text!==R.text.placed||C.icon!==R.icon.placed):(this.opacities[S]=new Os(null,m,C.text,C.icon,C.skipFade,C.clipped),u=u||C.text||C.icon)}for(let S in _){let C=_[S];if(!this.opacities[S]){let R=new Os(C,m,!1,!1);R.isHidden()||(this.opacities[S]=R,u=u||C.text.placed||C.icon.placed)}}for(let S in b)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=b[S]);for(let S in w)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=w[S]);u?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:n)}updateLayerOpacities(n,s){let u=new Set;for(let m of s){let _=m.getBucket(n);_&&m.latestFeatureIndex&&n.fqid===_.layerIds[0]&&(this.updateBucketOpacities(_,u,m.collisionBoxArray),_.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(_,m.tileID),_.updateZOffset()))}}updateBucketOpacities(n,s,u){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();let m=n.layers[0].layout,_=!!n.layers[0].dynamicFilter(),b=new Os(null,0,!1,!1,!0),w=m.get("text-allow-overlap"),S=m.get("icon-allow-overlap"),C=m.get("text-variable-anchor"),R=m.get("text-rotation-alignment")==="map",O=m.get("text-pitch-alignment")==="map",F=new Os(null,0,w&&(S||!n.hasIconData()||m.get("icon-optional")),S&&(w||!n.hasTextData()||m.get("text-optional")),!0);!n.collisionArrays&&u&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(u);let B=(j,G,q)=>{for(let H=0;H<G/4;H++)j.opacityVertexArray.emplaceBack(q)},U=0;for(let j=0;j<n.symbolInstances.length;j++){let G=n.symbolInstances.get(j),{numHorizontalGlyphVertices:q,numVerticalGlyphVertices:H,crossTileID:ne,numIconVertices:ie}=G,oe=s.has(ne),$=this.opacities[ne];oe?$=b:$||($=F,this.opacities[ne]=$),s.add(ne);let X=q>0||H>0,ue=ie>0,le=this.placedOrientations[ne],ge=le===r.b9.vertical,Me=le===r.b9.horizontal||le===r.b9.horizontalOnly;if(!X&&!ue||$.isHidden()||U++,X){let me=ds($.text);B(n.text,q,ge?za:me),B(n.text,H,Me?za:me);let Ee=$.text.isHidden(),{leftJustifiedTextSymbolIndex:Re,centerJustifiedTextSymbolIndex:pe,rightJustifiedTextSymbolIndex:xe,verticalPlacedTextSymbolIndex:He}=G,ye=n.text.placedSymbolArray,Se=Ee||ge?1:0;Re>=0&&(ye.get(Re).hidden=Se),pe>=0&&(ye.get(pe).hidden=Se),xe>=0&&(ye.get(xe).hidden=Se),He>=0&&(ye.get(He).hidden=Ee||Me?1:0);let De=this.variableOffsets[ne];De&&this.markUsedJustification(n,De.anchor,G,le);let re=this.placedOrientations[ne];re&&(this.markUsedJustification(n,"left",G,re),this.markUsedOrientation(n,re,G))}if(ue){let me=ds($.icon),{placedIconSymbolIndex:Ee,verticalPlacedIconSymbolIndex:Re}=G,pe=n.icon.placedSymbolArray,xe=$.icon.isHidden()?1:0;Ee>=0&&(B(n.icon,ie,ge?za:me),pe.get(Ee).hidden=xe),Re>=0&&(B(n.icon,G.numVerticalIconVertices,Me?za:me),pe.get(Re).hidden=xe)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){let me=n.collisionArrays[j];if(me){let Ee=new r.P(0,0),Re=!0;if(me.textBox||me.verticalTextBox){if(C){let xe=this.variableOffsets[ne];xe?(Ee=mc(xe.anchor,xe.width,xe.height,xe.textOffset,xe.textScale),R&&Ee._rotate(O?this.transform.angle:-this.transform.angle)):Re=!1}_&&(Re=!$.clipped),me.textBox&&Oa(n.textCollisionBox.collisionVertexArray,$.text.placed,!Re||ge,Ee.x,Ee.y),me.verticalTextBox&&Oa(n.textCollisionBox.collisionVertexArray,$.text.placed,!Re||Me,Ee.x,Ee.y)}let pe=Re&&!!(!Me&&me.verticalIconBox);me.iconBox&&Oa(n.iconCollisionBox.collisionVertexArray,$.icon.placed,pe,G.hasIconTextFit?Ee.x:0,G.hasIconTextFit?Ee.y:0),me.verticalIconBox&&Oa(n.iconCollisionBox.collisionVertexArray,$.icon.placed,!pe,G.hasIconTextFit?Ee.x:0,G.hasIconTextFit?Ee.y:0)}}}if(n.fullyClipped=U===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){let j=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=j.invProjMatrix,n.placementViewportMatrix=j.viewportMatrix,n.collisionCircleArray=j.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,s){let u=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*u>n}setStale(){this.stale=!0}}function Oa(c,n,s,u,m){c.emplaceBack(n?1:0,s?1:0,u||0,m||0),c.emplaceBack(n?1:0,s?1:0,u||0,m||0),c.emplaceBack(n?1:0,s?1:0,u||0,m||0),c.emplaceBack(n?1:0,s?1:0,u||0,m||0)}let cl=Math.pow(2,25),La=Math.pow(2,24),ul=Math.pow(2,17),Fa=Math.pow(2,16),Bh=Math.pow(2,9),Ls=Math.pow(2,8),gc=Math.pow(2,1);function ds(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;let n=c.placed?1:0,s=Math.floor(127*c.opacity);return s*cl+n*La+s*ul+n*Fa+s*Bh+n*Ls+s*gc+n}let za=0;class Vl{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,s,u,m,_){let b=this._bucketParts;for(;this._currentTileIndex<n.length;)if(s.getBucketParts(b,m,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((w,S)=>w.sortKey-S.sortKey));this._currentPartIndex<b.length;){let w=b[this._currentPartIndex];if(s.placeLayerBucketPart(w,this._seenCrossTileIDs,u,w.symbolInstanceStart===0),this._currentPartIndex++,_())return!0}return!1}}class la{constructor(n,s,u,m,_,b,w,S,C){this.placement=new vu(n,_,b,w,S,C),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(n,s,u,m){let _=r.f.now(),b=()=>{let w=r.f.now()-_;return!this._forceFullPlacement&&w>2};for(;this._currentPlacementIndex>=0;){let w=s[n[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=S)&&(!w.maxzoom||w.maxzoom>S)){let C=w,R=C.layout.get("symbol-z-elevate"),O=this._inProgressLayer=this._inProgressLayer||new Vl(C),F=r.aj(w.source,w.scope);if(O.continuePlacement(R?m[F]:u[F],this.placement,this._showCollisionBoxes,w,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}let jl=512/r.Y/2;class bu{constructor(n,s,u){this.tileID=n,this.bucketInstanceId=u,this.index=new r.bj(s.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let m=n.canonical.x*r.Y,_=n.canonical.y*r.Y;for(let b=0;b<s.length;b++){let{key:w,crossTileID:S,tileAnchorX:C,tileAnchorY:R}=s.get(b),O=Math.floor((m+C)*jl),F=Math.floor((_+R)*jl);this.index.add(O,F),this.keys.push(w),this.crossTileIDs.push(S)}this.index.finish()}findMatches(n,s,u){let m=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z),_=jl/Math.pow(2,s.canonical.z-this.tileID.canonical.z),b=s.canonical.x*r.Y,w=s.canonical.y*r.Y;for(let S=0;S<n.length;S++){let C=n.get(S);if(C.crossTileID)continue;let{key:R,tileAnchorX:O,tileAnchorY:F}=C,B=Math.floor((b+O)*_),U=Math.floor((w+F)*_),j=this.index.range(B-m,U-m,B+m,U+m);for(let G of j){let q=this.crossTileIDs[G];if(this.keys[G]===R&&!u.has(q)){u.add(q),C.crossTileID=q;break}}}}}class Ul{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class hl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){let s=Math.round((n-this.lng)/360);if(s!==0)for(let u in this.indexes){let m=this.indexes[u],_={};for(let b in m){let w=m[b];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+s),_[w.tileID.key]=w}this.indexes[u]=_}this.lng=n}addBucket(n,s,u){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let _=0;_<s.symbolInstances.length;_++)s.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);let m=this.usedCrossTileIDs[n.overscaledZ];for(let _ in this.indexes){let b=this.indexes[_];if(Number(_)>n.overscaledZ)for(let w in b){let S=b[w];S.tileID.isChildOf(n)&&S.findMatches(s.symbolInstances,n,m)}else{let w=b[n.scaledTo(Number(_)).key];w&&w.findMatches(s.symbolInstances,n,m)}}for(let _=0;_<s.symbolInstances.length;_++){let b=s.symbolInstances.get(_);b.crossTileID||(b.crossTileID=u.generate(),m.add(b.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new bu(n,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(n,s){for(let u of s.crossTileIDs)this.usedCrossTileIDs[n].delete(u)}removeStaleBuckets(n){let s=!1;for(let u in this.indexes){let m=this.indexes[u];for(let _ in m)n[m[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,m[_]),delete m[_],s=!0)}return s}}class Ba{constructor(){this.layerIndexes={},this.crossTileIDs=new Ul,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,s,u,m){let _=this.layerIndexes[n.fqid];_===void 0&&(_=this.layerIndexes[n.fqid]=new hl);let b=!1,w={};m.name!=="globe"&&_.handleWrapJump(u);for(let S of s){let C=S.getBucket(n);C&&n.fqid===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(S.tileID,C,this.crossTileIDs)&&(b=!0),w[C.bucketInstanceId]=!0)}return _.removeStaleBuckets(w)&&(b=!0),b}pruneUnusedLayers(n){let s={};n.forEach(u=>{s[u]=!0});for(let u in this.layerIndexes)s[u]||delete this.layerIndexes[u]}}class dl{constructor(n=0,s=0,u=0,m=0){if(isNaN(n)||n<0||isNaN(s)||s<0||isNaN(u)||u<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=s,this.left=u,this.right=m}interpolate(n,s,u){return s.top!=null&&n.top!=null&&(this.top=r.X(n.top,s.top,u)),s.bottom!=null&&n.bottom!=null&&(this.bottom=r.X(n.bottom,s.bottom,u)),s.left!=null&&n.left!=null&&(this.left=r.X(n.left,s.left,u)),s.right!=null&&n.right!=null&&(this.right=r.X(n.right,s.right,u)),this}getCenter(n,s){let u=r.ad((this.left+n-this.right)/2,0,n),m=r.ad((this.top+s-this.bottom)/2,0,s);return new r.P(u,m)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new dl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function _c(c,n){let s=r.bn(c,3);r.a9.fromQuat(c,n),r.bp(c,3,s)}function Ce(c,n){let s=r.bl.identity([]);return r.bl.rotateZ(s,s,-n),r.bl.rotateX(s,s,-c),s}function We(c,n){let s=[c[0],c[1],0],u=[n[0],n[1],0];if(r.Q.length(s)>=1e-15){let b=r.Q.normalize([],s);r.Q.scale(u,b,r.Q.dot(u,b)),n[0]=u[0],n[1]=u[1]}let m=r.Q.cross([],n,c);if(r.Q.len(m)<1e-15)return null;let _=Math.atan2(-m[1],m[0]);return Ce(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),_)}class Ct{constructor(n,s){this.position=n,this.orientation=s}get position(){return this._position}set position(n){if(n){let s=n instanceof r.O?n:new r.O(n[0],n[1],n[2]);this._renderWorldCopies&&(s.x=r.bk(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(n,s){if(this.orientation=null,!this.position)return;let u=this.position,m=this._elevation?this._elevation.getAtPointOrZero(r.O.fromLngLat(n)):0,_=r.O.fromLngLat(n,m),b=[_.x-u.x,_.y-u.y,_.z-u.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=We(b,s)}setPitchBearing(n,s){this.orientation=Ce(r.bm(n),r.bm(-s))}}class Kt{constructor(n,s){this._transform=r.a9.identity([]),this.orientation=s,this.position=n}get mercatorPosition(){let n=this.position;return new r.O(n[0],n[1],n[2])}get position(){let n=r.bn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var s;n&&r.bp(this._transform,3,[(s=n)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||r.bl.identity([]),n&&_c(this._transform,this._orientation)}getPitchBearing(){let n=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,s){this._orientation=Ce(n,s),_c(this._transform,this._orientation)}forward(){let n=r.bn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){let n=r.bn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){let n=r.bn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,s){let u=new Float64Array(16);return r.a9.invert(u,this.getWorldToCamera(n,s)),u}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,s,u){let m=this.position;r.Q.scale(m,m,-n);let _=new Float64Array(16);return r.a9.fromScaling(_,[u,u,u]),r.a9.translate(_,_,m),_[10]*=s,_}getWorldToCamera(n,s){let u=new Float64Array(16),m=new Float64Array(4),_=this.position;return r.bl.conjugate(m,this._orientation),r.Q.scale(_,_,-n),r.a9.fromQuat(u,m),r.a9.translate(u,u,_),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=s,u[9]*=s,u[10]*=s,u[11]*=s,u}getCameraToClipPerspective(n,s,u,m){let _=new Float64Array(16);return r.a9.perspective(_,n,s,u,m),_}getCameraToClipOrthographic(n,s,u,m,_,b){let w=new Float64Array(16);return r.a9.ortho(w,n,s,u,m,_,b),w}getDistanceToElevation(n,s=!1){let u=n===0?0:r.bo(n,s?r.ax(this.position[1]):this.position[1]),m=this.forward();return(u-this.position[2])/m[2]}clone(){return new Kt([...this.position],[...this.orientation])}}let kn=(c,n,s)=>(1-s)*c+s*n,ji=c=>c*c*c*c*c;class Un{constructor(n,s,u,m,_,b,w){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=n||0,this._maxZoom=s||22,this._minPitch=u??0,this._maxPitch=m??60,this.setProjection(b),this.setMaxBounds(w),this.width=0,this.height=0,this._center=new r.bq(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new dl,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Kt,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let n=new Un(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,s=!1){let u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||u)&&this._updateCameraOnTerrain(),(n||u)&&this._constrainCamera(s),this._calcMatrices()}getProjection(){return r.af(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};let s=this.projection?this.getProjection():void 0;this.projection=r.br(this.projectionOptions);let u=!k(s,this.getProjection());return u&&this._calcMatrices(),this.mercatorFromTransition=!1,u}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){let n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.br({name:"mercator"});let s=n!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){let n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.bo(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bk(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){let s=-n*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=r.b7.create(),r.b7.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){let s=r.ad(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=r.bm(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){let s=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){let n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,s=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!s||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let u=this._elevation;s||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&u.exaggeration()&&this._centerAltitudeValidForExaggeration!==u.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*u.exaggeration(),this._centerAltitudeValidForExaggeration=u.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=u.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let n=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop(),m=0,_=0;for(let b=0;b<s.length;b++){let w=new r.P(s[b][0]*this.width,u+s[b][1]*(this.height-u)),S=n.pointCoordinate(w);if(!S)continue;let C=1/Math.hypot(S[0]-this._camera.position[0],S[1]-this._camera.position[1]);m+=S[3]*C,_+=C}return _===0?NaN:m/_}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let n=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*s,m=this._mercatorZfromZoom(n),_=this._mercatorZfromZoom(this._maxZoom),b=Math.max(m-u,_);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){let s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude())),u;u=n.z<this._camera.position[2]?[s.x,s.y,s.z]:[n.x,n.y,n.z];let m=r.Q.length(r.Q.sub([],this._camera.position,u));return r.ad(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let s=!1;if(n.orientation&&!r.bl.exactEquals(n.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(n.orientation)),n.position){let u=[n.position.x,n.position.y,n.position.z];r.Q.exactEquals(u,this._camera.position)||(this._setCameraPosition(u),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let n=this._camera.position,s=new Ct;return s.position=new r.O(n[0],n[1],n[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(n){if(!r.bl.length(n))return!1;r.bl.normalize(n,n);let s=r.Q.transformQuat([],[0,0,-1],n),u=r.Q.transformQuat([],[0,-1,0],n);if(u[2]<0)return!1;let m=We(s,u);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(n){let s=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;n[2]=r.ad(n[2],m/u,m/s),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,s,u){this._unmodified=!1,this._edgeInsets.interpolate(n,s,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){let s=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(n){let s=[new r.bs(0,n)];if(this.renderWorldCopies){let u=this.pointCoordinate(new r.P(0,0)),m=this.pointCoordinate(new r.P(this.width,0)),_=this.pointCoordinate(new r.P(this.width,this.height)),b=this.pointCoordinate(new r.P(0,this.height)),w=Math.floor(Math.min(u.x,m.x,_.x,b.x)),S=Math.floor(Math.max(u.x,m.x,_.x,b.x)),C=1;for(let R=w-C;R<=S+C;R++)R!==0&&s.push(new r.bs(R,n))}return s}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(n,s,u){let m=[];if(s[0]===0&&s[1]===0)return m;for(let b of n){let w=b.canonical,S=b.overscaledZ,C=b.wrap,R=1<<w.z,O=w.x+1<R,F=w.x>0,B=w.y+1<R,U=w.y>0,j=b.wrap-(F?0:1),G=b.wrap+(O?0:1),q=F?w.x-1:R-1,H=O?w.x+1:0;s[0]<0?(m.push(new r.ap(S,G,w.z,H,w.y)),s[1]<0&&B&&(m.push(new r.ap(S,C,w.z,w.x,w.y+1)),m.push(new r.ap(S,G,w.z,H,w.y+1))),s[1]>0&&U&&(m.push(new r.ap(S,C,w.z,w.x,w.y-1)),m.push(new r.ap(S,G,w.z,H,w.y-1)))):s[0]>0?(m.push(new r.ap(S,j,w.z,q,w.y)),s[1]<0&&B&&(m.push(new r.ap(S,C,w.z,w.x,w.y+1)),m.push(new r.ap(S,j,w.z,q,w.y+1))),s[1]>0&&U&&(m.push(new r.ap(S,C,w.z,w.x,w.y-1)),m.push(new r.ap(S,j,w.z,q,w.y-1)))):s[1]<0&&B?m.push(new r.ap(S,C,w.z,w.x,w.y+1)):U&&m.push(new r.ap(S,C,w.z,w.x,w.y-1))}if(m.length>1){m.sort((S,C)=>S.overscaledZ-C.overscaledZ||S.wrap-C.wrap||S.canonical.z-C.canonical.z||S.canonical.x-C.canonical.x||S.canonical.y-C.canonical.y);let b=0,w=0;for(;w<m.length;)m[w].equals(m[b])?++w:m[++b]=m[w++];m.length=b+1}let _=[];for(let b of m)m.some(w=>b.isChildOf(w))||_.push(b);return m=_.filter(b=>!n.some(w=>!!(b.overscaledZ<u&&w.isChildOf(b))||b.equals(w)||b.isChildOf(w))),m}coveringTiles(n){let s=this.coveringZoomLevel(n),u=s,m=this.elevation&&this.elevation.exaggeration(),_=m&&!n.isTerrainDEM,b=this.projection.name==="mercator";if(n.minzoom!==void 0&&s<n.minzoom)return[];n.maxzoom!==void 0&&s>n.maxzoom&&(s=n.maxzoom);let w=this.locationCoordinate(this.center),S=this.center.lat,C=1<<s,R=[C*w.x,C*w.y,0],O=this.projection.name==="globe",F=!O,B=r.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,F),U=O?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),j=C*r.bo(1,this.center.lat),G=this._camera.position[2]/r.bo(1,this.center.lat),q=[C*U.x,C*U.y,G*(F?1:j)],H=O||m,ne=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),ie=this.isLODDisabled(!0)?s:0,oe;if(this._elevation&&n.isTerrainDEM)oe=1e4*this._elevation.exaggeration();else if(this._elevation){let ye=this._elevation.getMinMaxForVisibleTiles();oe=ye?ye.max:this._centerAltitude}else oe=this._centerAltitude;let $=n.isTerrainDEM?-oe:this._elevation?this._elevation.getMinElevationBelowMSL():0,X=this.projection.isReprojectedInTileSpace?r.bu(this):1,ue=ye=>{let De=new r.O(ye.x+25e-6,ye.y,ye.z),re=new r.O(ye.x,ye.y+25e-6,ye.z),Ue=ye.toLngLat(),gt=De.toLngLat(),Et=re.toLngLat(),Ot=this.locationCoordinate(Ue),At=this.locationCoordinate(gt),Nt=this.locationCoordinate(Et),xi=Math.hypot(At.x-Ot.x,At.y-Ot.y),ei=Math.hypot(Nt.x-Ot.x,Nt.y-Ot.y);return Math.sqrt(xi*ei)*X/25e-6},le=ye=>{let Se=oe,De=$;return{aabb:r.bx(this,C,0,0,0,ye,De,Se,this.projection),zoom:0,x:0,y:0,minZ:De,maxZ:Se,wrap:ye,fullyVisible:!1}},ge=[],Me=[],me=s,Ee=n.reparseOverscaled?u:s,Re=ye=>ye*ye,pe=Re((G-this._centerAltitude)*j),xe=ye=>{if(!this._elevation||!ye.tileID||!b)return;let Se=this._elevation.getMinMaxForTile(ye.tileID),De=ye.aabb;Se?(De.min[2]=Se.min,De.max[2]=Se.max,De.center[2]=(De.min[2]+De.max[2])/2):(ye.shouldSplit=He(ye),ye.shouldSplit||(De.min[2]=De.max[2]=De.center[2]=this._centerAltitude))},He=ye=>{if(ye.zoom<ie)return!0;if(ye.zoom===me)return!1;if(ye.shouldSplit!=null)return ye.shouldSplit;let Se=ye.aabb.distanceX(q),De=ye.aabb.distanceY(q),re=pe,Ue=1;if(O){re=Re(ye.aabb.distanceZ(q));let Ot=Math.pow(2,ye.zoom),At=r.ax((ye.y+1)/Ot),Nt=r.ax(ye.y/Ot),xi=Math.min(Math.max(S,At),Nt),ei=r.bM(xi)/r.bM(S);if(Ue=xi===S?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ei/this._mercatorScaleRatio),this.zoom<=r.bJ&&ye.zoom===me-1&&ei>=.9)return!0}else if(_&&(re=Re(ye.aabb.distanceZ(q)*j)),this.projection.isReprojectedInTileSpace&&u<=5){let Ot=Math.pow(2,ye.zoom),At=ue(new r.O((ye.x+.5)/Ot,(ye.y+.5)/Ot));Ue=At>.85?1:At}let gt=Se*Se+De*De+re,Et=Re((1<<me-ye.zoom)*ne*Ue*((Ot,At)=>{if(At*Re(.707)<Ot)return 1;let Nt=Math.sqrt(At/Ot);return Nt/(1.4144271570014144+(Math.pow(1.1,Nt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(re,pe),gt));return gt<Et};if(this.renderWorldCopies)for(let ye=1;ye<=3;ye++)ge.push(le(-ye)),ge.push(le(ye));for(ge.push(le(0));ge.length>0;){let ye=ge.pop(),Se=ye.x,De=ye.y,re=ye.fullyVisible,Ue=()=>this.projection.name==="globe"&&(ye.y===0||ye.y===(1<<ye.zoom)-1);if(!re){let gt=H?ye.aabb.intersects(B):ye.aabb.intersectsFlat(B);if(gt===0&&Ue()){let Et=new r.bv(ye.zoom,Se,De);gt=r.bw(this,C,Et,!0).intersects(B)}if(gt===0)continue;re=gt===2}if(ye.zoom!==me&&He(ye))for(let gt=0;gt<4;gt++){let Et=(Se<<1)+gt%2,Ot=(De<<1)+(gt>>1),At={aabb:b?ye.aabb.quadrant(gt):r.bx(this,C,ye.zoom+1,Et,Ot,ye.wrap,ye.minZ,ye.maxZ,this.projection),zoom:ye.zoom+1,x:Et,y:Ot,wrap:ye.wrap,fullyVisible:re,tileID:void 0,shouldSplit:void 0,minZ:ye.minZ,maxZ:ye.maxZ};_&&!O&&(At.tileID=new r.ap(ye.zoom+1===me?Ee:ye.zoom+1,ye.wrap,ye.zoom+1,Et,Ot),xe(At)),ge.push(At)}else{let gt=ye.zoom===me?Ee:ye.zoom;if(n.minzoom&&n.minzoom>gt)continue;if(!re){let Nt=H?ye.aabb.intersectsPrecise(B):ye.aabb.intersectsPreciseFlat(B);if(Nt===0&&Ue()){let xi=new r.bv(ye.zoom,Se,De);Nt=r.bw(this,C,xi,!0).intersectsPrecise(B)}if(Nt===0)continue}let Et=R[0]-(.5+Se+(ye.wrap<<ye.zoom))*(1<<s-ye.zoom),Ot=R[1]-.5-De,At=ye.tileID?ye.tileID:new r.ap(gt,ye.wrap,ye.zoom,Se,De);Me.push({tileID:At,distanceSq:Et*Et+Ot*Ot})}}if(this.fogCullDistSq){let ye=this.fogCullDistSq,Se=this.horizonLineFromTop();Me=Me.filter(De=>{let re=[0,0,0,1],Ue=[r.Y,r.Y,0,1],gt=this.calculateFogTileMatrix(De.tileID.toUnwrapped());r.aa.transformMat4(re,re,gt),r.aa.transformMat4(Ue,Ue,gt);let Et=r.aa.min([],re,Ue),Ot=r.aa.max([],re,Ue),At=r.by(Et,Ot);if(At===0)return!0;let Nt=!1,xi=this._elevation;if(xi&&At>ye&&Se!==0){let ei=this.calculateProjMatrix(De.tileID.toUnwrapped()),Di;n.isTerrainDEM||(Di=xi.getMinMaxForTile(De.tileID)),Di||(Di={min:$,max:oe});let wi=r.bK(this.rotation),Cn=[wi[0]*r.Y,wi[1]*r.Y,Di.max];r.Q.transformMat4(Cn,Cn,ei),Nt=(1-Cn[1])*this.height*.5<Se}return At<ye||Nt})}return Me.sort((ye,Se)=>ye.distanceSq-Se.distanceSq).map(ye=>ye.tileID)}resize(n,s){this.width=n,this.height=s,this.pixelsToGLUnits=[2/n,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){let s=r.ad(n.lat,-r.bz,r.bz),u=this.projection.project(n.lng,s);return new r.P(u.x*this.worldSize,u.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.bo(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,s){let u,m,_=this.centerPoint;if(this.projection.name==="globe"){let w=this.worldSize;u=(s.x-_.x)/w,m=(s.y-_.y)/w}else{let w=this.pointCoordinate(s),S=this.pointCoordinate(_);u=w.x-S.x,m=w.y-S.y}let b=this.locationCoordinate(n);this.setLocation(new r.O(b.x-u,b.y-m))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,s){let u=s?r.bo(s,n.lat):void 0,m=this.projection.project(n.lng,n.lat);return new r.O(m.x,m.y,u)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,s){let u=s??this._centerAltitude,m=[n.x,n.y,0,1],_=[n.x,n.y,1,1];r.aa.transformMat4(m,m,this.pixelMatrixInverse),r.aa.transformMat4(_,_,this.pixelMatrixInverse);let b=_[3];r.aa.scale(m,m,1/m[3]),r.aa.scale(_,_,1/b);let w=m[2],S=_[2];return{p0:m,p1:_,t:w===S?0:(u-w)/(S-w)}}screenPointToMercatorRay(n){let s=[n.x,n.y,0,1],u=[n.x,n.y,1,1];return r.aa.transformMat4(s,s,this.pixelMatrixInverse),r.aa.transformMat4(u,u,this.pixelMatrixInverse),r.aa.scale(s,s,1/s[3]),r.aa.scale(u,u,1/u[3]),s[2]=r.bo(s[2],this._center.lat)*this.worldSize,u[2]=r.bo(u[2],this._center.lat)*this.worldSize,r.aa.scale(s,s,1/this.worldSize),r.aa.scale(u,u,1/this.worldSize),new r.a5([s[0],s[1],s[2]],r.Q.normalize([],r.Q.sub([],u,s)))}rayIntersectionCoordinate(n){let{p0:s,p1:u,t:m}=n,_=r.bo(s[2],this._center.lat),b=r.bo(u[2],this._center.lat);return new r.O(r.X(s[0],u[0],m)/this.worldSize,r.X(s[1],u[1],m)/this.worldSize,r.X(_,b,m))}pointCoordinate(n,s=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,s)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let s=this.projection.pointCoordinate3D(this,n.x,n.y);if(s)return new r.O(s[0],s[1],s[2]);let u=0,m=this.horizonLineFromTop();if(n.y>m)return this.pointCoordinate(n);let _=.02*m,b=n.clone();for(let w=0;w<10&&m-u>_;w++){b.y=r.X(u,m,.66);let S=this.projection.pointCoordinate3D(this,b.x,b.y);S?(m=b.y,s=S):u=b.y}return s?new r.O(s[0],s[1],s[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=r.bA)return!this.isPointAboveHorizon(n);let s=this.pointCoordinate(n);return s.y>=0&&s.y<=1}_coordinatePoint(n,s){let u=s&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,m=[n.x*this.worldSize,n.y*this.worldSize,u+n.toAltitude(),1];return r.aa.transformMat4(m,m,this.pixelMatrix),m[3]>0?new r.P(m[0]/m[3],m[1]/m[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:n,left:s}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,m=this.width-this._edgeInsets.right,_=this.pointLocation3D(new r.P(s,n)),b=this.pointLocation3D(new r.P(m,n)),w=this.pointLocation3D(new r.P(m,u)),S=this.pointLocation3D(new r.P(s,u)),C=Math.min(_.lng,b.lng,w.lng,S.lng),R=Math.max(_.lng,b.lng,w.lng,S.lng),O=Math.min(_.lat,b.lat,w.lat,S.lat),F=Math.max(_.lat,b.lat,w.lat,S.lat),B=Math.pow(2,-this.zoom)/16*270,U=this.projection.name==="globe"?1:4,j=(G,q,H,ne,ie)=>{let oe=(G+H)/2,$=(q+ne)/2,X=new r.P(oe,$),{lng:ue,lat:le}=this.pointLocation3D(X),ge=Math.max(0,C-ue,O-le,ue-R,le-F);C=Math.min(C,ue),R=Math.max(R,ue),O=Math.min(O,le),F=Math.max(F,le),(ie<U||ge>B)&&(j(G,q,oe,$,ie+1),j(oe,$,H,ne,ie+1))};if(j(s,n,m,n,1),j(m,n,m,u,1),j(m,u,s,u,1),j(s,u,s,n,1),this.projection.name==="globe"){let[G,q]=r.bB(this);G?(F=90,R=180,C=-180):q&&(O=-90,R=180,C=-180)}return new r.ag(new r.bq(C,O),new r.bq(R,F))}_getBoundsRectangular(n,s){let{top:u,left:m}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,w=new r.P(m,u),S=new r.P(b,u),C=new r.P(b,_),R=new r.P(m,_),O=this.pointCoordinate(w,n),F=this.pointCoordinate(S,n),B=this.pointCoordinate(C,s),U=this.pointCoordinate(R,s),j=(G,q)=>(q.y-G.y)/(q.x-G.x);return O.y>1&&F.y>=0?O=new r.O((1-U.y)/j(U,O)+U.x,1):O.y<0&&F.y<=1&&(O=new r.O(-U.y/j(U,O)+U.x,0)),F.y>1&&O.y>=0?F=new r.O((1-B.y)/j(B,F)+B.x,1):F.y<0&&O.y<=1&&(F=new r.O(-B.y/j(B,F)+B.x,0)),new r.ag().extend(this.coordinateLocation(O)).extend(this.coordinateLocation(F)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(B))}_getBoundsRectangularTerrain(){let n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);let s=n.visibleDemTiles.reduce((u,m)=>{if(m.dem){let _=m.dem.tree;u.min=Math.min(u.min,_.minimums[0]),u.max=Math.max(u.max,_.maximums[0])}return u},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(s.min*n.exaggeration(),s.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){let s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,u=this.height/2-s*(1-this._horizonShift);return n?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-r.bz,this.maxLat=r.bz,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.a8(this.minLng)*this.tileSize,this.worldMaxX=r.a8(this.maxLng)*this.tileSize,this.worldMinY=r.ah(this.maxLat)*this.tileSize,this.worldMaxY=r.ah(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,s){return this.projection.createTileMatrix(this,s,n)}calculateDistanceTileData(n){let s=n.key,u=this._distanceTileDataCache;if(u[s])return u[s];let m=n.canonical,_=1/this.height,b=this.cameraWorldSize,w=b/this.zoomScale(m.z),S=(m.x+Math.pow(2,m.z)*n.wrap)*w,C=m.y*w,R=this.point;R.x*=b/this.worldSize,R.y*=b/this.worldSize;let O=this.angle,F=Math.sin(-O),B=-Math.cos(-O);return u[s]={bearing:[F,B],center:[(R.x-S)*_,(R.y-C)*_],scale:w/r.Y*_},u[s]}calculateFogTileMatrix(n){let s=n.key,u=this._fogTileMatrixCache;if(u[s])return u[s];let m=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return r.a9.multiply(m,this.worldToFogMatrix,m),u[s]=new Float32Array(m),u[s]}calculateProjMatrix(n,s=!1,u=!1){let m=n.key,_;if(_=u?this._expandedProjMatrixCache:s?this._alignedProjMatrixCache:this._projMatrixCache,_[m])return _[m];let b=this.calculatePosMatrix(n,this.worldSize),w;return w=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.expandedFarZProjMatrix:s?this.alignedProjMatrix:this.projMatrix,r.a9.multiply(b,w,b),_[m]=new Float32Array(b),_[m]}calculatePixelsToTileUnitsMatrix(n){let s=n.tileID.key,u=this._pixelsToTileUnitsCache;if(u[s])return u[s];let m=r.bC(n,this);return u[s]=m,u[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let n=1/this.worldSize,s=r.a9.fromScaling([],[n,n,n]);return r.a9.multiply(s,s,this.globeMatrix),s}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let n=this._elevation;this._updateCameraState();let s=r.bo(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(s),m=this._camera.forward(),_=r.bo(1,this._center.lat);u[2]/=_,m[2]/=_,r.Q.normalize(m,m);let b=n.raycast(u,m,n.exaggeration());if(b){let w=r.Q.scaleAndAdd([],u,m,b),S=new r.O(w[0],w[1],r.bo(w[2],r.ax(w[1]))),C=(S.z+r.Q.length([S.x-u[0],S.y-u[1],S.z-u[2]*_]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(C),this._centerAltitude=S.toAltitude(),this._center=this.coordinateLocation(S),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;let s=this._elevation,u=r.bo(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(u),_=s.getAtPointOrZero(new r.O(...m)),b=this.pixelsPerMeter/this.worldSize*_,w=this._minimumHeightOverTerrain(),S=m[2]-b;if(S<=w)if(S<0||n){let C=this.locationCoordinate(this._center,this._centerAltitude),R=[m[0],m[1],C.z-m[2]],O=r.Q.length(R);R[2]-=(w-S)/this._pixelsPerMercatorPixel;let F=r.Q.length(R);if(F===0)return;r.Q.scale(R,R,O/F*this._pixelsPerMercatorPixel),this._camera.position=[m[0],m[1],C.z*this._pixelsPerMercatorPixel-R[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){let F=this.center;return F.lat=r.ad(F.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(F.lng=r.ad(F.lng,this.minLng,this.maxLng)),this.center=F,void(this._constraining=!1)}let s=this._unmodified,{x:u,y:m}=this.point,_=0,b=u,w=m,S=this.width/2,C=this.height/2,R=this.worldMinY*this.scale,O=this.worldMaxY*this.scale;if(m-C<R&&(w=R+C),m+C>O&&(w=O-C),O-R<this.height&&(_=Math.max(_,this.height/(O-R)),w=(O+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let F=this.worldMinX*this.scale,B=this.worldMaxX*this.scale,U=this.worldSize/2-(F+B)/2;b=(u+U+this.worldSize)%this.worldSize-U,b-S<F&&(b=F+S),b+S>B&&(b=B-S),B-F<this.width&&(_=Math.max(_,this.width/(B-F)),b=(B+F)/2)}b===u&&w===m||(this.center=this.unproject(new r.P(b,w))),_&&(this.zoom+=this.scaleZoom(_)),this._constrainCamera(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let n=this.centerOffset,s=this.projection.name==="globe",u=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.bo(1,this.center.lat)/r.bo(1,r.bL));let m=r.bD(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let _=this.projection.zAxisUnit==="meters"?u:1,b=this._camera.getWorldToCamera(this.worldSize,_),w,S=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(S[8]=2*-n.x/this.width,S[9]=2*n.y/this.height,this.isOrthographic){let le=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ge=le*this.aspect,Me=-ge,me=-le;ge-=n.x,Me-=n.x,le+=n.y,me+=n.y,w=this._camera.getCameraToClipOrthographic(Me,ge,me,le,this._nearZ,this._farZ),((Ee,Re,pe,xe)=>{for(let He=0;He<16;He++)Ee[He]=kn(Re[He],pe[He],xe)})(w,w,S,ji(this.pitch>=15?1:this.pitch/15))}else w=S;let C=r.a9.mul([],S,b),R=r.a9.mul([],w,b);if(this.projection.isReprojectedInTileSpace){let le=this.locationCoordinate(this.center),ge=r.a9.identity([]);r.a9.translate(ge,ge,[le.x*this.worldSize,le.y*this.worldSize,0]),r.a9.multiply(ge,ge,r.bE(this)),r.a9.translate(ge,ge,[-le.x*this.worldSize,-le.y*this.worldSize,0]),r.a9.multiply(R,R,ge),r.a9.multiply(C,C,ge),this.inverseAdjustmentMatrix=r.bF(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.a9.scale([],R,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=R,this.invProjMatrix=r.a9.invert(new Float64Array(16),this.projMatrix),s){let le=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);le[8]=2*-n.x/this.width,le[9]=2*n.y/this.height,this.expandedFarZProjMatrix=r.a9.mul([],le,b)}else this.expandedFarZProjMatrix=this.projMatrix;let O=r.a9.invert([],w);this.frustumCorners=r.bG.fromInvProjectionMatrix(O,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!s);let F=new Float32Array(16);r.a9.identity(F),r.a9.scale(F,F,[1,-1,1]),r.a9.rotateX(F,F,this._pitch),r.a9.rotateZ(F,F,this.angle);let B=r.a9.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.a9.clone(B);let U=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;B[8]=2*-n.x/this.width,B[9]=2*(n.y+U)/this.height,this.skyboxMatrix=r.a9.multiply(F,B,F);let j=this.point,G=j.x,q=j.y,H=this.width%2/2,ne=this.height%2/2,ie=Math.cos(this.angle),oe=Math.sin(this.angle),$=G-Math.round(G)+ie*H+oe*ne,X=q-Math.round(q)+ie*ne+oe*H,ue=new Float64Array(R);if(r.a9.translate(ue,ue,[$>.5?$-1:$,X>.5?X-1:X,0]),this.alignedProjMatrix=ue,R=r.a9.create(),r.a9.scale(R,R,[this.width/2,-this.height/2,1]),r.a9.translate(R,R,[1,-1,0]),this.labelPlaneMatrix=R,R=r.a9.create(),r.a9.scale(R,R,[1,-1,1]),r.a9.translate(R,R,[-1,-1,0]),r.a9.scale(R,R,[2/this.width,2/this.height,1]),this.glCoordMatrix=R,this.pixelMatrix=r.a9.multiply(new Float64Array(16),this.labelPlaneMatrix,C),this._calcFogMatrices(),this._distanceTileDataCache={},R=r.a9.invert(new Float64Array(16),this.pixelMatrix),!R)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=R,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.bH(this);let le=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.Q.transformMat4(le,le,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=R;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let n=this.cameraWorldSizeForFog,s=this.cameraPixelsPerMeter,u=this._camera.position,m=1/this.height/this._pixelsPerMercatorPixel,_=[n,n,s];r.Q.scale(_,_,m),r.Q.scale(u,u,-1),r.Q.multiply(u,u,_);let b=r.a9.create();r.a9.translate(b,b,u),r.a9.scale(b,b,_),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,s,m)}_computeCameraPosition(n){let s=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),m=this.point,_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-n/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-u[0]*_,m.y/this.worldSize-u[1]*_,n/this.worldSize*this._centerAltitude-u[2]*_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){let s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=this._camera.position[2],m=n[2],_=1;this.projection.wrap&&(this.center=this.center.wrap()),m>0&&(_=Math.min((s-u)/m,1)),this._camera.position=r.Q.scaleAndAdd([],this._camera.position,n,_),this._updateStateFromCamera()}_updateStateFromCamera(){let n=this._camera.position,s=this._camera.forward(),{pitch:u,bearing:m}=this._camera.getPitchBearing(),_=r.bo(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.bm(this._maxPitch)),w=Math.max((n[2]-_)/Math.cos(u),b),S=this._zoomFromMercatorZ(w);r.Q.scaleAndAdd(n,n,s,w),this._pitch=r.ad(u,r.bm(this.minPitch),r.bm(this.maxPitch)),this.angle=r.bk(m,-Math.PI,Math.PI),this._setZoom(r.ad(S,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.O(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){let n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let s=0,u=r.bA,m=0,_=1/0;for(;u-s>1e-6&&u>s;){let b=s+.5*(u-s),w=this.tileSize*Math.pow(2,b),S=this.getCameraToCenterDistance(this.projection,b,w),C=this.scaleZoom(S/(n*this.tileSize)),R=Math.abs(b-C);R<_&&(_=R,m=b),b<C?s=b:u=b}return m}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,s){let u=Math.min(n.x,s.x),m=Math.max(n.x,s.x),_=Math.min(n.y,s.y),b=Math.max(n.y,s.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let w=[new r.P(u,_),new r.P(m,b),new r.P(u,b),new r.P(m,_)],S=this.renderWorldCopies?-3:0,C=this.renderWorldCopies?4:1;for(let R of w){let O=this.pointRayIntersection(R);if(O.t<0)return!0;let F=this.rayIntersectionCoordinate(O);if(F.x<S||F.y<0||F.x>C||F.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.bI(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(n,s){let u=r.Q.length(r.Q.sub([],this._camera.position,n)),m=this._zoomFromMercatorZ(u)+s;return u-this._mercatorZfromZoom(m)}getCameraPoint(){if(this.projection.name==="globe"){let n=function([s,u,m],_){let b=[s,u,m,1];r.aa.transformMat4(b,b,_);let w=b[3]=Math.max(b[3],1e-6);return b[0]/=w,b[1]/=w,b[2]/=w,b}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(n[0],n[1])}{let n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,n))}}getCameraToCenterDistance(n,s=this.zoom,u=this.worldSize){let m=r.bD(n,s,this.width,this.height,1024),_=n.pixelSpaceConversion(this.center.lat,u,m),b=.5/Math.tan(.5*this._fov)*this.height*_;return this.isOrthographic&&(b=kn(1,b,ji(this.pitch>=15?1:this.pitch/15))),b}getWorldToCameraMatrix(){let n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.a9.multiply(n,n,this.globeMatrix),n}getFrustum(n){return r.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}let hn={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},wr=(c,n)=>{if(n>0&&c.terrain&&r.w("Cutoff is currently disabled on terrain"),n<=0||c.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let s=c.transform,u=Math.max(Math.abs(s._zoom-(c.minCutoffZoom-1)),1),m=s.isLODDisabled(!1)?r.S(60,45,s.pitch):r.S(30,15,s.pitch),_=s._farZ-s._nearZ,b=n*s.height,w=((1-(S=m))*s.cameraToCenterDistance+S*(s._farZ+b))*u;var S;return{shouldRenderCutoff:m<1,uniformValues:{u_cutoff_params:[s._nearZ,s._farZ,(w-s._nearZ)/_,(w-b-s._nearZ)/_]}}},pn={cascadeCount:2,shadowMapResolution:2048};class ur{constructor(n,s){this.aabb=n,this.lastCascade=s}}class ps{add(n,s){let u=this.receivers[n.key];u!==void 0?(u.aabb.min[0]=Math.min(u.aabb.min[0],s.min[0]),u.aabb.min[1]=Math.min(u.aabb.min[1],s.min[1]),u.aabb.min[2]=Math.min(u.aabb.min[2],s.min[2]),u.aabb.max[0]=Math.max(u.aabb.max[0],s.max[0]),u.aabb.max[1]=Math.max(u.aabb.max[1],s.max[1]),u.aabb.max[2]=Math.max(u.aabb.max[2],s.max[2])):this.receivers[n.key]=new ur(s,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,s,u){let m=r.bV.fromPoints(n.points),_=0;for(let b in this.receivers){let w=this.receivers[b];if(!w||!m.intersectsAabb(w.aabb))continue;w.aabb.min=m.closestPoint(w.aabb.min),w.aabb.max=m.closestPoint(w.aabb.max);let S=w.aabb.getCorners();for(let C=0;C<u.length;C++){let R=!0;for(let O of S){let F=[O[0]*s,O[1]*s,O[2]];if(r.Q.transformMat4(F,F,u[C].matrix),F[0]<-1||F[0]>1||F[1]<-1||F[1]>1){R=!1;break}}if(w.lastCascade=C,_=Math.max(_,C),R)break}}return _+1}}class fs{constructor(n){this.painter=n,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new ps,this._depthMode=new ze(n.context.gl.LEQUAL,ze.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,n.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),n.tp.registerParameter(pn,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),n.tp.registerParameter(pn,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),n.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,s){let u=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!s||!s.properties)return;let m=s.properties.get("shadow-intensity");if(!s.shadowsEnabled()||m<=0||(this._shadowLayerCount=u.style.order.reduce((U,j)=>{let G=u.style._mergedLayers[j];return U+(G.hasShadowPass()&&!G.isHidden(n.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let _=u.context,b=pn.shadowMapResolution,w=pn.shadowMapResolution;if(this._cascades.length===0||pn.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let U=0;U<pn.cascadeCount;++U){let j=u._shadowMapDebug,G=_.gl,q=_.createFramebuffer(b,w,j,"texture"),H=new r.T(_,{width:b,height:w,data:null},G.DEPTH_COMPONENT);if(q.depthAttachment.set(H.texture),j){let ne=new r.T(_,{width:b,height:w,data:null},G.RGBA);q.colorAttachment.set(ne.texture)}this._cascades.push({framebuffer:q,texture:H,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.bt,scale:0})}}this.shadowDirection=ko(s);let S=0;if(n.elevation){let U=n.elevation,j=[1e4,-1e4];U.visibleDemTiles.filter(G=>G.dem).forEach(G=>{let q=G.dem.tree;j[0]=Math.min(j[0],q.minimums[0]),j[1]=Math.max(j[1],q.maximums[0])}),j[0]!==1e4&&(S=(j[1]-j[0])*U.exaggeration())}let C=1.5*n.cameraToCenterDistance,R=3*C,O=new Float64Array(16);for(let U=0;U<this._cascades.length;++U){let j=this._cascades[U],G=n.height/50,q=1;pn.cascadeCount===1?q=R:U===0?q=C:(G=C,q=R);let[H,ne]=Na(n,this.shadowDirection,G,q,pn.shadowMapResolution,S);j.scale=n.scale,j.matrix=H,j.boundingSphereRadius=ne,r.a9.invert(O,j.matrix),j.frustum=r.bt.fromInvProjectionMatrix(O,1,0,!0),j.far=q}let F=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[F].far,this._cascades[F].far],this._uniformValues.u_shadow_intensity=m,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/pn.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=pn.shadowMapResolution,this._uniformValues.u_shadowmap_0=hn.ShadowMap0,this._uniformValues.u_shadowmap_1=hn.ShadowMap0+1,this._groundShadowTiles=u.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let B=u.transform.elevation;for(let U of this._groundShadowTiles){let j={min:0,max:0};if(B){let G=B.getMinMaxForTile(U);G&&(j=G)}this.addShadowReceiver(U.toUnwrapped(),j.min,j.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(n){this._enabled=n}drawShadowPass(n,s){if(!this.enabled)return;let u=this.painter,m=u.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(u.transform.getFrustum(0),u.transform.worldSize,this._cascades),m.viewport.set([0,0,pn.shadowMapResolution,pn.shadowMapResolution]);for(let _=0;_<this._numCascadesToRender;++_){u.currentShadowCascade=_,m.bindFramebuffer.set(this._cascades[_].framebuffer.framebuffer),m.clear({color:r.aA.white,depth:1});for(let b of n.order){let w=n._mergedLayers[b];if(!w.hasShadowPass()||w.isHidden(u.transform.zoom))continue;let S=n.getLayerSourceCache(w),C=S?s[S.id]:void 0;(w.type==="model"||C&&C.length)&&u.renderLayer(u,S,w,C)}}u.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let n=this.painter,s=n.style,u=n.context,m=s.directionalLight,_=s.ambientLight;if(!m||!_)return;let b=[],w=wr(n,n.longestCutoffRange);w.shouldRenderCutoff&&b.push("RENDER_CUTOFF");let S=ca(m,_),C=new ze(u.gl.LEQUAL,ze.ReadOnly,n.depthRangeFor3D);for(let R of this._groundShadowTiles){let O=R.toUnwrapped(),F=n.isTileAffectedByFog(R),B=n.getOrCreateProgram("groundShadow",{defines:b,overrideFog:F});this.setupShadows(O,B),n.uploadCommonUniforms(u,B,O,null,w);let U={u_matrix:n.transform.calculateProjMatrix(O),u_ground_shadow_factor:S};B.draw(n,u.gl.TRIANGLES,C,kt.disabled,qt.multiply,Tt.disabled,U,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,{},n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?qt.unblended:qt.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(n){let s=this.painter.transform,u=s.calculatePosMatrix(n,s.worldSize);return r.a9.multiply(u,this._cascades[this.painter.currentShadowCascade].matrix,u),Float32Array.from(u)}calculateShadowPassMatrixFromMatrix(n){return r.a9.multiply(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}setupShadows(n,s,u,m=0){if(!this.enabled)return;let _=this.painter.transform,b=this.painter.context,w=b.gl,S=this._uniformValues,C=new Float64Array(16),R=_.calculatePosMatrix(n,_.worldSize);for(let O=0;O<this._cascades.length;O++)r.a9.multiply(C,this._cascades[O].matrix,R),S[O===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),b.activeTexture.set(w.TEXTURE0+hn.ShadowMap0+O),this._cascades[O].texture.bind(w.NEAREST,w.CLAMP_TO_EDGE);if(this.useNormalOffset=!!u,this.useNormalOffset){let O=r.bU(n.canonical),F=2/_.tileSize*r.Y/pn.shadowMapResolution,B=F*this._cascades[0].boundingSphereRadius,U=F*this._cascades[this._cascades.length-1].boundingSphereRadius,j=(u==="vector-tile"?1:3)/Math.pow(2,m-n.canonical.z-(1-_.zoom+Math.floor(_.zoom)));S.u_shadow_normal_offset=[O,B*j,U*j],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(b,S)}setupShadowsFromMatrix(n,s,u=!1){if(!this.enabled)return;let m=this.painter.context,_=m.gl,b=this._uniformValues,w=new Float64Array(16);for(let S=0;S<pn.cascadeCount;S++)r.a9.multiply(w,this._cascades[S].matrix,n),b[S===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(w),m.activeTexture.set(_.TEXTURE0+hn.ShadowMap0+S),this._cascades[S].texture.bind(_.NEAREST,_.CLAMP_TO_EDGE);this.useNormalOffset=u,u?(b.u_shadow_normal_offset=[1,5,5],b.u_shadow_bias=[6e-5,.0012,.012]):b.u_shadow_bias=[36e-5,.0012,.012],s.setShadowUniformValues(m,b)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,s,u,m){if(m[2]>=0)return{};let _=function(S,C,R){let O=R/(1<<S.canonical.z);return new r.bV([S.canonical.x*O+S.wrap*R,S.canonical.y*O+S.wrap*R,0],[(S.canonical.x+1)*O+S.wrap*R,(S.canonical.y+1)*O+S.wrap*R,C])}(n,s,u).getCorners(),b=s/-m[2];m[0]<0?(r.Q.add(_[0],_[0],[m[0]*b,0,0]),r.Q.add(_[3],_[3],[m[0]*b,0,0])):m[0]>0&&(r.Q.add(_[1],_[1],[m[0]*b,0,0]),r.Q.add(_[2],_[2],[m[0]*b,0,0])),m[1]<0?(r.Q.add(_[0],_[0],[0,m[1]*b,0]),r.Q.add(_[1],_[1],[0,m[1]*b,0])):m[1]>0&&(r.Q.add(_[2],_[2],[0,m[1]*b,0]),r.Q.add(_[3],_[3],[0,m[1]*b,0]));let w={};return w.vertices=_,w.planes=[Tr(_[1],_[0],_[4]),Tr(_[2],_[1],_[5]),Tr(_[3],_[2],_[6]),Tr(_[0],_[3],_[7])],w}addShadowReceiver(n,s,u){this._receivers.add(n,r.bV.fromTileIdAndHeight(n,s,u))}getMaxCascadeForTile(n){let s=this._receivers.get(n);return s&&s.lastCascade?s.lastCascade:0}}function Tr(c,n,s){let u=r.Q.sub([],s,n),m=r.Q.sub([],c,n),_=r.Q.cross([],u,m),b=r.Q.length(_);return b===0?[0,0,1,0]:(r.Q.scale(_,_,1/b),[_[0],_[1],_[2],-r.Q.dot(_,n)])}function ko(c){let n=c.properties.get("direction"),s=r.bT(n.x,n.y,n.z);s[2]=r.ad(s[2],0,75);let u=r.bW([s[0],s[1],s[2]]);return r.Q.fromValues(u.x,u.y,u.z)}function ca(c,n){let s=c.properties.get("color"),u=c.properties.get("intensity"),m=c.properties.get("direction"),_=[m.x,m.y,m.z],b=n.properties.get("color"),w=n.properties.get("intensity"),S=Math.max(r.Q.dot([0,0,1],_),0),C=[0,0,0];r.Q.scale(C,b.toArray01Linear().slice(0,3),w);let R=[0,0,0];return r.Q.scale(R,s.toArray01Linear().slice(0,3),S*u),r.bX([C[0]>0?C[0]/(C[0]+R[0]):0,C[1]>0?C[1]/(C[1]+R[1]):0,C[2]>0?C[2]/(C[2]+R[2]):0])}function Na(c,n,s,u,m,_){let b=c.zoom,w=c.scale,S=c.worldSize,C=1/S,R=c.aspect,O=Math.sqrt(1+R*R)*Math.tan(.5*c.fovX),F=O*O,B=u-s,U=u+s,j,G;F>B/U?(j=u,G=u*O):(j=.5*U*(1+F),G=.5*Math.sqrt(B*B+2*(u*u+s*s)*F+U*U*F*F));let q=c.projection.pixelsPerMeter(c.center.lat,S),H=c._camera.getCameraToWorldMercator(),ne=[0,0,-j*C];r.Q.transformMat4(ne,ne,H);let ie=G*C,oe=c._edgeInsets;if(!(oe.left===0&&oe.top===0&&oe.right===0&&oe.bottom===0||oe.left===oe.right&&oe.top===oe.bottom)){let re=c._camera.getWorldToCamera(c.worldSize,c.projection.zAxisUnit==="meters"?q:1),Ue=c._camera.getCameraToClipPerspective(c._fov,c.width/c.height,s,u);Ue[8]=2*-c.centerOffset.x/c.width,Ue[9]=2*c.centerOffset.y/c.height;let gt=new Float64Array(16);r.a9.mul(gt,Ue,re);let Et=new Float64Array(16);r.a9.invert(Et,gt);let Ot=r.bt.fromInvProjectionMatrix(Et,S,b,!0);for(let At of Ot.points){let Nt=(($=At)[0]/=w,$[1]/=w,$[2]=r.bo($[2],c._center.lat),$);ie=Math.max(ie,r.Q.len(r.Q.subtract([],ne,Nt)))}}var $;ie*=m/(m-1);let X=Math.acos(n[2]),ue=Math.atan2(-n[0],-n[1]),le=new Kt;le.position=ne,le.setPitchBearing(X,ue);let ge=le.getWorldToCamera(S,q),Me=ie*S,me=Math.min(c._mercatorZfromZoom(17)*S*-2,-2*Me),Ee=le.getCameraToClipOrthographic(-Me,Me,-Me,Me,me,(Me+_*q)/n[2]),Re=new Float64Array(16);r.a9.multiply(Re,Ee,ge);let pe=r.Q.fromValues(Math.floor(1e6*ne[0])/1e6*S,Math.floor(1e6*ne[1])/1e6*S,0),xe=.5*m,He=[0,0,0];r.Q.transformMat4(He,pe,Re),r.Q.scale(He,He,xe);let ye=[Math.floor(He[0]),Math.floor(He[1]),Math.floor(He[2])],Se=[0,0,0];r.Q.sub(Se,He,ye),r.Q.scale(Se,Se,-1/xe);let De=new Float64Array(16);return r.a9.identity(De),r.a9.translate(De,De,Se),r.a9.multiply(Re,De,Re),[Re,Me]}let Wr=(c,n)=>_t(c,n&&n.filter(s=>s.identifier!=="source.canvas")),pl=r.af(zi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Nh=r.af(zi,["setCenter","setZoom","setBearing","setPitch"]),xu={version:8,layers:[],sources:{}},wu={duration:300,delay:0};class Qi extends r.E{constructor(n,s={}){super(),this.map=n,this.scope=s.scope||"",this.globalId=null,this.fragments=[],this.importDepth=s.importDepth||0,this.importsCache=s.importsCache||new Map,this.resolvedImports=s.resolvedImports||new Set,this.transition=r.e({},wu),this._buildingIndex=new pc(this),this.crossTileSymbolIndex=new Ba,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=s.styleChanges||new Ni,this.dispatcher=s.dispatcher?s.dispatcher:new r.bZ(r.b_(),this),s.imageManager?this.imageManager=s.imageManager:(this.imageManager=new Rl,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=s.glyphManager?s.glyphManager:new r.b$(n._requestManager,s.localFontFamily?r.c0.all:s.localIdeographFontFamily?r.c0.ideographs:r.c0.none,s.localFontFamily||s.localIdeographFontFamily),s.modelManager?this.modelManager=s.modelManager:(this.modelManager=new _o(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=s.configOptions?s.configOptions:new Map,this._configDependentLayers=s.configDependentLayers?s.configDependentLayers:new Set,this._config=s.config,this._initialConfig=s.initialConfig,this.dispatcher.broadcast("setReferrer",r.c1());let u=this;this._rtlTextPluginCallback=Qi.registerForPluginStateChange(m=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(_,b)=>{if(r.c2(_),b&&b.every(w=>w))for(let w in u._sourceCaches){let S=u._sourceCaches[w],C=S.getSource().type;C!=="vector"&&C!=="geojson"||S.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;let _=this.getOwnSource(m.sourceId);if(_&&_.vectorLayerIds)for(let b in this._layers){let w=this._layers[b];w.source===_.id&&this._validateLayer(w)}})}load(n){return n?(typeof n=="string"?this.loadURL(n):this.loadJSON(n),this):this}_getGlobalId(n){if(!n)return null;if(typeof n=="string"){if(r.c3(n))return n;let s=r.c4(n);if(!s.startsWith("http"))try{return new URL(s,location.href).toString()}catch{return s}return s}return`json://${r.c5(JSON.stringify(n))}`}_diffStyle(n,s,u){this.globalId=this._getGlobalId(n);let m=(_,b)=>{try{b(null,this.setState(_,u))}catch(w){b(w,!1)}};if(typeof n=="string"){let _=this.map._requestManager.normalizeStyleURL(n),b=this.map._requestManager.transformRequest(_,r.R.Style);r.g(b,(w,S)=>{w?this.fire(new r.a(w)):S&&m(S,s)})}else typeof n=="object"&&m(n,s)}loadURL(n,s={}){this.fire(new r.b("dataloading",{dataType:"style"}));let u=typeof s.validate=="boolean"?s.validate:!r.c3(n);this.globalId=this._getGlobalId(n),n=this.map._requestManager.normalizeStyleURL(n,s.accessToken),this.resolvedImports.add(n);let m=this.importsCache.get(n);if(m)return this._load(m,u);let _=this.map._requestManager.transformRequest(n,r.R.Style);this._request=r.g(_,(b,w)=>{if(this._request=null,b)this.fire(new r.a(b));else if(w)return this.importsCache.set(n,w),this._load(w,u)})}loadJSON(n,s={}){this.fire(new r.b("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(n),this._request=r.f.frame(()=>{this._request=null,this._load(n,s.validate!==!1)})}loadEmpty(){this.fire(new r.b("dataloading",{dataType:"style"})),this._load(xu,!1)}_loadImports(n,s,u){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let m=[];for(let _ of n){let b=this._createFragmentStyle(_),w=new Promise(R=>{b.once("style.import.load",R),b.once("error",R)}).then(()=>this.mergeAll());if(m.push(w),this.resolvedImports.has(_.url)){b.loadEmpty();continue}let S=_.data||this.importsCache.get(_.url);S?(b.loadJSON(S,{validate:s}),this._isInternalStyle(S)&&(b.globalId=null)):_.url?b.loadURL(_.url,{validate:s}):b.loadEmpty();let C={style:b,id:_.id,config:_.config};if(u){let R=this.fragments.findIndex(({id:O})=>O===u);this.fragments=this.fragments.slice(0,R).concat(C).concat(this.fragments.slice(R))}else this.fragments.push(C)}return Promise.allSettled(m)}getImportGlobalIds(n=this,s=new Set){for(let u of n.fragments)u.style.globalId&&s.add(u.style.globalId),this.getImportGlobalIds(u.style,s);return[...s.values()]}_createFragmentStyle(n){let s=this.scope?r.aj(n.id,this.scope):n.id,u,m=this._initialConfig&&this._initialConfig[s];(n.config||m)&&(u=r.e({},n.config,m));let _=new Qi(this.map,{scope:s,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:u,configOptions:this.options,configDependentLayers:this._configDependentLayers});return _.setEventedParent(this.map,{style:_}),_}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(n){return this.isRootStyle()&&(n.fragment||!!n.schema&&n.fragment!==!1)}_load(n,s){let u=n.schema;if(this._isInternalStyle(n)){let w=r.e({},xu,{imports:[{id:"basemap",data:n,url:""}]});return void this._load(w,s)}if(this.updateConfig(this._config,u),s&&Wr(this,Wt(n)))return;this._loaded=!0,this.stylesheet=r.c6(n);for(let w in n.sources)this.addSource(w,n.sources[w],{validate:!1,isInitialLoad:!0});n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(n.glyphs,this.scope);let m=Fh(this.stylesheet.layers);if(this._order=m.map(w=>w.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let w=this.stylesheet.lights[0];this.light=new Dt(w.properties,w.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Dt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let w of m){let S=r.c7(w,this.scope,this.options);S.isConfigDependent&&this._configDependentLayers.add(S.fqid),S.setEventedParent(this,{layer:{id:S.id}}),this._layers[S.id]=S,this._serializedLayers[S.id]=S.serialize();let C=this.getOwnLayerSourceCache(S),R=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&S.canCastShadows()&&R&&(C.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let _=this.stylesheet.terrain;_&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(_,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.b("data",{dataType:"style"}));let b=this.isRootStyle();n.imports?this._loadImports(n.imports,s).then(()=>{this._reloadImports(),this.fire(new r.b(b?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.b(b?"style.load":"style.import.load")))}isRootStyle(){return this.importDepth===0}mergeAll(){let n,s,u,m,_,b,w,S;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(C=>{if(C.stylesheet){if(C.light!=null&&(n=C.light),C.stylesheet.lights)for(let R of C.stylesheet.lights)R.type==="ambient"&&C.ambientLight!=null&&(s=C.ambientLight),R.type==="directional"&&C.directionalLight!=null&&(u=C.directionalLight);m=this._prioritizeTerrain(m,C.terrain,C.stylesheet.terrain),C.stylesheet.fog&&C.fog!=null&&(_=C.fog),C.stylesheet.camera!=null&&(S=C.stylesheet.camera),C.stylesheet.projection!=null&&(b=C.stylesheet.projection),C.stylesheet.transition!=null&&(w=C.stylesheet.transition)}}),this.light=n,this.ambientLight=s,this.directionalLight=u,this.fog=_,m===null?delete this.terrain:this.terrain=m,this.camera=S||{"camera-projection":"perspective"},this.projection=b||{name:"mercator"},this.transition=r.e({},wu,w),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(n){let s=u=>{for(let m of u.fragments)s(m.style);n(u)};s(this)}_prioritizeTerrain(n,s,u){let m=n&&n.drapeRenderMode===0;return u===null?s&&s.drapeRenderMode===0?s:m?n:null:s!=null&&(!n||m||s&&s.drapeRenderMode===1)?s:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(s=>{n=this._prioritizeTerrain(n,s.terrain,s.stylesheet.terrain)}),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle(s=>{s.stylesheet.projection!=null&&(n=s.stylesheet.projection)}),this.projection=n||{name:"mercator"}}mergeSources(){let n={},s={},u={};this.forEachFragmentStyle(m=>{for(let _ in m._sourceCaches){let b=r.aj(_,m.scope);n[b]=m._sourceCaches[_]}for(let _ in m._otherSourceCaches){let b=r.aj(_,m.scope);s[b]=m._otherSourceCaches[_]}for(let _ in m._symbolSourceCaches){let b=r.aj(_,m.scope);u[b]=m._symbolSourceCaches[_]}}),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=s,this._mergedSymbolSourceCaches=u}mergeLayers(){let n={},s=[],u={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(_=>{for(let b of _._order){let w=_._layers[b];if(w.type==="slot"){let S=r.c8(b);if(n[S])continue;n[S]=[]}w.slot&&n[w.slot]?n[w.slot].push(w):s.push(w)}}),this._mergedOrder=[];let m=(_=[])=>{for(let b of _)if(b.type==="slot"){let w=r.c8(b.id);n[w]&&m(n[w])}else{let w=r.aj(b.id,b.scope);this._mergedOrder.push(w),u[w]=b,b.is3D()&&(this._has3DLayers=!0),b.type==="circle"&&(this._hasCircleLayers=!0),b.type==="symbol"&&(this._hasSymbolLayers=!0)}};m(s),this._mergedLayers=u,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=r.e({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=function(s,u,m){let _,b,w,S=r.f.devicePixelRatio>1?"@2x":"",C=r.g(u.transformRequest(u.normalizeSpriteURL(s,S,".json"),r.R.SpriteJSON),(F,B)=>{C=null,w||(w=F,_=B,O())}),R=r.d(u.transformRequest(u.normalizeSpriteURL(s,S,".png"),r.R.SpriteImage),(F,B)=>{R=null,w||(w=F,b=B,O())});function O(){if(w)m(w);else if(_&&b){let F=r.f.getImageData(b),B={};for(let U in _){let{width:j,height:G,x:q,y:H,sdf:ne,pixelRatio:ie,stretchX:oe,stretchY:$,content:X}=_[U],ue=new r.h({width:j,height:G});r.h.copy(F,ue,{x:q,y:H},{x:0,y:0},{width:j,height:G}),B[U]={data:ue,pixelRatio:ie,sdf:ne,stretchX:oe,stretchY:$,content:X}}m(null,B)}}return{cancel(){C&&(C.cancel(),C=null),R&&(R.cancel(),R=null)}}}(n,this.map._requestManager,(s,u)=>{if(this._spriteRequest=null,s)this.fire(new r.a(s));else if(u)for(let m in u)this.imageManager.addImage(m,this.scope,u[m]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.b("data",{dataType:"style"}))})}_validateLayer(n){let s=this.getOwnSource(n.source);if(!s)return;let u=n.sourceLayer;u&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(u)===-1)&&this.fire(new r.a(new Error(`Source layer "${u}" does not exist on source "${s.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(let{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((n,s)=>{let u=this.fragments[s];return u&&u.style&&(n.data=u.style.serialize()),n})}_serializeSources(){let n={};for(let s in this._sourceCaches){let u=this._sourceCaches[s].getSource();n[u.id]||(n[u.id]=u.serialize())}return n}_serializeLayers(n){let s=[];for(let u of n){let m=this._layers[u];m&&m.type!=="custom"&&s.push(m.serialize())}return s}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(let n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&n.isDraped(this.getLayerSourceCache(n))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){let s=this.getOwnLayer(n);if(s)return s;this.fire(new r.a(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){let s=this.getOwnSource(n);if(s)return s;this.fire(new r.a(new Error(`The source '${n}' does not exist in the map's style.`)))}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);let s=this.calculateLightsBrightness();n.brightness=s||0,s!==this._brightness&&(this._brightness=s,this.dispatcher.broadcast("setBrightness",s));let u=this._changes.isDirty();if(this._changes.isDirty()){let _=this._changes.getLayerUpdatesByScope();for(let b in _){let{updatedIds:w,removedIds:S}=_[b];(w||S)&&this._updateWorkerLayers(b,w,S)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._changes.reset()}let m={};for(let _ in this._mergedSourceCaches){let b=this._mergedSourceCaches[_];m[_]=b.used,b.used=!1,b.tileCoverLift=0}for(let _ of this._mergedOrder){let b=this._mergedLayers[_];if(b.recalculate(n,this._availableImages),!b.isHidden(n.zoom)){let w=this.getLayerSourceCache(b);w&&(w.used=!0,w.tileCoverLift=Math.max(w.tileCoverLift,b.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let w=b.minzoom||0;w<(b.maxzoom||25.5);w++){let S=this.map.painter;if(S){let C=b.getProgramIds();if(!C)continue;for(let R of C){let O=b.getDefaultProgramParams(R,n.zoom);O&&(S.style=this,this.fog&&(S._fogVisible=!0,O.overrideFog=!0,S.getOrCreateProgram(R,O)),S._fogVisible=!1,O.overrideFog=!1,S.getOrCreateProgram(R,O),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(O.overrideRtt=!0,S.getOrCreateProgram(R,O)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(let _ in m){let b=this._mergedSourceCaches[_];m[_]!==b.used&&b.getSource().fire(new r.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),u&&this.fire(new r.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){let n=this._changes.getUpdatedImages();if(n.length){for(let s in this._sourceCaches)this._sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],n);this._changes.resetUpdatedImages()}}_updateWorkerLayers(n,s,u){let m=this.getFragmentStyle(n);m&&this.dispatcher.broadcast("updateLayers",{layers:s?m._serializeLayers(s):[],scope:n,removedIds:u||[],options:m.options})}setState(n,s){if(this._checkLoaded(),Wr(this,Wt(n)))return!1;(n=r.c6(n)).layers=Fh(n.layers);let u=function(b,w){if(!b)return[{command:zi.setStyle,args:[w]}];let S=[];try{if(!k(b.version,w.version))return[{command:zi.setStyle,args:[w]}];k(b.center,w.center)||S.push({command:zi.setCenter,args:[w.center]}),k(b.zoom,w.zoom)||S.push({command:zi.setZoom,args:[w.zoom]}),k(b.bearing,w.bearing)||S.push({command:zi.setBearing,args:[w.bearing]}),k(b.pitch,w.pitch)||S.push({command:zi.setPitch,args:[w.pitch]}),k(b.sprite,w.sprite)||S.push({command:zi.setSprite,args:[w.sprite]}),k(b.glyphs,w.glyphs)||S.push({command:zi.setGlyphs,args:[w.glyphs]}),k(b.imports,w.imports)||function(B=[],U=[],j){U=U||[];let G=(B=B||[]).map(Aa),q=U.map(Aa),H=B.reduce(Bl,{}),ne=U.reduce(Bl,{}),ie=G.slice(),oe,$,X,ue;for(oe=0,$=0;oe<G.length;oe++)X=G[oe],ne.hasOwnProperty(X)?$++:(j.push({command:zi.removeImport,args:[X]}),ie.splice(ie.indexOf(X,$),1));for(oe=0,$=0;oe<q.length;oe++)X=q[q.length-1-oe],ie[ie.length-1-oe]!==X&&(H.hasOwnProperty(X)?(j.push({command:zi.removeImport,args:[X]}),ie.splice(ie.lastIndexOf(X,ie.length-$),1)):$++,ue=ie[ie.length-oe],j.push({command:zi.addImport,args:[ne[X],ue]}),ie.splice(ie.length-oe,0,X));for(let le of U){let ge=H[le.id];ge&&!k(ge,le)&&j.push({command:zi.updateImport,args:[le.id,le]})}}(b.imports,w.imports,S),k(b.transition,w.transition)||S.push({command:zi.setTransition,args:[w.transition]}),k(b.light,w.light)||S.push({command:zi.setLight,args:[w.light]}),k(b.fog,w.fog)||S.push({command:zi.setFog,args:[w.fog]}),k(b.projection,w.projection)||S.push({command:zi.setProjection,args:[w.projection]}),k(b.lights,w.lights)||S.push({command:zi.setLights,args:[w.lights]}),k(b.camera,w.camera)||S.push({command:zi.setCamera,args:[w.camera]});let C={},R=[];(function(B,U,j,G){let q;for(q in U=U||{},B=B||{})B.hasOwnProperty(q)&&(U.hasOwnProperty(q)||zl(q,j,G));for(q in U){if(!U.hasOwnProperty(q))continue;let H=U[q];B.hasOwnProperty(q)?k(B[q],H)||(B[q].type==="geojson"&&H.type==="geojson"&&Do(B,U,q)?j.push({command:zi.setGeoJSONSourceData,args:[q,H.data]}):mu(q,U,j,G)):Ca(q,U,j)}})(b.sources,w.sources,R,C);let O=[];b.layers&&b.layers.forEach(B=>{B.source&&C[B.source]?S.push({command:zi.removeLayer,args:[B.id]}):O.push(B)});let F=b.terrain;F&&C[F.source]&&(S.push({command:zi.setTerrain,args:[void 0]}),F=void 0),S=S.concat(R),k(F,w.terrain)||S.push({command:zi.setTerrain,args:[w.terrain]}),function(B,U,j){U=U||[];let G=(B=B||[]).map(Aa),q=U.map(Aa),H=B.reduce(Bl,{}),ne=U.reduce(Bl,{}),ie=G.slice(),oe=Object.create(null),$,X,ue,le,ge,Me,me;for($=0,X=0;$<G.length;$++)ue=G[$],ne.hasOwnProperty(ue)?X++:(j.push({command:zi.removeLayer,args:[ue]}),ie.splice(ie.indexOf(ue,X),1));for($=0,X=0;$<q.length;$++)ue=q[q.length-1-$],ie[ie.length-1-$]!==ue&&(H.hasOwnProperty(ue)?(j.push({command:zi.removeLayer,args:[ue]}),ie.splice(ie.lastIndexOf(ue,ie.length-X),1)):X++,Me=ie[ie.length-$],j.push({command:zi.addLayer,args:[ne[ue],Me]}),ie.splice(ie.length-$,0,ue),oe[ue]=!0);for($=0;$<q.length;$++)if(ue=q[$],le=H[ue],ge=ne[ue],!oe[ue]&&!k(le,ge))if(k(le.source,ge.source)&&k(le["source-layer"],ge["source-layer"])&&k(le.type,ge.type)){for(me in na(le.layout,ge.layout,j,ue,null,zi.setLayoutProperty),na(le.paint,ge.paint,j,ue,null,zi.setPaintProperty),k(le.slot,ge.slot)||j.push({command:zi.setSlot,args:[ue,ge.slot]}),k(le.filter,ge.filter)||j.push({command:zi.setFilter,args:[ue,ge.filter]}),k(le.minzoom,ge.minzoom)&&k(le.maxzoom,ge.maxzoom)||j.push({command:zi.setLayerZoomRange,args:[ue,ge.minzoom,ge.maxzoom]}),le)le.hasOwnProperty(me)&&me!=="layout"&&me!=="paint"&&me!=="filter"&&me!=="metadata"&&me!=="minzoom"&&me!=="maxzoom"&&me!=="slot"&&(me.indexOf("paint.")===0?na(le[me],ge[me],j,ue,me.slice(6),zi.setPaintProperty):k(le[me],ge[me])||j.push({command:zi.setLayerProperty,args:[ue,me,ge[me]]}));for(me in ge)ge.hasOwnProperty(me)&&!le.hasOwnProperty(me)&&me!=="layout"&&me!=="paint"&&me!=="filter"&&me!=="metadata"&&me!=="minzoom"&&me!=="maxzoom"&&me!=="slot"&&(me.indexOf("paint.")===0?na(le[me],ge[me],j,ue,me.slice(6),zi.setPaintProperty):k(le[me],ge[me])||j.push({command:zi.setLayerProperty,args:[ue,me,ge[me]]}))}else j.push({command:zi.removeLayer,args:[ue]}),Me=ie[ie.lastIndexOf(ue)+1],j.push({command:zi.addLayer,args:[ge,Me]})}(O,w.layers,S)}catch(C){console.warn("Unable to compute style diff:",C),S=[{command:zi.setStyle,args:[w]}]}return S}(this.serialize(),n).filter(b=>!(b.command in Nh));if(u.length===0)return!1;let m=u.filter(b=>!(b.command in pl));if(m.length>0)throw new Error(`Unimplemented: ${m.map(b=>b.command).join(", ")}.`);let _=[];return u.forEach(b=>{_.push(this[b.command].apply(this,b.args))}),s&&Promise.all(_).then(s),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(n,s){return this.getImage(n)?this.fire(new r.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,this.scope,s),this._afterImageUpdated(n),this)}updateImage(n,s){this.imageManager.updateImage(n,this.scope,s)}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._afterImageUpdated(n),this):this.fire(new r.a(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(n),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new r.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(n,s,u={}){return this._checkLoaded(),this._validate(Mt,`models.${n}`,s,null,u)||(this.modelManager.addModel(n,s,this.scope),this._changes.setDirty()),this}hasModel(n){return this.modelManager.hasModel(n,this.scope)}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.scope),this):this.fire(new r.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(n,s,u={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(Mo,`sources.${n}`,s,null,u))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);let m=Go(n,s,this.dispatcher,this);m.scope=this.scope,m.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(m.id),source:m.serialize(),sourceId:m.id}));let _=b=>{let w=(b?"symbol:":"other:")+m.id,S=r.aj(w,this.scope),C=this._sourceCaches[w]=new qo(S,m,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[m.id]=C,C.onAdd(this.map)};_(!1),s.type!=="vector"&&s.type!=="geojson"||_(!0),m.onAdd&&m.onAdd(this.map),u.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();let s=this.getOwnSource(n);if(!s)throw new Error("There is no source with this ID");for(let m in this._layers)if(this._layers[m].source===n)return this.fire(new r.a(new Error(`Source "${n}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new r.a(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));let u=this.getOwnSourceCaches(n);for(let m of u){let _=r.c8(m.id);delete this._sourceCaches[_],this._changes.discardSourceCacheUpdate(m.id),m.fire(new r.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,s){this._checkLoaded(),this.getOwnSource(n).setData(s),this._changes.setDirty()}getOwnSource(n){let s=this.getOwnSourceCache(n);return s&&s.getSource()}getOwnSources(){let n=[];for(let s in this._otherSourceCaches){let u=this.getOwnSourceCache(s);u&&n.push(u.getSource())}return n}areTilesLoaded(){let n=this._mergedSourceCaches;for(let s in n){let u=n[s]._tiles;for(let m in u){let _=u[m];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;let s=this._getTransitionParameters();for(let m of n){if(this._validate(et,"lights",m))return;switch(m.type){case"ambient":if(this.ambientLight){let _=this.ambientLight;_.set(m),_.updateTransitions(s)}else this.ambientLight=new Fr(m,Uo,this.scope,this.options);break;case"directional":if(this.directionalLight){let _=this.directionalLight;_.set(m),_.updateTransitions(s)}else this.directionalLight=new Fr(m,Yn,this.scope,this.options)}}let u=new r.N(this.z||0,s);this.ambientLight&&this.ambientLight.recalculate(u),this.directionalLight&&this.directionalLight.recalculate(u),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let n=this.directionalLight,s=this.ambientLight;if(!n||!s)return;let u=O=>.2126*(O[0]<=.03928?O[0]/12.92:Math.pow((O[0]+.055)/1.055,2.4))+.7152*(O[1]<=.03928?O[1]/12.92:Math.pow((O[1]+.055)/1.055,2.4))+.0722*(O[2]<=.03928?O[2]/12.92:Math.pow((O[2]+.055)/1.055,2.4)),m=n.properties.get("color").toArray01(),_=n.properties.get("intensity"),b=n.properties.get("direction"),w=1-r.bT(b.x,b.y,b.z)[2]/90,S=u(m)*_*w,C=s.properties.get("color").toArray01(),R=s.properties.get("intensity");return(S+u(C)*R)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(!n)return this;if(r.c9(n)){let s=r.ca(n),u=this.fragments.find(({id:_})=>_===s);if(!u)throw new Error(`Style import not found: ${n}`);let m=r.c8(n);return u.style.getFragmentStyle(m)}{let s=this.fragments.find(({id:u})=>u===n);if(!s)throw new Error(`Style import not found: ${n}`);return s.style}}getConfigProperty(n,s){let u=this.getFragmentStyle(n);if(!u)return null;let m=r.aj(s,u.scope),_=u.options.get(m),b=_?_.value||_.default:null;return b?b.serialize():null}setConfigProperty(n,s,u){let m=this.getFragmentStyle(n);if(!m)return;let _=m.stylesheet.schema;if(!_||!_[s])return;let b=r.t(u);if(b.result!=="success")return void Wr(this,b.value);let w=b.value.expression,S=r.aj(s,m.scope),C=m.options.get(S);if(!C)return;let R,{minValue:O,maxValue:F,stepValue:B,type:U,values:j}=_[s],G=r.t(_[s].default);G.result==="success"&&(R=G.value.expression),R?(this.options.set(S,fr(Vt({},C),{value:w,default:R,minValue:O,maxValue:F,stepValue:B,type:U,values:j})),this.updateConfigDependencies()):this.fire(new r.a(new Error(`No schema defined for the config option "${s}" in the "${n}" fragment.`)))}getConfig(n){let s=this.getFragmentStyle(n);if(!s)return null;let u=s.stylesheet.schema;if(!u)return null;let m={};for(let _ in u){let b=r.aj(_,s.scope),w=s.options.get(b),S=w?w.value||w.default:null;m[_]=S?S.serialize():null}return m}setConfig(n,s){let u=this.getFragmentStyle(n);u&&(u.updateConfig(s,u.stylesheet.schema),this.updateConfigDependencies())}getSchema(n){let s=this.getFragmentStyle(n);return s?s.stylesheet.schema:null}setSchema(n,s){let u=this.getFragmentStyle(n);u&&(u.stylesheet.schema=s,u.updateConfig(u._config,s),this.updateConfigDependencies())}updateConfig(n,s){if(this._config=n,n||s)if(s)for(let u in s){let m,_,b=r.t(s[u].default);if(b.result==="success"&&(m=b.value.expression),n&&n[u]!==void 0){let F=r.t(n[u]);F.result==="success"&&(_=F.value.expression)}let{minValue:w,maxValue:S,stepValue:C,type:R,values:O}=s[u];if(m){let F=r.aj(u,this.scope);this.options.set(F,{default:m,value:_,minValue:w,maxValue:S,stepValue:C,type:R,values:O})}else this.fire(new r.a(new Error(`No schema defined for config option "${u}".`)))}else this.fire(new r.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let n of this._configDependentLayers){let s=this.getLayer(n);s&&(s.possiblyEvaluateVisibility(),this._updateLayer(s))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(n,s,u={}){this._checkLoaded();let m=n.id;if(this._layers[m])return void this.fire(new r.a(new Error(`Layer with id "${m}" already exists on this map`)));let _;if(n.type==="custom"){if(Wr(this,r.cb(n)))return;_=r.c7(n,this.scope,this.options)}else{if(typeof n.source=="object"&&(this.addSource(m,n.source),n=r.c6(n),n=r.e(n,{source:m})),this._validate(_e,`layers.${m}`,n,{arrayIndex:-1},u))return;_=r.c7(n,this.scope,this.options),this._validateLayer(_),_.setEventedParent(this,{layer:{id:m}}),this._serializedLayers[_.id]=_.serialize()}_.isConfigDependent&&this._configDependentLayers.add(_.fqid);let b=this._order.length;if(s){let R=this._order.indexOf(s);if(R===-1)return void this.fire(new r.a(new Error(`Layer with id "${s}" does not exist on this map.`)));_.slot===this._layers[s].slot?b=R:r.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,m),this._layerOrderChanged=!0,this._layers[m]=_;let w=this.getOwnLayerSourceCache(_),S=!!this.directionalLight&&this.directionalLight.shadowsEnabled();w&&_.canCastShadows()&&S&&(w.castsShadows=!0);let C=this._changes.getRemovedLayer(_);if(C&&_.source&&w&&_.type!=="custom"){this._changes.discardLayerRemoval(_);let R=r.aj(_.source,_.scope);C.type!==_.type?this._changes.updateSourceCache(R,"clear"):(this._changes.updateSourceCache(R,"reload"),w.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),_.scope=this.scope,this.mergeLayers()}moveLayer(n,s){this._checkLoaded();let u=this._checkLayer(n);if(!u||n===s)return;let m=this._order.indexOf(n);this._order.splice(m,1);let _=this._order.length;if(s){let b=this._order.indexOf(s);if(b===-1)return void this.fire(new r.a(new Error(`Layer with id "${s}" does not exist on this map.`)));u.slot===this._layers[s].slot?_=b:r.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(_,0,n),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(n){this._checkLoaded();let s=this._checkLayer(n);if(!s)return;s.setEventedParent(null);let u=this._order.indexOf(n);this._order.splice(u,1),delete this._layers[n],delete this._serializedLayers[n],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(s.fqid),this._changes.removeLayer(s);let m=this.getOwnLayerSourceCache(s);if(m&&m.castsShadows){let _=!1;for(let b in this._layers)if(this._layers[b].source===s.source&&this._layers[b].canCastShadows()){_=!0;break}m.castsShadows=_}s.onRemove&&s.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(let s in this._layers)if(this._layers[s].type===n)return!0;return!1}setLayerZoomRange(n,s,u){this._checkLoaded();let m=this._checkLayer(n);m&&(m.minzoom===s&&m.maxzoom===u||(s!=null&&(m.minzoom=s),u!=null&&(m.maxzoom=u),this._updateLayer(m)))}setSlot(n,s){this._checkLoaded();let u=this._checkLayer(n);u&&u.slot!==s&&(u.slot=s,this._updateLayer(u))}setFilter(n,s,u={}){this._checkLoaded();let m=this._checkLayer(n);if(m&&!k(m.filter,s))return s==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(Ge,`layers.${m.id}.filter`,s,{layerType:m.type},u)||(m.filter=r.c6(s),this._updateLayer(m)))}getFilter(n){let s=this._checkLayer(n);if(s)return r.c6(s.filter)}setLayoutProperty(n,s,u,m={}){this._checkLoaded();let _=this._checkLayer(n);if(_&&!k(_.getLayoutProperty(s),u)){if(u!=null&&(!m||m.validate!==!1)&&Wr(_,nt.call(Wt,{key:`layers.${n}.layout.${s}`,layerType:_.type,objectKey:s,value:u,styleSpec:r.G,style:{glyphs:!0,sprite:!0}})))return;_.setLayoutProperty(s,u),_.isConfigDependent&&this._configDependentLayers.add(_.fqid),this._updateLayer(_)}}getLayoutProperty(n,s){let u=this._checkLayer(n);if(u)return u.getLayoutProperty(s)}setPaintProperty(n,s,u,m={}){this._checkLoaded();let _=this._checkLayer(n);if(!_||k(_.getPaintProperty(s),u)||u!=null&&(!m||m.validate!==!1)&&Wr(_,Ze.call(Wt,{key:`layers.${n}.paint.${s}`,layerType:_.type,objectKey:s,value:u,styleSpec:r.G})))return;let b=_.setPaintProperty(s,u);_.isConfigDependent&&this._configDependentLayers.add(_.fqid),b&&this._updateLayer(_),this._changes.updatePaintProperties(_)}getPaintProperty(n,s){let u=this._checkLayer(n);if(u)return u.getPaintProperty(s)}setFeatureState(n,s){this._checkLoaded();let u=n.source,m=n.sourceLayer,_=this._checkSource(u);if(!_)return;let b=_.type;if(b==="geojson"&&m)return void this.fire(new r.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(b==="vector"&&!m)return void this.fire(new r.a(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new r.a(new Error("The feature id parameter must be provided.")));let w=this.getOwnSourceCaches(u);for(let S of w)S.setFeatureState(m,n.id,s)}removeFeatureState(n,s){this._checkLoaded();let u=n.source,m=this._checkSource(u);if(!m)return;let _=m.type,b=_==="vector"?n.sourceLayer:void 0;if(_==="vector"&&!b)return void this.fire(new r.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new r.a(new Error("A feature id is required to remove its specific state property.")));let w=this.getOwnSourceCaches(u);for(let S of w)S.removeFeatureState(b,n.id,s)}getFeatureState(n){this._checkLoaded();let s=n.source,u=n.sourceLayer,m=this._checkSource(s);if(m){if(m.type!=="vector"||u)return n.id===void 0&&this.fire(new r.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(s)[0].getFeatureState(u,n.id);this.fire(new r.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=r.e({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return r.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();let n=this.getTerrain(),s=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return r.cc({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:s,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},u=>u!==void 0)}_updateLayer(n){this._changes.updateLayer(n);let s=this.getLayerSourceCache(n),u=r.aj(n.source,n.scope),m=this._changes.getUpdatedSourceCaches();n.source&&!m[u]&&s&&s.getSource().type!=="raster"&&(this._changes.updateSourceCache(u,"reload"),s.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){let s=w=>this._mergedLayers[w].type==="fill-extrusion"||this._mergedLayers[w].type==="model",u=this.order,m={},_=[];for(let w=u.length-1;w>=0;w--){let S=u[w];if(s(S)){m[S]=w;for(let C of n){let R=C[S];if(R)for(let O of R)_.push(O)}}}_.sort((w,S)=>S.intersectionZ-w.intersectionZ);let b=[];for(let w=u.length-1;w>=0;w--){let S=u[w];if(s(S))for(let C=_.length-1;C>=0;C--){let R=_[C].feature;if(m[R.layer.id]<w)break;b.push(R),_.pop()}else for(let C of n){let R=C[S];if(R)for(let O of R)b.push(O.feature)}}return b}queryRenderedFeatures(n,s,u){s&&s.filter&&this._validate(Ge,"queryRenderedFeatures.filter",s.filter,null,s),s.scope=this.scope,s.availableImages=this._availableImages,s.serializedLayers=this._serializedLayers;let m={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new r.a(new Error("parameters.layers must be an Array."))),[];for(let C of s.layers){let R=this._mergedLayers[C];if(!R)return this.fire(new r.a(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];m[R.source]=!0}}let _=[],b=s.serializedLayers||{},w=s&&s.layers?s.layers.some(C=>{let R=this.getLayer(C);return R&&R.is3D()}):this.has3DLayers(),S=Dn.createFromScreenPoints(n,u);for(let C in this._mergedSourceCaches){let R=this._mergedSourceCaches[C].getSource();if(!R||R.scope!==s.scope)continue;let O=this._mergedSourceCaches[C].getSource().id;s.layers&&!m[O]||_.push(Si(this._mergedSourceCaches[C],this._mergedLayers,b,S,s,u,w,!!this.map._showQueryGeometry))}return this.placement&&_.push(function(C,R,O,F,B,U,j){let G={},q=U.queryRenderedSymbols(F),H=[];for(let ne of Object.keys(q).map(Number))H.push(j[ne]);H.sort(dc);for(let ne of H){let ie=ne.featureIndex.lookupSymbolFeatures(q[ne.bucketInstanceId],R,ne.bucketIndex,ne.sourceLayerIndex,B.filter,B.layers,B.availableImages,C);for(let oe in ie){let $=G[oe]=G[oe]||[],X=ie[oe];X.sort((ue,le)=>{let ge=ne.featureSortOrder;if(ge){let Me=ge.indexOf(ue.featureIndex);return ge.indexOf(le.featureIndex)-Me}return le.featureIndex-ue.featureIndex});for(let ue of X)$.push(ue)}}for(let ne in G)G[ne].forEach(ie=>{let oe=ie.feature,$=O(C[ne]);if(!$)return;let X=$.getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=X});return G}(this._mergedLayers,b,this.getLayerSourceCache.bind(this),S.screenGeometry,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(n,s){s&&s.filter&&this._validate(Ge,"querySourceFeatures.filter",s.filter,null,s);let u=this.getOwnSourceCaches(n),m=[];for(let _ of u)m=m.concat(zr(_,s));return m}addSourceType(n,s,u){return Qi.getSourceType(n)?u(new Error(`A source type called "${n}" already exists.`)):(Qi.setSourceType(n,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:s.workerSourceURL},u):u(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,s,u={}){this._checkLoaded();let m=this.light.getLight(),_=!1;for(let w in n)if(!k(n[w],m[w])){_=!0;break}if(!_)return;let b=this._getTransitionParameters();this.light.setLight(n,s,u),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,s=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()&&s!==0||delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let u=n,m=n.source==null;if(s===1){if(typeof u.source=="object"){let w="terrain-dem-src";this.addSource(w,u.source),u=r.c6(u),u=r.e(u,{source:w})}let _=r.e({},u),b={};if(this.terrain&&m){_.source=this.terrain.get().source;let w=this.terrain?this.getFragmentStyle(this.terrain.scope):null;w&&(b.style=w.serialize())}if(this._validate(J,"terrain",_,b))return}if(!this.terrain||this.terrain.scope!==this.scope&&!m||this.terrain&&s!==this.terrain.drapeRenderMode){if(!u)return;this._createTerrain(u,s),this.fire(new r.b("data",{dataType:"style"}))}else{let _=this.terrain,b=_.get();for(let w of Object.keys(r.G.terrain))!u.hasOwnProperty(w)&&r.G.terrain[w].default&&(u[w]=r.G.terrain[w].default);for(let w in n)if(!k(n[w],b[w])){_.set(n,this.options),this.stylesheet.terrain=n;let S=this._getTransitionParameters({duration:0});_.updateTransitions(S),this.fire(new r.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){let s=this.fog=new Lr(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=s.get();let u=this._getTransitionParameters({duration:0});s.updateTransitions(u)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let s=this.fog;if(!k(s.get(),n)){s.set(n,this.options),this.stylesheet.fog=s.get();let u=this._getTransitionParameters({duration:0});s.updateTransitions(u)}}else this._createFog(n);this._markersNeedUpdate=!0}_getTransitionParameters(n){return{now:r.f.now(),transition:r.e(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;let n=[],s=[];for(let u in this._mergedLayers)this.isLayerDraped(this._mergedLayers[u])?n.push(u):s.push(u);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...s)}_createTerrain(n,s){let u=this.terrain=new tn(n,s,this.scope,this.options);s===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let m=this._getTransitionParameters({duration:0});u.updateTransitions(m)}_force3DLayerUpdate(){for(let n in this._layers){let s=this._layers[n];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(let n in this._layers){let s=this._layers[n];s.type==="symbol"&&this._updateLayer(s)}}_validate(n,s,u,m,_={}){if(_&&_.validate===!1)return!1;let b=r.e({},this.serialize());return Wr(this,n.call(Wt,r.e({key:s,style:b,value:u,styleSpec:r.G},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.cd.off("pluginStateChange",this._rtlTextPluginCallback);for(let n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(let n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(n){let s=this.getSourceCaches(n);for(let u of s)u.clearTiles()}clearSources(){for(let n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}reloadSource(n){let s=this.getSourceCaches(n);for(let u of s)u.resume(),u.reload()}reloadSources(){for(let n of this.getSources())n.reload&&n.reload()}updateSources(n){let s;this.directionalLight&&(s=ko(this.directionalLight));for(let u in this._mergedSourceCaches)this._mergedSourceCaches[u].update(n,void 0,void 0,s)}_generateCollisionBoxes(){for(let n in this._sourceCaches){let s=this._sourceCaches[n];s.resume(),s.reload()}}_updatePlacement(n,s,u,m,_=!1){let b=!1,w=!1,S={},C={};for(let R of this._mergedOrder){let O=this._mergedLayers[R];if(O.type!=="symbol")continue;let F=r.aj(O.source,O.scope),B=S[F];if(!B){let j=this.getLayerSourceCache(O);if(!j)continue;let G=j.getRenderableIds(!0).map(q=>j.getTileByID(q));C[F]=G.slice(),B=S[F]=G.sort((q,H)=>H.tileID.overscaledZ-q.tileID.overscaledZ||(q.tileID.isLessThan(H.tileID)?-1:1))}let U=this.crossTileSymbolIndex.addLayer(O,B,n.center.lng,n.projection);b=b||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),_=_||this._layerOrderChanged||u===0,this._layerOrderChanged&&this.fire(new r.b("neworder")),(_||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.f.now(),n.zoom))&&(this.pauseablePlacement=new la(n,this._mergedOrder,_,s,u,m,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,S,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.f.now()),w=!0),b&&this.pauseablePlacement.placement.setStale()),w||b){this._buildingIndex.onNewFrame(n.zoom);for(let R of this._mergedOrder){let O=this._mergedLayers[R];O.type==="symbol"&&this.placement.updateLayerOpacities(O,S[r.aj(O.source,O.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.f.now())}_releaseSymbolFadeTiles(){for(let n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,s){this._checkLoaded();let u=this.stylesheet.imports=this.stylesheet.imports||[];if(u.findIndex(({id:_})=>_===n.id)!==-1)return void this.fire(new r.a(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!s)return u.push(n),this._loadImports([n],!0);let m=u.findIndex(({id:_})=>_===s);return m===-1&&this.fire(new r.a(new Error(`Import with id "${s}" does not exist on this map.`))),this.stylesheet.imports=u.slice(0,m).concat(n).concat(u.slice(m)),this._loadImports([n],!0,s)}updateImport(n,s){this._checkLoaded();let u=this.stylesheet.imports||[],m=this.getImportIndex(n);return m===-1?this:typeof s=="string"?(this.setImportUrl(n,s),this):(s.url&&s.url!==u[m].url&&this.setImportUrl(n,s.url),k(s.config,u[m].config)||this.setImportConfig(n,s.config),k(s.data,u[m].data)||this.setImportData(n,s.data),this)}moveImport(n,s){this._checkLoaded();let u=this.stylesheet.imports||[],m=this.getImportIndex(n);if(m===-1)return this;let _=this.getImportIndex(s);if(_===-1)return this;let b=u[m],w=this.fragments[m];return u=u.filter(({id:S})=>S!==n),this.fragments=this.fragments.filter(({id:S})=>S!==n),this.stylesheet.imports=u.slice(0,_).concat(b).concat(u.slice(_)),this.fragments=this.fragments.slice(0,_).concat(w).concat(this.fragments.slice(_)),this.mergeLayers(),this}setImportUrl(n,s){this._checkLoaded();let u=this.stylesheet.imports||[],m=this.getImportIndex(n);if(m===-1)return this;u[m].url=s;let _=this.fragments[m];return _.style=this._createFragmentStyle(u[m]),_.style.on("style.import.load",()=>this.mergeAll()),_.style.loadURL(s),this}setImportData(n,s){this._checkLoaded();let u=this.getImportIndex(n),m=this.stylesheet.imports||[];return u===-1?this:s?(this.fragments[u].style.setState(s),this._reloadImports(),this):(delete m[u].data,this.setImportUrl(n,m[u].url))}setImportConfig(n,s){this._checkLoaded();let u=this.getImportIndex(n),m=this.stylesheet.imports||[];if(u===-1)return this;s?m[u].config=s:delete m[u].config;let _=this.fragments[u],b=_.style.stylesheet&&_.style.stylesheet.schema;return _.config=s,_.style.updateConfig(s,b),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();let s=this.stylesheet.imports||[],u=this.getImportIndex(n);u!==-1&&(s.splice(u,1),this.fragments[u].style._remove(),this.fragments.splice(u,1),this._reloadImports())}getImportIndex(n){let s=(this.stylesheet.imports||[]).findIndex(u=>u.id===n);return s===-1&&this.fire(new r.a(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),s}getLayer(n){return this._mergedLayers[n]}getSources(){let n=[];for(let s in this._mergedOtherSourceCaches){let u=this._mergedOtherSourceCaches[s];u&&n.push(u.getSource())}return n}getSource(n,s){let u=this.getSourceCache(n,s);return u&&u.getSource()}getLayerSource(n){let s=this.getLayerSourceCache(n);return s&&s.getSource()}getSourceCache(n,s){let u=r.aj(n,s);return this._mergedOtherSourceCaches[u]}getLayerSourceCache(n){let s=r.aj(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[s]:this._mergedOtherSourceCaches[s]}getSourceCaches(n){if(n==null)return Object.values(this._mergedSourceCaches);let s=[];return this._mergedOtherSourceCaches[n]&&s.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&s.push(this._mergedSymbolSourceCaches[n]),s}updateSourceCaches(){let n=this._changes.getUpdatedSourceCaches();for(let s in n){let u=n[s];u==="reload"?this.reloadSource(s):u==="clear"&&this.clearSource(s)}}updateLayers(n){let s=this._changes.getUpdatedPaintProperties();for(let u of s){let m=this.getLayer(u);m&&m.updateTransitions(n)}}getImages(n,s,u){this.imageManager.getImages(s.icons,s.scope,u),this._updateTilesForChangedImages();let m=_=>{_&&_.setDependencies(s.tileID.key,s.type,s.icons)};m(this._otherSourceCaches[s.source]),m(this._symbolSourceCaches[s.source])}getGlyphs(n,s,u){this.glyphManager.getGlyphs(s.stacks,s.scope,u)}getResource(n,s,u){return r.ce(s,u)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){let s=[];return this._otherSourceCaches[n]&&s.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&s.push(this._symbolSourceCaches[n]),s}_isSourceCacheLoaded(n){let s=this.getOwnSourceCaches(n);return s.length===0?(this.fire(new r.a(new Error(`There is no source with ID '${n}'`))),!1):s.every(u=>u.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(n=>{n.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Qi.getSourceType=function(c){return ct[c]},Qi.setSourceType=function(c,n){ct[c]=n},Qi.registerForPluginStateChange=r.bY;var dn=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,fl=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,Ho=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,ms="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Zr=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Hr=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,gs=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Fs=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Va=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec4 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,_s=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,ys=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let Wi=[];Qo(dn,Wi),Qo(Ho,Wi),Qo(fl,Wi);let si={"_prelude_fog.vertex.glsl":Hr,"_prelude_terrain.vertex.glsl":Zr,"_prelude_shadow.vertex.glsl":_s,"_prelude_fog.fragment.glsl":gs,"_prelude_shadow.fragment.glsl":ys,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Fs,"_prelude_raster_particle.glsl":Va},ja={};ci("",Zr),ci(gs,Hr),ci(ys,_s),ci(Fs,""),ci(Va,"");let ua=ci(fl,Ho),Ua=dn;var Oo={background:ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ci("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ci(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ci(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ci("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ci("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ci("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:ci(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:ci(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:ci(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:ci(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform mediump float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size.x/aspect;float segment_phase=pattern_len-mod((v_linesofar-v_pattern_data.x),pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in float a_linesofar;
#ifdef LINE_JOIN_NONE
in vec2 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform mediump float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width+=ANTIALIASING;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5/u_tile_units_to_pixels;v_linesofar+=line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:ci("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:ci("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:ci(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp float speed=velocity==INVALID_VELOCITY ? 0.0 : length(velocity);highp float reset_rate_bump=speed*u_reset_rate;highp vec2 particle_pos_min=-u_particle_pos_offset;highp vec2 particle_pos_max=vec2(1.0)+u_particle_pos_offset;highp vec2 pos_drop_rate=vec2(1.0)-step(particle_pos_min,pos)+step(particle_pos_max,pos);highp float drop_rate=max(u_reset_rate+reset_rate_bump,length(pos_drop_rate));highp float drop=step(1.0-drop_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:ci(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:ci(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:ci(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:ci("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:ci(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ms),skyboxGradient:ci(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ms),skyboxCapture:ci(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ci(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:ci(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:ci(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function Qo(c,n){let s=c.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let u of s)if(u=u.trim(),u[0]==="#"&&u.includes("if")&&!u.includes("endif")){u=u.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let m=u.split(" ");for(let _ of m)n.includes(_)||n.push(_)}}function ci(c,n){let s=/#include\s+"([^"]+)"/g,u=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,m=n.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);m&&(m=m.map(C=>{let R=C.split(" ");return R[R.length-1]}),m=[...new Set(m)]);let _={},b=[],w=[];if(c=c.replace(s,(C,R)=>(w.push(R),"")),(n=n.replace(s,(C,R)=>(b.push(R),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let S=[...Wi];Qo(c,S),Qo(n,S);for(let C of[...b,...w])si[C]||console.error(`Undefined include: ${C}`),ja[C]||(ja[C]=[],Qo(si[C],ja[C])),S=[...S,...ja[C]];return{fragmentSource:c=c.replace(u,(C,R,O,F,B)=>(_[B]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${B}
in ${O} ${F} ${B};
#else
uniform ${O} ${F} u_${B};
#endif
`:R==="initialize"?`
#ifdef HAS_UNIFORM_u_${B}
    ${O} ${F} ${B} = u_${B};
#endif
`:R==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    in ${O} ${F} ${B};
#endif
`:R==="initialize-attribute"?"":void 0)),vertexSource:n=n.replace(u,(C,R,O,F,B)=>{let U=F==="float"?"vec2":F,j=B.match(/color/)?"color":U;return R==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${B}
in ${O} ${F} a_${B};
#endif
`:_[B]?R==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
in ${O} ${U} a_${B};
out ${O} ${F} ${B};
#else
uniform ${O} ${F} u_${B};
#endif
`:R==="initialize"?j==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${O} ${F} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${j}(a_${B}, u_${B}_t);
#else
    ${O} ${F} ${B} = u_${B};
#endif
`:R==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    in ${O} ${F} a_${B};
    out ${O} ${F} ${B};
#endif
`:R==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    ${B} = a_${B};
#endif
`:void 0:R==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
in ${O} ${U} a_${B};
#else
uniform ${O} ${F} u_${B};
#endif
`:R==="define-instanced"?j==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${B}0;
in vec4 a_${B}1;
in vec4 a_${B}2;
in vec4 a_${B}3;
#else
uniform ${O} ${F} u_${B};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${O} ${U} a_${B};
#else
uniform ${O} ${F} u_${B};
#endif
`:R==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    ${O} ${F} ${B} = a_${B};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${O} ${F} ${B} = a_${B};
#else
    ${O} ${F} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${O} ${F} ${B} = unpack_mix_${j}(a_${B}, u_${B}_t);
#else
    ${O} ${F} ${B} = u_${B};
#endif
`}),staticAttributes:m,usedDefines:S,vertexIncludes:b,fragmentIncludes:w}}class vt{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,s,u,m,_,b,w,S){this.context=n;let C=this.boundPaintVertexBuffers.length!==m.length;for(let O=0;!C&&O<m.length;O++)this.boundPaintVertexBuffers[O]!==m[O]&&(C=!0);let R=this.boundDynamicVertexBuffers.length!==w.length;for(let O=0;!R&&O<w.length;O++)this.boundDynamicVertexBuffers[O]!==w[O]&&(R=!0);if(!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==u||C||R||this.boundIndexBuffer!==_||this.boundVertexOffset!==b)this.freshBind(s,u,m,_,b,w,S);else{n.bindVertexArrayOES.set(this.vao);for(let O of w)O&&(O.bind(),S&&O.instanceCount&&O.setVertexAttribDivisor(n.gl,s,S));_&&_.dynamicDraw&&_.bind()}}freshBind(n,s,u,m,_,b,w){let S=n.numAttributes,C=this.context,R=C.gl;this.vao&&this.destroy(),this.vao=C.gl.createVertexArray(),C.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=m,this.boundVertexOffset=_,this.boundDynamicVertexBuffers=b,s.enableAttributes(R,n),s.bind(),s.setVertexAttribPointers(R,n,_);for(let O of u)O.enableAttributes(R,n),O.bind(),O.setVertexAttribPointers(R,n,_);for(let O of b)O&&(O.enableAttributes(R,n),O.bind(),O.setVertexAttribPointers(R,n,_),w&&O.instanceCount&&O.setVertexAttribDivisor(R,n,w));m&&m.bind(),C.currentNumAttributes=S}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Zi(c,n){let s=Math.pow(2,n.canonical.z),u=n.canonical.y;return[new r.O(0,u/s).toLngLat().lat,new r.O(0,(u+1)/s).toLngLat().lat]}function Hi(c,n,s,u,m,_,b){let w=c.context,S=w.gl,C=s.hillshadeFBO;if(!C)return;c.prepareDrawTile();let R=c.isTileAffectedByFog(n),O=c.getOrCreateProgram("hillshade",{overrideFog:R});w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,C.colorAttachment.get());let F=((G,q,H,ne)=>{let ie=H.paint.get("hillshade-shadow-color"),oe=H.paint.get("hillshade-highlight-color"),$=H.paint.get("hillshade-accent-color"),X=H.paint.get("hillshade-emissive-strength"),ue=r.bm(H.paint.get("hillshade-illumination-direction"));if(H.paint.get("hillshade-illumination-anchor")==="viewport")ue-=G.transform.angle;else if(G.style&&G.style.enable3dLights()&&G.style.directionalLight){let ge=G.style.directionalLight.properties.get("direction"),Me=r.bT(ge.x,ge.y,ge.z);ue=r.bm(Me[1])}let le=!G.options.moving;return{u_matrix:ne||G.transform.calculateProjMatrix(q.tileID.toUnwrapped(),le),u_image:0,u_latrange:Zi(0,q.tileID),u_light:[H.paint.get("hillshade-exaggeration"),ue],u_shadow:ie,u_highlight:oe,u_emissive_strength:X,u_accent:$}})(c,s,u,c.terrain?n.projMatrix:null);c.uploadCommonUniforms(w,O,n.toUnwrapped());let{tileBoundsBuffer:B,tileBoundsIndexBuffer:U,tileBoundsSegments:j}=c.getTileBoundsBuffers(s);O.draw(c,S.TRIANGLES,m,_,b,Tt.disabled,F,u.id,B,U,j)}function Xo(c,n,s){if(!n.needsDEMTextureUpload)return;let u=c.context,m=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||c.getTileTexture(s.stride);let _=s.getPixels();n.demTexture?n.demTexture.update(_,{premultiply:!1}):n.demTexture=new r.T(u,_,m.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function yc(c,n,s){let u=c.context,m=u.gl;if(!n.dem)return;let _=n.dem;if(u.activeTexture.set(m.TEXTURE1),Xo(c,n,_),!n.demTexture)return;n.demTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE);let b=_.dim;u.activeTexture.set(m.TEXTURE0);let w=n.hillshadeFBO;if(!w){let F=new r.T(u,{width:b,height:b,data:null},m.RGBA);F.bind(m.LINEAR,m.CLAMP_TO_EDGE),w=n.hillshadeFBO=u.createFramebuffer(b,b,!0,"renderbuffer"),w.colorAttachment.set(F.texture)}u.bindFramebuffer.set(w.framebuffer),u.viewport.set([0,0,b,b]);let{tileBoundsBuffer:S,tileBoundsIndexBuffer:C,tileBoundsSegments:R}=c.getMercatorTileBoundsBuffers(),O=[];c.linearFloatFilteringSupported()&&O.push("TERRAIN_DEM_FLOAT_FORMAT"),c.getOrCreateProgram("hillshadePrepare",{defines:O}).draw(c,m.TRIANGLES,ze.disabled,kt.disabled,qt.unblended,Tt.disabled,((F,B)=>{let U=B.stride,j=r.a9.create();return r.a9.ortho(j,0,r.Y,-r.Y,0,0,1),r.a9.translate(j,j,[0,-r.Y,0]),{u_matrix:j,u_image:1,u_dimension:[U,U],u_zoom:F.overscaledZ}})(n.tileID,_),s.id,S,C,R),n.needsHillshadePrepare=!1}let Li=c=>({u_matrix:new r.bN(c),u_image0:new r.bR(c),u_skirt_height:new r.bQ(c),u_ground_shadow_factor:new r.bP(c)}),Tu=(c,n,s)=>({u_matrix:c,u_image0:0,u_skirt_height:n,u_ground_shadow_factor:s}),vc=(c,n,s,u,m,_,b,w,S,C,R,O,F,B,U,j)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(u),u_merc_matrix:s,u_zoom_transition:m,u_merc_center:_,u_image0:0,u_frustum_tl:b,u_frustum_tr:w,u_frustum_br:S,u_frustum_bl:C,u_globe_pos:R,u_globe_radius:O,u_viewport:F,u_grid_matrix:j?Float32Array.from(j):new Float32Array(9),u_skirt_height:B,u_far_z_cutoff:U});function bc(c,n){return c!=null&&n!=null&&!(!c.hasData()||!n.hasData())&&c.demTexture!=null&&n.demTexture!=null&&c.tileID.key!==n.tileID.key}let kr=new class{constructor(){this.operations={}}newMorphing(c,n,s,u,m){if(c in this.operations){let _=this.operations[c];_.to.tileID.key!==s.tileID.key&&(_.queued=s)}else this.operations[c]={startTime:u,phase:0,duration:m,from:n,to:s,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;let n=this.operations[c];return{from:n.from,to:n.to,phase:n.phase}}update(c){for(let n in this.operations){let s=this.operations[n];for(s.phase=(c-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,c)){delete this.operations[n];break}}}_nextOp(c,n){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=n,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},Zn={0:null,1:"TERRAIN_VERTEX_MORPHING"};function rm(c,n,s){if(n===0)return 0;let u=n<1&&s===514?.25/n:1;return 6*Math.pow(1.5,22-c)*Math.max(n,1)*u}function Eu(c,n){let s=1<<c.z;return!n&&(c.x===0||c.x===s-1)||c.y===0||c.y===s-1}let Iu=c=>({u_matrix:c});function Gl(c,n,s,u,m){if(m>0){let _=r.f.now(),b=(_-c.timeAdded)/m,w=n?(_-n.timeAdded)/m:-1,S=s.getSource(),C=u.coveringZoomLevel({tileSize:S.tileSize,roundZoom:S.roundZoom}),R=!n||Math.abs(n.tileID.overscaledZ-C)>Math.abs(c.tileID.overscaledZ-C),O=R&&c.refreshedUponExpiration?1:r.ad(R?b:1-w,0,1);return c.refreshedUponExpiration&&b>=1&&(c.refreshedUponExpiration=!1),n?{opacity:1,mix:1-O}:{opacity:O,mix:0}}return{opacity:1,mix:0}}class ap extends qo{constructor(n){let s={type:"raster-dem",maxzoom:n.transform.maxZoom},u=new r.bZ(r.b_(),null),m=Go("mock-dem",s,u,n.style);super("mock-dem",m,!1),m.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,s){n.state="loaded",s(null)}}class Vh extends qo{constructor(n){let s=Go("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new r.bZ(r.b_(),null),n.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,s,u){if(n.freezeTileCoverage)return;this.transform=n;let m=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,b)=>{if(_[b.key]="",!this._tiles[b.key]){let w=new Ao(b,this._source.tileSize*b.overscaleFactor(),n.tileZoom);w.state="loaded",this._tiles[b.key]=w}return _},{});for(let _ in this._tiles)_ in m||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(n){let s=this.proxyCachedFBO[n];if(s!==void 0){let u=Object.values(s);this.renderCachePool.push(...u),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Qr extends r.ap{constructor(n,s,u){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=s,this.projMatrix=u}}class Yo extends r.cp{constructor(n,s){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},n.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[u,m,_]=function(S){let C=new r.aQ,R=new r.az,O=131;C.reserve(17161),R.reserve(33800);let F=r.Y/128,B=r.Y+F/2,U=B+F;for(let G=-F;G<U;G+=F)for(let q=-F;q<U;q+=F){let H=q<0||q>B||G<0||G>B?24575:0,ne=r.ad(Math.round(q),0,r.Y),ie=r.ad(Math.round(G),0,r.Y);C.emplaceBack(ne+H,ie)}let j=(G,q)=>{let H=q*O+G;R.emplaceBack(H+1,H,H+O),R.emplaceBack(H+O,H+O+1,H+1)};for(let G=1;G<129;G++)for(let q=1;q<129;q++)j(q,G);return[0,129].forEach(G=>{for(let q=0;q<130;q++)j(q,G),j(G,q)}),[C,R,32768]}(),b=n.context;this.gridBuffer=b.createVertexBuffer(u,r.aS.members),this.gridIndexBuffer=b.createIndexBuffer(m),this.gridSegments=r.aE.simpleSegment(0,0,u.length,m.length),this.gridNoSkirtSegments=r.aE.simpleSegment(0,0,u.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Vh(s.map),this.orthoMatrix=r.a9.create(),r.a9.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.Y,0,r.Y,0,1);let w=b.gl;this._overlapStencilMode=new kt({func:w.GEQUAL,mask:255},0,255,w.KEEP,w.KEEP,w.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ap(s.map),this._pendingGroundEffectLayers=[]}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,s,u){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);let m=n.terrain.properties,_=n.terrain.drapeRenderMode===0,b=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.f.now();let w=n.terrain&&n.terrain.scope,S=m.get("source"),C=_?this._mockSourceCache:n.getSourceCache(S,w);if(!C)return void r.w(`Couldn't find terrain source "${S}".`);if(this.sourceCache=C,this._exaggeration=b?this.calculateExaggeration(s):m.get("exaggeration"),!s.projection.requiresDraping&&b&&this._exaggeration===0)return void this._disable();this.enabled=!0;let R=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let O=this.getScaledDemTileSize();this.sourceCache.update(s,O,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,R(),this._initializing=!0),R(),s.updateElevation(!0,u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0,this._previousZoom=s.zoom}else this._disable()}calculateExaggeration(n){let s=this._previousCameraAltitude,u=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=u;let m=s!=null?u-s:Number.MAX_VALUE;if(Math.abs(m)<2)return this._exaggeration;let _=n.zoom,b=this._style.terrain;if(!this._previousUpdateTimestamp)return b.getExaggeration(_);let w=_-this._previousZoom,S=this._previousUpdateTimestamp,C=_;this._evaluationZoom!=null&&(C=this._evaluationZoom,Math.abs(_-C)>.5&&(w=.5*(_-C+w)),w*m<0&&(C+=w)),this._evaluationZoom=C;let R=b.getExaggeration(C),O=R===b.getExaggeration(Math.max(0,C-.1));if(O&&Math.abs(R-this._exaggeration)<.01)return R;let F=Math.min(.1,.00375*(this._updateTimestamp-S));return(O||R<.1||Math.abs(w)<1e-4)&&(F=Math.min(.2,4*F)),r.X(this._exaggeration,R,F)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let s=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=u._centerAltitude===0&&this.getAtPointOrZero(r.O.fromLngLat(u.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let m=this.proxyCoords=s.getIds().map(S=>{let C=s.getTileByID(S).tileID;return C.projMatrix=u.calculateProjMatrix(C.toUnwrapped()),C});(function(S,C){let R=C.transform.pointCoordinate(C.transform.getCameraPoint()),O=new r.P(R.x,R.y);S.sort((F,B)=>{if(B.overscaledZ-F.overscaledZ)return B.overscaledZ-F.overscaledZ;let U=new r.P(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),j=new r.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),G=O.mult(1<<F.canonical.z);return G.x-=.5,G.y-=.5,G.distSqr(U)-G.distSqr(j)})})(m,this.painter);let _=this.proxyToSource||{};this.proxyToSource={},m.forEach(S=>{this.proxyToSource[S.key]={}}),this.terrainTileForTile={};let b=this._style._mergedSourceCaches;for(let S in b){let C=b[S];if(!C.used||(C!==this.sourceCache&&this.resetTileLookupCache(C.id),this._setupProxiedCoordsForOrtho(C,n[S],_),C.usedForTerrain))continue;let R=n[S];C.getSource().reparseOverscaled&&this._assignTerrainTiles(R)}this.proxiedCoords[s.id]=m.map(S=>new Qr(S,S.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1;let w={};this._visibleDemTiles=[];for(let S of this.proxyCoords){let C=this.terrainTileForTile[S.key];if(!C)continue;let R=C.tileID.key;R in w||(this._visibleDemTiles.push(C),w[R]=R)}}_assignTerrainTiles(n){this._initializing||n.forEach(s=>{if(this.terrainTileForTile[s.key])return;let u=this._findTileCoveringTileID(s,this.sourceCache);u&&(this.terrainTileForTile[s.key]=u)})}_prepareDEMTextures(){let n=this.painter.context,s=n.gl;for(let u in this.terrainTileForTile){let m=this.terrainTileForTile[u],_=m.dem;!_||m.demTexture&&!m.needsDEMTextureUpload||(n.activeTexture.set(s.TEXTURE1),Xo(this.painter,m,_))}}_prepareDemTileUniforms(n,s,u,m){if(!s||s.demTexture==null)return!1;let _=n.tileID.canonical,b=Math.pow(2,s.tileID.canonical.z-_.z),w=m||"";return u[`u_dem_tl${w}`]=[_.x*b%1,_.y*b%1],u[`u_dem_scale${w}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let n=this.painter.context,s=n.gl;if(!this._emptyDepthBufferTexture){let u=new r.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new r.T(n,u,s.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0,s=this._visibleDemTiles.reduce((u,m)=>{if(!m.dem)return u;let _=m.dem.tree.minimums[0];return _>0&&n++,u+_},0);return n?s/n:0}_updateEmptyDEMTexture(){let n=this.painter.context,s=n.gl;n.activeTexture.set(s.TEXTURE2);let u=this._getLoadedAreaMinimum(),[m,_]=(()=>{let w=new r.cr({width:1,height:1},new Float32Array([u]));return[s.R32F,w]})();this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(_,{premultiply:!1}):b=this._emptyDEMTexture=new r.T(n,_,m,{premultiply:!1}),b}setupElevationDraw(n,s,u){let m=this.painter.context,_=m.gl,b={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};b.u_exaggeration=this.exaggeration();let w=null,S=null,C=1;if(u&&u.morphing&&this._useVertexMorphing){let F=u.morphing.srcDemTile,B=u.morphing.dstDemTile;C=u.morphing.phase,F&&B&&(this._prepareDemTileUniforms(n,F,b,"_prev")&&(S=F),this._prepareDemTileUniforms(n,B,b)&&(w=B))}let R=F=>F&&F.demTexture&&this.painter.linearFloatFilteringSupported()?_.LINEAR:_.NEAREST,O=F=>{b.u_dem_size=F.size[0]===1?1:F.size[0]-2};if(S&&w)m.activeTexture.set(_.TEXTURE2),w.demTexture.bind(R(w),_.CLAMP_TO_EDGE),m.activeTexture.set(_.TEXTURE4),S.demTexture.bind(R(S),_.CLAMP_TO_EDGE),w.demTexture&&O(w.demTexture),b.u_dem_lerp=C;else{w=this.terrainTileForTile[n.tileID.key],m.activeTexture.set(_.TEXTURE2);let F=this._prepareDemTileUniforms(n,w,b)?w.demTexture:this.emptyDEMTexture;F.bind(R(w),_.CLAMP_TO_EDGE),O(F)}if(m.activeTexture.set(_.TEXTURE3),u&&u.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),this._depthFBO&&(b.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),b.u_depth_size_inv=[1,1]),u&&u.useMeterToDem&&w){let F=(1<<w.tileID.canonical.z)*r.bo(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=F}if(u&&u.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),s.setTerrainUniformValues(m,b),this.painter.transform.projection.name==="globe"){let F=this.globeUniformValues(this.painter.transform,n.tileID.canonical,u&&u.useDenormalizedUpVectorScale);s.setGlobeUniformValues(m,F)}}globeUniformValues(n,s,u){let m=n.projection;return{u_tile_tl_up:m.upVector(s,0,0),u_tile_tr_up:m.upVector(s,r.Y,0),u_tile_br_up:m.upVector(s,r.Y,r.Y),u_tile_bl_up:m.upVector(s,0,r.Y),u_tile_up_scale:u?r.cq(1):m.upVectorScale(s,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){let s=this.painter,u=this.painter.context;n.length!==0&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(m,_,b,w,S){if(m.transform.projection.name==="globe")(function(C,R,O,F,B){let U=C.context,j=U.gl,G,q,H=C.transform,ne=r.ci(C,U,H),ie=(Ee,Re)=>{if(q===Re)return;let pe=[Zn[Re],"PROJECTION_GLOBE_VIEW"];ne&&pe.push("CUSTOM_ANTIALIASING");let xe=C.isTileAffectedByFog(Ee);G=C.getOrCreateProgram("globeRaster",{defines:pe,overrideFog:xe}),q=Re},oe=C.colorModeForRenderPass(),$=new ze(j.LEQUAL,ze.ReadWrite,C.depthRangeFor3D);kr.update(B);let X=r.cj(H),ue=[r.a8(H.center.lng),r.ah(H.center.lat)],le=C.globeSharedBuffers,ge=[H.width*r.f.devicePixelRatio,H.height*r.f.devicePixelRatio],Me=Float32Array.from(H.globeMatrix),me={useDenormalizedUpVectorScale:!0};{let Ee=C.transform,Re=rm(Ee.zoom,R.exaggeration(),R.sourceCache._source.tileSize);q=-1;let pe=j.TRIANGLES;for(let xe of F){let He=O.getTile(xe),ye=kt.disabled,Se=R.prevTerrainTileForTile[xe.key],De=R.terrainTileForTile[xe.key];bc(Se,De)&&kr.newMorphing(xe.key,Se,De,B,250),U.activeTexture.set(j.TEXTURE0),He.texture&&He.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);let re=kr.getMorphValuesForProxy(xe.key),Ue=re?1:0;re&&r.k(me,{morphing:{srcDemTile:re.from,dstDemTile:re.to,phase:r.ch(re.phase)}});let gt=r.ck(xe.canonical),Et=r.cl(gt.getCenter().lat),Ot=r.cm(xe.canonical,gt,Et,Ee.worldSize/Ee._pixelsPerMercatorPixel),At=r.aW(r.cn(xe.canonical)),Nt=vc(Ee.expandedFarZProjMatrix,Me,X,At,r.W(Ee.zoom),ue,Ee.frustumCorners.TL,Ee.frustumCorners.TR,Ee.frustumCorners.BR,Ee.frustumCorners.BL,Ee.globeCenterInViewSpace,Ee.globeRadius,ge,Re,Ee._farZ,Ot);if(ie(xe,Ue),G&&(R.setupElevationDraw(He,G,me),C.uploadCommonUniforms(U,G,xe.toUnwrapped()),le)){let[xi,ei,Di]=le.getGridBuffers(Et,Re!==0);G.draw(C,pe,$,ye,oe,Tt.backCCW,Nt,"globe_raster",xi,ei,Di)}}}if(le&&(C.renderDefaultNorthPole||C.renderDefaultSouthPole)){let Ee=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ne&&Ee.push("CUSTOM_ANTIALIASING"),G=C.getOrCreateProgram("globeRaster",{defines:Ee});for(let Re of F){let{x:pe,y:xe,z:He}=Re.canonical,ye=xe===0,Se=xe===(1<<He)-1,[De,re,Ue,gt]=le.getPoleBuffers(He,!1);if(gt&&(ye||Se)){let Et=O.getTile(Re);U.activeTexture.set(j.TEXTURE0),Et.texture&&Et.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);let Ot=r.co(He,pe,H),At=r.aW(r.cn(Re.canonical)),Nt=(xi,ei)=>xi.draw(C,j.TRIANGLES,$,kt.disabled,oe,Tt.disabled,vc(H.expandedFarZProjMatrix,Ot,Ot,At,0,ue,H.frustumCorners.TL,H.frustumCorners.TR,H.frustumCorners.BR,H.frustumCorners.BL,H.globeCenterInViewSpace,H.globeRadius,ge,0,H._farZ),"globe_pole_raster",ei,Ue,gt);R.setupElevationDraw(Et,G,me),C.uploadCommonUniforms(U,G,Re.toUnwrapped()),ye&&C.renderDefaultNorthPole&&Nt(G,De),Se&&C.renderDefaultSouthPole&&(Ot=r.a9.scale(r.a9.create(),Ot,[1,-1,1]),Nt(G,re))}}}})(m,_,b,w,S);else{let C=m.context,R=C.gl,O,F,B=m.shadowRenderer,U=wr(m,m.longestCutoffRange),j=oe=>{if(F===oe)return;let $=[];$.push(Zn[oe]),U.shouldRenderCutoff&&$.push("RENDER_CUTOFF"),O=m.getOrCreateProgram("terrainRaster",{defines:$}),F=oe},G=m.colorModeForRenderPass(),q=new ze(R.LEQUAL,ze.ReadWrite,m.depthRangeFor3D);kr.update(S);let H=m.transform,ne=rm(H.zoom,_.exaggeration(),_.sourceCache._source.tileSize),ie=[0,0,0];if(B){let oe=m.style.directionalLight,$=m.style.ambientLight;oe&&$&&(ie=ca(oe,$))}{F=-1;let oe=R.TRIANGLES,[$,X]=[_.gridIndexBuffer,_.gridSegments];for(let ue of w){let le=b.getTile(ue),ge=kt.disabled,Me=_.prevTerrainTileForTile[ue.key],me=_.terrainTileForTile[ue.key];bc(Me,me)&&kr.newMorphing(ue.key,Me,me,S,250),C.activeTexture.set(R.TEXTURE0),le.texture&&le.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE);let Ee=kr.getMorphValuesForProxy(ue.key),Re=Ee?1:0,pe;Ee&&(pe={morphing:{srcDemTile:Ee.from,dstDemTile:Ee.to,phase:r.ch(Ee.phase)}});let xe=Tu(ue.projMatrix,Eu(ue.canonical,H.renderWorldCopies)?ne/10:ne,ie);if(j(Re),!O)continue;_.setupElevationDraw(le,O,pe);let He=ue.toUnwrapped();B&&B.setupShadows(He,O),m.uploadCommonUniforms(C,O,He,null,U),O.draw(m,oe,q,ge,G,Tt.backCCW,xe,"terrain_raster",_.gridBuffer,$,X)}}}}(s,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;let s=this.painter,u=this.painter.context,m=this.proxySourceCache,_=this.proxiedCoords[m.id],b=this._drapedRenderBatches.shift(),w=s.style.order,S=[],C=0;for(let R of _){let O=m.getTileByID(R.proxyTileKey),F=m.proxyCachedFBO[R.key]?m.proxyCachedFBO[R.key][n]:void 0,B=F!==void 0?m.renderCache[F]:this.pool[C++],U=F!==void 0;if(O.texture=B.tex,U&&!B.dirty){S.push(O.tileID);continue}let j;u.bindFramebuffer.set(B.fb.framebuffer),this.renderedToTile=!1,B.dirty&&(u.clear({color:r.aA.transparent,stencil:0}),B.dirty=!1);for(let G=b.start;G<=b.end;++G){let q=s.style._mergedLayers[w[G]];if(q.isHidden(s.transform.zoom))continue;let H=s.style.getLayerSourceCache(q),ne=H?this.proxyToSource[R.key][H.id]:[R];if(!ne)continue;let ie=ne;u.viewport.set([0,0,B.fb.width,B.fb.height]),j!==(H?H.id:null)&&(this._setupStencil(B,ne,q,H),j=H?H.id:null),s.renderLayer(s,H,q,ie)}if(this._drapedRenderBatches.length===0)for(let G of this._pendingGroundEffectLayers){let q=s.style._mergedLayers[w[G]];if(q.isHidden(s.transform.zoom))continue;let H=s.style.getLayerSourceCache(q),ne=H?this.proxyToSource[R.key][H.id]:[R];if(!ne)continue;let ie=ne;u.viewport.set([0,0,B.fb.width,B.fb.height]),j!==(H?H.id:null)&&(this._setupStencil(B,ne,q,H),j=H?H.id:null),s.renderLayer(s,H,q,ie)}this.renderedToTile?(B.dirty=!0,S.push(O.tileID)):U||--C,C===5&&(C=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,s.width,s.height]),b.end+1}postRender(){}isLayerOrderingCorrect(n){let s=n.order.length,u=-1,m=s;for(let _=0;_<s;++_)this._style.isLayerDraped(n._mergedLayers[n.order[_]])?u=Math.max(u,_):m=Math.min(m,_);return m>u}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{n=Math.min(n,s.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,s,u){if(!this._visibleDemTiles)return null;let m=this._visibleDemTiles.filter(_=>_.dem).map(_=>{let b=_.tileID,w=1<<b.overscaledZ,{x:S,y:C}=b.canonical,R=S/w,O=(S+1)/w,F=C/w,B=(C+1)/w;return{minx:R,miny:F,maxx:O,maxy:B,t:_.dem.tree.raycastRoot(R,F,O,B,n,s,u),tile:_}});m.sort((_,b)=>(_.t!==null?_.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(let _ of m){if(_.t==null)return null;let b=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,n,s,u);if(b!=null)return b}return null}_createFBO(){let n=this.painter.context,s=n.gl,u=this.drapeBufferSize;n.activeTexture.set(s.TEXTURE0);let m=new r.T(n,{width:u[0],height:u[1],data:null},s.RGBA);m.bind(s.LINEAR,s.CLAMP_TO_EDGE);let _=n.createFramebuffer(u[0],u[1],!0,null);return _.colorAttachment.set(m.texture),_.depthAttachment=new Lt(n,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:_,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{let s=this._style._mergedLayers[n],u=s.isHidden(this.painter.transform.zoom);return s.type==="custom"?!u&&s.shouldRedrape():!u&&s.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(let u of this._style.getSources())if(u instanceof ut){n=!0;break}if(!n)return;let s={};for(let u=0;u<this._style.order.length;++u){let m=this._style._mergedLayers[this._style.order[u]],_=this._style.getLayerSourceCache(m);if(_&&!s[_.id]&&!m.isHidden(this.painter.transform.zoom)&&m.type==="line"&&m.widthExpression()instanceof r.Z){s[_.id]=!0;for(let b of this.proxyCoords){let w=this.proxyToSource[b.key][_.id];if(w)for(let S of w)this._clearRenderCacheForTile(_.id,S)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(let u in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[u]._source instanceof ht){n=!0;break}if(!n)return;let s={};for(let u=0;u<this._style.order.length;++u){let m=this._style._mergedLayers[this._style.order[u]],_=this._style.getLayerSourceCache(m);if(!_||s[_.id]||m.isHidden(this.painter.transform.zoom)||m.type!=="raster")continue;let b=m.paint.get("raster-fade-duration");for(let w of this.proxyCoords){let S=this.proxyToSource[w.key][_.id];if(S)for(let C of S){let R=Gl(_.getTile(C),_.findLoadedParent(C,0),_,this.painter.transform,b);(R.opacity!==1||R.mix!==0)&&this._clearRenderCacheForTile(_.id,C)}}}}_setupDrapedRenderBatches(){let n=this._style.order,s=n.length;if(s===0)return;let u=[];this._pendingGroundEffectLayers=[];let m,_=0,b=this._style._mergedLayers[n[_]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++_<s;)b=this._style._mergedLayers[n[_]];for(;_<s;++_){let w=this._style._mergedLayers[n[_]];w.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(w)?m===void 0&&(m=_):(w.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(_),m!==void 0&&(u.push({start:m,end:_-1}),m=void 0)))}if(m!==void 0&&u.push({start:m,end:_-1}),u.length!==0){let w=u[u.length-1];this._pendingGroundEffectLayers.every(S=>S>w.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=u}_setupRenderCache(n){let s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){let b=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let w=0;w<b.length;++w){let S=Object.values(b[w]);s.renderCachePool.push(...S)}}return}this._clearRasterLayersFromRenderCache();let u=this.proxyCoords,m=this._tilesDirty;for(let b=u.length-1;b>=0;b--){let w=u[b];if(s.getTileByID(w.key),s.proxyCachedFBO[w.key]!==void 0){let S=n[w.key],C=this.proxyToSource[w.key],R=0;for(let O in C){let F=C[O],B=S[O];if(!B||B.length!==F.length||F.some((U,j)=>U!==B[j]||m[O]&&m[O].hasOwnProperty(U.key))){R=-1;break}++R}for(let O in s.proxyCachedFBO[w.key])s.renderCache[s.proxyCachedFBO[w.key][O]].dirty=R<0||R!==Object.values(S).length}}let _=[...this._drapedRenderBatches];_.sort((b,w)=>w.end-w.start-(b.end-b.start));for(let b of _)for(let w of u){if(s.proxyCachedFBO[w.key])continue;let S=s.renderCachePool.pop();S===void 0&&s.renderCache.length<50&&(S=s.renderCache.length,s.renderCache.push(this._createFBO())),S!==void 0&&(s.proxyCachedFBO[w.key]={},s.proxyCachedFBO[w.key][b.start]=S,s.renderCache[S].dirty=!0)}this._tilesDirty={}}_setupStencil(n,s,u,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let _=this.painter.context,b=_.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let w;if(u.isTileClipped())w=s.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);w=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+w>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=w,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):kt.disabled}_renderTileClippingMasks(n,s){let u=this.painter,m=this.painter.context,_=m.gl;u._tileClippingMaskIDs={},m.setColorMode(qt.disabled),m.setDepthMode(ze.disabled);let b=u.getOrCreateProgram("clippingMask");for(let w of n){let S=u._tileClippingMaskIDs[w.key]=--s;b.draw(u,_.TRIANGLES,ze.disabled,new kt({func:_.ALWAYS,mask:0},S,255,_.KEEP,_.KEEP,_.REPLACE),qt.disabled,Tt.disabled,Iu(w.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(n){let s=this.painter.transform;if(n.x<0||n.x>s.width||n.y<0||n.y>s.height)return null;let u=[n.x,n.y,1,1];r.aa.transformMat4(u,u,s.pixelMatrixInverse),r.aa.scale(u,u,1/u[3]),u[0]/=s.worldSize,u[1]/=s.worldSize;let m=s._camera.position,_=r.bo(1,s.center.lat),b=[m[0],m[1],m[2]/_,0],w=r.Q.subtract([],u.slice(0,3),b);r.Q.normalize(w,w);let S=this.raycast(b,w,this._exaggeration);return S!==null&&S?(r.Q.scaleAndAdd(b,b,w,S),b[3]=b[2],b[2]*=_,b):null}drawDepth(){let n=this.painter,s=n.context,u=this.proxySourceCache,m=Math.ceil(n.width),_=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===m&&this._depthFBO.height===_||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let b=s.gl,w=s.createFramebuffer(m,_,!0,"renderbuffer");s.activeTexture.set(b.TEXTURE0);let S=new r.T(s,{width:m,height:_,data:null},b.RGBA);S.bind(b.NEAREST,b.CLAMP_TO_EDGE),w.colorAttachment.set(S.texture);let C=s.createRenderbuffer(s.gl.DEPTH_COMPONENT16,m,_);w.depthAttachment.set(C),this._depthFBO=w,this._depthTexture=S}s.bindFramebuffer.set(this._depthFBO.framebuffer),s.viewport.set([0,0,m,_]),function(b,w,S,C){if(b.transform.projection.name==="globe")return;let R=b.context,O=R.gl;R.clear({depth:1});let F=b.getOrCreateProgram("terrainDepth"),B=new ze(O.LESS,ze.ReadWrite,b.depthRangeFor3D);for(let U of C){let j=S.getTile(U),G=Tu(U.projMatrix,0,[0,0,0]);w.setupElevationDraw(j,F),F.draw(b,O.TRIANGLES,B,kt.disabled,qt.unblended,Tt.backCCW,G,"terrain_depth",w.gridBuffer,w.gridIndexBuffer,w.gridNoSkirtSegments)}}(n,this,u,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,s,u){if(n.getSource()instanceof r.as)return this._setupProxiedCoordsForImageSource(n,s,u);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};let m=this.proxiedCoords[n.id]=[],_=this.proxyCoords;for(let S=0;S<_.length;S++){let C=_[S],R=this._findTileCoveringTileID(C,n);if(R){let O=this._createProxiedId(C,R,u[C.key]&&u[C.key][n.id]);m.push(O),this.proxyToSource[C.key][n.id]=[O]}}let b=!1,w=new Set;for(let S=0;S<s.length;S++){let C=n.getTile(s[S]);if(!C||!C.hasData())continue;let R=this._findTileCoveringTileID(C.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==C.tileID.canonical.z){let O=this.proxyToSource[R.tileID.key][n.id],F=this._createProxiedId(R.tileID,C,u[R.tileID.key]&&u[R.tileID.key][n.id]);O?O.splice(O.length-1,0,F):this.proxyToSource[R.tileID.key][n.id]=[F];let B=this.proxyToSource[R.tileID.key][n.id];w.has(B)||w.add(B),m.push(F),b=!0}}if(this._sourceTilesOverlap[n.id]=b,b&&this._debugParams.sortTilesHiZFirst)for(let S of w)S.sort((C,R)=>R.overscaledZ-C.overscaledZ)}_setupProxiedCoordsForImageSource(n,s,u){if(!n.getSource().loaded())return;let m=this.proxiedCoords[n.id]=[],_=this.proxyCoords,b=n.getSource(),w=b.tileID;if(!w)return;let S=new r.P(w.x,w.y)._div(1<<w.z),C=b.coordinates.map(r.O.fromLngLat).reduce((O,F)=>(O.min.x=Math.min(O.min.x,F.x-S.x),O.min.y=Math.min(O.min.y,F.y-S.y),O.max.x=Math.max(O.max.x,F.x-S.x),O.max.y=Math.max(O.max.y,F.y-S.y),O),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(O,F)=>{let B=O.wrap+O.canonical.x/(1<<O.canonical.z),U=O.canonical.y/(1<<O.canonical.z),j=r.Y/(1<<O.canonical.z),G=F.wrap+F.canonical.x/(1<<F.canonical.z),q=F.canonical.y/(1<<F.canonical.z);return B+j<G+C.min.x||B>G+C.max.x||U+j<q+C.min.y||U>q+C.max.y};for(let O=0;O<_.length;O++){let F=_[O];for(let B=0;B<s.length;B++){let U=n.getTile(s[B]);if(!U||!U.hasData()||R(F,U.tileID))continue;let j=this._createProxiedId(F,U,u[F.key]&&u[F.key][n.id]),G=this.proxyToSource[F.key][n.id];G?G.push(j):this.proxyToSource[F.key][n.id]=[j],m.push(j)}}}_createProxiedId(n,s,u){let m=this.orthoMatrix;if(u){let _=u.find(b=>b.key===s.tileID.key);if(_)return _}if(s.tileID.key!==n.key){let _=n.canonical.z-s.tileID.canonical.z,b,w,S;m=r.a9.create();let C=s.tileID.wrap-n.wrap<<n.overscaledZ;_>0?(b=r.Y>>_,w=b*((s.tileID.canonical.x<<_)-n.canonical.x+C),S=b*((s.tileID.canonical.y<<_)-n.canonical.y)):(b=r.Y<<-_,w=r.Y*(s.tileID.canonical.x-(n.canonical.x+C<<-_)),S=r.Y*(s.tileID.canonical.y-(n.canonical.y<<-_))),r.a9.ortho(m,0,b,0,b,0,1),r.a9.translate(m,m,[w,S,0])}return new Qr(s.tileID,n.key,m)}_findTileCoveringTileID(n,s){let u=s.getTile(n);if(u&&u.hasData())return u;let m=this._findCoveringTileCache[s.id],_=m[n.key];if(u=_?s.getTileByID(_):null,u&&u.hasData()||_===null)return u;let b=u?u.tileID:n,w=b.overscaledZ,S=s.getSource().minzoom,C=[];if(!_){let O=s.getSource().maxzoom;if(n.canonical.z>=O){let F=n.canonical.z-O;s.getSource().reparseOverscaled?(w=Math.max(n.canonical.z+2,s.transform.tileZoom),b=new r.ap(w,n.wrap,O,n.canonical.x>>F,n.canonical.y>>F)):F!==0&&(w=O,b=new r.ap(w,n.wrap,O,n.canonical.x>>F,n.canonical.y>>F))}b.key!==n.key&&(C.push(b.key),u=s.getTile(b))}let R=O=>{C.forEach(F=>{m[F]=O}),C.length=0};for(w-=1;w>=S&&(!u||!u.hasData());w--){u&&R(u.tileID.key);let O=b.calculateScaledKey(w);if(u=s.getTileByID(O),u&&u.hasData())break;let F=m[O];if(F===null)break;F===void 0?C.push(O):u=s.getTileByID(F)}return R(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,s){let u=this._tilesDirty[n];u||(u=this._tilesDirty[n]={}),u[s.key]=!0}}function om(c,n,s){let u=function(w,S,C){let R=r.Q.dot(S,w),O=r.Q.dot(C,[.2126,.7152,.0722]),F=(U,j,G)=>(1-G)*U+G*j,B=F(1-.3*Math.min(O,1),1,Math.min(R+1,1));return F(.92,1,Math.asin(r.ad(S[2],-1,1))/Math.PI+.5)*B}(c,[0,0,1],n),m=[0,0,0];r.Q.scale(m,s.slice(0,3),u);let _=[0,0,0];r.Q.scale(_,n.slice(0,3),c[2]);let b=[0,0,0];return r.Q.add(b,m,_),r.bX(b)}let xc=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],hr=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class vs{static cacheKey(n,s,u,m){let _=`${s}${m?m.cacheKey:""}`;for(let b of u)n.usedDefines.includes(b)&&(_+=`/${b}`);return _}constructor(n,s,u,m,_,b){let w=n.gl;this.program=w.createProgram(),this.configuration=m,this.name=s,this.fixedDefines=[...b];let S=m?m.getBinderAttributes():[],C=(u.staticAttributes||[]).concat(S),R=m?m.defines():[];R=R.concat(b.map(G=>`#define ${G}`));let O=`#version 300 es
`,F=O+R.concat("precision mediump float;",Ua,ua.fragmentSource).join(`
`);for(let G of u.fragmentIncludes)F+=`
${si[G]}`;F+=`
${u.fragmentSource}`;let B=O+R.concat("precision highp float;",Ua,ua.vertexSource).join(`
`);for(let G of u.vertexIncludes)B+=`
${si[G]}`;B+=`
${u.vertexSource}`;let U=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);w.shaderSource(U,F),w.compileShader(U),w.attachShader(this.program,U);let j=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())this.failedToCreate=!0;else{w.shaderSource(j,B),w.compileShader(j),w.attachShader(this.program,j),this.attributes={},this.numAttributes=C.length;for(let G=0;G<this.numAttributes;G++)if(C[G]){let q=C[G].startsWith("a_")?C[G]:`a_${C[G]}`;w.bindAttribLocation(this.program,G,q),this.attributes[q]=G}w.linkProgram(this.program),w.deleteShader(j),w.deleteShader(U),this.fixedUniforms=_(n),this.binderUniforms=m?m.getUniforms(n):[],b.includes("TERRAIN")&&(this.terrainUniforms=(G=>({u_dem:new r.bR(G),u_dem_prev:new r.bR(G),u_dem_tl:new r.bO(G),u_dem_scale:new r.bQ(G),u_dem_tl_prev:new r.bO(G),u_dem_scale_prev:new r.bQ(G),u_dem_size:new r.bQ(G),u_dem_lerp:new r.bQ(G),u_exaggeration:new r.bQ(G),u_depth:new r.bR(G),u_depth_size_inv:new r.bO(G),u_meter_to_dem:new r.bQ(G),u_label_plane_matrix_inv:new r.bN(G)}))(n)),b.includes("GLOBE")&&(this.globeUniforms=(G=>({u_tile_tl_up:new r.bP(G),u_tile_tr_up:new r.bP(G),u_tile_br_up:new r.bP(G),u_tile_bl_up:new r.bP(G),u_tile_up_scale:new r.bQ(G)}))(n)),b.includes("FOG")&&(this.fogUniforms=(G=>({u_fog_matrix:new r.bN(G),u_fog_range:new r.bO(G),u_fog_color:new r.bS(G),u_fog_horizon_blend:new r.bQ(G),u_fog_vertical_limit:new r.bO(G),u_fog_temporal_offset:new r.bQ(G),u_frustum_tl:new r.bP(G),u_frustum_tr:new r.bP(G),u_frustum_br:new r.bP(G),u_frustum_bl:new r.bP(G),u_globe_pos:new r.bP(G),u_globe_radius:new r.bQ(G),u_globe_transition:new r.bQ(G),u_is_globe:new r.bR(G),u_viewport:new r.bO(G)}))(n)),b.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(G=>({u_cutoff_params:new r.bS(G)}))(n)),b.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(G=>({u_lighting_ambient_color:new r.bP(G),u_lighting_directional_dir:new r.bP(G),u_lighting_directional_color:new r.bP(G),u_ground_radiance:new r.bP(G)}))(n)),b.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(G=>({u_light_matrix_0:new r.bN(G),u_light_matrix_1:new r.bN(G),u_fade_range:new r.bO(G),u_shadow_normal_offset:new r.bP(G),u_shadow_intensity:new r.bQ(G),u_shadow_texel_size:new r.bQ(G),u_shadow_map_resolution:new r.bQ(G),u_shadow_direction:new r.bP(G),u_shadow_bias:new r.bP(G),u_shadowmap_0:new r.bR(G),u_shadowmap_1:new r.bR(G)}))(n))}}setTerrainUniformValues(n,s){if(!this.terrainUniforms)return;let u=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(let m in s)u[m]&&u[m].set(this.program,m,s[m])}}setGlobeUniformValues(n,s){if(!this.globeUniforms)return;let u=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(let m in s)u[m]&&u[m].set(this.program,m,s[m])}}setFogUniformValues(n,s){if(!this.fogUniforms)return;let u=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(let m in s)u[m].set(this.program,m,s[m])}}setCutoffUniformValues(n,s){if(!this.cutoffUniforms)return;let u=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(let m in s)u[m].set(this.program,m,s[m])}}setLightsUniformValues(n,s){if(!this.lightsUniforms)return;let u=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(let m in s)u[m].set(this.program,m,s[m])}}setShadowUniformValues(n,s){if(this.failedToCreate||!this.shadowUniforms)return;let u=this.shadowUniforms;n.program.set(this.program);for(let m in s)u[m].set(this.program,m,s[m])}_drawDebugWireframe(n,s,u,m,_,b,w,S,C,R){let O=n.options.wireframe;if(O.terrain===!1&&O.layers2D===!1&&O.layers3D===!1)return;let F=n.context;if(!(!(!O.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!O.layers2D||n._terrain&&n._terrain.renderingToTexture||!xc.includes(this.name))||!(!O.layers3D||!hr.includes(this.name))))return;let B=F.gl,U=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,_,F);if(!U)return;let j=[...this.fixedDefines];j.push("DEBUG_WIREFRAME");let G=n.getOrCreateProgram(this.name,{config:this.configuration,defines:j});F.program.set(G.program);let q=(ie,oe,$)=>{if(oe[ie]&&$[ie])for(let X in oe[ie])$[ie][X]&&$[ie][X].set($.program,X,oe[ie][X].current)};C&&C.setUniforms(G.program,F,G.binderUniforms,w,{zoom:S}),q("fixedUniforms",this,G),q("terrainUniforms",this,G),q("globeUniforms",this,G),q("fogUniforms",this,G),q("lightsUniforms",this,G),q("shadowUniforms",this,G),U.bind(),F.setColorMode(new qt([B.ONE,B.ONE_MINUS_SRC_ALPHA,B.ZERO,B.ONE],r.aA.transparent,[!0,!0,!0,!1])),F.setDepthMode(new ze(s.func===B.LESS?B.LEQUAL:s.func,ze.ReadOnly,s.range)),F.setStencilMode(kt.disabled);let H=3*b.primitiveLength*2,ne=3*b.primitiveOffset*2*2;R&&R>1?B.drawElementsInstanced(B.LINES,H,B.UNSIGNED_SHORT,ne,R):B.drawElements(B.LINES,H,B.UNSIGNED_SHORT,ne),_.bind(),F.program.set(this.program),F.setDepthMode(s),F.setStencilMode(u),F.setColorMode(m)}draw(n,s,u,m,_,b,w,S,C,R,O,F,B,U,j,G){let q=n.context,H=q.gl;if(this.failedToCreate)return;q.program.set(this.program),q.setDepthMode(u),q.setStencilMode(m),q.setColorMode(_),q.setCullFace(b);for(let oe of Object.keys(this.fixedUniforms))this.fixedUniforms[oe].set(this.program,oe,w[oe]);U&&U.setUniforms(this.program,q,this.binderUniforms,F,{zoom:B});let ne={[H.POINTS]:1,[H.LINES]:2,[H.TRIANGLES]:3,[H.LINE_STRIP]:1}[s],ie=G&&G>0?1:void 0;for(let oe of O.get()){let $=oe.vaos||(oe.vaos={});($[S]||($[S]=new vt)).bind(q,this,C,U?U.getPaintVertexBuffers():[],R,oe.vertexOffset,j||[],ie),G&&G>1?H.drawElementsInstanced(s,oe.primitiveLength*ne,H.UNSIGNED_SHORT,oe.primitiveOffset*ne*2,G):R?H.drawElements(s,oe.primitiveLength*ne,H.UNSIGNED_SHORT,oe.primitiveOffset*ne*2):H.drawArrays(s,oe.vertexOffset,oe.vertexLength),s===H.TRIANGLES&&R&&this._drawDebugWireframe(n,u,m,_,R,oe,F,B,U,G)}}}function ha(c,n){let s=Math.pow(2,n.tileID.overscaledZ),u=n.tileSize*Math.pow(2,c.transform.tileZoom)/s,m=u*(n.tileID.canonical.x+n.tileID.wrap*s),_=u*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.a6(n,1,c.transform.tileZoom),u_pixel_coord_upper:[m>>16,_>>16],u_pixel_coord_lower:[65535&m,65535&_]}}let Er=r.a9.create(),jh=(c,n,s,u,m,_,b,w,S,C,R,O,F,B,U,j)=>{let G=n.style.light,q=G.properties.get("position"),H=[q.x,q.y,q.z],ne=r.ct.create();G.properties.get("anchor")==="viewport"&&(r.ct.fromRotation(ne,-n.transform.angle),r.Q.transformMat3(H,H,ne));let ie=G.properties.get("color"),oe=n.transform,$={u_matrix:c,u_lightpos:H,u_lightintensity:G.properties.get("intensity"),u_lightcolor:[ie.r,ie.g,ie.b],u_vertical_gradient:+s,u_opacity:u,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Er,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:m,u_edge_radius:_,u_flood_light_color:O,u_vertical_scale:F,u_flood_light_intensity:B,u_ground_shadow_factor:U,u_emissive_strength:j};return oe.projection.name==="globe"&&($.u_tile_id=[b.canonical.x,b.canonical.y,1<<b.canonical.z],$.u_zoom_transition=S,$.u_inv_rot_matrix=R,$.u_merc_center=C,$.u_up_dir=oe.projection.upVector(new r.bv(0,0,0),C[0]*r.Y,C[1]*r.Y),$.u_height_lift=w),$},zs=(c,n,s)=>({u_matrix:c,u_edge_radius:n,u_vertical_scale:s}),Su=(c,n,s,u,m,_,b,w,S,C,R,O,F,B)=>{let U=jh(c,n,s,u,m,_,b,S,C,R,O,F,B,1,[0,0,0],0),j={u_height_factor:-Math.pow(2,b.overscaledZ)/w.tileSize/8};return r.e(U,ha(n,w),j)},wc=(c,n)=>({u_matrix:c,u_emissive_strength:n}),ml=(c,n,s,u)=>r.e(wc(c,n),ha(s,u)),q_=(c,n,s)=>({u_matrix:c,u_world:s,u_emissive_strength:n}),Ga=(c,n,s,u,m)=>r.e(ml(c,n,s,u),{u_world:m}),$_=(c,n,s,u)=>{let m=r.Y/s.tileSize;return{u_matrix:c,u_camera_to_center_distance:n.getCameraToCenterDistance(u),u_extrude_scale:[n.pixelsToGLUnits[0]/m,n.pixelsToGLUnits[1]/m]}},lp=(c,n,s=1)=>({u_matrix:c,u_color:n,u_overlay:0,u_overlay_scale:s}),Lo=r.a9.create(),W_=(c,n,s,u,m,_,b)=>{let w=c.transform,S=w.projection.name==="globe",C=S?r.cu(w.zoom,n.canonical)*w._pixelsPerMercatorPixel:r.a6(s,1,_),R={u_matrix:n.projMatrix,u_extrude_scale:C,u_intensity:b,u_inv_rot_matrix:Lo,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){R.u_inv_rot_matrix=u,R.u_merc_center=m,R.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],R.u_zoom_transition=r.W(w.zoom);let O=m[0]*r.Y,F=m[1]*r.Y;R.u_up_dir=w.projection.upVector(new r.bv(0,0,0),O,F)}return R};function Mu(c,[n,s,u,m],[_,b]){if(_===b)return[0,0,0,0];let w=255*(c-1)/(c*(b-_));return[n*w,s*w,u*w,m*w]}function cp(c,n,[s,u]){return s===u?0:.5/c+(n-s)*(c-1)/(c*(u-s))}let sm=(c,n,s,u,m,_,b,w,S,C,R,O,F,B,U,j,G,q,H,ne,ie)=>({u_matrix:c,u_normalize_matrix:n,u_globe_matrix:s,u_merc_matrix:u,u_grid_matrix:m,u_tl_parent:_,u_scale_parent:C,u_fade_t:R.mix,u_opacity:R.opacity*O.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:O.paint.get("raster-brightness-min"),u_brightness_high:O.paint.get("raster-brightness-max"),u_saturation_factor:r.cv(O.paint.get("raster-saturation")),u_contrast_factor:r.cw(O.paint.get("raster-contrast")),u_spin_weights:Z_(O.paint.get("raster-hue-rotate")),u_perspective_transform:F,u_raster_elevation:B,u_zoom_transition:b,u_merc_center:w,u_cutoff_params:S,u_colorization_mix:Mu(r.cx,j,q),u_colorization_offset:cp(r.cx,G,q),u_color_ramp:U,u_texture_offset:[ne/(H+2*ne),H/(H+2*ne)],u_texture_res:[H+2*ne,H+2*ne],u_emissive_strength:ie});function Z_(c){c*=Math.PI/180;let n=Math.sin(c),s=Math.cos(c);return[(2*s+1)/3,(-Math.sqrt(3)*n-s+1)/3,(Math.sqrt(3)*n-s+1)/3]}let Cu=(c,n,s,u,m,_,b,w,S,C,R,O)=>({u_matrix:c,u_normalize_matrix:n,u_globe_matrix:s,u_merc_matrix:u,u_grid_matrix:m,u_tl_parent:_,u_scale_parent:C,u_fade_t:R.mix,u_opacity:R.opacity,u_image0:0,u_image1:1,u_raster_elevation:O,u_zoom_transition:b,u_merc_center:w,u_cutoff_params:S}),Au=(c,n,s,u,m,_,b,w,S,C)=>({u_particle_texture:c,u_particle_texture_side_len:n,u_tile_offset:s,u_velocity:u,u_color_ramp:_,u_velocity_res:m,u_max_speed:b,u_uv_offset:w,u_data_scale:S,u_data_offset:C,u_particle_pos_scale:1.3,u_particle_pos_offset:[Ps,Ps]}),H_=(c,n,s,u,m,_,b,w,S,C)=>({u_particle_texture:c,u_particle_texture_side_len:n,u_velocity:s,u_velocity_res:u,u_max_speed:m,u_speed_factor:_,u_reset_rate:b,u_rand_seed:Math.random(),u_uv_offset:w,u_data_scale:S,u_data_offset:C,u_particle_pos_scale:1.3,u_particle_pos_offset:[Ps,Ps]}),ql=r.a9.create(),up=(c,n,s,u,m,_,b,w,S,C,R,O,F,B,U,j,G,q)=>{let H=m.transform,ne={u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:H.getCameraToCenterDistance(j),u_rotate_symbol:+s,u_aspect_ratio:H.width/H.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:b,u_coord_matrix:w,u_is_text:+S,u_pitch_with_map:+u,u_texsize:C,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ql,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ql,u_up_vector:[0,-1,0],u_color_adj_mat:G,u_icon_transition:q||0};return j.name==="globe"&&(ne.u_tile_id=[R.canonical.x,R.canonical.y,1<<R.canonical.z],ne.u_zoom_transition=O,ne.u_inv_rot_matrix=B,ne.u_merc_center=F,ne.u_camera_forward=H._camera.forward(),ne.u_ecef_origin=r.cy(H.globeMatrix,R.toUnwrapped()),ne.u_tile_matrix=Float32Array.from(H.globeMatrix),ne.u_up_vector=U),ne},Tc=(c,n,s,u,m,_,b,w,S,C,R,O,F,B,U,j,G)=>r.e(up(c,n,s,u,m,_,b,w,S,C,O,F,B,U,j,G),{u_gamma_scale:u?m.transform.getCameraToCenterDistance(G)*Math.cos(m.terrain?0:m.transform._pitch):1,u_device_pixel_ratio:r.f.devicePixelRatio,u_is_halo:+R,undefined:void 0}),gl=(c,n,s,u,m,_,b,w,S,C,R,O,F,B,U,j)=>r.e(Tc(c,n,s,u,m,_,b,w,!0,S,!0,R,O,F,B,U,j),{u_texsize_icon:C,u_texture_icon:1}),Q_=(c,n,s,u)=>({u_matrix:c,u_emissive_strength:n,u_opacity:s,u_color:u}),X_=(c,n,s,u,m,_,b)=>r.e(function(w,S,C,R){let O=C.imageManager.getPattern(w.toString(),S),{width:F,height:B}=C.imageManager.getPixelSize(S),U=Math.pow(2,R.tileID.overscaledZ),j=R.tileSize*Math.pow(2,C.transform.tileZoom)/U,G=j*(R.tileID.canonical.x+R.tileID.wrap*U),q=j*R.tileID.canonical.y;return{u_image:0,u_pattern_tl:O.tl,u_pattern_br:O.br,u_texsize:[F,B],u_pattern_size:O.displaySize,u_tile_units_to_pixels:1/r.a6(R,1,C.transform.tileZoom),u_pixel_coord_upper:[G>>16,q>>16],u_pixel_coord_lower:[65535&G,65535&q]}}(m,_,u,b),{u_matrix:c,u_emissive_strength:n,u_opacity:s}),hp=new Float32Array(r.a9.identity([])),Uh=(c,n,s,u,m,_,b,w,S,C,R,O,F,B=[0,0,0],U)=>{let j=m.style.light,G=j.properties.get("position"),q=[-G.x,-G.y,G.z],H=r.ct.create();j.properties.get("anchor")==="viewport"&&(r.ct.fromRotation(H,-m.transform.angle),r.Q.transformMat3(q,q,H));let ne=R.alphaMode==="MASK",ie=j.properties.get("color"),oe=F.paint.get("model-ambient-occlusion-intensity"),$=F.paint.get("model-color").constantOr(r.aA.white),X=F.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:c,u_lighting_matrix:n,u_normal_matrix:s,u_node_matrix:u||hp,u_lightpos:q,u_lightintensity:j.properties.get("intensity"),u_lightcolor:[ie.r,ie.g,ie.b],u_camera_pos:B,u_opacity:_,u_baseTextureIsAlpha:0,u_alphaMask:+ne,u_alphaCutoff:R.alphaCutoff,u_baseColorFactor:[b.r,b.g,b.b,b.a],u_emissiveFactor:[w[0],w[1],w[2],1],u_metallicFactor:S,u_roughnessFactor:C,u_baseColorTexture:hn.BaseColor,u_metallicRoughnessTexture:hn.MetallicRoughness,u_normalTexture:hn.Normal,u_occlusionTexture:hn.Occlusion,u_emissionTexture:hn.Emission,u_color_mix:[$.r,$.g,$.b,X],u_aoIntensity:oe,u_emissive_strength:O,u_occlusionTextureTransform:U||[0,0,0,0]}},am=(c,n=hp,s=hp)=>({u_matrix:c,u_instance:n,u_node_matrix:s}),dp={fillExtrusion:c=>({u_matrix:new r.bN(c),u_lightpos:new r.bP(c),u_lightintensity:new r.bQ(c),u_lightcolor:new r.bP(c),u_vertical_gradient:new r.bQ(c),u_opacity:new r.bQ(c),u_edge_radius:new r.bQ(c),u_ao:new r.bO(c),u_tile_id:new r.bP(c),u_zoom_transition:new r.bQ(c),u_inv_rot_matrix:new r.bN(c),u_merc_center:new r.bO(c),u_up_dir:new r.bP(c),u_height_lift:new r.bQ(c),u_flood_light_color:new r.bP(c),u_vertical_scale:new r.bQ(c),u_flood_light_intensity:new r.bQ(c),u_ground_shadow_factor:new r.bP(c),u_emissive_strength:new r.bQ(c)}),fillExtrusionDepth:c=>({u_matrix:new r.bN(c),u_edge_radius:new r.bQ(c),u_vertical_scale:new r.bQ(c)}),fillExtrusionPattern:c=>({u_matrix:new r.bN(c),u_lightpos:new r.bP(c),u_lightintensity:new r.bQ(c),u_lightcolor:new r.bP(c),u_vertical_gradient:new r.bQ(c),u_height_factor:new r.bQ(c),u_edge_radius:new r.bQ(c),u_ao:new r.bO(c),u_tile_id:new r.bP(c),u_zoom_transition:new r.bQ(c),u_inv_rot_matrix:new r.bN(c),u_merc_center:new r.bO(c),u_up_dir:new r.bP(c),u_height_lift:new r.bQ(c),u_image:new r.bR(c),u_texsize:new r.bO(c),u_pixel_coord_upper:new r.bO(c),u_pixel_coord_lower:new r.bO(c),u_tile_units_to_pixels:new r.bQ(c),u_opacity:new r.bQ(c)}),fillExtrusionGroundEffect:c=>({u_matrix:new r.bN(c),u_opacity:new r.bQ(c),u_ao_pass:new r.bQ(c),u_meter_to_tile:new r.bQ(c),u_ao:new r.bO(c),u_flood_light_intensity:new r.bQ(c),u_flood_light_color:new r.bP(c),u_attenuation:new r.bQ(c),u_edge_radius:new r.bQ(c),u_fb:new r.bR(c),u_fb_size:new r.bQ(c)}),fill:c=>({u_matrix:new r.bN(c),u_emissive_strength:new r.bQ(c)}),fillPattern:c=>({u_matrix:new r.bN(c),u_emissive_strength:new r.bQ(c),u_image:new r.bR(c),u_texsize:new r.bO(c),u_pixel_coord_upper:new r.bO(c),u_pixel_coord_lower:new r.bO(c),u_tile_units_to_pixels:new r.bQ(c)}),fillOutline:c=>({u_matrix:new r.bN(c),u_emissive_strength:new r.bQ(c),u_world:new r.bO(c)}),fillOutlinePattern:c=>({u_matrix:new r.bN(c),u_emissive_strength:new r.bQ(c),u_world:new r.bO(c),u_image:new r.bR(c),u_texsize:new r.bO(c),u_pixel_coord_upper:new r.bO(c),u_pixel_coord_lower:new r.bO(c),u_tile_units_to_pixels:new r.bQ(c)}),circle:r.cz,collisionBox:c=>({u_matrix:new r.bN(c),u_camera_to_center_distance:new r.bQ(c),u_extrude_scale:new r.bO(c)}),collisionCircle:c=>({u_matrix:new r.bN(c),u_inv_matrix:new r.bN(c),u_camera_to_center_distance:new r.bQ(c),u_viewport_size:new r.bO(c)}),debug:c=>({u_color:new r.cf(c),u_matrix:new r.bN(c),u_overlay:new r.bR(c),u_overlay_scale:new r.bQ(c)}),clippingMask:c=>({u_matrix:new r.bN(c)}),heatmap:c=>({u_extrude_scale:new r.bQ(c),u_intensity:new r.bQ(c),u_matrix:new r.bN(c),u_inv_rot_matrix:new r.bN(c),u_merc_center:new r.bO(c),u_tile_id:new r.bP(c),u_zoom_transition:new r.bQ(c),u_up_dir:new r.bP(c)}),heatmapTexture:c=>({u_image:new r.bR(c),u_color_ramp:new r.bR(c),u_opacity:new r.bQ(c)}),hillshade:c=>({u_matrix:new r.bN(c),u_image:new r.bR(c),u_latrange:new r.bO(c),u_light:new r.bO(c),u_shadow:new r.cf(c),u_highlight:new r.cf(c),u_emissive_strength:new r.bQ(c),u_accent:new r.cf(c)}),hillshadePrepare:c=>({u_matrix:new r.bN(c),u_image:new r.bR(c),u_dimension:new r.bO(c),u_zoom:new r.bQ(c)}),line:r.cA,linePattern:r.cB,raster:c=>({u_matrix:new r.bN(c),u_normalize_matrix:new r.bN(c),u_globe_matrix:new r.bN(c),u_merc_matrix:new r.bN(c),u_grid_matrix:new r.cg(c),u_tl_parent:new r.bO(c),u_scale_parent:new r.bQ(c),u_fade_t:new r.bQ(c),u_opacity:new r.bQ(c),u_image0:new r.bR(c),u_image1:new r.bR(c),u_brightness_low:new r.bQ(c),u_brightness_high:new r.bQ(c),u_saturation_factor:new r.bQ(c),u_contrast_factor:new r.bQ(c),u_spin_weights:new r.bP(c),u_perspective_transform:new r.bO(c),u_raster_elevation:new r.bQ(c),u_zoom_transition:new r.bQ(c),u_merc_center:new r.bO(c),u_cutoff_params:new r.bS(c),u_colorization_mix:new r.bS(c),u_colorization_offset:new r.bQ(c),u_color_ramp:new r.bR(c),u_texture_offset:new r.bO(c),u_texture_res:new r.bO(c),u_emissive_strength:new r.bQ(c)}),rasterParticle:c=>({u_matrix:new r.bN(c),u_normalize_matrix:new r.bN(c),u_globe_matrix:new r.bN(c),u_merc_matrix:new r.bN(c),u_grid_matrix:new r.cg(c),u_tl_parent:new r.bO(c),u_scale_parent:new r.bQ(c),u_fade_t:new r.bQ(c),u_opacity:new r.bQ(c),u_image0:new r.bR(c),u_image1:new r.bR(c),u_raster_elevation:new r.bQ(c),u_zoom_transition:new r.bQ(c),u_merc_center:new r.bO(c),u_cutoff_params:new r.bS(c)}),rasterParticleTexture:c=>({u_texture:new r.bR(c),u_opacity:new r.bQ(c)}),rasterParticleDraw:c=>({u_particle_texture:new r.bR(c),u_particle_texture_side_len:new r.bQ(c),u_tile_offset:new r.bO(c),u_velocity:new r.bR(c),u_color_ramp:new r.bR(c),u_velocity_res:new r.bO(c),u_max_speed:new r.bQ(c),u_uv_offset:new r.bO(c),u_data_scale:new r.bS(c),u_data_offset:new r.bQ(c),u_particle_pos_scale:new r.bQ(c),u_particle_pos_offset:new r.bO(c)}),rasterParticleUpdate:c=>({u_particle_texture:new r.bR(c),u_particle_texture_side_len:new r.bQ(c),u_velocity:new r.bR(c),u_velocity_res:new r.bO(c),u_max_speed:new r.bQ(c),u_speed_factor:new r.bQ(c),u_reset_rate:new r.bQ(c),u_rand_seed:new r.bQ(c),u_uv_offset:new r.bO(c),u_data_scale:new r.bS(c),u_data_offset:new r.bQ(c),u_particle_pos_scale:new r.bQ(c),u_particle_pos_offset:new r.bO(c)}),symbolIcon:c=>({u_is_size_zoom_constant:new r.bR(c),u_is_size_feature_constant:new r.bR(c),u_size_t:new r.bQ(c),u_size:new r.bQ(c),u_camera_to_center_distance:new r.bQ(c),u_rotate_symbol:new r.bR(c),u_aspect_ratio:new r.bQ(c),u_fade_change:new r.bQ(c),u_matrix:new r.bN(c),u_label_plane_matrix:new r.bN(c),u_coord_matrix:new r.bN(c),u_is_text:new r.bR(c),u_pitch_with_map:new r.bR(c),u_texsize:new r.bO(c),u_tile_id:new r.bP(c),u_zoom_transition:new r.bQ(c),u_inv_rot_matrix:new r.bN(c),u_merc_center:new r.bO(c),u_camera_forward:new r.bP(c),u_tile_matrix:new r.bN(c),u_up_vector:new r.bP(c),u_ecef_origin:new r.bP(c),u_texture:new r.bR(c),u_icon_transition:new r.bQ(c),u_color_adj_mat:new r.bN(c)}),symbolSDF:c=>({u_is_size_zoom_constant:new r.bR(c),u_is_size_feature_constant:new r.bR(c),u_size_t:new r.bQ(c),u_size:new r.bQ(c),u_camera_to_center_distance:new r.bQ(c),u_rotate_symbol:new r.bR(c),u_aspect_ratio:new r.bQ(c),u_fade_change:new r.bQ(c),u_matrix:new r.bN(c),u_label_plane_matrix:new r.bN(c),u_coord_matrix:new r.bN(c),u_is_text:new r.bR(c),u_pitch_with_map:new r.bR(c),u_texsize:new r.bO(c),u_texture:new r.bR(c),u_gamma_scale:new r.bQ(c),u_device_pixel_ratio:new r.bQ(c),u_tile_id:new r.bP(c),u_zoom_transition:new r.bQ(c),u_inv_rot_matrix:new r.bN(c),u_merc_center:new r.bO(c),u_camera_forward:new r.bP(c),u_tile_matrix:new r.bN(c),u_up_vector:new r.bP(c),u_ecef_origin:new r.bP(c),u_is_halo:new r.bR(c)}),symbolTextAndIcon:c=>({u_is_size_zoom_constant:new r.bR(c),u_is_size_feature_constant:new r.bR(c),u_size_t:new r.bQ(c),u_size:new r.bQ(c),u_camera_to_center_distance:new r.bQ(c),u_rotate_symbol:new r.bR(c),u_aspect_ratio:new r.bQ(c),u_fade_change:new r.bQ(c),u_matrix:new r.bN(c),u_label_plane_matrix:new r.bN(c),u_coord_matrix:new r.bN(c),u_is_text:new r.bR(c),u_pitch_with_map:new r.bR(c),u_texsize:new r.bO(c),u_texsize_icon:new r.bO(c),u_texture:new r.bR(c),u_texture_icon:new r.bR(c),u_gamma_scale:new r.bQ(c),u_device_pixel_ratio:new r.bQ(c),u_is_halo:new r.bR(c)}),background:c=>({u_matrix:new r.bN(c),u_emissive_strength:new r.bQ(c),u_opacity:new r.bQ(c),u_color:new r.cf(c)}),backgroundPattern:c=>({u_matrix:new r.bN(c),u_emissive_strength:new r.bQ(c),u_opacity:new r.bQ(c),u_image:new r.bR(c),u_pattern_tl:new r.bO(c),u_pattern_br:new r.bO(c),u_texsize:new r.bO(c),u_pattern_size:new r.bO(c),u_pixel_coord_upper:new r.bO(c),u_pixel_coord_lower:new r.bO(c),u_tile_units_to_pixels:new r.bQ(c)}),terrainRaster:Li,terrainDepth:Li,skybox:c=>({u_matrix:new r.bN(c),u_sun_direction:new r.bP(c),u_cubemap:new r.bR(c),u_opacity:new r.bQ(c),u_temporal_offset:new r.bQ(c)}),skyboxGradient:c=>({u_matrix:new r.bN(c),u_color_ramp:new r.bR(c),u_center_direction:new r.bP(c),u_radius:new r.bQ(c),u_opacity:new r.bQ(c),u_temporal_offset:new r.bQ(c)}),skyboxCapture:c=>({u_matrix_3f:new r.cg(c),u_sun_direction:new r.bP(c),u_sun_intensity:new r.bQ(c),u_color_tint_r:new r.bS(c),u_color_tint_m:new r.bS(c),u_luminance:new r.bQ(c)}),globeRaster:c=>({u_proj_matrix:new r.bN(c),u_globe_matrix:new r.bN(c),u_normalize_matrix:new r.bN(c),u_merc_matrix:new r.bN(c),u_zoom_transition:new r.bQ(c),u_merc_center:new r.bO(c),u_image0:new r.bR(c),u_grid_matrix:new r.cg(c),u_skirt_height:new r.bQ(c),u_far_z_cutoff:new r.bQ(c),u_frustum_tl:new r.bP(c),u_frustum_tr:new r.bP(c),u_frustum_br:new r.bP(c),u_frustum_bl:new r.bP(c),u_globe_pos:new r.bP(c),u_globe_radius:new r.bQ(c),u_viewport:new r.bO(c)}),globeAtmosphere:c=>({u_frustum_tl:new r.bP(c),u_frustum_tr:new r.bP(c),u_frustum_br:new r.bP(c),u_frustum_bl:new r.bP(c),u_horizon:new r.bQ(c),u_transition:new r.bQ(c),u_fadeout_range:new r.bQ(c),u_color:new r.bS(c),u_high_color:new r.bS(c),u_space_color:new r.bS(c),u_temporal_offset:new r.bQ(c),u_horizon_angle:new r.bQ(c)}),model:c=>({u_matrix:new r.bN(c),u_lighting_matrix:new r.bN(c),u_normal_matrix:new r.bN(c),u_node_matrix:new r.bN(c),u_lightpos:new r.bP(c),u_lightintensity:new r.bQ(c),u_lightcolor:new r.bP(c),u_camera_pos:new r.bP(c),u_opacity:new r.bQ(c),u_baseColorFactor:new r.bS(c),u_emissiveFactor:new r.bS(c),u_metallicFactor:new r.bQ(c),u_roughnessFactor:new r.bQ(c),u_baseTextureIsAlpha:new r.bR(c),u_alphaMask:new r.bR(c),u_alphaCutoff:new r.bQ(c),u_baseColorTexture:new r.bR(c),u_metallicRoughnessTexture:new r.bR(c),u_normalTexture:new r.bR(c),u_occlusionTexture:new r.bR(c),u_emissionTexture:new r.bR(c),u_color_mix:new r.bS(c),u_aoIntensity:new r.bQ(c),u_emissive_strength:new r.bQ(c),u_occlusionTextureTransform:new r.bS(c)}),modelDepth:c=>({u_matrix:new r.bN(c),u_instance:new r.bN(c),u_node_matrix:new r.bN(c)}),groundShadow:c=>({u_matrix:new r.bN(c),u_ground_shadow_factor:new r.bP(c)}),stars:c=>({u_matrix:new r.bN(c),u_up:new r.bP(c),u_right:new r.bP(c),u_intensity_multiplier:new r.bQ(c)})},Du;function pp(c,n,s,u,m,_,b){let w=c.context,S=w.gl,C=c.transform,R=c.getOrCreateProgram("collisionBox"),O=[],F=0,B=0;for(let ie=0;ie<u.length;ie++){let oe=u[ie],$=n.getTile(oe),X=$.getBucket(s);if(!X)continue;let ue=Br(oe,X,C),le=ue;m[0]===0&&m[1]===0||(le=c.translatePosMatrix(ue,$,m,_));let ge=b?X.textCollisionBox:X.iconCollisionBox,Me=X.collisionCircleArray;if(Me.length>0){let me=r.a9.create(),Ee=le;r.a9.mul(me,X.placementInvProjMatrix,C.glCoordMatrix),r.a9.mul(me,me,X.placementViewportMatrix),O.push({circleArray:Me,circleOffset:B,transform:Ee,invTransform:me,projection:X.getProjection()}),F+=Me.length/4,B=F}ge&&(c.terrain&&c.terrain.setupElevationDraw($,R),R.draw(c,S.LINES,ze.disabled,kt.disabled,c.colorModeForRenderPass(),Tt.disabled,$_(le,C,$,X.getProjection()),s.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,null,C.zoom,null,[ge.collisionVertexBuffer,ge.collisionVertexBufferExt]))}if(!b||!O.length)return;let U=c.getOrCreateProgram("collisionCircle"),j=new r.cC;j.resize(4*F),j._trim();let G=0;for(let ie of O)for(let oe=0;oe<ie.circleArray.length/4;oe++){let $=4*oe,X=ie.circleArray[$+0],ue=ie.circleArray[$+1],le=ie.circleArray[$+2],ge=ie.circleArray[$+3];j.emplace(G++,X,ue,le,ge,0),j.emplace(G++,X,ue,le,ge,1),j.emplace(G++,X,ue,le,ge,2),j.emplace(G++,X,ue,le,ge,3)}(!Du||Du.length<2*F)&&(Du=function(ie){let oe=2*ie,$=new r.az;$.resize(oe),$._trim();for(let X=0;X<oe;X++){let ue=6*X;$.uint16[ue+0]=4*X+0,$.uint16[ue+1]=4*X+1,$.uint16[ue+2]=4*X+2,$.uint16[ue+3]=4*X+2,$.uint16[ue+4]=4*X+3,$.uint16[ue+5]=4*X+0}return $}(F));let q=w.createIndexBuffer(Du,!0),H=w.createVertexBuffer(j,r.cD.members,!0);for(let ie of O){let oe={u_matrix:ie.transform,u_inv_matrix:ie.invTransform,u_camera_to_center_distance:(ne=C).getCameraToCenterDistance(ie.projection),u_viewport_size:[ne.width,ne.height]};U.draw(c,S.TRIANGLES,ze.disabled,kt.disabled,c.colorModeForRenderPass(),Tt.disabled,oe,s.id,H,q,r.aE.simpleSegment(0,2*ie.circleOffset,ie.circleArray.length,ie.circleArray.length/2),null,C.zoom)}var ne;H.destroy(),q.destroy()}let Ru=r.a9.create();function fp(c){let n=c._camera.getWorldToCamera(c.worldSize,1),s=r.a9.multiply([],n,c.globeMatrix);r.a9.invert(s,s);let u=[0,0,0],m=[0,1,0,0];return r.aa.transformMat4(m,m,s),u[0]=m[0],u[1]=m[1],u[2]=m[2],r.Q.normalize(u,u),u}function $l({width:c,height:n,anchor:s,textOffset:u,textScale:m},_){let{horizontalAlign:b,verticalAlign:w}=r.bi(s),S=-(b-.5)*c,C=-(w-.5)*n,R=r.bh(s,u);return new r.P((S/m+R[0])*_,(C/m+R[1])*_)}function lm(c,n,s,u,m,_,b,w,S,C,R){let O=c.text.placedSymbolArray,F=c.text.dynamicLayoutVertexArray,B=c.icon.dynamicLayoutVertexArray,U={},j=c.getProjection(),G=Ro(w,j,_),q=_.elevation,H=j.upVectorScale(w.canonical,_.center.lat,_.worldSize).metersToTile;F.clear();for(let ne=0;ne<O.length;ne++){let ie=O.get(ne),{tileAnchorX:oe,tileAnchorY:$,numGlyphs:X}=ie,ue=ie.hidden||!ie.crossTileID||c.allowVerticalPlacement&&!ie.placedOrientation?null:u[ie.crossTileID];if(ue){let le=0,ge=0,Me=0;if(q){let De=q?q.getAtTileOffset(w,oe,$):0,[re,Ue,gt]=j.upVector(w.canonical,oe,$);le=De*re*H,ge=De*Ue*H,Me=De*gt*H}let[me,Ee,Re,pe]=xo(ie.projectedAnchorX+le,ie.projectedAnchorY+ge,ie.projectedAnchorZ+Me,s?G:b),xe=fc(_.getCameraToCenterDistance(j),pe),He=m.evaluateSizeForFeature(c.textSizeData,C,ie)*xe/r.bf;s&&(He*=c.tilePixelRatio/S);let ye=$l(ue,He);s?({x:me,y:Ee,z:Re}=j.projectTilePoint(oe+ye.x,$+ye.y,w.canonical),[me,Ee,Re]=xo(me+le,Ee+ge,Re+Me,b)):(n&&ye._rotate(-_.angle),me+=ye.x,Ee+=ye.y,Re=0);let Se=c.allowVerticalPlacement&&ie.placedOrientation===r.b9.vertical?Math.PI/2:0;for(let De=0;De<X;De++)r.bc(F,me,Ee,Re,Se);R&&ie.associatedIconIndex>=0&&(U[ie.associatedIconIndex]={x:me,y:Ee,z:Re,angle:Se})}else Pa(X,F)}if(R){B.clear();let ne=c.icon.placedSymbolArray;for(let ie=0;ie<ne.length;ie++){let oe=ne.get(ie),{numGlyphs:$}=oe,X=U[ie];if(oe.hidden||!X)Pa($,B);else{let{x:ue,y:le,z:ge,angle:Me}=X;for(let me=0;me<$;me++)r.bc(B,ue,le,ge,Me)}}c.icon.dynamicLayoutVertexBuffer.updateData(B)}c.text.dynamicLayoutVertexBuffer.updateData(F)}function Pu(c,n,s,u,m,_,b={}){let w=s.paint.get("icon-translate"),S=s.paint.get("text-translate"),C=s.paint.get("icon-translate-anchor"),R=s.paint.get("text-translate-anchor"),O=s.layout.get("icon-rotation-alignment"),F=s.layout.get("text-rotation-alignment"),B=s.layout.get("icon-pitch-alignment"),U=s.layout.get("text-pitch-alignment"),j=s.layout.get("icon-keep-upright"),G=s.layout.get("text-keep-upright"),q=s.paint.get("icon-color-saturation"),H=s.paint.get("icon-color-contrast"),ne=s.paint.get("icon-color-brightness-min"),ie=s.paint.get("icon-color-brightness-max"),oe=c.context,$=oe.gl,X=c.transform,ue=O==="map",le=F==="map",ge=B==="map",Me=U==="map",me=s.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ee=!1,Re=c.depthModeForSublayer(0,ze.ReadOnly),pe=[r.a8(X.center.lng),r.ah(X.center.lat)],xe=s.layout.get("text-variable-anchor"),He=X.projection.name==="globe",ye=[],Se=[0,-1,0];for(let De of u){let re=n.getTile(De),Ue=re.getBucket(s);if(!Ue||Ue.projection.name==="mercator"&&He||Ue.fullyClipped)continue;let gt=Ue.projection.name==="globe",Et=gt?r.W(X.zoom):0,Ot=Ro(De,Ue.getProjection(),X),At=X.calculatePixelsToTileUnitsMatrix(re),Nt=xe&&Ue.hasTextData(),xi=Ue.hasIconTextFit()&&Nt&&Ue.hasIconData(),ei=Ue.getProjection().createInversionMatrix(X,De.canonical),Di=()=>{let ui=ue&&s.layout.get("symbol-placement")!=="point",di=[],wn=ui||xi,mn=s.paint.get("icon-image-cross-fade").constantOr(0);c.terrainRenderModeElevated()&&ge&&di.push("PITCH_WITH_MAP_TERRAIN"),gt&&(di.push("PROJECTION_GLOBE_VIEW"),wn&&di.push("PROJECTED_POS_ON_VIEWPORT")),mn>0&&di.push("ICON_TRANSITION"),Ue.icon.zOffsetVertexBuffer&&di.push("Z_OFFSET"),q===0&&H===0&&ne===0&&ie===1||di.push("COLOR_ADJUSTMENT");let yi=Ue.icon.programConfigurations.get(s.id),oi=c.getOrCreateProgram(Ue.sdfIcons?"symbolSDF":"symbolIcon",{config:yi,defines:di}),wo,Yr=re.imageAtlasTexture?re.imageAtlasTexture.size:[0,0],Ir=Ue.iconSizeData,Kr=r.b8(Ir,X.zoom),To=ge||X.pitch!==0,ro=Nl(Ot,re.tileID.canonical,ge,ue,X,Ue.getProjection(),At),Sr=cs(Ot,re.tileID.canonical,ge,ue,X,Ue.getProjection(),At),Nr=c.translatePosMatrix(Sr,re,w,C,!0),Vr=c.translatePosMatrix(Ot,re,w,C),pa=wn?Ru:ro,Ns=ue&&!ge&&!ui,fa=Se;!He&&!X.mercatorFromTransition||ue||(fa=fp(X));let ma=gt?fa:Se;if(Ue.sdfIcons&&!Ue.iconsInText)wo=Tc(Ir.kind,Kr,Ns,ge,c,Vr,pa,Nr,!1,Yr,!0,De,Et,pe,ei,ma,Ue.getProjection());else{let Wa=s.getColorAdjustmentMatrix(q,H,ne,ie);wo=up(Ir.kind,Kr,Ns,ge,c,Vr,pa,Nr,!1,Yr,De,Et,pe,ei,ma,Ue.getProjection(),Wa,mn)}let xl=re.imageAtlasTexture?re.imageAtlasTexture:null,bs=s.layout.get("icon-size").constantOr(0)!==1||Ue.iconsNeedLinear,Wu=Ue.sdfIcons||c.options.rotating||c.options.zooming||bs||To?$.LINEAR:$.NEAREST,kc=Ue.sdfIcons&&s.paint.get("icon-halo-width").constantOr(1)!==0,Zu=c.terrain&&ge&&ui?r.a9.invert(r.a9.create(),ro):Ru;if(ui&&Ue.icon){let Wa=X.elevation,Mr=Wa?Wa.getAtTileOffsetFunc(De,X.center.lat,X.worldSize,Ue.getProjection()):null,Hu=$o(Ot,re.tileID.canonical,ge,ue,X,Ue.getProjection(),At);ra(Ue,Ot,c,!1,Hu,Sr,ge,j,Mr,De)}return{program:oi,buffers:Ue.icon,uniformValues:wo,atlasTexture:xl,atlasTextureIcon:null,atlasInterpolation:Wu,atlasInterpolationIcon:null,isSDF:Ue.sdfIcons,hasHalo:kc,tile:re,labelPlaneMatrixInv:Zu}},wi=()=>{let ui=le&&s.layout.get("symbol-placement")!=="point",di=[],wn=ui||xe||xi;c.terrainRenderModeElevated()&&Me&&di.push("PITCH_WITH_MAP_TERRAIN"),gt&&(di.push("PROJECTION_GLOBE_VIEW"),wn&&di.push("PROJECTED_POS_ON_VIEWPORT")),Ue.text.zOffsetVertexBuffer&&di.push("Z_OFFSET");let mn=Ue.text.programConfigurations.get(s.id),yi=c.getOrCreateProgram(Ue.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:mn,defines:di}),oi,wo=[0,0],Yr=null,Ir=Ue.textSizeData;Ue.iconsInText&&(wo=re.imageAtlasTexture?re.imageAtlasTexture.size:[0,0],Yr=re.imageAtlasTexture?re.imageAtlasTexture:null,oi=Me||X.pitch!==0||c.options.rotating||c.options.zooming||Ir.kind==="composite"||Ir.kind==="camera"?$.LINEAR:$.NEAREST);let Kr=re.glyphAtlasTexture?re.glyphAtlasTexture.size:[0,0],To=r.b8(Ir,X.zoom),ro=Nl(Ot,re.tileID.canonical,Me,le,X,Ue.getProjection(),At),Sr=cs(Ot,re.tileID.canonical,Me,le,X,Ue.getProjection(),At),Nr=c.translatePosMatrix(Sr,re,S,R,!0),Vr=c.translatePosMatrix(Ot,re,S,R),pa=wn?Ru:ro,Ns=le&&!Me&&!ui,fa=Se;!He&&!X.mercatorFromTransition||le||(fa=fp(X));let ma=gt?fa:Se,xl;xl=Ue.iconsInText?gl(Ir.kind,To,Ns,Me,c,Vr,pa,Nr,Kr,wo,De,Et,pe,ei,ma,Ue.getProjection()):Tc(Ir.kind,To,Ns,Me,c,Vr,pa,Nr,!0,Kr,!0,De,Et,pe,ei,ma,Ue.getProjection());let bs=re.glyphAtlasTexture?re.glyphAtlasTexture:null,Wu=$.LINEAR,kc=s.paint.get("text-halo-width").constantOr(1)!==0,Zu=c.terrain&&Me&&ui?r.a9.invert(r.a9.create(),ro):Ru;if(ui&&Ue.text){let Wa=X.elevation,Mr=Wa?Wa.getAtTileOffsetFunc(De,X.center.lat,X.worldSize,Ue.getProjection()):null,Hu=$o(Ot,re.tileID.canonical,Me,le,X,Ue.getProjection(),At);ra(Ue,Ot,c,!0,Hu,Sr,Me,G,Mr,De)}return{program:yi,buffers:Ue.text,uniformValues:xl,atlasTexture:bs,atlasTextureIcon:Yr,atlasInterpolation:Wu,atlasInterpolationIcon:oi,isSDF:!0,hasHalo:kc,tile:re,labelPlaneMatrixInv:Zu}},Cn=Ue.icon.segments.get().length,Xi=Ue.text.segments.get().length,dr=Cn&&!b.onlyText?Di():null,Jn=Xi&&!b.onlyIcons?wi():null,fn=s.paint.get("icon-opacity").constantOr(1),rn=s.paint.get("text-opacity").constantOr(1);if(me&&Ue.canOverlap){Ee=!0;let ui=fn&&!b.onlyText?Ue.icon.segments.get():[],di=rn&&!b.onlyIcons?Ue.text.segments.get():[];for(let wn of ui)ye.push({segments:new r.aE([wn]),sortKey:wn.sortKey,state:dr});for(let wn of di)ye.push({segments:new r.aE([wn]),sortKey:wn.sortKey,state:Jn})}else b.onlyText||ye.push({segments:fn?Ue.icon.segments:new r.aE([]),sortKey:0,state:dr}),b.onlyIcons||ye.push({segments:rn?Ue.text.segments:new r.aE([]),sortKey:0,state:Jn})}Ee&&ye.sort((De,re)=>De.sortKey-re.sortKey);for(let De of ye){let re=De.state;if(re)if(c.terrain&&c.terrain.setupElevationDraw(re.tile,re.program,{useDepthForOcclusion:X.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:re.labelPlaneMatrixInv}),oe.activeTexture.set($.TEXTURE0),re.atlasTexture&&re.atlasTexture.bind(re.atlasInterpolation,$.CLAMP_TO_EDGE,!0),re.atlasTextureIcon&&(oe.activeTexture.set($.TEXTURE1),re.atlasTextureIcon&&re.atlasTextureIcon.bind(re.atlasInterpolationIcon,$.CLAMP_TO_EDGE,!0)),c.uploadCommonLightUniforms(c.context,re.program),re.hasHalo){let Ue=re.uniformValues;Ue.u_is_halo=1,Gh(re.buffers,De.segments,s,c,re.program,Re,m,_,Ue,2),Ue.u_is_halo=0}else{if(re.isSDF){let Ue=re.uniformValues;re.hasHalo&&(Ue.u_is_halo=1,Gh(re.buffers,De.segments,s,c,re.program,Re,m,_,Ue,1)),Ue.u_is_halo=0}Gh(re.buffers,De.segments,s,c,re.program,Re,m,_,re.uniformValues,1)}}}function Gh(c,n,s,u,m,_,b,w,S,C){let R=[c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer,c.iconTransitioningVertexBuffer,c.globeExtVertexBuffer,c.zOffsetVertexBuffer];m.draw(u,u.context.gl.TRIANGLES,_,b,w,Tt.disabled,S,s.id,c.layoutVertexBuffer,c.indexBuffer,n,s.paint,u.transform.zoom,c.programConfigurations.get(s.id),R,C)}function qh(c,n,s,u,m,_,b){let w=c.context.gl,S=s.paint.get("fill-pattern"),C=S&&S.constantOr(1),R,O,F,B,U;b?(O=C&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=w.LINES):(O=C?"fillPattern":"fill",R=w.TRIANGLES);for(let j of u){let G=n.getTile(j);if(C&&!G.patternsLoaded())continue;let q=G.getBucket(s);if(!q)continue;c.prepareDrawTile();let H=q.programConfigurations.get(s.id),ne=c.isTileAffectedByFog(j),ie=c.getOrCreateProgram(O,{config:H,overrideFog:ne});C&&(c.context.activeTexture.set(w.TEXTURE0),G.imageAtlasTexture&&G.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),H.updatePaintBuffers());let oe=S.constantOr(null);if(oe&&G.imageAtlas){let ue=G.imageAtlas.patternPositions[oe.toString()];ue&&H.setConstantPatternPositions(ue)}let $=c.translatePosMatrix(j.projMatrix,G,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor")),X=s.paint.get("fill-emissive-strength");if(b){B=q.indexBuffer2,U=q.segments2;let ue=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[w.drawingBufferWidth,w.drawingBufferHeight];F=O==="fillOutlinePattern"&&C?Ga($,X,c,G,ue):q_($,X,ue)}else B=q.indexBuffer,U=q.segments,F=C?ml($,X,c,G):wc($,X);c.uploadCommonUniforms(c.context,ie,j.toUnwrapped()),ie.draw(c,R,m,c.stencilModeForClipping(j),_,Tt.disabled,F,s.id,q.layoutVertexBuffer,B,U,s.paint,c.transform.zoom,H,void 0)}}function pt(c,n,s,u,m,_,b,w){s.resetLayerRenderingStats(c);let S=c.context,C=S.gl,R=c.transform,O=s.paint.get("fill-extrusion-pattern"),F=O.constantOr(1),B=s.paint.get("fill-extrusion-opacity"),U=c.style.enable3dLights(),j=s.paint.get(U&&!F?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),G=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),j],q=s.layout.get("fill-extrusion-edge-radius"),H=q>0&&!s.paint.get("fill-extrusion-rounded-roof"),ne=H?0:q,ie=R.projection.name==="globe"?r.cM():0,oe=R.projection.name==="globe",$=oe?r.W(R.zoom):0,X=[r.a8(R.center.lng),r.ah(R.center.lat)],ue=s.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),le=s.paint.get("fill-extrusion-flood-light-intensity"),ge=s.paint.get("fill-extrusion-vertical-scale"),Me=wr(c,s.paint.get("fill-extrusion-cutoff-fade-range")),me=s.paint.get("fill-extrusion-emissive-strength"),Ee=[],Re;oe&&Ee.push("PROJECTION_GLOBE_VIEW"),G[0]>0&&Ee.push("FAUX_AO"),H&&Ee.push("ZERO_ROOF_RADIUS"),w&&Ee.push("HAS_CENTROID"),le>0&&Ee.push("FLOOD_LIGHT"),Me.shouldRenderCutoff&&Ee.push("RENDER_CUTOFF");let pe=c.renderPass==="shadow",xe=c.shadowRenderer,He=pe&&!!xe;c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!0);let ye=[0,0,0];if(xe){let re=c.style.directionalLight,Ue=c.style.ambientLight;re&&Ue&&(ye=ca(re,Ue)),Re=Ee.concat(["SHADOWS_SINGLE_CASCADE"])}let Se=He?"fillExtrusionDepth":F?"fillExtrusionPattern":"fillExtrusion",De=s.getLayerRenderingStats();for(let re of u){let Ue=n.getTile(re),gt=Ue.getBucket(s);if(!gt||gt.projection.name!==R.projection.name)continue;let Et=!1;xe&&(Et=xe.getMaxCascadeForTile(re.toUnwrapped())===0);let Ot=c.isTileAffectedByFog(re),At=gt.programConfigurations.get(s.id),Nt=c.getOrCreateProgram(Se,{config:At,defines:Et?Re:Ee,overrideFog:Ot});if(c.terrain&&c.terrain.setupElevationDraw(Ue,Nt,{useMeterToDem:!0}),!gt.centroidVertexBuffer){let Xi=Nt.attributes.a_centroid_pos;Xi!==void 0&&C.vertexAttrib2f(Xi,0,0)}!pe&&xe&&xe.setupShadows(Ue.tileID.toUnwrapped(),Nt,"vector-tile",Ue.tileID.overscaledZ),F&&(c.context.activeTexture.set(C.TEXTURE0),Ue.imageAtlasTexture&&Ue.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),At.updatePaintBuffers());let xi=O.constantOr(null);if(xi&&Ue.imageAtlas){let Xi=Ue.imageAtlas.patternPositions[xi.toString()];Xi&&At.setConstantPatternPositions(Xi)}let ei=s.paint.get("fill-extrusion-vertical-gradient"),Di;if(pe&&xe){if(qa(Ue.tileID,gt,c))continue;let Xi=xe.calculateShadowPassMatrixFromTile(Ue.tileID.toUnwrapped());Di=zs(Xi,ne,ge)}else{let Xi=c.translatePosMatrix(re.expandedProjMatrix,Ue,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),dr=R.projection.createInversionMatrix(R,re.canonical);Di=F?Su(Xi,c,ei,B,G,ne,re,Ue,ie,$,X,dr,ue,ge):jh(Xi,c,ei,B,G,ne,re,ie,$,X,dr,ue,ge,le,ye,me)}c.uploadCommonUniforms(S,Nt,re.toUnwrapped(),null,Me);let wi=gt.segments;if(R.projection.name==="mercator"&&!pe&&(wi=gt.getVisibleSegments(Ue.tileID,c.terrain,c.transform.getFrustum(0)),!wi.get().length))continue;if(De)if(pe)for(let Xi of wi.get())De.numRenderedVerticesInShadowPass+=Xi.primitiveLength;else for(let Xi of wi.get())De.numRenderedVerticesInTransparentPass+=Xi.primitiveLength;let Cn=[];(c.terrain||w)&&Cn.push(gt.centroidVertexBuffer),oe&&Cn.push(gt.layoutVertexExtBuffer),Nt.draw(c,S.gl.TRIANGLES,m,_,b,Tt.backCCW,Di,s.id,gt.layoutVertexBuffer,gt.indexBuffer,wi,s.paint,c.transform.zoom,At,Cn)}c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!1)}function Wl(c,n,s,u,m,_,b,w,S,C,R,O,F,B,U,j,G,q,H){let ne=c.context,ie=ne.gl,oe=c.transform,$=c.transform.zoom,X=[],ue=wr(c,s.paint.get("fill-extrusion-cutoff-fade-range"));C==="clear"?(X.push("CLEAR_SUBPASS"),H&&(X.push("CLEAR_FROM_TEXTURE"),ne.activeTexture.set(ie.TEXTURE0),H.bind(ie.LINEAR,ie.CLAMP_TO_EDGE))):C==="sdf"&&X.push("SDF_SUBPASS"),G&&X.push("HAS_CENTROID"),ue.shouldRenderCutoff&&X.push("RENDER_CUTOFF");let le=s.layout.get("fill-extrusion-edge-radius"),ge=(Me,me,Ee,Re,pe)=>{let xe=me.programConfigurations.get(s.id),He=c.isTileAffectedByFog(Me),ye=c.getOrCreateProgram("fillExtrusionGroundEffect",{config:xe,defines:X,overrideFog:He}),Se=((re,Ue,gt,Et,Ot,At,Nt,xi,ei,Di,wi)=>({u_matrix:Ue,u_opacity:gt,u_ao_pass:Et?1:0,u_meter_to_tile:Ot,u_ao:At,u_flood_light_intensity:Nt,u_flood_light_color:xi,u_attenuation:ei,u_edge_radius:Di,u_fb:0,u_fb_size:wi}))(0,Re,R,S,pe,[O,F*pe],B,U,j,$>=17?0:le*pe,H?H.size[0]:0),De=[];G&&De.push(me.hiddenByLandmarkVertexBuffer),c.uploadCommonUniforms(ne,ye,Me.toUnwrapped(),null,ue),ye.draw(c,ne.gl.TRIANGLES,m,_,b,w,Se,s.id,me.vertexBuffer,me.indexBuffer,Ee,s.paint,$,xe,De)};for(let Me of u){let me=n.getTile(Me),Ee=me.getBucket(s);if(!Ee||Ee.projection.name!==oe.projection.name||!Ee.groundEffect||Ee.groundEffect&&!Ee.groundEffect.hasData())continue;let Re=Ee.groundEffect,pe=1/Ee.tileToMeter;{let xe=c.translatePosMatrix(Me.projMatrix,me,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),He=Re.getDefaultSegment();ge(Me,Re,He,xe,pe)}if(q)for(let xe=0;xe<4;xe++){let He=r.cN[xe](Me),ye=n.getTile(He);if(!ye)continue;let Se=ye.getBucket(s);if(!Se||Se.projection.name!==oe.projection.name||!Se.groundEffect||Se.groundEffect&&!Se.groundEffect.hasData())continue;let De=Se.groundEffect,re,Ue;xe===0?(re=[-r.Y,0,0],Ue=1):xe===1?(re=[r.Y,0,0],Ue=0):xe===2?(re=[0,-r.Y,0],Ue=3):(re=[0,r.Y,0],Ue=2);let gt=De.regionSegments[Ue];if(!gt)continue;let Et=new Float32Array(16);r.a9.translate(Et,Me.projMatrix,re),ge(Me,De,gt,c.translatePosMatrix(Et,me,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),pe)}}}function mp(c,n,s,u,m,_,b){u.centroidVertexArray.length===0&&u.createCentroidsBuffer();let w=_?_.findDEMTileFor(s):null;if(!(w&&w.dem||b))return;let S=q=>new r.P(Math.ceil((q+r.cQ)*r.cR),0),C=q=>{let H=n.getSource().minzoom,ne=oe=>{let $=n.getTileByID(oe);if($&&$.hasData())return $.getBucket(m)},ie=[0,-1,1];for(let oe of ie){if(q.overscaledZ+oe<H)continue;let $=ne(q.calculateScaledKey(q.overscaledZ+oe));if($)return $}},R=[0,0,0],O=(q,H)=>(R[0]=Math.min(q.min.y,H.min.y),R[1]=Math.max(q.max.y,H.max.y),R[2]=r.Y-H.min.x>q.max.x?H.min.x-r.Y:q.max.x,R),F=(q,H)=>(R[0]=Math.min(q.min.x,H.min.x),R[1]=Math.max(q.max.x,H.max.x),R[2]=r.Y-H.min.y>q.max.y?H.min.y-r.Y:q.max.y,R),B=[(q,H)=>O(q,H),(q,H)=>O(H,q),(q,H)=>F(q,H),(q,H)=>F(H,q)],U=(q,H,ne,ie,oe,$,X)=>{if(!_)return 0;let ue=[[$?ne:q,$?q:ne,0],[$?ne:H,$?H:ne,0]],le=X<0?r.Y+X:X,ge=[$?le:(q+H)/2,$?(q+H)/2:le,0];return ne===0&&X<0||ne!==0&&X>0?_.getForTilePoints(oe,[ge],!0,ie):ue.push(ge),_.getForTilePoints(s,ue,!0,w),Math.max(ue[0][2],ue[1][2],ge[2])/_.exaggeration()};for(let q=0;q<4;q++){let H=u.borderFeatureIndices[q];if(H.length===0)continue;let ne=r.cN[q](s),ie=C(ne);if(!(ie&&ie instanceof r.cO)||u.borderDoneWithNeighborZ[q]===ie.canonical.z)continue;ie.centroidVertexArray.length===0&&ie.createCentroidsBuffer();let oe=_?_.findDEMTileFor(ne):null;if(!(oe&&oe.dem||b))continue;let $=(q<2?1:5)-q,X=ie.borderDoneWithNeighborZ[$]!==u.canonical.z,ue=ie.borderFeatureIndices[$],le=0;if(u.canonical.z!==ie.canonical.z){for(let ge of H)u.showCentroid(u.featuresOnBorder[ge]);if(X)for(let ge of ue)ie.showCentroid(ie.featuresOnBorder[ge]);u.borderDoneWithNeighborZ[q]=ie.canonical.z,ie.borderDoneWithNeighborZ[$]=u.canonical.z}for(let ge of H){let Me=u.featuresOnBorder[ge],me=u.centroidData[Me.centroidDataIndex],Ee=Me.borders[q],Re;for(;le<ue.length;){Re=ie.featuresOnBorder[ue[le]];let pe=Re.borders[$];if(pe[1]>Ee[0]+3||pe[0]>Ee[0]-3)break;ie.showCentroid(Re),le++}if(Re&&le<ue.length){let pe=le,xe=0;for(;!(Re.borders[$][0]>Ee[1]-3)&&(xe++,++le!==ue.length);)Re=ie.featuresOnBorder[ue[le]];if(Re=ie.featuresOnBorder[ue[pe]],xe>1){let Se=Re.borders[$];Math.abs(Ee[0]-Se[0])<3&&Math.abs(Ee[1]-Se[1])<3&&(xe=1,le=pe+1)}else if(xe===0){u.showCentroid(Me);continue}let He=ie.centroidData[Re.centroidDataIndex];b&&xe===1&&(((j=me).flags|(G=He).flags)&r.cP?(j.flags|=r.cP,G.flags|=r.cP):(j.flags&=~r.cP,G.flags&=~r.cP));let ye=Me.intersectsCount()>1||Re.intersectsCount()>1;if(xe>1)le=pe,me.centroidXY=He.centroidXY=new r.P(0,0);else if(oe&&oe.dem&&!ye){let Se=B[q](me,He),De=q%2?r.Y-1:0,re=U(Se[0],Math.min(r.Y-1,Se[1]),De,oe,ne,q<2,Se[2]);me.centroidXY=He.centroidXY=S(re)}else ye?me.centroidXY=He.centroidXY=new r.P(0,0):(me.centroidXY=u.encodeBorderCentroid(Me),He.centroidXY=ie.encodeBorderCentroid(Re));u.writeCentroidToBuffer(me),ie.writeCentroidToBuffer(He)}else u.showCentroid(Me)}u.borderDoneWithNeighborZ[q]=ie.canonical.z,ie.borderDoneWithNeighborZ[$]=u.canonical.z}var j,G;(u.needsCentroidUpdate||!u.centroidVertexBuffer&&u.centroidVertexArray.length!==0)&&u.uploadCentroid(c)}let gp=[1,0,0],cm=[0,1,0],$h=[0,0,1];function qa(c,n,s){let u=s.transform,m=s.shadowRenderer;if(!m)return!0;let _=c.toUnwrapped(),b=u.tileSize*m._cascades[s.currentShadowCascade].scale,w=n.maxHeight;if(u.elevation){let j=u.elevation.getMinMaxForTile(c);j&&(w+=j.max)}let S=[...m.shadowDirection];S[2]=-S[2];let C=m.computeSimplifiedTileShadowVolume(_,w,b,S);if(!C)return!1;let R=[gp,cm,$h,S,[S[0],0,S[2]],[0,S[1],S[2]]],O=u.projection.name==="globe",F=u.scaleZoom(b),B=r.bt.fromInvProjectionMatrix(u.invProjMatrix,u.worldSize,F,!O),U=m.getCurrentCascadeFrustum();return B.intersectsPrecise(C.vertices,C.planes,R)===0||U.intersectsPrecise(C.vertices,C.planes,R)===0}function Wh(c){return[c[0]*r.cS,c[1]*r.cS,c[2]*r.cS,0]}function $a(c,n,s,u,m,_,b,w,S){let C=u.getSource(),R=s.globeSharedBuffers;if(!R)return;let O,F,B;if(n&&(O=u.getTile(n)),C instanceof r.as?(F=C.texture,B=r.co(0,0,s.transform)):O&&n&&(F=O.texture,B=r.co(n.canonical.z,n.canonical.x,s.transform)),!F||!B)return;c||(B=r.a9.scale(r.a9.create(),B,[1,-1,1]));let U=s.context,j=U.gl,G=m.paint.get("raster-resampling")==="nearest"?j.NEAREST:j.LINEAR,q=s.colorModeForDrapableLayerRenderPass(_),H=b.defines;H.push("GLOBE_POLES");let ne=new ze(j.LEQUAL,ze.ReadWrite,s.depthRangeFor3D),ie=Float32Array.from(s.transform.expandedFarZProjMatrix),oe=Float32Array.from(r.aW(r.cn(new r.bv(0,0,0))));s.terrain&&s.terrain.prepareDrawTile(),U.activeTexture.set(j.TEXTURE0),F.bind(G,j.CLAMP_TO_EDGE),U.activeTexture.set(j.TEXTURE1),F.bind(G,j.CLAMP_TO_EDGE),F.useMipmap&&U.extTextureFilterAnisotropic&&s.transform.pitch>20&&j.texParameterf(j.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax);let[$,X,ue,le]=n?R.getPoleBuffers(n.canonical.z,!1):R.getPoleBuffers(0,!0),ge=m.paint.get("raster-elevation"),Me;c?(Me=$,s.renderDefaultNorthPole=ge!==0):(Me=X,s.renderDefaultSouthPole=ge!==0);let me=Wh(b.mix),Ee=((pe,xe,He,ye,Se,De,re,Ue,gt,Et,Ot,At,Nt)=>sm(pe,xe,He,new Float32Array(16),new Float32Array(9),[0,0],ye,[0,0],[0,0,0,0],1,{opacity:1,mix:0},De,[0,0],Ue,2,Et,Ot,At,1,0,Nt))(ie,oe,B,r.W(s.transform.zoom),0,m,0,ge,0,me,b.offset,b.range,_),Re=s.getOrCreateProgram("raster",{defines:H});s.uploadCommonUniforms(U,Re,null),Re.draw(s,j.TRIANGLES,ne,S,q,w,Ee,m.id,Me,ue,le)}function Zh(c){let n=c._nearZ,s=c.projection.farthestPixelDistance(c),u=s-n,m=.2*c.height,_=n+m;return[n,s,(_-m-n)/u,(_-n)/u]}function Ec(c,n,s,u){if(c)return n instanceof rt&&c instanceof Ll?n.getTextureDescriptor(c,s,!0):{texture:c.texture,mix:Wh(u.mix),offset:u.offset,buffer:0,tileSize:1}}function Y_(c,n,s){if(!c)return null;let u=n.getTextureDescriptor(c,s,!0);if(!u)return null;let{texture:m,mix:_,offset:b,tileSize:w,buffer:S,format:C}=u;if(!m||!C)return null;let R=!1;return C==="uint32"&&(R=!0,_[3]=0,_=Mu(r.cT,_,[0,s.paint.get("raster-particle-max-speed")]),b=cp(r.cT,b,[0,s.paint.get("raster-particle-max-speed")])),{texture:m,textureOffset:[S/(w+2*S),w/(w+2*S)],tileSize:w,scalarData:R,scale:_,offset:b,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[C]]}}function K_(c){let n=c._nearZ,s=c.projection.farthestPixelDistance(c),u=s-n,m=.2*c.height,_=n+m;return[n,s,(_-m-n)/u,(_-n)/u]}let _p=new r.aA(1,0,0,1),J_=new r.aA(0,1,0,1),um=new r.aA(0,0,1,1),hm=new r.aA(1,0,1,1),yp=new r.aA(0,1,1,1);function Ic(c,n,s,u,m,_,b){let w=c.context,S=c.transform,C=w.gl,R=S.projection.name==="globe",O=R?["PROJECTION_GLOBE_VIEW"]:[],F=r.a9.clone(s.projMatrix);if(R&&r.W(S.zoom)>0){let me=r.aV(s.canonical,S),Ee=r.cU(me);F=r.a9.multiply(new Float32Array(16),S.globeMatrix,Ee),r.a9.multiply(F,S.projMatrix,F)}let B=r.a9.create();B[12]+=2*m/(r.f.devicePixelRatio*S.width),B[13]+=2*_/(r.f.devicePixelRatio*S.height),r.a9.multiply(F,B,F);let U=c.getOrCreateProgram("debug",{defines:O}),j=n.getTileByID(s.key);c.terrain&&c.terrain.setupElevationDraw(j,U);let G=ze.disabled,q=kt.disabled,H=c.colorModeForRenderPass(),ne="$debug";w.activeTexture.set(C.TEXTURE0),c.emptyTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),R?j._makeGlobeTileDebugBuffers(c.context,S):j._makeDebugTileBoundsBuffers(c.context,S.projection);let ie=j._tileDebugBuffer||c.debugBuffer,oe=j._tileDebugIndexBuffer||c.debugIndexBuffer,$=j._tileDebugSegments||c.debugSegments;if(U.draw(c,C.LINE_STRIP,G,q,H,Tt.disabled,lp(F,u),ne,ie,oe,$,null,null,null,[j._globeTileDebugBorderBuffer]),b){let me=j.latestRawTileData,Ee=Math.floor((me&&me.byteLength||0)/1024),Re=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(Re+=` => ${s.overscaledZ}`),Re+=` ${j.state}`,Re+=` ${Ee}kb`,function(pe,xe){pe.initDebugOverlayCanvas();let He=pe.debugOverlayCanvas,ye=pe.context.gl,Se=pe.debugOverlayCanvas.getContext("2d");Se.clearRect(0,0,He.width,He.height),Se.shadowColor="white",Se.shadowBlur=2,Se.lineWidth=1.5,Se.strokeStyle="white",Se.textBaseline="top",Se.font="bold 36px Open Sans, sans-serif",Se.fillText(xe,5,5),Se.strokeText(xe,5,5),pe.debugOverlayTexture.update(He),pe.debugOverlayTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE)}(c,Re)}let X=n.getTile(s).tileSize,ue=512/Math.min(X,512)*(s.overscaledZ/S.zoom)*.5,le=j._tileDebugTextBuffer||c.debugBuffer,ge=j._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,Me=j._tileDebugTextSegments||c.debugSegments;U.draw(c,C.TRIANGLES,G,q,qt.alphaBlended,Tt.disabled,lp(F,r.aA.transparent,ue),ne,le,ge,Me,null,null,null,[j._globeTileDebugTextBuffer])}function dm(c,n,s,u){Hh(c,0,n+s/2,c.transform.width,s,u)}function pm(c,n,s,u){Hh(c,n-s/2,0,s,c.transform.height,u)}function Hh(c,n,s,u,m,_){let b=c.context,w=b.gl;w.enable(w.SCISSOR_TEST),w.scissor(n*r.f.devicePixelRatio,s*r.f.devicePixelRatio,u*r.f.devicePixelRatio,m*r.f.devicePixelRatio),b.clear({color:_}),w.disable(w.SCISSOR_TEST)}let fm=r.aB([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ey}=fm;function Bs(c,n,s,u){c.emplaceBack(n,s,u)}class mm{constructor(n){this.vertexArray=new r.cV,this.indices=new r.az,Bs(this.vertexArray,-1,-1,1),Bs(this.vertexArray,1,-1,1),Bs(this.vertexArray,-1,1,1),Bs(this.vertexArray,1,1,1),Bs(this.vertexArray,-1,-1,-1),Bs(this.vertexArray,1,-1,-1),Bs(this.vertexArray,-1,1,-1),Bs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,ey),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=r.aE.simpleSegment(0,0,36,12)}}function Zl(c,n,s,u,m,_){let b=c.context.gl,w=n.paint.get("sky-atmosphere-color"),S=n.paint.get("sky-atmosphere-halo-color"),C=n.paint.get("sky-atmosphere-sun-intensity"),R=((O,F,B,U,j)=>({u_matrix_3f:O,u_sun_direction:F,u_sun_intensity:B,u_color_tint_r:[U.r,U.g,U.b,U.a],u_color_tint_m:[j.r,j.g,j.b,j.a],u_luminance:5e-5}))(r.ct.fromMat4(r.ct.create(),u),m,C,w,S);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+_,n.skyboxTexture,0),s.draw(c,b.TRIANGLES,ze.disabled,kt.disabled,qt.unblended,Tt.frontCW,R,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}let vp=r.aB([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Qh{constructor(n){let s=new r.cW;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);let u=new r.az;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(s,vp.members),this.indexBuffer=n.createIndexBuffer(u),this.segments=r.aE.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let bp=r.aB([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Hl{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class xp{constructor(n){this.colorModeAlphaBlendedWriteRGB=new qt([1,bi,1,bi],r.aA.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new qt([1,0,1,0],r.aA.transparent,[!1,!1,!1,!0]),this.params=new Hl,this.updateNeeded=!0,n.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),n.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(n){let s=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Qh(s);let u=this.params.sizeRange,m=this.params.intensityRange,_=function(R){let O=r.aC(30),F=[];for(let B=0;B<R;++B){let U=2*Math.PI*O(),j=Math.acos(1-2*O())-.5*Math.PI;F.push(r.Q.fromValues(Math.cos(j)*Math.cos(U),Math.cos(j)*Math.sin(U),Math.sin(j)))}return F}(this.params.starsCount),b=r.aC(300),w=new r.cX,S=new r.az,C=0;for(let R=0;R<_.length;++R){let O=r.Q.scale([],_[R],200),F=Math.max(0,1+.01*u*(1*b()-.5)),B=Math.max(0,1+.01*m*(1*b()-.5));w.emplaceBack(O[0],O[1],O[2],-1,-1,F,B),w.emplaceBack(O[0],O[1],O[2],1,-1,F,B),w.emplaceBack(O[0],O[1],O[2],1,1,F,B),w.emplaceBack(O[0],O[1],O[2],-1,1,F,B),S.emplaceBack(C+0,C+1,C+2),S.emplaceBack(C+0,C+2,C+3),C+=4}this.starsVx=s.createVertexBuffer(w,bp.members),this.starsIdx=s.createIndexBuffer(S),this.starsSegments=r.aE.simpleSegment(0,0,w.length,S.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,s){let u=n.context,m=u.gl,_=n.transform,b=new ze(m.LEQUAL,ze.ReadOnly,[0,1]),w=r.W(_.zoom),S=s.properties.get("color").toArray01(),C=s.properties.get("high-color").toArray01(),R=s.properties.get("space-color").toArray01PremultipliedAlpha(),O=5e-4,F=r.cY(s.properties.get("horizon-blend"),0,1,O,.25),B=r.ci(n,u,_)&&F===O?_.worldSize/(2*Math.PI*1.025)-1:_.globeRadius,U=n.frameCounter/1e3%1,j=r.Q.length(_.globeCenterInViewSpace),G=Math.sqrt(Math.pow(j,2)-Math.pow(B,2)),q=Math.acos(G/j),H=ne=>{let ie=_.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ne&&ie.push("ALPHA_PASS");let oe=n.getOrCreateProgram("globeAtmosphere",{defines:ie}),$=((ue,le,ge,Me,me,Ee,Re,pe,xe,He,ye,Se)=>({u_frustum_tl:ue,u_frustum_tr:le,u_frustum_br:ge,u_frustum_bl:Me,u_horizon:me,u_transition:Ee,u_fadeout_range:Re,u_color:pe,u_high_color:xe,u_space_color:He,u_temporal_offset:ye,u_horizon_angle:Se}))(_.frustumCorners.TL,_.frustumCorners.TR,_.frustumCorners.BR,_.frustumCorners.BL,_.frustumCorners.horizon,w,F,S,C,R,U,q);n.uploadCommonUniforms(u,oe);let X=this.atmosphereBuffer;X&&oe.draw(n,m.TRIANGLES,b,kt.disabled,ne?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Tt.backCW,$,ne?"atmosphere_glow_alpha":"atmosphere_glow",X.vertexBuffer,X.indexBuffer,X.segments)};H(!1),H(!0)}drawStars(n,s){let u=r.ad(s.properties.get("star-intensity"),0,1);if(u===0)return;let m=n.context,_=m.gl,b=n.transform,w=n.getOrCreateProgram("stars"),S=r.bl.identity([]);r.bl.rotateX(S,S,-b._pitch),r.bl.rotateZ(S,S,-b.angle),r.bl.rotateX(S,S,r.bm(b._center.lat)),r.bl.rotateY(S,S,-r.bm(b._center.lng));let C=r.a9.fromQuat(new Float32Array(16),S),R=r.a9.multiply([],b.starsProjMatrix,C),O=r.ct.fromMat4([],C),F=r.ct.invert([],O),B=[0,1,0];r.Q.transformMat3(B,B,F),r.Q.scale(B,B,this.params.sizeMultiplier);let U=[1,0,0];r.Q.transformMat3(U,U,F),r.Q.scale(U,U,this.params.sizeMultiplier);let j=(G=B,q=U,H=u,{u_matrix:Float32Array.from(R),u_up:G,u_right:q,u_intensity_multiplier:H});var G,q,H;n.uploadCommonUniforms(m,w),this.starsVx&&this.starsIdx&&w.draw(n,_.TRIANGLES,ze.disabled,kt.disabled,this.colorModeAlphaBlendedWriteRGB,Tt.disabled,j,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function wp(c,n){let s=[...c],u=n.cameraWorldSizeForFog/n.worldSize,m=r.a9.identity([]);return r.a9.scale(m,m,[u,u,1]),r.a9.multiply(s,m,s),r.a9.multiply(s,n.worldToFogMatrix,s),s}function _l(c,n,s,u){let m=s.material,_=u.context,{baseColorTexture:b,metallicRoughnessTexture:w}=m.pbrMetallicRoughness,{normalTexture:S,occlusionTexture:C,emissionTexture:R}=m;function O(F,B,U){if(F&&(c.push(B),_.activeTexture.set(_.gl.TEXTURE0+U),F.gfxTexture)){let{minFilter:j,magFilter:G,wrapS:q,wrapT:H}=F.sampler;F.gfxTexture.bindExtraParam(j,G,q,H)}}O(b,"HAS_TEXTURE_u_baseColorTexture",hn.BaseColor),O(w,"HAS_TEXTURE_u_metallicRoughnessTexture",hn.MetallicRoughness),O(S,"HAS_TEXTURE_u_normalTexture",hn.Normal),O(C,"HAS_TEXTURE_u_occlusionTexture",hn.Occlusion),O(R,"HAS_TEXTURE_u_emissionTexture",hn.Emission),s.texcoordBuffer&&(c.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(s.texcoordBuffer)),s.colorBuffer&&(c.push(s.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(s.colorBuffer)),s.normalBuffer&&(c.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(s.normalBuffer)),s.pbrBuffer&&(c.push("HAS_ATTRIBUTE_a_pbr"),c.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(s.pbrBuffer)),m.alphaMode!=="OPAQUE"&&m.alphaMode!=="MASK"||c.push("UNPREMULT_TEXTURE_IN_SHADER"),m.defined||c.push("DIFFUSE_SHADED"),c.push("USE_STANDARD_DERIVATIVES")}function yl(c,n,s,u,m,_){let b=s.paint.get("model-opacity"),w=n.context,S=new ze(n.context.gl.LEQUAL,ze.ReadWrite,n.depthRangeFor3D),C=n.transform,R=c.mesh,O=R.material,F=O.pbrMetallicRoughness,B=n.style.fog,U;U=n.transform.projection.zAxisUnit==="pixels"?[...c.nodeModelMatrix]:r.a9.multiply([],u.zScaleMatrix,c.nodeModelMatrix),r.a9.multiply(U,u.negCameraPosMatrix,U);let j=r.a9.invert([],U);r.a9.transpose(j,j);let G=s.paint.get("model-emissive-strength").constantOr(0),q=Uh(new Float32Array(c.worldViewProjection),new Float32Array(U),new Float32Array(j),null,n,b,F.baseColorFactor,O.emissiveFactor,F.metallicFactor,F.roughnessFactor,O,G,s),H={defines:[]},ne=[];_l(H.defines,ne,R,n);let ie=n.shadowRenderer;ie&&(ie.useNormalOffset=!1);let oe=null;if(B){let ue=wp(c.nodeModelMatrix,n.transform);if(oe=new Float32Array(ue),C.projection.name!=="globe"){let le=R.aabb.min,ge=R.aabb.max,[Me,me]=B.getOpacityForBounds(ue,le[0],le[1],ge[0],ge[1]);H.overrideFog=Me>=Fi||me>=Fi}}let $=wr(n,s.paint.get("model-cutoff-fade-range"));$.shouldRenderCutoff&&H.defines.push("RENDER_CUTOFF");let X=n.getOrCreateProgram("model",H);n.uploadCommonUniforms(w,X,null,oe,$),n.renderPass!=="shadow"&&ie&&ie.setupShadowsFromMatrix(c.nodeModelMatrix,X),X.draw(n,w.gl.TRIANGLES,S,m,_,R.material.doubleSided?Tt.disabled:Tt.backCCW,q,s.id,R.vertexBuffer,R.indexBuffer,R.segments,s.paint,n.transform.zoom,void 0,ne)}function ku(c,n,s,u,m,_,b){let w;w=c.projection.name==="globe"?r.c_(s,c):[...s],r.a9.multiply(w,w,n.matrix);let S=r.a9.multiply([],u,w);if(n.meshes)for(let C of n.meshes){if(C.material.alphaMode!=="BLEND"){b.push({mesh:C,depth:0,modelIndex:m,worldViewProjection:S,nodeModelMatrix:w});continue}let R=r.Q.transformMat4([],C.centroid,S);R[2]>0&&_.push({mesh:C,depth:R[2],modelIndex:m,worldViewProjection:S,nodeModelMatrix:w})}if(n.children)for(let C of n.children)ku(c,C,s,u,m,_,b)}function Ou(c,n,s,u){let m=s.shadowRenderer;if(!m)return;let _=m.getShadowPassDepthMode(),b=m.getShadowPassColorMode(),w=m.calculateShadowPassMatrixFromMatrix(n),S=am(w);s.getOrCreateProgram("modelDepth",{defines:s._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(s,s.context.gl.TRIANGLES,_,kt.disabled,b,Tt.backCCW,S,u.id,c.vertexBuffer,c.indexBuffer,c.segments,u.paint,s.transform.zoom,void 0,void 0)}function Lu(c,n,s){let u=n.updateZoomBasedPaintProperties(),m=function(_,b,w){let S,C,R,O=_.terrain?_.terrain.exaggeration():0;if(_.terrain&&O>0){let F=_.terrain,B=F.findDEMTileFor(w);B&&B.dem?S=r.d0.create(F,w,B):O=0}if(O===0&&(b.terrainElevationMin=0,b.terrainElevationMax=0),O===b.validForExaggeration&&(O===0||S&&S._demTile&&S._demTile.tileID===b.validForDEMTile.id&&S._dem._timestamp===b.validForDEMTile.timestamp))return!1;for(let F in b.instancesPerModel){let B=b.instancesPerModel[F];for(let U=0;U<B.instancedDataArray.length;++U){let j=(S?O*S.getElevationAt(0|B.instancedDataArray.float32[16*U],0|B.instancedDataArray.float32[16*U+1],!0,!0):0)+B.instancesEvaluatedElevation[U];B.instancedDataArray.float32[16*U+6]=j,C=C?Math.min(b.terrainElevationMin,j):j,R=R?Math.max(b.terrainElevationMax,j):j}}return b.terrainElevationMin=C||0,b.terrainElevationMax=R||0,b.validForExaggeration=O,b.validForDEMTile=S&&S._demTile?{id:S._demTile.tileID,timestamp:S._dem._timestamp}:{id:void 0,timestamp:0},!0}(c,n,s);(u||m)&&(n.uploaded=!1,n.upload(c.context))}let Ko={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.bV([0,0,0],[r.Y,r.Y,0])};function Xh(c,n){let s=1<<c.canonical.z,u=n.getFreeCameraOptions().position,m=n.elevation,_=c.canonical.x/s,b=(c.canonical.x+1)/s,w=c.canonical.y/s,S=(c.canonical.y+1)/s,C=n._centerAltitude;if(m){let B=m.getMinMaxForTile(c);B&&B.max>C&&(C=B.max)}let R=r.ad(u.x,_,b)-u.x,O=r.ad(u.y,w,S)-u.y,F=r.bo(C,n.center.lat)-u.z;return n._zoomFromMercatorZ(Math.sqrt(R*R+O*O+F*F))}function Yh(c,n,s,u,m,_,b){let w=c.context,S=c.renderPass==="shadow",C=c.shadowRenderer,R=S&&C?C.getShadowPassDepthMode():new ze(w.gl.LEQUAL,ze.ReadWrite,c.depthRangeFor3D),O=c.isTileAffectedByFog(_);if(s.meshes)for(let F of s.meshes){let B=["MODEL_POSITION_ON_GPU"],U=[],j,G,q;u.instancedDataArray.length>20&&B.push("INSTANCED_ARRAYS");let H=wr(c,n.paint.get("model-cutoff-fade-range"));if(H.shouldRenderCutoff&&B.push("RENDER_CUTOFF"),S&&C)j=c.getOrCreateProgram("modelDepth",{defines:B}),G=am(b.shadowTileMatrix,b.shadowTileMatrix,Float32Array.from(s.matrix)),q=C.getShadowPassColorMode();else{_l(B,U,F,c),j=c.getOrCreateProgram("model",{defines:B,overrideFog:O});let ie=F.material,oe=ie.pbrMetallicRoughness,$=n.paint.get("model-opacity"),X=n.paint.get("model-emissive-strength").constantOr(0);G=Uh(_.expandedProjMatrix,Float32Array.from(s.matrix),new Float32Array(16),null,c,$,oe.baseColorFactor,ie.emissiveFactor,oe.metallicFactor,oe.roughnessFactor,ie,X,n,m),C&&(b.shadowUniformsInitialized?j.setShadowUniformValues(w,C.getShadowUniformValues()):(C.setupShadows(_.toUnwrapped(),j,"model-tile",_.overscaledZ),b.shadowUniformsInitialized=!0)),q=H.shouldRenderCutoff||$<1||ie.alphaMode!=="OPAQUE"?qt.alphaBlended:qt.unblended}c.uploadCommonUniforms(w,j,_.toUnwrapped(),null,H);let ne=F.material.doubleSided?Tt.disabled:Tt.backCCW;if(u.instancedDataArray.length>20)U.push(u.instancedDataBuffer),j.draw(c,w.gl.TRIANGLES,R,kt.disabled,q,ne,G,n.id,F.vertexBuffer,F.indexBuffer,F.segments,n.paint,c.transform.zoom,void 0,U,u.instancedDataArray.length);else{let ie=S?"u_instance":"u_normal_matrix";for(let oe=0;oe<u.instancedDataArray.length;++oe)G[ie]=new Float32Array(u.instancedDataArray.arrayBuffer,64*oe,16),j.draw(c,w.gl.TRIANGLES,R,kt.disabled,q,ne,G,n.id,F.vertexBuffer,F.indexBuffer,F.segments,n.paint,c.transform.zoom,void 0,U)}}if(s.children)for(let F of s.children)Yh(c,n,F,u,m,_,b)}let Kh=[1,-1,1];function Fu(c,n,s,u){if(!s.modelManager)return!0;let m=s.modelManager;if(!s.shadowRenderer)return!0;let _=s.shadowRenderer,b=n.aabb,w=!0,S=c.maxHeight;if(S===0){let R=0;for(let O in c.instancesPerModel){let F=m.getModel(O,u);F?R=Math.max(R,Math.max(Math.max(F.aabb.max[0],F.aabb.max[1]),F.aabb.max[2])):w=!1}S=c.maxScale*R*1.41+c.maxVerticalOffset,w&&(c.maxHeight=S)}b.max[2]=S,b.min[2]+=c.terrainElevationMin,b.max[2]+=c.terrainElevationMax,r.Q.transformMat4(b.min,b.min,n.tileMatrix),r.Q.transformMat4(b.max,b.max,n.tileMatrix);let C=b.intersects(_.getCurrentCascadeFrustum());return s.currentShadowCascade===0&&(c.isInsideFirstShadowMapFrustum=C===2),C===0}class gm{}class _m{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,s,u){{let O=this._storage.get(s.id);if(O)return O.lastUsedFrameIdx=n,O.buf}let m=u.gl,_=m.getBufferParameter(m.ELEMENT_ARRAY_BUFFER,m.BUFFER_SIZE),b=new ArrayBuffer(_),w=new Int16Array(b);m.getBufferSubData(m.ELEMENT_ARRAY_BUFFER,0,new Int16Array(b));let S=new r.d2;for(let O=0;O<_/2;O+=3){let F=w[O],B=w[O+1],U=w[O+2];S.emplaceBack(F,B),S.emplaceBack(B,U),S.emplaceBack(U,F)}let C=u.bindVertexArrayOES.current,R=new gm;return R.buf=new Rn(u,S),R.lastUsedFrameIdx=n,this._storage.set(s.id,R),u.bindVertexArrayOES.set(C),R.buf}update(n){for(let[s,u]of this._storage)n-u.lastUsedFrameIdx>30&&(u.buf.destroy(),this._storage.delete(s))}destroy(){for(let[n,s]of this._storage)s.buf.destroy(),this._storage.delete(n)}}let Jh={symbol:function(c,n,s,u,m){if(c.renderPass!=="translucent")return;let _=kt.disabled,b=c.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(C,R,O,F,B,U,j){let G=R.transform,q=B==="map",H=U==="map";for(let ne of C){let ie=F.getTile(ne),oe=ie.getBucket(O);if(!oe||!oe.text||!oe.text.segments.get().length)continue;let $=r.b8(oe.textSizeData,G.zoom),X=Ro(ne,oe.getProjection(),G),ue=G.calculatePixelsToTileUnitsMatrix(ie),le=Nl(X,ie.tileID.canonical,H,q,G,oe.getProjection(),ue),ge=oe.hasIconTextFit()&&oe.hasIconData();if($){let Me=Math.pow(2,G.zoom-ie.tileID.overscaledZ);lm(oe,q,H,j,r.cE,G,le,ne,Me,$,ge)}}}(u,c,s,n,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),m);let w=s.paint.get("icon-opacity").constantOr(1)!==0,S=s.paint.get("text-opacity").constantOr(1)!==0;s.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(w||S)?Pu(c,n,s,u,_,b):(w&&Pu(c,n,s,u,_,b,{onlyIcons:!0}),S&&Pu(c,n,s,u,_,b,{onlyText:!0})),n.map.showCollisionBoxes&&(pp(c,n,s,u,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),pp(c,n,s,u,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(c,n,s,u){if(c.renderPass!=="translucent")return;let m=s.paint.get("circle-opacity"),_=s.paint.get("circle-stroke-width"),b=s.paint.get("circle-stroke-opacity"),w=s.layout.get("circle-sort-key").constantOr(1)!==void 0,S=s.paint.get("circle-emissive-strength");if(m.constantOr(1)===0&&(_.constantOr(1)===0||b.constantOr(1)===0))return;let C=c.context,R=C.gl,O=c.transform,F=c.depthModeForSublayer(0,ze.ReadOnly),B=kt.disabled,U=c.colorModeForDrapableLayerRenderPass(S),j=O.projection.name==="globe",G=[r.a8(O.center.lng),r.ah(O.center.lat)],q=[];for(let ne=0;ne<u.length;ne++){let ie=u[ne],oe=n.getTile(ie),$=oe.getBucket(s);if(!$||$.projection.name!==O.projection.name)continue;let X=$.programConfigurations.get(s.id),ue=r.cF(s),le=c.isTileAffectedByFog(ie);j&&ue.push("PROJECTION_GLOBE_VIEW");let ge=c.getOrCreateProgram("circle",{config:X,defines:ue,overrideFog:le}),Me=$.layoutVertexBuffer,me=$.globeExtVertexBuffer,Ee=$.indexBuffer,Re=O.projection.createInversionMatrix(O,ie.canonical),pe={programConfiguration:X,program:ge,layoutVertexBuffer:Me,globeExtVertexBuffer:me,indexBuffer:Ee,uniformValues:r.cG(c,ie,oe,Re,G,s),tile:oe};if(w){let xe=$.segments.get();for(let He of xe)q.push({segments:new r.aE([He]),sortKey:He.sortKey,state:pe})}else q.push({segments:$.segments,sortKey:0,state:pe})}w&&q.sort((ne,ie)=>ne.sortKey-ie.sortKey);let H={useDepthForOcclusion:O.depthOcclusionForSymbolsAndCircles};for(let ne of q){let{programConfiguration:ie,program:oe,layoutVertexBuffer:$,globeExtVertexBuffer:X,indexBuffer:ue,uniformValues:le,tile:ge}=ne.state,Me=ne.segments;c.terrain&&c.terrain.setupElevationDraw(ge,oe,H),c.uploadCommonUniforms(C,oe,ge.tileID.toUnwrapped()),oe.draw(c,R.TRIANGLES,F,B,U,Tt.disabled,le,s.id,$,ue,Me,s.paint,O.zoom,ie,[X])}},heatmap:function(c,n,s,u){if(s.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){let m=c.context,_=m.gl,b=kt.disabled,w=new qt([_.ONE,_.ONE,_.ONE,_.ONE],r.aA.transparent,[!0,!0,!0,!0]);(function(B,U,j,G){let q=B.gl,H=U.width*G,ne=U.height*G;B.activeTexture.set(q.TEXTURE1),B.viewport.set([0,0,H,ne]);let ie=j.heatmapFbo;if(!ie||ie&&(ie.width!==H||ie.height!==ne)){ie&&ie.destroy();let oe=q.createTexture();q.bindTexture(q.TEXTURE_2D,oe),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR),ie=j.heatmapFbo=B.createFramebuffer(H,ne,!0,null),function($,X,ue,le,ge,Me){let me=$.gl;me.texImage2D(me.TEXTURE_2D,0,$.extRenderToTextureHalfFloat?me.RGBA16F:me.RGBA,ge,Me,0,me.RGBA,$.extRenderToTextureHalfFloat?me.HALF_FLOAT:me.UNSIGNED_BYTE,null),le.colorAttachment.set(ue)}(B,0,oe,ie,H,ne)}else q.bindTexture(q.TEXTURE_2D,ie.colorAttachment.get()),B.bindFramebuffer.set(ie.framebuffer)})(m,c,s,c.transform.projection.name==="globe"?.5:.25),m.clear({color:r.aA.transparent});let S=c.transform,C=S.projection.name==="globe",R=C?["PROJECTION_GLOBE_VIEW"]:[],O=C?Tt.frontCCW:Tt.disabled,F=[r.a8(S.center.lng),r.ah(S.center.lat)];for(let B=0;B<u.length;B++){let U=u[B];if(n.hasRenderableParent(U))continue;let j=n.getTile(U),G=j.getBucket(s);if(!G||G.projection.name!==S.projection.name)continue;let q=c.isTileAffectedByFog(U),H=G.programConfigurations.get(s.id),ne=c.getOrCreateProgram("heatmap",{config:H,defines:R,overrideFog:q}),{zoom:ie}=c.transform;c.terrain&&c.terrain.setupElevationDraw(j,ne),c.uploadCommonUniforms(m,ne,U.toUnwrapped());let oe=S.projection.createInversionMatrix(S,U.canonical);ne.draw(c,_.TRIANGLES,ze.disabled,b,w,O,W_(c,U,j,oe,F,ie,s.paint.get("heatmap-intensity")),s.id,G.layoutVertexBuffer,G.indexBuffer,G.segments,s.paint,c.transform.zoom,H,C?[G.globeExtVertexBuffer]:null)}m.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(m,_){let b=m.context,w=b.gl,S=_.heatmapFbo;if(!S)return;b.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,S.colorAttachment.get()),b.activeTexture.set(w.TEXTURE1);let C=_.colorRampTexture;C||(C=_.colorRampTexture=new r.T(b,_.colorRamp,w.RGBA)),C.bind(w.LINEAR,w.CLAMP_TO_EDGE),m.getOrCreateProgram("heatmapTexture").draw(m,w.TRIANGLES,ze.disabled,kt.disabled,m.colorModeForRenderPass(),Tt.disabled,((R,O,F,B)=>({u_image:0,u_color_ramp:1,u_opacity:O.paint.get("heatmap-opacity")}))(0,_),_.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,_.paint,m.transform.zoom)}(c,s))},line:function(c,n,s,u){if(c.renderPass!=="translucent")return;let m=s.paint.get("line-opacity"),_=s.paint.get("line-width");if(m.constantOr(1)===0||_.constantOr(1)===0)return;let b=s.paint.get("line-emissive-strength"),w=c.depthModeForSublayer(0,ze.ReadOnly),S=c.colorModeForDrapableLayerRenderPass(b),C=c.terrain&&c.terrain.renderingToTexture?1:r.f.devicePixelRatio,R=s.paint.get("line-dasharray"),O=R.constantOr(1),F=s.layout.get("line-cap"),B=s.paint.get("line-pattern"),U=B.constantOr(1),j=s.paint.get("line-opacity").constantOr(1)!==1,G=!U&&j,q=s.paint.get("line-gradient"),H=U?"linePattern":"line",ne=c.context,ie=ne.gl,oe=r.cH(s);c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(G=!1);for(let $ of u){let X=n.getTile($);if(U&&!X.patternsLoaded())continue;let ue=X.getBucket(s);if(!ue)continue;c.prepareDrawTile();let le=ue.programConfigurations.get(s.id),ge=c.isTileAffectedByFog($),Me=c.getOrCreateProgram(H,{config:le,defines:oe,overrideFog:ge}),me=B.constantOr(null);if(me&&X.imageAtlas){let De=X.imageAtlas.patternPositions[me.toString()];De&&le.setConstantPatternPositions(De)}let Ee=R.constantOr(null),Re=F.constantOr(null);if(!U&&Ee&&Re&&X.lineAtlas){let De=X.lineAtlas.getDash(Ee,Re);De&&le.setConstantPatternPositions(De)}let[pe,xe]=s.paint.get("line-trim-offset");(Re==="round"||Re==="square")&&pe!==xe&&(pe===0&&(pe-=1),xe===1&&(xe+=1));let He=c.terrain?$.projMatrix:null,ye=U?r.cI(c,X,s,He,C,[pe,xe]):r.cJ(c,X,s,He,ue.lineClipsArray.length,C,[pe,xe]);if(q){let De=ue.gradients[s.id],re=De.texture;if(s.gradientVersion!==De.version){let Ue=256;if(s.stepInterpolant){let gt=n.getSource().maxzoom,Et=$.canonical.z===gt?Math.ceil(1<<c.transform.maxZoom-$.canonical.z):1;Ue=r.ad(r.cK(ue.maxLineLength/r.Y*1024*Et),256,ne.maxTextureSize)}De.gradient=r.cL({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:Ue,image:De.gradient||void 0,clips:ue.lineClipsArray}),De.texture?De.texture.update(De.gradient):De.texture=new r.T(ne,De.gradient,ie.RGBA),De.version=s.gradientVersion,re=De.texture}ne.activeTexture.set(ie.TEXTURE1),re.bind(s.stepInterpolant?ie.NEAREST:ie.LINEAR,ie.CLAMP_TO_EDGE)}O&&(ne.activeTexture.set(ie.TEXTURE0),X.lineAtlasTexture&&X.lineAtlasTexture.bind(ie.LINEAR,ie.REPEAT),le.updatePaintBuffers()),U&&(ne.activeTexture.set(ie.TEXTURE0),X.imageAtlasTexture&&X.imageAtlasTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),le.updatePaintBuffers()),c.uploadCommonUniforms(ne,Me,$.toUnwrapped());let Se=De=>{Me.draw(c,ie.TRIANGLES,w,De,S,Tt.disabled,ye,s.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,s.paint,c.transform.zoom,le,[ue.layoutVertexBuffer2,ue.patternVertexBuffer])};if(G){let De=c.stencilModeForClipping($).ref;De===0&&c.terrain&&ne.clear({stencil:0});let re={func:ie.EQUAL,mask:255};ye.u_alpha_discard_threshold=.8,Se(new kt(re,De,255,ie.KEEP,ie.KEEP,ie.INVERT)),ye.u_alpha_discard_threshold=0,Se(new kt(re,De,255,ie.KEEP,ie.KEEP,ie.KEEP))}else Se(c.stencilModeForClipping($))}G&&(c.resetStencilClippingMasks(),c.terrain&&ne.clear({stencil:0}))},fill:function(c,n,s,u){let m=s.paint.get("fill-color"),_=s.paint.get("fill-opacity");if(_.constantOr(1)===0)return;let b=s.paint.get("fill-emissive-strength"),w=c.colorModeForDrapableLayerRenderPass(b),S=s.paint.get("fill-pattern"),C=c.opaquePassEnabledForLayer()&&!S.constantOr(1)&&m.constantOr(r.aA.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===C){let R=c.depthModeForSublayer(1,c.renderPass==="opaque"?ze.ReadWrite:ze.ReadOnly);qh(c,n,s,u,R,w,!1)}if(c.renderPass==="translucent"&&s.paint.get("fill-antialias")){let R=c.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,ze.ReadOnly);qh(c,n,s,u,R,w,!0)}},"fill-extrusion":function(c,n,s,u){let m=s.paint.get("fill-extrusion-opacity"),_=c.context,b=_.gl,w=c.terrain,S=w&&w.renderingToTexture;if(m===0)return;let C=c.conflationActive&&c.layerUsedInConflation(s,n.getSource());if(C&&function(R,O,F,B){for(let U of B){let j=O.getTile(U).getBucket(F);j&&(j.updateReplacement(U,R.replacementSource),j.uploadCentroid(R.context))}}(c,n,s,u),w||C)for(let R of u){let O=n.getTile(R).getBucket(s);O&&mp(c.context,n,R,O,s,w,C)}if(c.renderPass==="shadow"&&c.shadowRenderer){let R=c.shadowRenderer;if(w&&m<.65&&s._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.Z)return;let O=R.getShadowPassDepthMode(),F=R.getShadowPassColorMode();pt(c,n,s,u,O,kt.disabled,F,C)}else if(c.renderPass==="translucent"){let R=!s.paint.get("fill-extrusion-pattern").constantOr(1),O=s.paint.get("fill-extrusion-color").constantOr(r.aA.white);if(!S&&O.a!==0){let F=new ze(c.context.gl.LEQUAL,ze.ReadWrite,c.depthRangeFor3D);m===1&&R?pt(c,n,s,u,F,kt.disabled,qt.unblended,C):(pt(c,n,s,u,F,kt.disabled,qt.disabled,C),pt(c,n,s,u,F,c.stencilModeFor3D(),c.colorModeForRenderPass(),C),c.resetStencilClippingMasks())}if(c.style.enable3dLights()&&R&&(!w&&c.transform.projection.name!=="globe"||S)){let F=s.paint.get("fill-extrusion-opacity"),B=s.paint.get("fill-extrusion-ambient-occlusion-intensity"),U=s.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),j=s.paint.get("fill-extrusion-flood-light-intensity"),G=s.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),q=B>0&&U>0,H=j>0,ne=(oe,$,X)=>(1-X)*oe+X*$,ie=oe=>{let $=c.depthModeForSublayer(1,ze.ReadOnly,b.LEQUAL,!0),X=s.paint.get(oe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ue=ne(.1,3,X),le=c._showOverdrawInspector;if(!le){let ge=new kt({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),Me=new qt([b.ONE,b.ONE,b.ONE,b.ONE],r.aA.transparent,[!1,!1,!1,!0],b.MIN);Wl(c,n,s,u,$,ge,Me,Tt.disabled,oe,"sdf",F,B,U,j,G,ue,C,!1)}{let ge=le?kt.disabled:new kt({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),Me=le?c.colorModeForRenderPass():new qt([b.ONE_MINUS_DST_ALPHA,b.DST_ALPHA,b.ONE,b.ONE],r.aA.transparent,[!0,!0,!0,!0]);Wl(c,n,s,u,$,ge,Me,Tt.disabled,oe,"color",F,B,U,j,G,ue,C,!1)}};if(S){let oe=($,X,ue)=>{let le=c.depthModeForSublayer(1,ze.ReadOnly,b.LEQUAL,!1),ge=s.paint.get($?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Me=ne(.1,3,ge);{let me=new qt([b.ONE,b.ONE,b.ONE,b.ONE],r.aA.transparent,[!1,!1,!1,!0]);Wl(c,n,s,u,le,kt.disabled,me,Tt.disabled,$,"clear",F,B,U,j,G,Me,C,X)}{let me=new kt({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),Ee=new qt([b.ONE,b.ONE,b.ONE,b.ONE],r.aA.transparent,[!1,!1,!1,!0],b.MIN);Wl(c,n,s,u,le,me,Ee,Tt.disabled,$,"sdf",F,B,U,j,G,Me,C,X)}{let me=$?b.ZERO:b.ONE_MINUS_DST_ALPHA,Ee=new kt({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),Re=new qt([me,b.DST_ALPHA,b.ONE_MINUS_DST_ALPHA,b.ZERO],r.aA.transparent,[!0,!0,!0,!0]);Wl(c,n,s,u,le,Ee,Re,Tt.disabled,$,"color",F,B,U,j,G,Me,C,X)}{let me=new qt([b.ONE,b.ONE,b.ONE,$?b.ZERO:b.ONE],r.aA.transparent,[!1,!1,!1,!0],$?b.FUNC_ADD:b.MAX);Wl(c,n,s,u,le,kt.disabled,me,Tt.disabled,$,"clear",F,B,U,j,G,Me,C,X,ue)}};if(q||H){let $;if(c.prepareDrawTile(),w){let X=w.drapeBufferSize[0],ue=w.drapeBufferSize[1];$=w.framebufferCopyTexture,$&&(!$||$.size[0]===X&&$.size[1]===ue)||($&&$.destroy(),$=w.framebufferCopyTexture=new r.T(_,new r.h({width:X,height:ue}),b.RGBA)),$.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.copyTexImage2D(b.TEXTURE_2D,0,b.RGBA,0,0,X,ue,0)}q&&oe(!0,!1,$),H&&oe(!1,!0,$)}}else q&&ie(!0),H&&ie(!1)}}},hillshade:function(c,n,s,u){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent"||c.style.disableElevatedTerrain)return;let m=c.context,_=c.terrain&&c.terrain.renderingToTexture,[b,w]=c.renderPass!=="translucent"||_?[{},u]:c.stencilConfigForOverlap(u);for(let S of w){let C=n.getTile(S);if(C.needsHillshadePrepare&&c.renderPass==="offscreen")yc(c,C,s);else if(c.renderPass==="translucent"){let R=c.depthModeForSublayer(0,ze.ReadOnly),O=s.paint.get("hillshade-emissive-strength"),F=c.colorModeForDrapableLayerRenderPass(O),B=_&&c.terrain?c.terrain.stencilModeForRTTOverlap(S):b[S.overscaledZ];Hi(c,S,C,s,R,B,F)}}m.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,n,s,u,m,_){if(c.renderPass!=="translucent"||s.paint.get("raster-opacity")===0)return;let b=c.transform.projection.name==="globe",w=s.paint.get("raster-elevation")!==0,S=w&&b;if(c.renderElevatedRasterBackface&&!S)return;let C=c.context,R=C.gl,O=n.getSource(),F=function($,X,ue,le){let ge=X.paint.get("raster-color"),Me=$.type==="raster-array",me=[],Ee=X.paint.get("raster-resampling"),Re=X.paint.get("raster-color-mix"),pe=X.paint.get("raster-color-range"),xe=[Re[0],Re[1],Re[2],0],He=Re[3],ye=Ee==="nearest"?le.NEAREST:le.LINEAR;if(Me&&(me.push("RASTER_ARRAY"),ge||me.push("RASTER_COLOR"),Ee==="linear"&&me.push("RASTER_ARRAY_LINEAR"),ye=le.NEAREST,!pe&&$.rasterLayers)){let Se=$.rasterLayers.find(({id:De})=>De===X.sourceLayer);Se&&Se.fields&&Se.fields.range&&(pe=Se.fields.range)}if(pe=pe||[0,1],ge){me.push("RASTER_COLOR"),ue.activeTexture.set(le.TEXTURE2),X.updateColorRamp(pe);let Se=X.colorRampTexture;Se||(Se=X.colorRampTexture=new r.T(ue,X.colorRamp,le.RGBA)),Se.bind(le.LINEAR,le.CLAMP_TO_EDGE)}return{mix:xe,range:pe,offset:He,defines:me,resampling:ye}}(O,s,C,R);if(O instanceof r.as&&!u.length&&!b)return;let B=s.paint.get("raster-emissive-strength"),U=c.colorModeForDrapableLayerRenderPass(B),j=c.terrain&&c.terrain.renderingToTexture,G=!c.options.moving,q=s.paint.get("raster-resampling")==="nearest"?R.NEAREST:R.LINEAR;if(O instanceof r.as&&!u.length&&(O.onNorthPole||O.onSouthPole)){let $=w?c.stencilModeFor3D():kt.disabled;return void $a(!!O.onNorthPole,null,c,n,s,B,F,Tt.disabled,$)}if(!u.length)return;let[H,ne]=O instanceof r.as||j?[{},u]:c.stencilConfigForOverlap(u),ie=ne[ne.length-1].overscaledZ;S&&F.defines.push("PROJECTION_GLOBE_VIEW"),w&&F.defines.push("RENDER_CUTOFF");let oe=($,X,ue)=>{for(let le of $){let ge=le.toUnwrapped(),Me=n.getTile(le);if(j&&(!Me||!Me.hasData()))continue;C.activeTexture.set(R.TEXTURE0);let me=Ec(Me,O,s,F);if(!me||!me.texture)continue;let{texture:Ee,mix:Re,offset:pe,tileSize:xe,buffer:He}=me,ye,Se;j?(ye=ze.disabled,Se=le.projMatrix):w?(ye=new ze(R.LEQUAL,ze.ReadWrite,c.depthRangeFor3D),Se=b?Float32Array.from(c.transform.expandedFarZProjMatrix):c.transform.calculateProjMatrix(ge,G)):(ye=c.depthModeForSublayer(le.overscaledZ-ie,s.paint.get("raster-opacity")===1?ze.ReadWrite:ze.ReadOnly,R.LESS),Se=c.transform.calculateProjMatrix(ge,G));let De=c.terrain&&j?c.terrain.stencilModeForRTTOverlap(le):H[le.overscaledZ],re=_?0:s.paint.get("raster-fade-duration");Me.registerFadeDuration(re);let Ue=n.findLoadedParent(le,0),gt=Gl(Me,Ue,n,c.transform,re),Et,Ot;c.terrain&&c.terrain.prepareDrawTile(),C.activeTexture.set(R.TEXTURE0),Ee.bind(q,R.CLAMP_TO_EDGE),C.activeTexture.set(R.TEXTURE1),Ue?(Ue.texture&&Ue.texture.bind(q,R.CLAMP_TO_EDGE),Et=Math.pow(2,Ue.tileID.overscaledZ-Me.tileID.overscaledZ),Ot=[Me.tileID.canonical.x*Et%1,Me.tileID.canonical.y*Et%1]):Ee.bind(q,R.CLAMP_TO_EDGE),Ee.useMipmap&&C.extTextureFilterAnisotropic&&c.transform.pitch>20&&R.texParameterf(R.TEXTURE_2D,C.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,C.extTextureFilterAnisotropicMax);let At=c.transform,Nt,xi=w?Zh(At):[0,0,0,0],ei,Di,wi,Cn,Xi,dr=0;if(S&&O instanceof r.as&&O.coordinates.length>3)ei=Float32Array.from(r.aW(r.cn(new r.bv(0,0,0)))),Di=Float32Array.from(At.globeMatrix),wi=Float32Array.from(r.cj(At)),Cn=[r.a8(At.center.lng),r.ah(At.center.lat)],Nt=O.elevatedGlobePerspectiveTransform,Xi=O.elevatedGlobeGridMatrix||new Float32Array(9);else if(S){let ui=r.ck(le.canonical);dr=r.cl(ui.getCenter().lat),ei=Float32Array.from(r.aW(r.cn(le.canonical))),Di=Float32Array.from(At.globeMatrix),wi=Float32Array.from(r.cj(At)),Cn=[r.a8(At.center.lng),r.ah(At.center.lat)],Nt=[0,0],Xi=Float32Array.from(r.cm(le.canonical,ui,dr,At.worldSize/At._pixelsPerMercatorPixel))}else Nt=O instanceof r.as?O.perspectiveTransform:[0,0],ei=new Float32Array(16),Di=new Float32Array(9),wi=new Float32Array(16),Cn=[0,0],Xi=new Float32Array(9);let Jn=sm(Se,ei,Di,wi,Xi,Ot||[0,0],r.W(c.transform.zoom),Cn,xi,Et||1,gt,s,Nt,w?s.paint.get("raster-elevation"):0,2,Re,pe,F.range,xe,He,B),fn=c.isTileAffectedByFog(le),rn=c.getOrCreateProgram("raster",{defines:F.defines,overrideFog:fn});if(c.uploadCommonUniforms(C,rn,ge),O instanceof r.as){let ui=O.elevatedGlobeVertexBuffer,di=O.elevatedGlobeIndexBuffer;if(j||!b)O.boundsBuffer&&O.boundsSegments&&rn.draw(c,R.TRIANGLES,ye,kt.disabled,U,Tt.disabled,Jn,s.id,O.boundsBuffer,c.quadTriangleIndexBuffer,O.boundsSegments);else if(ui&&di){let wn=At.zoom<=r.bJ?O.elevatedGlobeSegments:O.getSegmentsForLongitude(At.center.lng);wn&&rn.draw(c,R.TRIANGLES,ye,kt.disabled,U,X,Jn,s.id,ui,di,wn)}}else if(S){ye=new ze(R.LEQUAL,ze.ReadOnly,c.depthRangeFor3D);let ui=c.globeSharedBuffers;if(ui){let[di,wn,mn]=ui.getGridBuffers(dr,!1);rn.draw(c,R.TRIANGLES,ye,ue||De,c.colorModeForRenderPass(),X,Jn,s.id,di,wn,mn)}}else{let{tileBoundsBuffer:ui,tileBoundsIndexBuffer:di,tileBoundsSegments:wn}=c.getTileBoundsBuffers(Me);rn.draw(c,R.TRIANGLES,ye,De,U,Tt.disabled,Jn,s.id,ui,di,wn)}}if(!(O instanceof r.as)&&S)for(let le of $){let ge=le.canonical.y===(1<<le.canonical.z)-1;le.canonical.y===0&&$a(!0,le,c,n,s,B,F,X,ue||kt.disabled),ge&&$a(!1,le,c,n,s,B,F,X===Tt.frontCW?Tt.backCW:Tt.frontCW,ue||kt.disabled)}};S?oe(ne,c.renderElevatedRasterBackface?Tt.backCW:Tt.frontCW,c.stencilModeFor3D()):oe(ne,Tt.disabled,void 0),c.resetStencilClippingMasks()},"raster-particle":function(c,n,s,u,m,_){c.renderPass==="offscreen"&&function(b,w,S,C){if(!C.length)return;let R=b.context,O=R.gl,F=w.getSource();if(!(F instanceof rt))return;let B=Math.ceil(Math.sqrt(S.paint.get("raster-particle-count"))),U=S.particleFramebuffer;U?U.width!==B&&(U.destroy(),U=S.particleFramebuffer=R.createFramebuffer(B,B,!0,null)):U=S.particleFramebuffer=R.createFramebuffer(B,B,!0,null);let j=[];for(let H of C){let ne=w.getTile(H);if(!(ne instanceof Ll))continue;let ie=Y_(ne,F,S);if(!ie)continue;let oe=[ne.tileSize,ne.tileSize],$=S.tileFramebuffer;$||($=S.tileFramebuffer=R.createFramebuffer(oe[0],oe[1],!0,null));let X=ne.rasterParticleState;X||(X=ne.rasterParticleState=new Lh(R,H,oe,B));let ue=X.update(S.lastInvalidatedAt);X.particleTextureDimension!==B&&X.setParticleTextureDimension(H,B);let le=X.targetColorTexture;X.targetColorTexture=X.backgroundColorTexture,X.backgroundColorTexture=le;let ge=X.particleTexture0;X.particleTexture0=X.particleTexture1,X.particleTexture1=ge,j.push([H,ie,X,ue])}if(j.length===0)return;let G=r.f.now(),q=S.previousDrawTimestamp?.001*(G-S.previousDrawTimestamp):.0167;if(S.previousDrawTimestamp=G,S.hasColorMap()){R.activeTexture.set(O.TEXTURE0+2);let H=S.colorRampTexture;H||(H=S.colorRampTexture=new r.T(R,S.colorRamp,O.RGBA)),H.bind(O.LINEAR,O.CLAMP_TO_EDGE)}R.bindFramebuffer.set(S.tileFramebuffer.framebuffer),function(H,ne,ie){let oe=H.context,$=oe.gl,X=ne.tileFramebuffer;oe.activeTexture.set($.TEXTURE0);let ue={u_texture:0,u_opacity:1.05*(ge=ne.paint.get("raster-particle-fade-opacity-factor"))/(ge+.05)},le=H.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ge;for(let Me of ie){let[,,me,Ee]=Me;X.colorAttachment.set(me.targetColorTexture.texture),oe.viewport.set([0,0,X.width,X.height]),oe.clear({color:r.aA.transparent}),Ee&&(me.backgroundColorTexture.bind($.NEAREST,$.CLAMP_TO_EDGE),le.draw(H,$.TRIANGLES,ze.disabled,kt.disabled,qt.alphaBlended,Tt.disabled,ue,ne.id,H.viewportBuffer,H.quadTriangleIndexBuffer,H.viewportSegments))}}(b,S,j),function(H,ne,ie,oe){let $=H.context,X=$.gl,ue=ie.tileFramebuffer,le=H.transform.projection.name==="globe",ge=ie.paint.get("raster-particle-max-speed");for(let Me of oe){let[me,Ee,Re]=Me;$.activeTexture.set(X.TEXTURE0+0),Ee.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE),ue.colorAttachment.set(Re.targetColorTexture.texture);let pe=H.getOrCreateProgram("rasterParticleDraw",{defines:Ee.defines,overrideFog:!1});$.activeTexture.set(X.TEXTURE0+1);let xe=Ee.scalarData?[]:[0,1,2,3].map(Se=>r.cN[Se](me));xe.push(me);let He=me.canonical.x,ye=me.canonical.y;for(let Se of xe){let De=ne.getTile(le?Se.wrapped():Se);if(!De)continue;let re=De.rasterParticleState;if(!re)continue;let Ue=Se.canonical.x+(1<<Se.canonical.z)*(Se.wrap-me.wrap),gt=Se.canonical.y;re.particleTexture0.bind(X.NEAREST,X.CLAMP_TO_EDGE);let Et=Au(1,re.particleTexture0.size[0],[Ue-He,gt-ye],0,Ee.texture.size,2,ge,Ee.textureOffset,Ee.scale,Ee.offset);pe.draw(H,X.POINTS,ze.disabled,kt.disabled,qt.alphaBlended,Tt.disabled,Et,ie.id,re.particleIndexBuffer,void 0,re.particleSegment)}}}(b,w,S,j),R.bindFramebuffer.set(S.particleFramebuffer.framebuffer),function(H,ne,ie,oe){let $=H.context,X=$.gl,ue=ne.paint.get("raster-particle-max-speed"),le=oe*ne.paint.get("raster-particle-speed-factor")*.3,ge=function(me){return Math.pow(me,6)}(.01+1*ne.paint.get("raster-particle-reset-rate-factor")),Me=ne.particleFramebuffer;$.viewport.set([0,0,Me.width,Me.height]);for(let me of ie){let[,Ee,Re]=me;$.activeTexture.set(X.TEXTURE0+0),Ee.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE),$.activeTexture.set(X.TEXTURE0+1);let pe=Re.particleTexture0;pe.bind(X.NEAREST,X.CLAMP_TO_EDGE);let xe=H_(1,pe.size[0],0,Ee.texture.size,ue,le,ge,Ee.textureOffset,Ee.scale,Ee.offset);Me.colorAttachment.set(Re.particleTexture1.texture),$.clear({color:r.aA.transparent}),H.getOrCreateProgram("rasterParticleUpdate",{defines:Ee.defines}).draw(H,X.TRIANGLES,ze.disabled,kt.disabled,qt.unblended,Tt.disabled,xe,ne.id,H.viewportBuffer,H.quadTriangleIndexBuffer,H.viewportSegments)}}(b,S,j,q)}(c,n,s,u),c.renderPass==="translucent"&&(function(b,w,S,C,R){let O=b.context,F=O.gl,B=!b.options.moving,U=b.transform.projection.name==="globe";if(!C.length)return;let[j,G]=b.stencilConfigForOverlap(C),q=[];U&&q.push("PROJECTION_GLOBE_VIEW");let H=b.stencilModeFor3D();for(let ne of G){let ie=ne.toUnwrapped(),oe=w.getTile(ne);if(!oe.rasterParticleState)continue;let $=oe.rasterParticleState,X=100;oe.registerFadeDuration(X);let ue=w.findLoadedParent(ne,0),le=Gl(oe,ue,w,b.transform,X),ge,Me;b.terrain&&b.terrain.prepareDrawTile(),O.activeTexture.set(F.TEXTURE0),$.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),O.activeTexture.set(F.TEXTURE1),ue&&ue.rasterParticleState?(ue.rasterParticleState.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),ge=Math.pow(2,ue.tileID.overscaledZ-oe.tileID.overscaledZ),Me=[oe.tileID.canonical.x*ge%1,oe.tileID.canonical.y*ge%1]):$.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);let me=U?Float32Array.from(b.transform.expandedFarZProjMatrix):b.transform.calculateProjMatrix(ie,B),Ee=b.transform,Re=K_(Ee),pe=r.ck(ne.canonical),xe=r.cl(pe.getCenter().lat),He,ye,Se,De,re;U?(He=Float32Array.from(r.aW(r.cn(ne.canonical))),ye=Float32Array.from(Ee.globeMatrix),Se=Float32Array.from(r.cj(Ee)),De=[r.a8(Ee.center.lng),r.ah(Ee.center.lat)],re=Float32Array.from(r.cm(ne.canonical,pe,xe,Ee.worldSize/Ee._pixelsPerMercatorPixel))):(He=new Float32Array(16),ye=new Float32Array(9),Se=new Float32Array(16),De=[0,0],re=new Float32Array(9));let Ue=Cu(me,He,ye,Se,re,Me||[0,0],r.W(b.transform.zoom),De,Re,ge||1,le,250),gt=b.isTileAffectedByFog(ne),Et=b.getOrCreateProgram("rasterParticle",{defines:q,overrideFog:gt});if(b.uploadCommonUniforms(O,Et,ie),U){let Ot=new ze(F.LEQUAL,ze.ReadWrite,b.depthRangeFor3D),At=0,Nt=b.globeSharedBuffers;if(Nt){let[xi,ei,Di]=Nt.getGridBuffers(xe,At!==0);Et.draw(b,F.TRIANGLES,Ot,H,qt.alphaBlended,Tt.backCCW,Ue,S.id,xi,ei,Di)}}else{let Ot=b.depthModeForSublayer(0,ze.ReadOnly),At=j[ne.overscaledZ],{tileBoundsBuffer:Nt,tileBoundsIndexBuffer:xi,tileBoundsSegments:ei}=b.getTileBoundsBuffers(oe);Et.draw(b,F.TRIANGLES,Ot,At,qt.alphaBlended,Tt.disabled,Ue,S.id,Nt,xi,ei)}}b.resetStencilClippingMasks()}(c,n,s,u),c.style.map.triggerRepaint())},background:function(c,n,s,u){let m=s.paint.get("background-color"),_=s.paint.get("background-opacity"),b=s.paint.get("background-emissive-strength");if(_===0)return;let w=c.context,S=w.gl,C=c.transform,R=C.tileSize,O=s.paint.get("background-pattern");if(c.isPatternMissing(O,s.scope))return;let F=!O&&m.a===1&&_===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==F)return;let B=kt.disabled,U=c.depthModeForSublayer(0,F==="opaque"?ze.ReadWrite:ze.ReadOnly),j=c.colorModeForDrapableLayerRenderPass(b),G=O?"backgroundPattern":"background",q,H=u;H||(q=c.getBackgroundTiles(),H=Object.values(q).map(ne=>ne.tileID)),O&&(w.activeTexture.set(S.TEXTURE0),c.imageManager.bind(c.context,s.scope));for(let ne of H){let ie=c.isTileAffectedByFog(ne),oe=c.getOrCreateProgram(G,{overrideFog:ie}),$=ne.toUnwrapped(),X=u?ne.projMatrix:c.transform.calculateProjMatrix($);c.prepareDrawTile();let ue=n?n.getTile(ne):q?q[ne.key]:new Ao(ne,R,C.zoom,c),le=O?X_(X,b,_,c,O,s.scope,{tileID:ne,tileSize:R}):Q_(X,b,_,m);c.uploadCommonUniforms(w,oe,$);let{tileBoundsBuffer:ge,tileBoundsIndexBuffer:Me,tileBoundsSegments:me}=c.getTileBoundsBuffers(ue);oe.draw(c,S.TRIANGLES,U,B,j,Tt.disabled,le,s.id,ge,Me,me)}},sky:function(c,n,s){let u=c._atmosphere?r.W(c.transform.zoom):1,m=s.paint.get("sky-opacity")*u;if(m===0)return;let _=c.context,b=s.paint.get("sky-type"),w=new ze(_.gl.LEQUAL,ze.ReadOnly,[0,1]),S=c.frameCounter/1e3%1;b==="atmosphere"?c.renderPass==="offscreen"?s.needsSkyboxCapture(c)&&(function(C,R,O,F){let B=C.context,U=B.gl,j=R.skyboxFbo;if(!j){j=R.skyboxFbo=B.createFramebuffer(32,32,!0,null),R.skyboxGeometry=new mm(B),R.skyboxTexture=B.gl.createTexture(),U.bindTexture(U.TEXTURE_CUBE_MAP,R.skyboxTexture),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MAG_FILTER,U.LINEAR);for(let ne=0;ne<6;++ne)U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+ne,0,U.RGBA,32,32,0,U.RGBA,U.UNSIGNED_BYTE,null)}B.bindFramebuffer.set(j.framebuffer),B.viewport.set([0,0,32,32]);let G=R.getCenter(C,!0),q=C.getOrCreateProgram("skyboxCapture"),H=new Float64Array(16);r.a9.identity(H),r.a9.rotateY(H,H,.5*-Math.PI),Zl(C,R,q,H,G,0),r.a9.identity(H),r.a9.rotateY(H,H,.5*Math.PI),Zl(C,R,q,H,G,1),r.a9.identity(H),r.a9.rotateX(H,H,.5*-Math.PI),Zl(C,R,q,H,G,2),r.a9.identity(H),r.a9.rotateX(H,H,.5*Math.PI),Zl(C,R,q,H,G,3),r.a9.identity(H),Zl(C,R,q,H,G,4),r.a9.identity(H),r.a9.rotateY(H,H,Math.PI),Zl(C,R,q,H,G,5),B.viewport.set([0,0,C.width,C.height])}(c,s),s.markSkyboxValid(c)):c.renderPass==="sky"&&function(C,R,O,F,B){let U=C.context,j=U.gl,G=C.transform,q=C.getOrCreateProgram("skybox");U.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_CUBE_MAP,R.skyboxTexture);let H=((ne,ie,oe,$,X)=>({u_matrix:ne,u_sun_direction:ie,u_cubemap:0,u_opacity:$,u_temporal_offset:X}))(G.skyboxMatrix,R.getCenter(C,!1),0,F,B);C.uploadCommonUniforms(U,q),q.draw(C,j.TRIANGLES,O,kt.disabled,C.colorModeForRenderPass(),Tt.backCW,H,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(c,s,w,m,S):b==="gradient"&&c.renderPass==="sky"&&function(C,R,O,F,B){let U=C.context,j=U.gl,G=C.transform,q=C.getOrCreateProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new mm(U)),U.activeTexture.set(j.TEXTURE0);let H=R.colorRampTexture;H||(H=R.colorRampTexture=new r.T(U,R.colorRamp,j.RGBA)),H.bind(j.LINEAR,j.CLAMP_TO_EDGE);let ne=((ie,oe,$,X,ue)=>({u_matrix:ie,u_color_ramp:0,u_center_direction:oe,u_radius:r.bm($),u_opacity:X,u_temporal_offset:ue}))(G.skyboxMatrix,R.getCenter(C,!1),R.paint.get("sky-gradient-radius"),F,B);C.uploadCommonUniforms(U,q),q.draw(C,j.TRIANGLES,O,kt.disabled,C.colorModeForRenderPass(),Tt.backCW,ne,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(c,s,w,m,S)},debug:function(c,n,s,u,m,_){for(let b=0;b<s.length;b++)if(m){let C=new r.aA(u.r*.8,u.g*.8,u.b*.8,1);Ic(c,n,s[b],u,-1,-1,_),Ic(c,n,s[b],u,-1,1,_),Ic(c,n,s[b],u,1,1,_),Ic(c,n,s[b],u,1,-1,_),Ic(c,n,s[b],C,0,0,_)}else Ic(c,n,s[b],u,0,0,_)},custom:function(c,n,s,u){let m=c.context,_=s.implementation;if(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes("custom")||c.terrain&&(c.terrain.renderingToTexture||c.renderPass==="offscreen")&&s.isDraped(n)){if(c.renderPass==="offscreen"){let b=_.prerender;if(b){if(c.setCustomLayerDefaults(),m.setColorMode(c.colorModeForRenderPass()),c.transform.projection.name==="globe"){let w=c.transform.pointMerc;b.call(_,m.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),r.W(c.transform.zoom),[w.x,w.y],c.transform.pixelsPerMeterRatio)}else b.call(_,m.gl,c.transform.customLayerMatrix());m.setDirty(),c.setBaseState()}}else if(c.renderPass==="translucent"){if(c.terrain&&c.terrain.renderingToTexture){let w=_.renderToTile;if(w){let S=u[0].canonical,C=new r.O(S.x+u[0].wrap*(1<<S.z),S.y,S.z);m.setDepthMode(ze.disabled),m.setStencilMode(kt.disabled),m.setColorMode(c.colorModeForRenderPass()),c.setCustomLayerDefaults(),w.call(_,m.gl,C),m.setDirty(),c.setBaseState()}return}c.setCustomLayerDefaults(),m.setColorMode(c.colorModeForRenderPass()),m.setStencilMode(kt.disabled);let b=_.renderingMode==="3d"?new ze(c.context.gl.LEQUAL,ze.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,ze.ReadOnly);if(m.setDepthMode(b),c.transform.projection.name==="globe"){let w=c.transform.pointMerc;_.render(m.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),r.W(c.transform.zoom),[w.x,w.y],c.transform.pixelsPerMeterRatio)}else _.render(m.gl,c.transform.customLayerMatrix());m.setDirty(),c.setBaseState(),m.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(c,n,s,u){if(c.renderPass==="opaque")return;let m=s.paint.get("model-opacity");if(m===0)return;let _=s.paint.get("model-cast-shadows");if(c.renderPass==="shadow"&&(!_||c.terrain&&m<.65&&s._transitionablePaint._values["model-opacity"].value.expression instanceof r.Z))return;let b=c.shadowRenderer,w=s.paint.get("model-receive-shadows");b&&(b.useNormalOffset=!0,w||(b.enabled=!1));let S=()=>{b&&(b.useNormalOffset=!0,w||(b.enabled=!0))},C=n.getSource();if(c.renderPass==="light-beam"&&C.type!=="batched-model")return;if(C.type==="vector"||C.type==="geojson")return function(q,H,ne,ie,oe){let $=q.transform;if($.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${$.projection.name} projection is not yet implemented`);let X=$.getFreeCameraOptions().position;if(!q.modelManager)return;let ue=q.modelManager;ne.modelManager=ue;let le=q.shadowRenderer;if(!ne._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let ge=ne._unevaluatedLayout._values["model-id"],Me=Vt({},ne.layout.get("model-id").parameters);for(let me of ie){let Ee=H.getTile(me).getBucket(ne);if(!Ee||Ee.projection.name!==$.projection.name)continue;let Re=Ee.getModelUris();Re&&!Ee.modelsRequested&&(ue.addModelsFromBucket(Re,oe),Ee.modelsRequested=!0);let pe=Xh(me,$);Me.zoom=pe;let xe=ge.possiblyEvaluate(Me);if(Lu(q,Ee,me),Ko.shadowUniformsInitialized=!1,Ko.useSingleShadowCascade=!!le&&le.getMaxCascadeForTile(me.toUnwrapped())===0,q.renderPass==="shadow"&&le){if(q.currentShadowCascade===1&&Ee.isInsideFirstShadowMapFrustum)continue;let Se=$.calculatePosMatrix(me.toUnwrapped(),$.worldSize);if(Ko.tileMatrix.set(Se),Ko.shadowTileMatrix=Float32Array.from(le.calculateShadowPassMatrixFromMatrix(Se)),Ko.aabb.min.fill(0),Ko.aabb.max[0]=Ko.aabb.max[1]=r.Y,Ko.aabb.max[2]=0,Fu(Ee,Ko,q,ne.scope))continue}let He=1<<me.canonical.z,ye=[((X.x-me.wrap)*He-me.canonical.x)*r.Y,(X.y*He-me.canonical.y)*r.Y,X.z*He*r.Y];for(let Se in Ee.instancesPerModel){let De=Ee.instancesPerModel[Se];De.features.length>0&&(Se=xe.evaluate(De.features[0].feature,{}));let re=ue.getModel(Se,oe);if(re&&re.uploaded)for(let Ue of re.nodes)Yh(q,ne,Ue,De,ye,me,Ko)}}}(c,n,s,u,C.type==="vector"?s.scope:""),void S();if(!C.loaded())return;if(C.type==="batched-model")return function(q,H,ne,ie){ne.resetLayerRenderingStats(q);let oe=q.context,$=q.transform,X=q.style.fog,ue=q.shadowRenderer;if($.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${$.projection.name} projection is not yet implemented`);let le=q.transform.getFreeCameraOptions().position,ge=r.Q.scale([],[le.x,le.y,le.z],q.transform.worldSize);r.Q.negate(ge,ge);let Me=r.a9.identity([]),me=r.cZ($.center.lat,$.zoom),Ee=r.a9.fromScaling([],[1,1,1/me]);r.a9.translate(Me,Me,ge);let Re=ne.paint.get("model-opacity"),pe=new ze(oe.gl.LEQUAL,ze.ReadWrite,q.depthRangeFor3D),xe=new ze(oe.gl.LEQUAL,ze.ReadOnly,q.depthRangeFor3D),He=new r.bV([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ye=q.renderPass==="shadow",Se=ye&&ue?ue.getCurrentCascadeFrustum():$.getFrustum($.scaleZoom($.worldSize)),De=ne.getLayerRenderingStats(),re=function(Ue,gt){for(let Et of ie){let Ot=H.getTile(Et).getBucket(ne);if(!Ot||!Ot.uploaded)continue;let At=!1;ue&&(At=ue.getMaxCascadeForTile(Et.toUnwrapped())===0);let Nt=$.calculatePosMatrix(Et.toUnwrapped(),$.worldSize),xi=Ot.modelTraits;for(let ei of Ot.getNodesInfo()){if(ei.hiddenByReplacement||!ei.node.meshes)continue;let Di=ei.evaluatedScale,wi=ei.node,Cn=0;if(q.terrain&&wi.elevation&&(Cn=wi.elevation*q.terrain.exaggeration()),Di[0]<=1&&Di[1]<=1&&Di[2]<=1&&(()=>{let yi=ei.getLocalBounds();return He.min=[...yi.min],He.max=[...yi.max],He.min[2]+=Cn,He.max[2]+=Cn,r.Q.transformMat4(He.min,He.min,Nt),r.Q.transformMat4(He.max,He.max,Nt),He})().intersects(Se)===0)continue;let Xi=[...Nt];r.a9.translate(Xi,Xi,[(wi.anchor?wi.anchor[0]:0)*(Di[0]-1),(wi.anchor?wi.anchor[1]:0)*(Di[1]-1),Cn]),r.Q.exactEquals(Di,r.c$)||r.a9.scale(Xi,Xi,Di);let dr=r.a9.multiply([],Xi,wi.matrix),Jn=r.a9.multiply([],Ee,Xi);r.a9.multiply(Jn,Me,Jn);let fn=r.a9.invert([],Jn);r.a9.transpose(fn,fn),r.a9.scale(fn,fn,Kh),Jn=r.a9.multiply(Jn,Jn,wi.matrix);let rn=q.renderPass==="light-beam",ui=r.a9.multiply([],$.expandedFarZProjMatrix,dr),di=r.a9.multiply([],$.expandedFarZProjMatrix,Xi),wn=xi&r.d1.HasMapboxMeshFeatures,mn=wn?0:ei.evaluatedRMEA[0][2];for(let yi=0;yi<wi.meshes.length;++yi){let oi=wi.meshes[yi],wo=yi===wi.lightMeshIndex,Yr=ui;if(wo){if(!rn&&!q.terrain&&q.shadowRenderer){q.currentLayer<q.firstLightBeamLayer&&(q.firstLightBeamLayer=q.currentLayer);continue}Yr=di}else if(rn)continue;let Ir={defines:[]},Kr=[];if(_l(Ir.defines,Kr,oi,q),wn||Ir.defines.push("DIFFUSE_SHADED"),At&&Ir.defines.push("SHADOWS_SINGLE_CASCADE"),De&&(ye?De.numRenderedVerticesInShadowPass+=oi.vertexArray.length:De.numRenderedVerticesInTransparentPass+=oi.vertexArray.length),ye){Ou(oi,dr,q,ne);continue}let To=null;if(X){let Ns=wp(dr,q.transform);if(To=new Float32Array(Ns),$.projection.name!=="globe"){let fa=oi.aabb.min,ma=oi.aabb.max,[xl,bs]=X.getOpacityForBounds(Ns,fa[0],fa[1],ma[0],ma[1]);Ir.overrideFog=xl>=Fi||bs>=Fi}}let ro=oi.material,Sr;ro.occlusionTexture&&ro.occlusionTexture.offsetScale&&(Sr=ro.occlusionTexture.offsetScale,Ir.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!ye&&ue&&(ue.useNormalOffset=!!oi.normalBuffer);let Nr=q.getOrCreateProgram("model",Ir);!ye&&ue&&ue.setupShadowsFromMatrix(Xi,Nr,ue.useNormalOffset),q.uploadCommonUniforms(oe,Nr,null,To);let Vr=ro.pbrMetallicRoughness;Vr.metallicFactor=.9,Vr.roughnessFactor=.5;let pa=Uh(new Float32Array(Yr),new Float32Array(Jn),new Float32Array(fn),new Float32Array(wi.matrix),q,Re,Vr.baseColorFactor,ro.emissiveFactor,Vr.metallicFactor,Vr.roughnessFactor,ro,mn,ne,[0,0,0],Sr);Nr.draw(q,oe.gl.TRIANGLES,gt&&!wo?pe:xe,kt.disabled,Ue?wo||Re<1||ei.hasTranslucentParts?qt.alphaBlended:qt.unblended:qt.disabled,Tt.backCCW,pa,ne.id,oi.vertexBuffer,oi.indexBuffer,oi.segments,ne.paint,q.transform.zoom,void 0,Kr)}}}};(function(Ue,gt,Et,Ot){let At=Ue.terrain?Ue.terrain.exaggeration():0,Nt=Ue.transform.zoom;for(let xi of Ot){let ei=gt.getTile(xi).getBucket(Et);ei&&(Ue.conflationActive&&ei.updateReplacement(xi,Ue.replacementSource),ei.evaluateScale(Ue,Et),Ue.terrain&&At>0&&ei.elevationUpdate(Ue.terrain,At,xi,Et.source),ei.needsReEvaluation(Ue,Nt,Et)&&ei.evaluate(Et))}})(q,H,ne,ie),Re===1?re(!0,!0):(re(!1,!0),re(!0,!1))}(c,n,s,u),void S();let R=C.getModels(),O=[],F=c.transform.getFreeCameraOptions().position,B=r.Q.scale([],[F.x,F.y,F.z],c.transform.worldSize);r.Q.negate(B,B);let U=[],j=[],G=0;for(let q of R){let H=s.paint.get("model-rotation").constantOr(null),ne=s.paint.get("model-scale").constantOr(null),ie=s.paint.get("model-translation").constantOr(null);q.computeModelMatrix(c,H,ne,ie,!0,!0,!1);let oe=r.a9.identity([]),$=r.cZ(q.position.lat,c.transform.zoom),X=r.a9.fromScaling([],[1,1,1/$]);r.a9.translate(oe,oe,B),O.push({zScaleMatrix:X,negCameraPosMatrix:oe});for(let ue of q.nodes)ku(c.transform,ue,q.matrix,c.transform.expandedFarZProjMatrix,G,U,j);G++}if(U.sort((q,H)=>H.depth-q.depth),c.renderPass!=="shadow"){if(m===1)for(let q of j)yl(q,c,s,O[q.modelIndex],kt.disabled,c.colorModeForRenderPass());else{for(let q of j)yl(q,c,s,O[q.modelIndex],kt.disabled,qt.disabled);for(let q of j)yl(q,c,s,O[q.modelIndex],c.stencilModeFor3D(),c.colorModeForRenderPass());c.resetStencilClippingMasks()}for(let q of U)yl(q,c,s,O[q.modelIndex],kt.disabled,c.colorModeForRenderPass());S()}else{for(let q of j)Ou(q.mesh,q.nodeModelMatrix,c,s);for(let q of U)Ou(q.mesh,q.nodeModelMatrix,c,s);S()}}},Ql={model:function(c,n,s){let u=n.getSource();if(!u.loaded())return;if(u.type==="vector"||u.type==="geojson")return void(s.modelManager&&s.modelManager.upload(s,u.type==="vector"?c.scope:""));if(u.type==="batched-model")return;let m=u.getModels();for(let _ of m)_.upload(s.context)},raster:function(c,n,s){let u=n.getSource();if(!(u instanceof rt&&u.loaded()))return;let m=c.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!m)return;let _=c.paint.get("raster-array-band")||u.getInitialBand(m);if(_==null)return;let b=n.getIds().map(w=>n.getTileByID(w));for(let w of b)w.updateNeeded(m,_)&&u.prepareTile(w,m,_)},"raster-particle":function(c,n,s){let u=n.getSource();if(!(u instanceof rt&&u.loaded()))return;let m=c.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!m)return;let _=c.paint.get("raster-particle-array-band")||u.getInitialBand(m);if(_==null)return;let b=n.getIds().map(w=>n.getTileByID(w));for(let w of b)w.updateNeeded(m,_)&&u.prepareTile(w,m,_)}};class ym{constructor(n,s,u,m){this.context=new Pn(n,s),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=m,this._timeStamp=new Date().getTime(),this._averageFPS=0,this._fpsHistory=[],this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let _=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let b of _)this._debugParams.enabledLayers[b]=!0;m.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),m.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),m.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),m.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),m.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let b of _)m.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],b);this.setup(),this.numSublayers=qo.maxUnderzooming+qo.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.d3,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new fs(this),this._wireframeDebugCache=new _m,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(n,s){let u=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Yo(this,n));let m=this._terrain;this.transform.elevation=u?m:null,m.update(n,this.transform,s),this.transform.elevation&&!m.enabled&&(this.transform.elevation=null)}_updateFog(n){let s=n.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[u,m]=s.getFovAdjustedRange(this.transform._fov);if(u>m)return void(this.transform.fogCullDistSq=null);let _=u+.78*(m-u);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,s){if(this.width=n*r.f.devicePixelRatio,this.height=s*r.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let u of this.style.order)this.style._mergedLayers[u].resize()}setup(){let n=this.context,s=new r.aQ;s.emplaceBack(0,0),s.emplaceBack(r.Y,0),s.emplaceBack(0,r.Y),s.emplaceBack(r.Y,r.Y),this.tileExtentBuffer=n.createVertexBuffer(s,r.aS.members),this.tileExtentSegments=r.aE.simpleSegment(0,0,4,2);let u=new r.aQ;u.emplaceBack(0,0),u.emplaceBack(r.Y,0),u.emplaceBack(0,r.Y),u.emplaceBack(r.Y,r.Y),this.debugBuffer=n.createVertexBuffer(u,r.aS.members),this.debugSegments=r.aE.simpleSegment(0,0,4,5);let m=new r.aQ;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(m,r.aS.members),this.viewportSegments=r.aE.simpleSegment(0,0,4,2);let _=new r.ay;_.emplaceBack(0,0,0,0),_.emplaceBack(r.Y,0,r.Y,0),_.emplaceBack(0,r.Y,0,r.Y),_.emplaceBack(r.Y,r.Y,r.Y,r.Y),this.mercatorBoundsBuffer=n.createVertexBuffer(_,r.aU.members),this.mercatorBoundsSegments=r.aE.simpleSegment(0,0,4,2);let b=new r.az;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(b);let w=new r.aR;for(let C of[0,1,3,2,0])w.emplaceBack(C);this.debugIndexBuffer=n.createIndexBuffer(w),this.emptyTexture=new r.T(n,new r.h({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=r.a9.create();let S=this.context.gl;this.stencilClearMode=new kt({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,ze.disabled,this.stencilClearMode,qt.disabled,Tt.disabled,Iu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,s,u){if(!s||this.currentStencilSource===s.id||!n.isTileClipped()||!u||u.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let w=!1;for(let S of u)if(this._tileClippingMaskIDs[S.key]===void 0){w=!0;break}if(!w)return}this.currentStencilSource=s.id;let m=this.context,_=m.gl;this.nextStencilID+u.length>256&&this.clearStencil(),m.setColorMode(qt.disabled),m.setDepthMode(ze.disabled);let b=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let w of u){let S=s.getTile(w),C=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,{tileBoundsBuffer:R,tileBoundsIndexBuffer:O,tileBoundsSegments:F}=this.getTileBoundsBuffers(S);b.draw(this,_.TRIANGLES,ze.disabled,new kt({func:_.ALWAYS,mask:0},C,255,_.KEEP,_.KEEP,_.REPLACE),qt.disabled,Tt.disabled,Iu(w.projMatrix),"$clipping",R,O,F)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let n=this.nextStencilID++,s=this.context.gl;return new kt({func:s.NOTEQUAL,mask:255},n,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);let s=this.context.gl;return new kt({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(n){let s=this.context.gl,u=n.sort((b,w)=>w.overscaledZ-b.overscaledZ),m=u[u.length-1].overscaledZ,_=u[0].overscaledZ-m+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();let b={};for(let w=0;w<_;w++)b[w+m]=new kt({func:s.GEQUAL,mask:255},w+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=_,[b,u]}return[{[m]:kt.disabled},u]}colorModeForRenderPass(){let n=this.context.gl;return this._showOverdrawInspector?new qt([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new r.aA(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?qt.unblended:qt.alphaBlended}colorModeForDrapableLayerRenderPass(n){let s=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new qt([s.ONE,s.ONE_MINUS_SRC_ALPHA,s.CONSTANT_ALPHA,s.ONE_MINUS_SRC_ALPHA],new r.aA(0,0,0,n===void 0?0:n),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(n,s,u,m=!1){if(!this.opaquePassEnabledForLayer()&&!m)return ze.disabled;let _=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new ze(u||this.context.gl.LEQUAL,s,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}updateAverageFPS(){let n=new Date().getTime(),s=n-this._timeStamp;this._timeStamp=n,this._fpsHistory.push(s===0?0:1e3/s),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((u,m)=>u+m/this._fpsHistory.length,0))}render(n,s){this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=n.map.repaint,this.style=n,this.options=s;let u=this.style._mergedLayers,m=this.style.order.filter($=>{let X=u[$];return!(X.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[X.type]}),_=m.map($=>u[$]),b=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(r.f.now()),this.imageManager.beginFrame();let w=0,S=!1;for(let $ in b){let X=b[$];X.used&&(X.prepare(this.context),X.getSource().usedInConflation&&++w)}for(let $ of _)$.isHidden(this.transform.zoom)||this.prepareLayer($);let C={},R={},O={},F={},B={};for(let $ in b){let X=b[$];C[$]=X.getVisibleCoordinates(),R[$]=C[$].slice().reverse(),O[$]=X.getVisibleCoordinates(!0).reverse(),F[$]=X.getShadowCasterCoordinates(),B[$]=X.sortCoordinatesByDistance(C[$])}let U=$=>{let X=this.style.getLayerSourceCache($);return X&&X.used?X.getSource():null};if(w){let $=[];for(let X of _)this.layerUsedInConflation(X,U(X))&&$.push(X);if($&&$.length>1){let X=[];for(let ue of $){let le=this.style.getLayerSourceCache(ue);le&&le.used&&le.getSource().usedInConflation&&X.push({layer:ue.fqid,cache:le})}this.replacementSource.setSources(X),S=!0}}S||this.replacementSource.clear(),this.conflationActive=S,this.minCutoffZoom=0,this.longestCutoffRange=0;for(let $ of _){let X=$.cutoffRange();if(this.longestCutoffRange=Math.max(X,this.longestCutoffRange),X>0){let ue=U($);ue&&(this.minCutoffZoom=Math.max(ue.minzoom,this.minCutoffZoom)),$.minzoom&&(this.minCutoffZoom=Math.max($.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let $=0;$<_.length;$++)if(_[$].is3D()){this.opaquePassCutoff=$;break}let j=this.style&&this.style.fog;j?(this._fogVisible=j.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=j.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(O),this.opaquePassCutoff=0);let G=this._shadowRenderer;if(G){G.updateShadowParameters(this.transform,this.style.directionalLight);for(let $ in b)for(let X of C[$]){let ue={min:0,max:0};this.terrain&&(ue=this.terrain.getMinMaxForTile(X)||ue),G.addShadowReceiver(X.toUnwrapped(),ue.min,ue.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.d4(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new xp(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!r.d5(this.context.gl))return;this.renderPass="offscreen";for(let $ of _){let X=n.getLayerSourceCache($);if(!$.hasOffscreenPass()||$.isHidden(this.transform.zoom))continue;let ue=X?R[X.id]:void 0;($.type==="custom"||$.type==="raster"||$.type==="raster-particle"||$.isSky()||ue&&ue.length)&&this.renderLayer(this,X,$,ue)}this.depthRangeFor3D=[0,1-(_.length+2)*this.numSublayers*this.depthEpsilon];let q=this.terrain;q&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&q.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,F)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let H=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ne=(()=>{if(s.showOverdrawInspector)return r.aA.black;if(this.style.fog&&this.transform.projection.supportsFog&&!H){let $=this.style.fog.properties.get("color").toArray01();return new r.aA(...$)}if(this.style.fog&&this.transform.projection.supportsFog&&H){let $=this.style.fog.properties.get("space-color").toArray01();return new r.aA(...$)}return r.aA.transparent})();if(this.context.clear({color:ne,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&H&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){let $=_[this.currentLayer],X=n.getLayerSourceCache($);if($.isSky())continue;let ue=X?($.is3D()?B:R)[X.id]:void 0;this._renderTileClippingMasks($,X,ue),this.renderLayer(this,X,$,ue)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&H&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.W(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){let $=_[this.currentLayer],X=n.getLayerSourceCache($);$.isSky()&&this.renderLayer(this,X,$,X?R[X.id]:void 0)}function ie($,X){let ue;return X&&(ue=($.type==="symbol"?O:$.is3D()?B:R)[X.id]),ue}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<m.length;){let $=_[this.currentLayer];if($.type==="raster"){let X=n.getLayerSourceCache($);this.renderLayer(this,X,$,ie($,X))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let oe=0;for(G&&(oe=G.getShadowCastingLayerCount());this.currentLayer<m.length;){let $=_[this.currentLayer],X=n.getLayerSourceCache($);if($.isSky())++this.currentLayer;else if(q&&this.style.isLayerDraped($)){if($.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=q.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks($,X,X?C[X.id]:void 0),this.renderLayer(this,X,$,ie($,X)),!q&&G&&oe>0&&$.hasShadowPass()&&--oe==0&&(G.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let ue=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ue;this.currentLayer++){let le=_[this.currentLayer];if(!le.hasLightBeamPass())continue;let ge=n.getLayerSourceCache(le);this.renderLayer(this,ge,le,ge?R[ge.id]:void 0)}this.currentLayer=ue,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let $=null;_.forEach(X=>{let ue=n.getLayerSourceCache(X);ue&&!X.isHidden(this.transform.zoom)&&ue.getVisibleCoordinates().length&&(!$||$.getSource().maxzoom<ue.getSource().maxzoom)&&($=ue)}),$&&this.options.showTileBoundaries&&Jh.debug(this,$,$.getVisibleCoordinates(),r.aA.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Jh.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.aA(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function($){let X=$.transform.padding;dm($,$.transform.height-(X.top||0),3,_p),dm($,X.bottom||0,3,J_),pm($,X.left||0,3,um),pm($,$.transform.width-(X.right||0),3,hm);let ue=$.transform.centerPoint;(function(le,ge,Me,me){Hh(le,ge-1,Me-10,2,20,me),Hh(le,ge-10,Me-1,20,2,me)})($,ue.x,$.transform.height-ue.y,yp)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),S||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);let{unsupportedLayers:s}=this.transform.projection,u=!s||!s.includes(n.type);if(Ql[n.type]&&(u||this.terrain&&n.type==="custom")){let m=this.style.getLayerSourceCache(n);Ql[n.type](n,m,this)}this.gpuTimingEnd()}renderLayer(n,s,u,m){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="sky"||u.type==="custom"||u.type==="model"||u.type==="raster"||u.type==="raster-particle"||m&&m.length)&&(this.id=u.id,this.gpuTimingStart(u),(!n.transform.projection.unsupportedLayers||!n.transform.projection.unsupportedLayers.includes(u.type)||n.terrain&&u.type==="custom")&&Jh[u.type](n,s,u,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;let s=this.context.extTimerQuery,u=this.context.gl,m=this.gpuTimers[n.id];m||(m=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:u.createQuery()}),m.calls++,u.beginQuery(s.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let n=this.context.extTimerQuery,s=this.context.gl,u=s.createQuery();this.deferredRenderGpuTimeQueries.push(u),s.beginQuery(n.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){let n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){let s={};for(let u in n){let m=n[u],_=this.context.extTimerQuery,b=_.getQueryParameter(m.query,this.context.gl.QUERY_RESULT)/1e6;_.deleteQueryEXT(m.query),s[u]=b}return s}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;let s=this.context.extTimerQuery,u=this.context.gl,m=0;for(let _ of n)m+=s.getQueryParameter(_,u.QUERY_RESULT)/1e6,s.deleteQueryEXT(_);return m}translatePosMatrix(n,s,u,m,_){if(!u[0]&&!u[1])return n;let b=_?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(b){let C=Math.sin(b),R=Math.cos(b);u=[u[0]*R-u[1]*C,u[0]*C+u[1]*R]}let w=[_?u[0]:r.a6(s,u[0],this.transform.zoom),_?u[1]:r.a6(s,u[1],this.transform.zoom),0],S=new Float32Array(16);return r.a9.translate(S,n,w),S}saveTileTexture(n){let s=n.size[0],u=this._tileTextures[s];u?u.push(n):this._tileTextures[s]=[n]}getTileTexture(n){let s=this._tileTextures[n];return s&&s.length>0?s.pop():null}isPatternMissing(n,s){return n===null||n!==void 0&&!this.imageManager.getPattern(n.toString(),s)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,s,u){let m=u===void 0?this.terrain&&this.terrain.renderingToTexture:u,_=this.terrain&&this.terrain.exaggeration()===0,b=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):m||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||b.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?b.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):b.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT"),_&&b.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||m||s!==void 0&&!s||b.push("FOG","FOG_DITHERING"),m&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(n,s){this.cache=this.cache||{};let u=s&&s.defines||[],m=s&&s.config,_=this.currentGlobalDefines(n,s&&s.overrideFog,s&&s.overrideRtt).concat(u),b=vs.cacheKey(Oo[n],n,_,m);return this.cache[b]||(this.cache[b]=new vs(this.context,n,Oo[n],m,dp[n],_)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,s){if(this.style.enable3dLights()){let u=this.style.directionalLight,m=this.style.ambientLight;if(u&&m){let _=((b,w)=>{let S=b.properties.get("direction"),C=b.properties.get("color").toArray01(),R=b.properties.get("intensity"),O=w.properties.get("color").toArray01(),F=w.properties.get("intensity"),B=[S.x,S.y,S.z],U=r.cs(O,F),j=r.cs(C,R);return{u_lighting_ambient_color:U,u_lighting_directional_dir:B,u_lighting_directional_color:j,u_ground_radiance:om(B,j,U)}})(u,m);s.setLightsUniformValues(n,_)}}}uploadCommonUniforms(n,s,u,m,_){if(this.uploadCommonLightUniforms(n,s),this.terrain&&this.terrain.renderingToTexture)return;let b=this.style.fog;if(b){let w=b.getOpacity(this.transform.pitch),S=((C,R,O,F,B,U,j,G,q,H,ne,ie)=>{let oe=C.transform,$=R.properties.get("color").toArray01();$[3]=F;let X=C.frameCounter/1e3%1,[ue,le]=R.properties.get("vertical-range");return{u_fog_matrix:O?oe.calculateFogTileMatrix(O):ie||C.identityMat,u_fog_range:R.getFovAdjustedRange(oe._fov),u_fog_color:$,u_fog_horizon_blend:R.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ue,le),le],u_fog_temporal_offset:X,u_frustum_tl:B,u_frustum_tr:U,u_frustum_br:j,u_frustum_bl:G,u_globe_pos:q,u_globe_radius:H,u_viewport:ne,u_globe_transition:r.W(oe.zoom),u_is_globe:+(oe.projection.name==="globe")}})(this,b,u,w,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.f.devicePixelRatio,this.transform.height*r.f.devicePixelRatio],m);s.setFogUniformValues(n,S)}_&&s.setCutoffUniformValues(n,_.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){let n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){let n=this.context.gl,s=n.createTexture();return n.bindTexture(n.TEXTURE_2D,s),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let n=this._backgroundTiles,s=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(let m of u)s[m.key]=n[m.key]||new Ao(m,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(n,s){return!(!n.is3D()||n.minzoom&&n.minzoom>this.transform.zoom||n.sourceLayer!=="building"&&(!s||s.type!=="batched-model"))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let s=this._cachedTileFogOpacities[n.key];return s||(this._cachedTileFogOpacities[n.key]=s=this.style.fog.getOpacityForTile(n)),s[0]>=Fi||s[1]>=Fi}}function vm(c,n){let s=!1,u=null,m=()=>{u=null,s&&(c(),u=setTimeout(m,n),s=!1)};return()=>(s=!0,u||m(),u)}class ty{constructor(n){this._hashName=n&&encodeURIComponent(n),r.a$(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=vm(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let n=this._map;if(!n)return"";let s=bm(n);if(this._hashName){let u=this._hashName,m=!1,_=location.hash.slice(1).split("&").map(b=>{let w=b.split("=")[0];return w===u?(m=!0,`${w}=${s}`):b}).filter(b=>b);return m||_.push(`${u}=${s}`),`#${_.join("&")}`}return`#${s}`}_getCurrentHash(){let n=location.hash.replace("#","");if(this._hashName){let s;return n.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(s=u)}),(s&&s[1]||"").split("/")}return n.split("/")}_onHashChange(){let n=this._map;if(!n)return!1;let s=this._getCurrentHash();if(s.length>=3&&!s.some(u=>isNaN(u))){let u=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(s[3]||0):n.getBearing();return n.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:u,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function bm(c,n){let s=c.getCenter(),u=Math.round(100*c.getZoom())/100,m=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,m),b=Math.round(s.lng*_)/_,w=Math.round(s.lat*_)/_,S=c.getBearing(),C=c.getPitch(),R=n?`/${b}/${w}/${u}`:`${u}/${w}/${b}`;return(S||C)&&(R+="/"+Math.round(10*S)/10),C&&(R+=`/${Math.round(C)}`),R}let Sc={linearity:.3,easing:r.d6(0,0,.3,1)},Tp=r.e({deceleration:2500,maxSpeed:1400},Sc),Ep=r.e({deceleration:20,maxSpeed:1400},Sc),Ip=r.e({deceleration:1e3,maxSpeed:360},Sc),xm=r.e({deceleration:1e3,maxSpeed:90},Sc);class wm{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.f.now(),settings:n})}_drainInertiaBuffer(){let n=this._inertiaBuffer,s=r.f.now();for(;n.length>0&&s-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let s={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:_}of this._inertiaBuffer)s.zoom+=_.zoomDelta||0,s.bearing+=_.bearingDelta||0,s.pitch+=_.pitchDelta||0,_.panDelta&&s.pan._add(_.panDelta),_.around&&(s.around=_.around),_.pinchAround&&(s.pinchAround=_.pinchAround);let u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(s.pan.mag()){let _=vl(s.pan.mag(),u,r.e({},Tp,n||{}));m.offset=s.pan.mult(_.amount/s.pan.mag()),m.center=this._map.transform.center,ed(m,_)}if(s.zoom){let _=vl(s.zoom,u,Ep);m.zoom=this._map.transform.zoom+_.amount,ed(m,_)}if(s.bearing){let _=vl(s.bearing,u,Ip);m.bearing=this._map.transform.bearing+r.ad(_.amount,-179,179),ed(m,_)}if(s.pitch){let _=vl(s.pitch,u,xm);m.pitch=this._map.transform.pitch+_.amount,ed(m,_)}if(m.zoom||m.bearing){let _=s.pinchAround===void 0?s.around:s.pinchAround;m.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),m.noMoveStart=!0,m}}function ed(c,n){(!c.duration||c.duration<n.duration)&&(c.duration=n.duration,c.easing=n.easing)}function vl(c,n,s){let{maxSpeed:u,linearity:m,deceleration:_}=s,b=r.ad(c*m/(n/1e3),-u,u),w=Math.abs(b)/(_*m);return{easing:s.easing,duration:1e3*w,amount:b*(w/2)}}class Xr extends r.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,s,u,m={}){let _=Io(s.getCanvasContainer(),u),b=s.unproject(_);super(n,r.e({point:_,lngLat:b,originalEvent:u},m)),this._defaultPrevented=!1,this.target=s}}class zu extends r.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,s,u){let m=n==="touchend"?u.changedTouches:u.touches,_=In(s.getCanvasContainer(),m),b=_.map(S=>s.unproject(S)),w=_.reduce((S,C,R,O)=>S.add(C.div(O.length)),new r.P(0,0));super(n,{points:_,point:w,lngLats:b,lngLat:s.unproject(w),originalEvent:u}),this._defaultPrevented=!1}}class Jo extends r.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,s,u){super(n,{originalEvent:u}),this._defaultPrevented=!1}}class Sp{constructor(n,s){this._map=n,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new Jo(n.type,this._map,n))}mousedown(n,s){return this._mousedownPos=s,this._firePreventable(new Xr(n.type,this._map,n))}mouseup(n){this._map.fire(new Xr(n.type,this._map,n))}preclick(n){let s=r.e({},n);s.type="preclick",this._map.fire(new Xr(s.type,this._map,s))}click(n,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(n),this._map.fire(new Xr(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new Xr(n.type,this._map,n))}mouseover(n){this._map.fire(new Xr(n.type,this._map,n))}mouseout(n){this._map.fire(new Xr(n.type,this._map,n))}touchstart(n){return this._firePreventable(new zu(n.type,this._map,n))}touchmove(n){this._map.fire(new zu(n.type,this._map,n))}touchend(n){this._map.fire(new zu(n.type,this._map,n))}touchcancel(n){this._map.fire(new zu(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class td{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new Xr(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Xr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Xr(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class id{constructor(n,s){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,s){this.isEnabled()&&n.shiftKey&&n.button===0&&(Ei(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(n,s){if(!this._active)return;let u=s,m=this._startPos,_=this._lastPos;if(!m||!_||_.equals(u)||!this._box&&u.dist(m)<this._clickTolerance)return;this._lastPos=u,this._box||(this._box=Ie("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));let b=Math.min(m.x,u.x),w=Math.max(m.x,u.x),S=Math.min(m.y,u.y),C=Math.max(m.y,u.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${S}px)`,this._box.style.width=w-b+"px",this._box.style.height=C-S+"px")})}mouseupWindow(n,s){if(!this._active)return;let u=this._startPos,m=s;if(u&&n.button===0){if(this.reset(),ni(),u.x!==m.x||u.y!==m.y)return this._map.fire(new r.b("boxzoomend",{originalEvent:n})),{cameraAnimation:_=>_.fitScreenCoordinates(u,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),sn(),delete this._startPos,delete this._lastPos}_fireEvent(n,s){return this._map.fire(new r.b(n,{originalEvent:s}))}}function Bu(c,n){let s={};for(let u=0;u<c.length;u++)s[c[u].identifier]=n[u];return s}class Mp{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,s,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),u.length===this.numTouches&&(this.centroid=function(m){let _=new r.P(0,0);for(let b of m)_._add(b);return _.div(m.length)}(s),this.touches=Bu(u,s)))}touchmove(n,s,u){if(this.aborted||!this.centroid)return;let m=Bu(u,s);for(let _ in this.touches){let b=m[_];(!b||b.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(n,s,u){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){let m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Mc{constructor(n){this.singleTap=new Mp(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,s,u){this.singleTap.touchstart(n,s,u)}touchmove(n,s,u){this.singleTap.touchmove(n,s,u)}touchend(n,s,u){let m=this.singleTap.touchend(n,s,u);if(m){let _=n.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(m)<30;if(_&&b||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Cp{constructor(){this._zoomIn=new Mc({numTouches:1,numTaps:2}),this._zoomOut=new Mc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,s,u){this._zoomIn.touchstart(n,s,u),this._zoomOut.touchstart(n,s,u)}touchmove(n,s,u){this._zoomIn.touchmove(n,s,u),this._zoomOut.touchmove(n,s,u)}touchend(n,s,u){let m=this._zoomIn.touchend(n,s,u),_=this._zoomOut.touchend(n,s,u);return m?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(m)},{originalEvent:n})}):_?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(_)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let Ap={0:1,2:2};class Cc{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,s){return!1}_move(n,s){return{}}mousedown(n,s){if(this._lastPoint)return;let u=rs(n);this._correctButton(n,u)&&(this._lastPoint=s,this._eventButton=u)}mousemoveWindow(n,s){let u=this._lastPoint;if(u){if(n.preventDefault(),this._eventButton!=null&&function(m,_){let b=Ap[_];return m.buttons===void 0||(m.buttons&b)!==b}(n,this._eventButton))this.reset();else if(this._moved||!(s.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(u,s)}}mouseupWindow(n){this._lastPoint&&rs(n)===this._eventButton&&(this._moved&&ni(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tm extends Cc{mousedown(n,s){super.mousedown(n,s),this._lastPoint&&(this._active=!0)}_correctButton(n,s){return s===0&&!n.ctrlKey}_move(n,s){return{around:s,panDelta:s.sub(n)}}}class Dp extends Cc{_correctButton(n,s){return s===0&&n.ctrlKey||s===2}_move(n,s){let u=.8*(s.x-n.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(n){n.preventDefault()}}class Xl extends Cc{_correctButton(n,s){return s===0&&n.ctrlKey||s===2}_move(n,s){let u=-.5*(s.y-n.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(n){n.preventDefault()}}class iy{constructor(n,s){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),r.a$(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(n,s,u){return this._calculateTransform(n,s,u)}touchmove(n,s,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(u.length===1&&!r.d7())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,s,u)}}touchend(n,s,u){this._calculateTransform(n,s,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,s,u){u.length>0&&(this._active=!0);let m=Bu(u,s),_=new r.P(0,0),b=new r.P(0,0),w=0;for(let C in m){let R=m[C],O=this._touches[C];O&&(_._add(R),b._add(R.sub(O)),w++,m[C]=R)}if(this._touches=m,w<this._minTouches||!b.mag())return;let S=b.div(w);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(w),panDelta:S}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ie("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Rp{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,s,u){return{}}touchstart(n,s,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([s[0],s[1]]))}touchmove(n,s,u){let m=this._firstTwoTouches;if(!m)return;n.preventDefault();let[_,b]=m,w=nd(u,s,_),S=nd(u,s,b);if(!w||!S)return;let C=this._aroundCenter?null:w.add(S).div(2);return this._move([w,S],C,n)}touchend(n,s,u){if(!this._firstTwoTouches)return;let[m,_]=this._firstTwoTouches,b=nd(u,s,m),w=nd(u,s,_);b&&w||(this._active&&ni(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function nd(c,n,s){for(let u=0;u<c.length;u++)if(c[u].identifier===s)return n[u]}function Em(c,n){return Math.log(c/n)/Math.LN2}class ny extends Rp{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,s){let u=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Em(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Em(this._distance,u),pinchAround:s}}}function Im(c,n){return 180*c.angleWith(n)/Math.PI}class Pp extends Rp{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,s){let u=this._vector;if(this._vector=n[0].sub(n[1]),u&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Im(this._vector,u),pinchAround:s}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());let s=25/(Math.PI*this._minDiameter)*360,u=this._startVector;if(!u)return!1;let m=Im(n,u);return Math.abs(m)<s}}function Nu(c){return Math.abs(c.y)>Math.abs(c.x)}class Sm extends Rp{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Nu(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,s,u){let m=this._lastPoints;if(!m)return;let _=n[0].sub(m[0]),b=n[1].sub(m[1]);return this._map._cooperativeGestures&&!r.d7()&&u.touches.length<3||(this._valid=this.gestureBeginsVertically(_,b,u.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(_.y+b.y)/2*-.5})}gestureBeginsVertically(n,s,u){if(this._valid!==void 0)return this._valid;let m=n.mag()>=2,_=s.mag()>=2;if(!m&&!_)return;if(!m||!_)return this._firstMove==null&&(this._firstMove=u),u-this._firstMove<100&&void 0;let b=n.y>0==s.y>0;return Nu(n)&&Nu(s)&&b}}let Ac={panStep:100,bearingStep:15,pitchStep:10};class Mm{constructor(){let n=Ac;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let s=0,u=0,m=0,_=0,b=0;switch(n.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:n.shiftKey?u=-1:(n.preventDefault(),_=-1);break;case 39:n.shiftKey?u=1:(n.preventDefault(),_=1);break;case 38:n.shiftKey?m=1:(n.preventDefault(),b=-1);break;case 40:n.shiftKey?m=-1:(n.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(u=0,m=0),{cameraAnimation:w=>{let S=w.getZoom();w.easeTo({duration:300,easeId:"keyboardHandler",easing:Cm,zoom:s?Math.round(S)+s*(n.shiftKey?2:1):S,bearing:w.getBearing()+u*this._bearingStep,pitch:w.getPitch()+m*this._pitchStep,offset:[-_*this._panStep,-b*this._panStep],center:w.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Cm(c){return c*(2-c)}let kp=4.000244140625,Op=1/450;class Yl{constructor(n,s){this._map=n,this._el=n.getCanvasContainer(),this._handler=s,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Op,r.a$(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||r.d7()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY,u=r.f.now(),m=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,s!==0&&s%kp==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(m*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),n.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=n,this._delta-=s,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let s=Io(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let s=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){let C=this._type==="wheel"&&Math.abs(this._delta)>kp?this._wheelZoomRate:this._defaultZoomRate,R=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&R!==0&&(R=1/R);let O=s(),F=Math.pow(2,O),B=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):F;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(B*R))),this._type==="wheel"&&(this._startZoom=O,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let u=typeof this._targetZoom=="number"?this._targetZoom:s(),m=this._startZoom,_=this._easing,b,w=!1;if(this._type==="wheel"&&m&&_){let C=Math.min((r.f.now()-this._lastWheelEventTime)/200,1),R=_(C);b=r.X(m,u,R),C<1?this._frameId||(this._frameId=!0):w=!0}else b=u,w=!0;this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let S=b-s();return S*this._lastDelta<0&&(S=0),{noInertia:!0,needsRenderFrame:!w,zoomDelta:S,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let s=r.d8;if(this._prevEase){let u=this._prevEase,m=(r.f.now()-u.start)/u.duration,_=u.easing(m+.01)-u.easing(m),b=.27/Math.sqrt(_*_+1e-4)*.01,w=Math.sqrt(.0729-b*b);s=r.d6(b,w,.25,1)}return this._prevEase={start:r.f.now(),duration:n,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ie("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Am{constructor(n,s){this._clickZoom=n,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Kl{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,s){return n.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(n.shiftKey?-1:1),around:u.unproject(s)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dm{constructor(){this._tap=new Mc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,s,u){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=s[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(n,s,u))}touchmove(n,s,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;let m=s[0],_=m.y-this._swipePoint.y;return this._swipePoint=m,n.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(n,s,u)}touchend(n,s,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(n,s,u)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rd{constructor(n,s,u){this._el=n,this._mousePan=s,this._touchPan=u}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Rm{constructor(n,s,u){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=s,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Pm{constructor(n,s,u,m){this._el=n,this._touchZoom=s,this._touchRotate=u,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Dc=c=>c.zoom||c.drag||c.pitch||c.rotate;class Lp extends r.b{}class ry{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,s){let u=r.Q.sub([],s,n);this.radius=r.Q.length(u[2]<0?r.Q.div([],u,this.constants):[u[0],u[1],0])}projectRay(n){r.Q.div(n,n,this.constants),r.Q.normalize(n,n),r.Q.mul(n,n,this.constants);let s=r.Q.scale([],n,this.radius);if(s[2]>0){let u=r.Q.scale([],[0,0,1],r.Q.dot(s,[0,0,1])),m=r.Q.scale([],r.Q.normalize([],[s[0],s[1],0]),this.radius),_=r.Q.add([],s,r.Q.scale([],r.Q.sub([],r.Q.add([],m,u),s),2));s[0]=_[0],s[1]=_[1]}return s}}function Vu(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class ju{constructor(n,s){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new wm(n),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ry,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),r.a$(["handleEvent","handleWindowEvent"],this);let u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(let[m,_,b]of this._listeners){let w=m===document?this.handleWindowEvent:this.handleEvent;m.addEventListener(_,w,b)}}destroy(){for(let[n,s,u]of this._listeners){let m=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(s,m,u)}}_addDefaultHandlers(n){let s=this._map,u=s.getCanvasContainer();this._add("mapEvent",new Sp(s,n));let m=s.boxZoom=new id(s,n);this._add("boxZoom",m);let _=new Cp,b=new Kl;s.doubleClickZoom=new Am(b,_),this._add("tapZoom",_),this._add("clickZoom",b);let w=new Dm;this._add("tapDragZoom",w);let S=s.touchPitch=new Sm(s);this._add("touchPitch",S);let C=new Dp(n),R=new Xl(n);s.dragRotate=new Rm(n,C,R),this._add("mouseRotate",C,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]);let O=new Tm(n),F=new iy(s,n);s.dragPan=new rd(u,O,F),this._add("mousePan",O),this._add("touchPan",F,["touchZoom","touchRotate"]);let B=new Pp,U=new ny;s.touchZoomRotate=new Pm(u,U,B,w),this._add("touchRotate",B,["touchPan","touchZoom"]),this._add("touchZoom",U,["touchPan","touchRotate"]),this._add("blockableMapEvent",new td(s));let j=s.scrollZoom=new Yl(s,this);this._add("scrollZoom",j,["mousePan"]);let G=s.keyboard=new Mm;this._add("keyboard",G);for(let q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[q]&&s[q].enable(n[q])}_add(n,s,u){this._handlers.push({handlerName:n,handler:s,allowed:u}),this._handlersById[n]=s}stop(n){if(!this._updatingCamera){for(let{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Dc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,s,u){for(let m in n)if(m!==u&&(!s||s.indexOf(m)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){let s=[];for(let u of n)this._el.contains(u.target)&&s.push(u);return s}handleEvent(n,s){this._updatingCamera=!0;let u=n.type==="renderFrame",m=u?void 0:n,_={needsRenderFrame:!1},b={},w={},S=n.touches?this._getMapTouches(n.touches):void 0,C=S?In(this._el,S):u?void 0:Io(this._el,n);for(let{handlerName:F,handler:B,allowed:U}of this._handlers){if(!B.isEnabled())continue;let j;this._blockedByActive(w,U,F)?B.reset():B[s||n.type]&&(j=B[s||n.type](n,C,S),this.mergeHandlerResult(_,b,j,F,m),j&&j.needsRenderFrame&&this._triggerRenderFrame()),(j||B.isActive())&&(w[F]=B)}let R={};for(let F in this._previousActiveHandlers)w[F]||(R[F]=m);this._previousActiveHandlers=w,(Object.keys(R).length||Vu(_))&&(this._changes.push([_,b,R]),this._triggerRenderFrame()),(Object.keys(w).length||Vu(_))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:O}=_;O&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],O(this._map))}mergeHandlerResult(n,s,u,m,_){if(!u)return;r.e(n,u);let b={handlerName:m,originalEvent:u.originalEvent||_};u.zoomDelta!==void 0&&(s.zoom=b),u.panDelta!==void 0&&(s.drag=b),u.pitchDelta!==void 0&&(s.pitch=b),u.bearingDelta!==void 0&&(s.rotate=b)}_applyChanges(){let n={},s={},u={};for(let[m,_,b]of this._changes)m.panDelta&&(n.panDelta=(n.panDelta||new r.P(0,0))._add(m.panDelta)),m.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(n.around=m.around),m.aroundCoord!==void 0&&(n.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(n.pinchAround=m.pinchAround),m.noInertia&&(n.noInertia=m.noInertia),r.e(s,_),r.e(u,b);this._updateMapTransform(n,s,u),this._changes=[]}_updateMapTransform(n,s,u){let m=this._map,_=m.transform,b=H=>[H.x,H.y,H.z];if((H=>{let ne=this._eventsInProgress.drag;return ne&&!this._handlersById[ne.handlerName].isActive()})()&&!Vu(n)){let H=_.zoom;_.cameraElevationReference="sea",this._originalZoom!=null&&_._orthographicProjectionAtLowPitch&&_.projection.name!=="globe"&&_.pitch===0?(_.cameraElevationReference="ground",_.zoom=this._originalZoom):(_.recenterOnTerrain(),_.cameraElevationReference="ground"),H!==_.zoom&&this._map._update(!0)}if(_._isCameraConstrained&&m._stop(!0),!Vu(n))return void this._fireEvents(s,u,!0);let{panDelta:w,zoomDelta:S,bearingDelta:C,pitchDelta:R,around:O,aroundCoord:F,pinchAround:B}=n;_._isCameraConstrained&&(S>0&&(S=0),_._isCameraConstrained=!1),B!==void 0&&(O=B),(S||(H=>s[H]&&!this._eventsInProgress[H])("drag"))&&O&&(this._dragOrigin=b(_.pointCoordinate3D(O)),this._originalZoom=_.zoom,this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",m._stop(!0),O=O||m.transform.centerPoint,C&&(_.bearing+=C),R&&(_.pitch+=R),_._updateCameraState();let U=[0,0,0];if(w)if(_.projection.name==="mercator"){let H=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(O).dir),ne=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(O.sub(w)).dir);U[0]=ne[0]-H[0],U[1]=ne[1]-H[1]}else{let H=_.pointCoordinate(O);if(_.projection.name==="globe"){w=w.rotate(-_.angle);let ne=_._pixelsPerMercatorPixel/_.worldSize;U[0]=-w.x*r.d9(r.ax(H.y))*ne,U[1]=-w.y*r.d9(_.center.lat)*ne}else{let ne=_.pointCoordinate(O.sub(w));H&&ne&&(U[0]=ne.x-H.x,U[1]=ne.y-H.y)}}let j=_.zoom,G=[0,0,0];if(S){let H=b(F||_.pointCoordinate3D(O)),ne={dir:r.Q.normalize([],r.Q.sub([],H,_._camera.position))};if(ne.dir[2]<0){let ie=_.zoomDeltaToMovement(H,S);r.Q.scale(G,ne.dir,ie)}}let q=r.Q.add(U,U,G);_._translateCameraConstrained(q),S&&Math.abs(_.zoom-j)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(s,u,!0)}_fireEvents(n,s,u){let m=Dc(this._eventsInProgress),_=Dc(n),b={};for(let R in n){let{originalEvent:O}=n[R];this._eventsInProgress[R]||(b[`${R}start`]=O),this._eventsInProgress[R]=n[R]}!m&&_&&this._fireEvent("movestart",_.originalEvent);for(let R in b)this._fireEvent(R,b[R]);_&&this._fireEvent("move",_.originalEvent);for(let R in n){let{originalEvent:O}=n[R];this._fireEvent(R,O)}let w={},S;for(let R in this._eventsInProgress){let{handlerName:O,originalEvent:F}=this._eventsInProgress[R];this._handlersById[O].isActive()||(delete this._eventsInProgress[R],S=s[O]||F,w[`${R}end`]=S)}for(let R in w)this._fireEvent(R,w[R]);let C=Dc(this._eventsInProgress);if(u&&(m||_)&&!C){this._updatingCamera=!0;let R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;R?(O(R.bearing||this._map.getBearing())&&(R.bearing=0),this._map.easeTo(R,{originalEvent:S})):(this._map.fire(new r.b("moveend",{originalEvent:S})),O(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,s){this._map.fire(new r.b(n,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Lp("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let km="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class oy extends r.E{constructor(n,s){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=s.bearingSnap,this._respectPrefersReducedMotion=s.respectPrefersReducedMotion!==!1,r.a$(["_renderFrameCallback"],this)}getCenter(){return new r.bq(this.transform.center.lng,this.transform.center.lat)}setCenter(n,s){return this.jumpTo({center:n},s)}panBy(n,s,u){return n=r.P.convert(n).mult(-1),this.panTo(this.transform.center,r.e({offset:n},s),u)}panTo(n,s,u){return this.easeTo(r.e({center:n},s),u)}getZoom(){return this.transform.zoom}setZoom(n,s){return this.jumpTo({zoom:n},s),this}zoomTo(n,s,u){return this.easeTo(r.e({zoom:n},s),u)}zoomIn(n,s){return this.zoomTo(this.getZoom()+1,n,s),this}zoomOut(n,s){return this.zoomTo(this.getZoom()-1,n,s),this}getBearing(){return this.transform.bearing}setBearing(n,s){return this.jumpTo({bearing:n},s),this}getPadding(){return this.transform.padding}setPadding(n,s){return this.jumpTo({padding:n},s),this}rotateTo(n,s,u){return this.easeTo(r.e({bearing:n},s),u)}resetNorth(n,s){return this.rotateTo(0,r.e({duration:1e3},n),s),this}resetNorthPitch(n,s){return this.easeTo(r.e({bearing:0,pitch:0,duration:1e3},n),s),this}snapToNorth(n,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,s):this}getPitch(){return this.transform.pitch}setPitch(n,s){return this.jumpTo({pitch:n},s),this}cameraForBounds(n,s){n=r.ag.convert(n);let u=s&&s.bearing||0,m=s&&s.pitch||0,_=n.getNorthWest(),b=n.getSouthEast();return this._cameraForBounds(this.transform,_,b,u,m,s)}_extendPadding(n){let s={top:0,right:0,bottom:0,left:0};return n==null?r.e({},s,this.transform.padding):typeof n=="number"?{top:n,bottom:n,right:n,left:n}:r.e({},s,n)}_extendCameraOptions(n){return(n=r.e({offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=this._extendPadding(n.padding),n}_minimumAABBFrustumDistance(n,s){let u=s.max[0]-s.min[0],m=s.max[1]-s.min[1];return u/m>n.aspect?u/(2*Math.tan(.5*n.fovX)*n.aspect):m/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,s,u,m,_,b){let w=n.clone(),S=this._extendCameraOptions(b);w.bearing=m,w.pitch=_;let C=r.bq.convert(s),R=r.bq.convert(u),O=.5*(C.lat+R.lat),F=.5*(C.lng+R.lng),B=r.da(O,F),U=r.Q.normalize([],B),j=r.Q.normalize([],r.Q.cross([],U,[0,1,0])),G=r.Q.cross([],j,U),q=[j[0],j[1],j[2],0,G[0],G[1],G[2],0,U[0],U[1],U[2],0,0,0,0,1],H=[B,r.da(C.lat,C.lng),r.da(R.lat,C.lng),r.da(R.lat,R.lng),r.da(C.lat,R.lng),r.da(O,C.lng),r.da(O,R.lng),r.da(C.lat,F),r.da(R.lat,F)],ne=r.bV.fromPoints(H.map(De=>[r.Q.dot(j,De),r.Q.dot(G,De),r.Q.dot(U,De)])),ie=r.Q.transformMat4([],ne.center,q);r.Q.squaredLength(ie)===0&&r.Q.set(ie,0,0,1),r.Q.normalize(ie,ie),r.Q.scale(ie,ie,r.ae),w.center=r.db(ie);let oe=w.getWorldToCameraMatrix(),$=r.a9.invert(new Float64Array(16),oe);ne=r.bV.applyTransform(ne,r.a9.multiply([],oe,q));let X=this._extendAABB(ne,w,S,m);if(!X)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ne=X,r.Q.transformMat4(ie,ie,oe);let ue=.5*(ne.max[2]-ne.min[2]),le=this._minimumAABBFrustumDistance(w,ne),ge=r.Q.scale([],[0,0,1],ue),Me=r.Q.add(ge,ie,ge),me=le+(w.pitch===0?0:r.Q.distance(ie,Me)),Ee=w.globeCenterInViewSpace,Re=r.Q.sub([],ie,[Ee[0],Ee[1],Ee[2]]);r.Q.normalize(Re,Re),r.Q.scale(Re,Re,me);let pe=r.Q.add([],ie,Re);r.Q.transformMat4(pe,pe,$);let xe=r.dc/r.ae,He=r.Q.length(pe),ye=r.bo(Math.max(He*xe-r.dc,Number.EPSILON),0),Se=Math.min(w.zoomFromMercatorZAdjusted(ye),S.maxZoom);return Se>.5*(r.bJ+r.bA)?(w.setProjection({name:"mercator"}),w.zoom=Se,this._cameraForBounds(w,s,u,m,_,b)):{center:w.center,zoom:Se,bearing:m,pitch:_}}_extendAABB(n,s,u,m){let _=.5*((u.padding.left||0)+(u.padding.right||0)),b=.5*((u.padding.top||0)+(u.padding.bottom||0)),w=b,S=_,C=_,R=b,O=s.width-(S+C),F=s.height-(w+R),B=r.Q.sub([],n.max,n.min),U=Math.min(O/B[0],F/B[1]),j=Math.min(s.scaleZoom(s.scale*U),u.maxZoom);if(isNaN(j))return null;let G=s.scale/s.zoomScale(j),q=new r.bV([n.min[0]-S*G,n.min[1]-R*G,n.min[2]],[n.max[0]+C*G,n.max[1]+w*G,n.max[2]]),H=(typeof u.offset.x=="number"&&typeof u.offset.y=="number"?new r.P(u.offset.x,u.offset.y):r.P.convert(u.offset)).rotate(-r.bm(m));return q.center[0]-=H.x*G,q.center[1]+=H.y*G,q}queryTerrainElevation(n,s){let u=this.transform.elevation;return u?(s=r.e({},{exaggerated:!0},s),u.getAtPoint(r.O.fromLngLat(n),null,s.exaggerated)):null}_cameraForBounds(n,s,u,m,_,b){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,s,u,m,_,b);let w=n.clone(),S=this._extendCameraOptions(b);w.bearing=m,w.pitch=_;let C=r.bq.convert(s),R=r.bq.convert(u),O=new r.bq(C.lng,R.lat),F=new r.bq(R.lng,C.lat),B=w.project(C),U=w.project(R),j=this.queryTerrainElevation(C),G=this.queryTerrainElevation(R),q=this.queryTerrainElevation(O),H=this.queryTerrainElevation(F),ne=[[B.x,B.y,Math.min(j||0,G||0,q||0,H||0)],[U.x,U.y,Math.max(j||0,G||0,q||0,H||0)]],ie=r.bV.fromPoints(ne),oe=w.getWorldToCameraMatrix(),$=r.a9.invert(new Float64Array(16),oe);ie=r.bV.applyTransform(ie,oe);let X=this._extendAABB(ie,w,S,m);if(!X)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ie=X;let ue=.5*r.Q.sub([],ie.max,ie.min)[2],le=this._minimumAABBFrustumDistance(w,ie),ge=[0,0,1,0];r.aa.transformMat4(ge,ge,oe),r.aa.normalize(ge,ge);let Me=r.Q.scale([],ge,le+ue),me=r.Q.add([],ie.center,Me);r.Q.transformMat4(ie.center,ie.center,$),r.Q.transformMat4(me,me,$);let Ee=[ie.center[0],ie.center[1],me[2]*w.pixelsPerMeter];r.Q.scale(Ee,Ee,1/w.worldSize);let Re=r.aw(Ee[0]),pe=r.ax(Ee[1]),xe=Math.min(w._zoomFromMercatorZ(Ee[2]),S.maxZoom),He=new r.bq(Re,pe);return w.mercatorFromTransition&&xe<.5*(r.bJ+r.bA)?(w.setProjection({name:"globe"}),w.zoom=xe,this._cameraForBounds(w,s,u,m,_,b)):{center:He,zoom:xe,bearing:m,pitch:_}}fitBounds(n,s,u){let m=this.cameraForBounds(n,s);return this._fitInternal(m,s,u)}fitScreenCoordinates(n,s,u,m,_){let b=r.P.convert(n),w=r.P.convert(s),S=new r.P(Math.min(b.x,w.x),Math.min(b.y,w.y)),C=new r.P(Math.max(b.x,w.x),Math.max(b.y,w.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(b,w))return this;let R=this.transform.pointLocation3D(S),O=this.transform.pointLocation3D(C),F=this.transform.pointLocation3D(new r.P(S.x,C.y)),B=this.transform.pointLocation3D(new r.P(C.x,S.y)),U=[Math.min(R.lng,O.lng,F.lng,B.lng),Math.min(R.lat,O.lat,F.lat,B.lat)],j=[Math.max(R.lng,O.lng,F.lng,B.lng),Math.max(R.lat,O.lat,F.lat,B.lat)],G=m&&m.pitch?m.pitch:this.getPitch(),q=this._cameraForBounds(this.transform,U,j,u,G,m);return this._fitInternal(q,m,_)}_fitInternal(n,s,u){return n?(s=r.e(n,s)).linear?this.easeTo(s,u):this.flyTo(s,u):this}jumpTo(n,s){this.stop();let u=n.preloadOnly?this.transform.clone():this.transform,m=!1,_=!1,b=!1;return"zoom"in n&&u.zoom!==+n.zoom&&(m=!0,u.zoom=+n.zoom),n.center!==void 0&&(u.center=r.bq.convert(n.center)),"bearing"in n&&u.bearing!==+n.bearing&&(_=!0,u.bearing=+n.bearing),"pitch"in n&&u.pitch!==+n.pitch&&(b=!0,u.pitch=+n.pitch),n.padding==null||u.isPaddingEqual(n.padding)||(u.padding=n.padding),n.preloadOnly?(this._preloadTiles(u),this):(this.fire(new r.b("movestart",s)).fire(new r.b("move",s)),m&&this.fire(new r.b("zoomstart",s)).fire(new r.b("zoom",s)).fire(new r.b("zoomend",s)),_&&this.fire(new r.b("rotatestart",s)).fire(new r.b("rotate",s)).fire(new r.b("rotateend",s)),b&&this.fire(new r.b("pitchstart",s)).fire(new r.b("pitch",s)).fire(new r.b("pitchend",s)),this.fire(new r.b("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(km),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,s){let u=this.transform;if(!u.projection.supportsFreeCamera)return r.w(km),this;this.stop();let m=u.zoom,_=u.pitch,b=u.bearing;u.setFreeCameraOptions(n);let w=m!==u.zoom,S=_!==u.pitch,C=b!==u.bearing;return this.fire(new r.b("movestart",s)).fire(new r.b("move",s)),w&&this.fire(new r.b("zoomstart",s)).fire(new r.b("zoom",s)).fire(new r.b("zoomend",s)),C&&this.fire(new r.b("rotatestart",s)).fire(new r.b("rotate",s)).fire(new r.b("rotateend",s)),S&&this.fire(new r.b("pitchstart",s)).fire(new r.b("pitch",s)).fire(new r.b("pitchend",s)),this.fire(new r.b("moveend",s)),this}easeTo(n,s){this._stop(!1,n.easeId),((n=r.e({offset:[0,0],duration:500,easing:r.d8},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);let u=this.transform,m=this.getZoom(),_=this.getBearing(),b=this.getPitch(),w=this.getPadding(),S="zoom"in n?+n.zoom:m,C="bearing"in n?this._normalizeBearing(n.bearing,_):_,R="pitch"in n?+n.pitch:b,O=this._extendPadding(n.padding),F=r.P.convert(n.offset),B,U,j;if(u.projection.name==="globe"){let le=r.O.fromLngLat(u.center),ge=F.rotate(-u.angle);le.x+=ge.x/u.worldSize,le.y+=ge.y/u.worldSize;let Me=le.toLngLat(),me=r.bq.convert(n.center||Me);this._normalizeCenter(me),B=u.centerPoint.add(ge),U=new r.P(le.x,le.y).mult(u.worldSize),j=new r.P(r.a8(me.lng),r.ah(me.lat)).mult(u.worldSize).sub(U)}else{B=u.centerPoint.add(F);let le=u.pointLocation(B),ge=r.bq.convert(n.center||le);this._normalizeCenter(ge),U=u.project(le),j=u.project(ge).sub(U)}let G=u.zoomScale(S-m),q,H;n.around&&(q=r.bq.convert(n.around),H=u.locationPoint(q));let ne=this._zooming||S!==m,ie=this._rotating||_!==C,oe=this._pitching||R!==b,$=!u.isPaddingEqual(O),X=le=>ge=>{if(ne&&(le.zoom=r.X(m,S,ge)),ie&&(le.bearing=r.X(_,C,ge)),oe&&(le.pitch=r.X(b,R,ge)),$&&(le.interpolatePadding(w,O,ge),B=le.centerPoint.add(F)),q)le.setLocationAtPoint(q,H);else{let Me=le.zoomScale(le.zoom-m),me=S>m?Math.min(2,G):Math.max(.5,G),Ee=Math.pow(me,1-ge),Re=le.unproject(U.add(j.mult(ge*Ee)).mult(Me));le.setLocationAtPoint(le.renderWorldCopies?Re.wrap():Re,B)}return n.preloadOnly||this._fireMoveEvents(s),le};if(n.preloadOnly){let le=this._emulate(X,n.duration,u);return this._preloadTiles(le),this}let ue={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ne,this._rotating=ie,this._pitching=oe,this._padding=$,this._easeId=n.easeId,this._prepareEase(s,n.noMoveStart,ue),this._ease(X(u),le=>{u.cameraElevationReference==="sea"&&u.recenterOnTerrain(),this._afterEase(s,le)},n),this}_prepareEase(n,s,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),s||u.moving||this.fire(new r.b("movestart",n)),this._zooming&&!u.zooming&&this.fire(new r.b("zoomstart",n)),this._rotating&&!u.rotating&&this.fire(new r.b("rotatestart",n)),this._pitching&&!u.pitching&&this.fire(new r.b("pitchstart",n))}_fireMoveEvents(n){this.fire(new r.b("move",n)),this._zooming&&this.fire(new r.b("zoom",n)),this._rotating&&this.fire(new r.b("rotate",n)),this._pitching&&this.fire(new r.b("pitch",n))}_afterEase(n,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let u=this._zooming,m=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new r.b("zoomend",n)),m&&this.fire(new r.b("rotateend",n)),_&&this.fire(new r.b("pitchend",n)),this.fire(new r.b("moveend",n))}flyTo(n,s){if(this._prefersReducedMotion(n)){let Se=r.af(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Se,s)}this.stop(),n=r.e({offset:[0,0],speed:1.2,curve:1.42,easing:r.d8},n);let u=this.transform,m=this.getZoom(),_=this.getBearing(),b=this.getPitch(),w=this.getPadding(),S="zoom"in n?r.ad(+n.zoom,u.minZoom,u.maxZoom):m,C="bearing"in n?this._normalizeBearing(n.bearing,_):_,R="pitch"in n?+n.pitch:b,O=this._extendPadding(n.padding),F=u.zoomScale(S-m),B=r.P.convert(n.offset),U=u.centerPoint.add(B),j=u.pointLocation(U),G=r.bq.convert(n.center||j);this._normalizeCenter(G);let q=u.project(j),H=u.project(G).sub(q),ne=n.curve,ie=Math.max(u.width,u.height),oe=ie/F,$=H.mag();if("minZoom"in n){let Se=r.ad(Math.min(n.minZoom,m,S),u.minZoom,u.maxZoom),De=ie/u.zoomScale(Se-m);ne=Math.sqrt(De/$*2)}let X=ne*ne;function ue(Se){let De=(oe*oe-ie*ie+(Se?-1:1)*X*X*$*$)/(2*(Se?oe:ie)*X*$);return Math.log(Math.sqrt(De*De+1)-De)}function le(Se){return(Math.exp(Se)-Math.exp(-Se))/2}function ge(Se){return(Math.exp(Se)+Math.exp(-Se))/2}let Me=ue(0),me=function(Se){return ge(Me)/ge(Me+ne*Se)},Ee=function(Se){return ie*((ge(Me)*(le(De=Me+ne*Se)/ge(De))-le(Me))/X)/$;var De},Re=(ue(1)-Me)/ne;if(Math.abs($)<1e-6||!isFinite(Re)){if(Math.abs(ie-oe)<1e-6)return this.easeTo(n,s);let Se=oe<ie?-1:1;Re=Math.abs(Math.log(oe/ie))/ne,Ee=function(){return 0},me=function(De){return Math.exp(Se*ne*De)}}n.duration="duration"in n?+n.duration:1e3*Re/("screenSpeed"in n?+n.screenSpeed/ne:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);let pe=_!==C,xe=R!==b,He=!u.isPaddingEqual(O),ye=Se=>De=>{let re=De*Re,Ue=1/me(re);Se.zoom=De===1?S:m+Se.scaleZoom(Ue),pe&&(Se.bearing=r.X(_,C,De)),xe&&(Se.pitch=r.X(b,R,De)),He&&(Se.interpolatePadding(w,O,De),U=Se.centerPoint.add(B));let gt=De===1?G:Se.unproject(q.add(H.mult(Ee(re))).mult(Ue));return Se.setLocationAtPoint(Se.renderWorldCopies?gt.wrap():gt,U),Se._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(s),Se};if(n.preloadOnly){let Se=this._emulate(ye,n.duration,u);return this._preloadTiles(Se),this}return this._zooming=!0,this._rotating=pe,this._pitching=xe,this._padding=He,this._prepareEase(s,!1),this._ease(ye(u),()=>this._afterEase(s),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(n){}_cancelRenderFrame(n){}_stop(n,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let u=this._onEaseEnd;this._onEaseEnd=void 0,u.call(this,s)}if(!n){let u=this.handlers;u&&u.stop(!1)}return this}_ease(n,s,u){u.animate===!1||u.duration===0?(n(1),s()):(this._easeStart=r.f.now(),this._easeOptions=u,this._onEaseFrame=n,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let n=Math.min((r.f.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,s){n=r.bk(n,-180,180);let u=Math.abs(n-s);return Math.abs(n-360-s)<u&&(n-=360),Math.abs(n+360-s)<u&&(n+=360),n}_normalizeCenter(n){let s=this.transform;if(s.maxBounds||s.projection.name!=="globe"&&!s.renderWorldCopies)return;let u=n.lng-s.center.lng;n.lng+=u>180?-360:u<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&r.f.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,s,u){let m=Math.ceil(15*s/1e3),_=[],b=n(u.clone());for(let w=0;w<=m;w++){let S=b(w/m);_.push(S.clone())}return _}_preloadTiles(n,s){}}class Fp{constructor(n={}){this.options=n,r.a$(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){let s=this.options&&this.options.compact;return this._map=n,this._container=Ie("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ie("button","mapboxgl-ctrl-attrib-button",this._container),Ie("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ie("div","mapboxgl-ctrl-attrib-inner",this._container),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,s){let u=this._map._getUIString(`AttributionControl.${s}`);n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",u)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));let s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.dd.ACCESS_TOKEN}];if(n){let u=s.reduce((m,_,b)=>(_.value&&(m+=`${_.key}=${_.value}${b<s.length-1?"&":""}`),m),"?");n.href=`${r.dd.FEEDBACK_URL}/${u}#${bm(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){let m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}let s=this._map.style._mergedSourceCaches;for(let m in s){let _=s[m];if(_.used){let b=_.getSource();b.attribution&&n.indexOf(b.attribution)<0&&n.push(b.attribution)}}n.sort((m,_)=>m.length-_.length),n=n.filter((m,_)=>{for(let b=_+1;b<n.length;b++)if(n[b].indexOf(m)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));let u=n.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,n.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Om{constructor(){r.a$(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=Ie("div","mapboxgl-ctrl");let s=Ie("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(let s in n){let u=n[s].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){let n=this._container.children;if(n.length){let s=n[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class od{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){let s=++this._id;return this._queue.push({callback:n,id:s,cancelled:!1}),s}remove(n){let s=this._currentlyRunning,u=s?this._queue.concat(s):this._queue;for(let m of u)if(m.id===n)return void(m.cancelled=!0)}run(n=0){let s=this._currentlyRunning=this._queue;this._queue=[];for(let u of s)if(!u.cancelled&&(u.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function sd(c,n,s){if(c=new r.bq(c.lng,c.lat),n){let u=new r.bq(c.lng-360,c.lat),m=new r.bq(c.lng+360,c.lat),_=360*Math.ceil(Math.abs(c.lng-s.center.lng)/360),b=s.locationPoint(c).distSqr(n),w=n.x<0||n.y<0||n.x>s.width||n.y>s.height;s.locationPoint(u).distSqr(n)<b&&(w||Math.abs(u.lng-s.center.lng)<_)?c=u:s.locationPoint(m).distSqr(n)<b&&(w||Math.abs(m.lng-s.center.lng)<_)&&(c=m)}for(;Math.abs(c.lng-s.center.lng)>180;){let u=s.locationPoint(c);if(u.x>=0&&u.y>=0&&u.x<=s.width&&u.y<=s.height)break;c.lng>s.center.lng?c.lng-=360:c.lng+=360}return c}let Rc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Uu extends r.E{constructor(n,s){if(super(),(n instanceof HTMLElement||s)&&(n=r.e({element:n},s)),r.a$(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=r.P.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ie("div");let _=41,b=27,w=Ne("svg",{display:"block",height:_*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${_}`},this._element),S=Ne("radialGradient",{id:"shadowGradient"},Ne("defs",{},w));Ne("stop",{offset:"10%","stop-opacity":.4},S),Ne("stop",{offset:"100%","stop-opacity":.05},S),Ne("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},w),Ne("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},w),Ne("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},w),Ne("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},w),this._offset=r.P.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});let u=this._element.classList;for(let _ in Rc)u.remove(`mapboxgl-marker-anchor-${_}`);u.add(`mapboxgl-marker-anchor-${this._anchor}`);let m=n&&n.className?n.className.trim().split(/\s+/):[];u.add(...m),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){let n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=r.bq.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){let m=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){let s=n.code,u=n.charCode||n.keyCode;s!=="Space"&&s!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(n){let s=n.originalEvent.target,u=this._element;this._popup&&(s===u||u.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let n=this._map,s=this._pos;if(!n||!s)return!1;let u=n.unproject(s),m=n.getFreeCameraOptions();if(!m.position)return!1;let _=m.position.toLngLat();return _.distanceTo(u)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){let n=this._map;if(!n)return;let s=this._pos;if(!s||s.x<0||s.x>n.transform.width||s.y<0||s.y>n.transform.height)return void this._clearFadeTimer();let u=n.unproject(s),m;n._showingGlobe()&&r.de(n.transform,this._lngLat)?m=0:(m=1-n._queryFogOpacity(u),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(m*=this._occludedOpacity)),this._element.style.opacity=`${m}`,this._element.style.pointerEvents=m>0?"auto":"none",this._popup&&this._popup._setOpacity(m),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let n=this._pos;if(!n||!this._map)return;let s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${Rc[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){let n=this._pos,s=this._map,u=this.getPitchAlignment();if(!s||!n||u!=="map")return"";if(!s._showingGlobe()){let S=s.getPitch();return S?`rotateX(${S}deg)`:""}let m=r.bI(r.df(s.transform,this._lngLat)),_=n.sub(r.dg(s.transform)),b=Math.abs(_.x)+Math.abs(_.y);if(b===0)return"";let w=m/b;return`rotateX(${-_.y*w}deg) rotateY(${_.x*w}deg)`}_calculateZTransform(){let n=this._pos,s=this._map;if(!s||!n)return"";let u=0,m=this.getRotationAlignment();if(m==="map")if(s._showingGlobe()){let _=s.project(new r.bq(this._lngLat.lng,this._lngLat.lat+.001)),b=s.project(new r.bq(this._lngLat.lng,this._lngLat.lat-.001)).sub(_);u=r.bI(Math.atan2(b.y,b.x))-90}else u=-s.getBearing();else if(m==="horizon"){let _=r.S(4,6,s.getZoom()),b=r.dg(s.transform);b.y+=_*s.transform.height;let w=n.sub(b),S=r.bI(Math.atan2(w.y,w.x));u=(S>90?S-270:S+90)*(1-_)}return u+=this._rotation,u?`rotateZ(${u}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);let s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=sd(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat),n===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=r.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){let s=this._map;if(!s)return;let u=this._pointerdownPos,m=this._positionDelta;if(u&&m){if(!this._isDragging){let _=this._clickTolerance||s._clickTolerance;if(n.point.dist(u)<_)return;this._isDragging=!0}this._pos=n.point.sub(m),this._lngLat=s.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.b("dragstart"))),this.fire(new r.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.b("dragend")),this._state="inactive"}_addDragHandler(n){let s=this._map,u=this._pos;s&&u&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(u),this._pointerdownPos=n.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;let s=this._map;return s&&(n?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let Gu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Lm=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function qu(c=new r.P(0,0),n="bottom"){if(typeof c=="number"){let s=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(n){case"top":return new r.P(0,c);case"top-left":return new r.P(s,s);case"top-right":return new r.P(-s,s);case"bottom":return new r.P(0,-c);case"bottom-left":return new r.P(s,-s);case"bottom-right":return new r.P(-s,-s);case"left":return new r.P(c,0);case"right":return new r.P(-c,0)}return new r.P(0,0)}return c instanceof r.P||Array.isArray(c)?r.P.convert(c):r.P.convert(c[n]||[0,0])}class ad{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;let s=r.ch((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,s,u){this._start=this.getValue(s),this._end=n,this._startTime=s,this._endTime=s+u}}class Fm{registerParameter(n,s,u,m,_){}registerButton(n,s,u){}registerBinding(n,s,u,m){}refreshUI(){}}let bl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},da={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},Pc={showCompass:!0,showZoom:!0,visualizePitch:!1};class ld{constructor(n,s,u=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new Dp({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,u&&(this.mousePitch=new Xl({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),r.a$(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(n,s){this.mouseRotate.mousedown(n,s),this.mousePitch&&this.mousePitch.mousedown(n,s),Ei()}move(n,s){let u=this.map,m=this.mouseRotate.mousemoveWindow(n,s),_=m&&m.bearingDelta;if(_&&u.setBearing(u.getBearing()+_),this.mousePitch){let b=this.mousePitch.mousemoveWindow(n,s),w=b&&b.pitchDelta;w&&u.setPitch(u.getPitch()+w)}}off(){let n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){sn(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(r.e({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Io(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Io(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=In(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=In(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let bt={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},zm={maxWidth:100,unit:"metric"},Bm={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:r.du,supported:W,setRTLTextPlugin:r.dw,getRTLTextPluginStatus:r.dx,Map:class extends oy{constructor(c){let n=c;if((c=r.e({},da,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&r.dh(window)&&(c.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Un(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),c),this._repaint=!!c.repaint,this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._collectResourceTiming=c.collectResourceTiming,this._language=this._parseLanguage(c.language),this._worldview=c.worldview,this._renderTaskQueue=new od,this._domRenderTaskQueue=new od,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.aF(),this._locale=r.e({},bl,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._performanceMetricsCollection=c.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ad(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new r.di(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,this._contextCreateOptions=c.contextCreateOptions?Vt({},c.contextCreateOptions):{},typeof c.container=="string"){let s=document.getElementById(c.container);if(!s)throw new Error(`Container '${c.container.toString()}' not found.`);this._container=s}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),r.a$(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp=c.devtools?new Fm(this):new Fm,this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new ju(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,(c.style||!c.testMode)&&this.setStyle(c.style||r.dd.DEFAULT_STYLE,{config:c.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),c.hash&&(this._hash=new ty(typeof c.hash=="string"&&c.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch});let s=c.bounds;s&&(this.resize(),this.fitBounds(s,r.e({},c.fitBoundsOptions,{duration:0})))}this.resize(),c.attributionControl&&this.addControl(new Fp({customAttribution:c.customAttribution})),this._logoControl=new Om,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new r.b(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new r.b(`${s.dataType}dataloading`,s))})}_getMapId(){return this._mapId}addControl(c,n){if(n===void 0&&(n=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new r.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let s=c.onAdd(this);this._controls.push(c);let u=this._controlPositions[n];return n.indexOf("bottom")!==-1?u.insertBefore(s,u.firstChild):u.appendChild(s),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new r.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let n=this._controls.indexOf(c);return n>-1&&this._controls.splice(n,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let n=!this._moving;return n&&this.fire(new r.b("movestart",c)).fire(new r.b("move",c)),this.fire(new r.b("resize",c)),n&&this.fire(new r.b("moveend",c)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(r.ag.convert(c)),this._update()}setMinZoom(c){if((c=c??-2)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new r.b("zoomstart")).fire(new r.b("zoom")).fire(new r.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c??22)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new r.b("zoomstart")).fire(new r.b("zoom")).fire(new r.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new r.b("pitchstart")).fire(new r.b("pitch")).fire(new r.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new r.b("pitchstart")).fire(new r.b("pitch")).fire(new r.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(c){return c==="auto"?navigator.language:Array.isArray(c)?c.length===0?void 0:c.map(n=>n==="auto"?navigator.language:n):c}setLanguage(c){let n=this._parseLanguage(c);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(let s of this._controls)s._setLanguage&&s._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(c){return this.style&&c!==this._worldview?(this._worldview=c,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(c){return this._lazyInitEmptyStyle(),c?typeof c=="string"&&(c={name:c}):c=null,this._useExplicitProjection=!!c,this._prioritizeAndUpdateProjection(c,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let c=this.transform,n=c.projection.name,s;n==="globe"&&c.zoom>=r.bA?(c.setMercatorFromTransition(),s=!0):n==="mercator"&&c.zoom<r.bA&&(c.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(c,n){return this._updateProjection(c||n||{name:"mercator"})}_updateProjection(c){let n;return n=c.name==="globe"&&this.transform.zoom>=r.bA?this.transform.setMercatorFromTransition():this.transform.setProjection(c),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(c){return this.transform.locationPoint3D(r.bq.convert(c))}unproject(c){return this.transform.pointLocation3D(r.P.convert(c))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(c,n,s){if(c==="mouseenter"||c==="mouseover"){let u=!1,m=b=>{let w=n.filter(C=>this.getLayer(C)),S=w.length?this.queryRenderedFeatures(b.point,{layers:w}):[];S.length?u||(u=!0,s.call(this,new Xr(c,this,b.originalEvent,{features:S}))):u=!1},_=()=>{u=!1};return{layers:new Set(n),listener:s,delegates:{mousemove:m,mouseout:_}}}if(c==="mouseleave"||c==="mouseout"){let u=!1,m=b=>{let w=n.filter(S=>this.getLayer(S));(w.length?this.queryRenderedFeatures(b.point,{layers:w}):[]).length?u=!0:u&&(u=!1,s.call(this,new Xr(c,this,b.originalEvent)))},_=b=>{u&&(u=!1,s.call(this,new Xr(c,this,b.originalEvent)))};return{layers:new Set(n),listener:s,delegates:{mousemove:m,mouseout:_}}}{let u=m=>{let _=n.filter(w=>this.getLayer(w)),b=_.length?this.queryRenderedFeatures(m.point,{layers:_}):[];b.length&&(m.features=b,s.call(this,m),delete m.features)};return{layers:new Set(n),listener:s,delegates:{[c]:u}}}}on(c,n,s){if(s===void 0)return super.on(c,n);if(Array.isArray(n)||(n=[n]),n){for(let m of n)if(!this._isValidId(m))return this}let u=this._createDelegatedListener(c,n,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(u);for(let m in u.delegates)this.on(m,u.delegates[m]);return this}once(c,n,s){if(s===void 0)return super.once(c,n);if(Array.isArray(n)||(n=[n]),n){for(let m of n)if(!this._isValidId(m))return this}let u=this._createDelegatedListener(c,n,s);for(let m in u.delegates)this.once(m,u.delegates[m]);return this}off(c,n,s){if(s===void 0)return super.off(c,n);n=new Set(Array.isArray(n)?n:[n]);for(let _ of n)if(!this._isValidId(_))return this;let u=(_,b)=>{if(_.size!==b.size)return!1;for(let w of _)if(!b.has(w))return!1;return!0},m=this._delegatedListeners?this._delegatedListeners[c]:void 0;return m&&(_=>{for(let b=0;b<_.length;b++){let w=_[b];if(w.listener===s&&u(w.layers,n)){for(let S in w.delegates)this.off(S,w.delegates[S]);return _.splice(b,1),this}}})(m),this}queryRenderedFeatures(c,n){if(!this.style)return[];if(n!==void 0||c===void 0||c instanceof r.P||Array.isArray(c)||(n=c,c=void 0),c=c||[[0,0],[this.transform.width,this.transform.height]],(n=n||{}).layers&&Array.isArray(n.layers)){for(let s of n.layers)if(!this._isValidId(s))return[]}return this.style.queryRenderedFeatures(c,n,this.transform)}querySourceFeatures(c,n){return this._isValidId(c)?this.style.querySourceFeatures(c,n):[]}isPointOnSurface(c){let{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&r.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(c))}setStyle(c,n){return n=r.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&c&&n.diff!==!1&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(c,(s,u)=>{s?(r.w(`Unable to perform style diff: ${String(s.message||s.error||s)}. Rebuilding the style from scratch.`),this._updateStyle(c,n)):u&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(c,n))}_getUIString(c){let n=this._locale[c];if(n==null)throw new Error(`Missing UI string '${c}'`);return n}_updateStyle(c,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c){let s=r.e({},n);n&&n.config&&(s.initialConfig=n.config,delete s.config),this.style=new Qi(this,s).setEventedParent(this,{style:this.style}).load(c)}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Qi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(c){return c==null?(this.fire(new r.a(new Error("IDs can't be empty."))),!1):!r.c9(c)||(this.fire(new r.a(new Error(`IDs can't contain special symbols: "${c}".`))),!1)}addSource(c,n){return this._isValidId(c)?(this._lazyInitEmptyStyle(),this.style.addSource(c,n),this._update(!0)):this}isSourceLoaded(c){return!!this._isValidId(c)&&!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(c,n,s){this._lazyInitEmptyStyle(),this.style.addSourceType(c,n,s)}removeSource(c){return this._isValidId(c)?(this.style.removeSource(c),this._updateTerrain(),this._update(!0)):this}getSource(c){return this._isValidId(c)?this.style.getOwnSource(c):null}addImage(c,n,{pixelRatio:s=1,sdf:u=!1,stretchX:m,stretchY:_,content:b}={}){if(this._lazyInitEmptyStyle(),n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){let{width:w,height:S,data:C}=r.f.getImageData(n);this.style.addImage(c,{data:new r.h({width:w,height:S},C),pixelRatio:s,stretchX:m,stretchY:_,content:b,sdf:u,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new r.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:w,height:S}=n,C=n;this.style.addImage(c,{data:new r.h({width:w,height:S},new Uint8Array(C.data)),pixelRatio:s,stretchX:m,stretchY:_,content:b,sdf:u,version:0,userImage:C}),C.onAdd&&C.onAdd(this,c)}}updateImage(c,n){this._lazyInitEmptyStyle();let s=this.style.getImage(c);if(!s)return void this.fire(new r.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let u=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?r.f.getImageData(n):n,{width:m,height:_}=u,b=u.data;if(m===void 0||_===void 0)return void this.fire(new r.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==s.data.width||_!==s.data.height)return void this.fire(new r.a(new Error(`The width and height of the updated image (${m}, ${_})
                must be that same as the previous version of the image
                (${s.data.width}, ${s.data.height})`)));let w=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);s.data.replace(b,w),this.style.updateImage(c,s)}hasImage(c){return c?!!this.style&&!!this.style.getImage(c):(this.fire(new r.a(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,n){r.d(this._requestManager.transformRequest(c,r.R.Image),(s,u)=>{n(s,u instanceof HTMLImageElement?r.f.getImageData(u):u)})}listImages(){return this.style.listImages()}addModel(c,n){this._lazyInitEmptyStyle(),this.style.addModel(c,n)}hasModel(c){return c?this.style.hasModel(c):(this.fire(new r.a(new Error("Missing required model id"))),!1)}removeModel(c){this.style.removeModel(c)}listModels(){return this.style.listModels()}addLayer(c,n){return this._isValidId(c.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(c,n),this._update(!0)):this}getSlot(c){let n=this.getLayer(c);return n&&n.slot||null}setSlot(c,n){return this.style.setSlot(c,n),this.style.mergeLayers(),this._update(!0)}addImport(c,n){return this.style.addImport(c,n),this}updateImport(c,n){return typeof n!="string"&&n.id!==c?(this.removeImport(c),this.addImport(n)):(this.style.updateImport(c,n),this._update(!0))}removeImport(c){return this.style.removeImport(c),this}moveImport(c,n){return this.style.moveImport(c,n),this._update(!0)}moveLayer(c,n){return this._isValidId(c)?(this.style.moveLayer(c,n),this._update(!0)):this}removeLayer(c){return this._isValidId(c)?(this.style.removeLayer(c),this._update(!0)):this}getLayer(c){return this._isValidId(c)?this.style.getOwnLayer(c):null}setLayerZoomRange(c,n,s){return this._isValidId(c)?(this.style.setLayerZoomRange(c,n,s),this._update(!0)):this}setFilter(c,n,s={}){return this._isValidId(c)?(this.style.setFilter(c,n,s),this._update(!0)):this}getFilter(c){return this._isValidId(c)?this.style.getFilter(c):null}setPaintProperty(c,n,s,u={}){return this._isValidId(c)?(this.style.setPaintProperty(c,n,s,u),this._update(!0)):this}getPaintProperty(c,n){return this._isValidId(c)?this.style.getPaintProperty(c,n):null}setLayoutProperty(c,n,s,u={}){return this._isValidId(c)?(this.style.setLayoutProperty(c,n,s,u),this._update(!0)):this}getLayoutProperty(c,n){return this._isValidId(c)?this.style.getLayoutProperty(c,n):null}getSchema(c){return this.style.getSchema(c)}setSchema(c,n){return this.style.setSchema(c,n),this._update(!0)}getConfig(c){return this.style.getConfig(c)}setConfig(c,n){return this.style.setConfig(c,n),this._update(!0)}getConfigProperty(c,n){return this.style.getConfigProperty(c,n)}setConfigProperty(c,n,s){return this.style.setConfigProperty(c,n,s),this._update(!0)}setLights(c){if(this._lazyInitEmptyStyle(),c&&c.length===1&&c[0].type==="flat"){let n=c[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(c),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let c=this.style.getLights()||[];return c.length===0&&c.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),c}setLight(c,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:c}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(c){return this.style.setCamera(c),this._triggerCameraUpdate(c)}_triggerCameraUpdate(c){return this._update(this.transform.setOrthographicProjectionAtLowPitch(c["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.bq.convert(c),this.transform):0}setFeatureState(c,n){return this._isValidId(c.source)?(this.style.setFeatureState(c,n),this._update()):this}removeFeatureState(c,n){return this._isValidId(c.source)?(this.style.removeFeatureState(c,n),this._update()):this}getFeatureState(c){return this._isValidId(c.source)?this.style.getFeatureState(c):null}_updateContainerDimensions(){if(!this._container)return;let c=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300,s,u,m,_=this._container;for(;_&&(!u||!m);){let b=window.getComputedStyle(_).transform;b&&b!=="none"&&(s=b.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(u=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(m=s[3])),_=_.parentElement}this._containerWidth=u?Math.abs(c/u):c,this._containerHeight=m?Math.abs(n/m):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ie("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();let n=this._canvasContainer=Ie("div","mapboxgl-canvas-container",c);this._canvas=Ie("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let s=this._controlContainer=Ie("div","mapboxgl-control-container",c),u=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(m=>{u[m]=Ie("div",`mapboxgl-ctrl-${m}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,n){let s=r.f.devicePixelRatio||1;this._canvas.width=s*Math.ceil(c),this._canvas.height=s*Math.ceil(n),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${n}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){let n=this._markers.indexOf(c);n!==-1&&this._markers.splice(n,1)}_addPopup(c){this._popups.push(c)}_removePopup(c){let n=this._popups.indexOf(c);n!==-1&&this._popups.splice(n,1)}_setupPainter(){let c=r.e({},W.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",c);n?(r.dj(n,!0),this.painter=new ym(n,this._contextCreateOptions,this.transform,this._tp),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.dk.testSupport(n)):this.fire(new r.a(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.b("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.resize(),this._update(),this.fire(new r.b("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let n;this.fire(new r.b("renderstart"));let s=this.painter.context.extTimerQuery,u=r.f.now(),m=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=m.createQuery(),m.beginQuery(s.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;this._updateProjectionTransition();let _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let S=this.transform.zoom,C=this.transform.pitch,R=r.f.now(),O=new r.N(S,{now:R,fadeDuration:_,pitch:C,transition:this.style.transition});this.style.update(O)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(u),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(u),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new r.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){let S=r.f.now()-u;m.endQuery(s.TIME_ELAPSED_EXT),setTimeout(()=>{let C=m.getQueryParameter(n,m.QUERY_RESULT)/1e6;m.deleteQuery(n),this.fire(new r.b("gpu-timing-frame",{cpuTime:S,gpuTime:C}))},50)}if(this.listens("gpu-timing-layer")){let S=this.painter.collectGpuTimers();setTimeout(()=>{let C=this.painter.queryGpuTimers(S);this.fire(new r.b("gpu-timing-layer",{layerTimes:C}))},50)}if(this.listens("gpu-timing-deferred-render")){let S=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let C=this.painter.queryGpuTimeDeferredRender(S);this.fire(new r.b("gpu-timing-deferred-render",{gpuTime:C}))},50)}let w=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(w||this._repaint)this.triggerRepaint();else{let S=!this.isMoving()&&this.loaded();if(S&&(b=this._updateAverageElevation(u,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),S&&(this.fire(new r.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let C=this._calculateSpeedIndex();this.fire(new r.b("speedindexcompleted",{speedIndex:C})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||w||(this._fullyLoaded=!0,this._performanceMetricsCollection&&r.dl(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(c){for(let n of this._markers)c&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(let n of this._popups)!c||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(c,n=!1){let s=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);let u=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(u||(n||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){let m=this.transform.averageElevation,_=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=c;let b=Math.abs(m-_);if(b>1){if(this._isInitialLoad||u)return this._averageElevation.jumpTo(_),s(_);this._averageElevation.easeTo(_,c,300)}else if(b>1e-4)return this._averageElevation.jumpTo(_),s(_)}return!!this._averageElevation.isEasing(c)&&s(this._averageElevation.getValue(c))}_authenticate(){r.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===r.dn||c.status===401)){let n=this.painter.context.gl;r.dj(n,!1),this._logoControl instanceof Om&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),r.dp(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&r.dq(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let c=this._isDragging();this.painter.updateTerrain(this.style,c)}_calculateSpeedIndex(){let c=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());let s=this.painter.context.gl,u=s.createFramebuffer();function m(_){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,_,0);let b=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,b),b}return s.bindFramebuffer(s.FRAMEBUFFER,u),this._canvasPixelComparison(m(c),n.canvasCopies.map(m),n.timeStamps)}_canvasPixelComparison(c,n,s){let u=s[1]-s[0],m=c.length/4;for(let _=0;_<n.length;_++){let b=n[_],w=0;for(let S=0;S<b.length;S+=4)b[S]===c[S]&&b[S+1]===c[S+1]&&b[S+2]===c[S+2]&&b[S+3]===c[S+3]&&(w+=1);u+=(s[_+2]-s[_+1])*(1-w/m)}return u}remove(){this._hash&&this._hash.remove();for(let n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),r.dr(this.painter.context.gl),r.ds.remove(),r.dt.remove(),this._removed=!0,this.fire(new r.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=r.f.frame(n=>{let s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(n)}))}_preloadTiles(c){let n=this.style?this.style.getSourceCaches():[];return r.b4(n,(s,u)=>s._preloadTiles(c,u),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(c){this._showParseStatus!==c&&(this._showParseStatus=c,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(c){this._showLayers2DWireframe!==c&&(this._showLayers2DWireframe=c,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(c){this._showLayers3DWireframe!==c&&(this._showLayers3DWireframe=c,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,this._tp.refreshUI(),c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(c){this._showTileAABBs!==c&&(this._showTileAABBs=c,this._tp.refreshUI(),c&&this._update())}_setCacheLimits(c,n){r.dv(c,n)}get version(){return r.du}},NavigationControl:class{constructor(c){this.options=r.e({},Pc,c),this._container=Ie("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(r.a$(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),Ie("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),Ie("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.a$(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{let s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:n}):s.resetNorth({},{originalEvent:n}))}),this._compassIcon=Ie("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let c=this._map;if(!c)return;let n=c.getZoom(),s=n===c.getMaxZoom(),u=n===c.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){let c=this._map;if(!c)return;let n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ld(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){let c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,n){let s=Ie("button",c,this._container);return s.type="button",s.addEventListener("click",n),s}_setButtonTitle(c,n){if(!this._map)return;let s=this._map._getUIString(`NavigationControl.${n}`);c.setAttribute("aria-label",s),c.firstElementChild&&c.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends r.E{constructor(c){super();let n=navigator.geolocation;this.options=r.e({geolocation:n},bt,c),r.a$(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=vm(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(c){return this._map=c,this._container=Ie("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(c){let n=(s=!!this.options.geolocation)=>{this._supportsGeolocation=s,c(s)};this._supportsGeolocation!==void 0?c(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(s=>n(s.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(c){let n=this._map.getMaxBounds(),s=c.coords;return!!n&&(s.longitude<n.getWest()||s.longitude>n.getEast()||s.latitude<n.getSouth()||s.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new r.b("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.b("geolocate",c)),this._finish()}}_updateCamera(c){let n=new r.bq(c.coords.longitude,c.coords.latitude),s=c.coords.accuracy,u=this._map.getBearing(),m=r.e({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(s),m,{geolocateSource:!0})}_updateMarker(c){if(c){let n=new r.bq(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let c=this._map.transform,n=r.bo(1,c._center.lat)*c.worldSize,s=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.b("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=Ie("button","mapboxgl-ctrl-geolocate",this._container),Ie("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");let n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{let n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ie("div","mapboxgl-user-location"),this._dotElement.appendChild(Ie("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ie("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Uu({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ie("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Uu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.b("trackuserlocationend")))})}}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:c.absolute===!0&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(c={maximumAge:6e5,timeout:0},this._noTimeout=!0):(c=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let c=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&c()}).catch(console.error):c()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Fp,ScaleControl:class{constructor(c){this.options=r.e({},zm,c),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.a$(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let c=this.options.maxWidth||100,n=this._map,s=n._containerHeight/2,u=n._containerWidth/2-c/2,m=n.unproject([u,s]),_=n.unproject([u+c,s]),b=m.distanceTo(_);if(this.options.unit==="imperial"){let w=3.2808*b;w>5280?this._setScale(c,w/5280,"mile"):this._setScale(c,w,"foot")}else this.options.unit==="nautical"?this._setScale(c,b/1852,"nautical-mile"):b>=1e3?this._setScale(c,b/1e3,"kilometer"):this._setScale(c,b,"meter")}_setScale(c,n,s){this._map._requestDomTask(()=>{let u=function(_){let b=Math.pow(10,`${Math.floor(_)}`.length-1),w=_/b;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(S){let C=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*C)/C}(w),b*w}(n),m=u/n;this._container.innerHTML=this._isNumberFormatSupported&&s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:s}).format(u):`${u}&nbsp;${Bm[s]}`,this._container.style.width=c*m+"px"})}onAdd(c){return this._map=c,this._language=c.getLanguage(),this._container=Ie("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(c){this._language=c,this._update()}setUnit(c){this.options.unit=c,this._update()}},FullscreenControl:class{constructor(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof HTMLElement?this._container=c.container:r.w("Full screen control 'container' must be a DOM element.")),r.a$(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ie("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let c=this._fullscreenButton=Ie("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ie("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(c){super(),this.options=r.e(Object.create(Gu),c),r.a$(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),c._addPopup(this),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new r.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),c._canvasContainer&&c._canvasContainer.classList.remove("mapboxgl-track-pointer"),c._removePopup(this),this._map=void 0),this.fire(new r.b("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=r.bq.convert(c),this._pos=null,this._trackPointer=!1,this._update();let n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(document.createTextNode(c))}setHTML(c){let n=document.createDocumentFragment(),s=document.createElement("body"),u;for(s.innerHTML=c;u=s.firstChild,u;)n.appendChild(u);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=Ie("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(c),this.options.closeButton){let s=this._closeButton=Ie("button","mapboxgl-popup-close-button",n);s.type="button",s.setAttribute("aria-label","Close popup"),s.setAttribute("aria-hidden","true"),s.innerHTML="&#215;",s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let n;return this._classList.delete(c)?n=!1:(this._classList.add(c),n=!0),this._updateClassList(),n}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;let n=this._map,s=this._container,u=this._pos;if(!n||!s||!u)return"bottom";let m=s.offsetWidth,_=s.offsetHeight,b=u.x<m/2,w=u.x>n.transform.width-m/2;if(u.y+c<_)return b?"top-left":w?"top-right":"top";if(u.y>n.transform.height-_){if(b)return"bottom-left";if(w)return"bottom-right"}return b?"left":w?"right":"bottom"}_updateClassList(){let c=this._container;if(!c)return;let n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),c.className=n.join(" ")}_update(c){let n=this._map,s=this._content;if(!n||!this._lngLat&&!this._trackPointer||!s)return;let u=this._container;if(u||(u=this._container=Ie("div","mapboxgl-popup",n.getContainer()),this._tip=Ie("div","mapboxgl-popup-tip",u),u.appendChild(s)),this.options.maxWidth&&u.style.maxWidth!==this.options.maxWidth&&(u.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=sd(this._lngLat,this._pos,n.transform)),!this._trackPointer||c){let m=this._pos=this._trackPointer&&c?c:n.project(this._lngLat),_=qu(this.options.offset),b=this._anchor=this._getAnchor(_.y),w=qu(this.options.offset,b),S=m.add(w).round();n._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${Rc[b]} translate(${S.x}px,${S.y}px)`)})}if(!this._marker&&n._showingGlobe()){let m=r.de(n.transform,this._lngLat)?0:1;this._setOpacity(m)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let c=this._container.querySelector(Lm);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._container&&(this._container.style.opacity=`${c}`),this._content&&(this._content.style.pointerEvents=c?"auto":"none")}},Marker:Uu,Style:Qi,LngLat:r.bq,LngLatBounds:r.ag,Point:r.P,MercatorCoordinate:r.O,FreeCameraOptions:Ct,Evented:r.E,config:r.dd,prewarm:r.dy,clearPrewarmedResources:r.dz,get accessToken(){return r.dd.ACCESS_TOKEN},set accessToken(c){r.dd.ACCESS_TOKEN=c},get baseApiUrl(){return r.dd.API_URL},set baseApiUrl(c){r.dd.API_URL=c},get workerCount(){return r.dA.workerCount},set workerCount(c){r.dA.workerCount=c},get maxParallelImageRequests(){return r.dd.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){r.dd.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){r.dB(c)},get workerUrl(){return r.dC.workerUrl},set workerUrl(c){r.dC.workerUrl=c},get workerClass(){return r.dC.workerClass},set workerClass(c){r.dC.workerClass=c},get workerParams(){return r.dC.workerParams},set workerParams(c){r.dC.workerParams=c},get dracoUrl(){return r.dD()},set dracoUrl(c){r.dE(c)},get meshoptUrl(){return r.dF()},set meshoptUrl(c){r.dG(c)},setNow:r.f.setNow,restoreNow:r.f.restoreNow}});var v=T;return v})});var n0=class{};var jd=class p{constructor(d){this.normalizedNames=new Map,this.lazyUpdate=null,d?typeof d=="string"?this.lazyInit=()=>{this.headers=new Map,d.split(`
`).forEach(T=>{let f=T.indexOf(":");if(f>0){let v=T.slice(0,f),r=v.toLowerCase(),k=T.slice(f+1).trim();this.maybeSetNormalizedName(v,r),this.headers.has(r)?this.headers.get(r).push(k):this.headers.set(r,[k])}})}:typeof Headers<"u"&&d instanceof Headers?(this.headers=new Map,d.forEach((T,f)=>{this.setHeaderEntries(f,T)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(d).forEach(([T,f])=>{this.setHeaderEntries(T,f)})}:this.headers=new Map}has(d){return this.init(),this.headers.has(d.toLowerCase())}get(d){this.init();let T=this.headers.get(d.toLowerCase());return T&&T.length>0?T[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(d){return this.init(),this.headers.get(d.toLowerCase())||null}append(d,T){return this.clone({name:d,value:T,op:"a"})}set(d,T){return this.clone({name:d,value:T,op:"s"})}delete(d,T){return this.clone({name:d,value:T,op:"d"})}maybeSetNormalizedName(d,T){this.normalizedNames.has(T)||this.normalizedNames.set(T,d)}init(){this.lazyInit&&(this.lazyInit instanceof p?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(d=>this.applyUpdate(d)),this.lazyUpdate=null))}copyFrom(d){d.init(),Array.from(d.headers.keys()).forEach(T=>{this.headers.set(T,d.headers.get(T)),this.normalizedNames.set(T,d.normalizedNames.get(T))})}clone(d){let T=new p;return T.lazyInit=this.lazyInit&&this.lazyInit instanceof p?this.lazyInit:this,T.lazyUpdate=(this.lazyUpdate||[]).concat([d]),T}applyUpdate(d){let T=d.name.toLowerCase();switch(d.op){case"a":case"s":let f=d.value;if(typeof f=="string"&&(f=[f]),f.length===0)return;this.maybeSetNormalizedName(d.name,T);let v=(d.op==="a"?this.headers.get(T):void 0)||[];v.push(...f),this.headers.set(T,v);break;case"d":let r=d.value;if(!r)this.headers.delete(T),this.normalizedNames.delete(T);else{let k=this.headers.get(T);if(!k)return;k=k.filter(W=>r.indexOf(W)===-1),k.length===0?(this.headers.delete(T),this.normalizedNames.delete(T)):this.headers.set(T,k)}break}}setHeaderEntries(d,T){let f=(Array.isArray(T)?T:[T]).map(r=>r.toString()),v=d.toLowerCase();this.headers.set(v,f),this.maybeSetNormalizedName(d,v)}forEach(d){this.init(),Array.from(this.normalizedNames.keys()).forEach(T=>d(this.normalizedNames.get(T),this.headers.get(T)))}};var r0=class{encodeKey(d){return aE(d)}encodeValue(d){return aE(d)}decodeKey(d){return decodeURIComponent(d)}decodeValue(d){return decodeURIComponent(d)}};function pR(p,d){let T=new Map;return p.length>0&&p.replace(/^\?/,"").split("&").forEach(v=>{let r=v.indexOf("="),[k,W]=r==-1?[d.decodeKey(v),""]:[d.decodeKey(v.slice(0,r)),d.decodeValue(v.slice(r+1))],ee=T.get(k)||[];ee.push(W),T.set(k,ee)}),T}var fR=/%(\d[a-f0-9])/gi,mR={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function aE(p){return encodeURIComponent(p).replace(fR,(d,T)=>mR[T]??d)}function Zg(p){return`${p}`}var ru=class p{constructor(d={}){if(this.updates=null,this.cloneFrom=null,this.encoder=d.encoder||new r0,d.fromString){if(d.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=pR(d.fromString,this.encoder)}else d.fromObject?(this.map=new Map,Object.keys(d.fromObject).forEach(T=>{let f=d.fromObject[T],v=Array.isArray(f)?f.map(Zg):[Zg(f)];this.map.set(T,v)})):this.map=null}has(d){return this.init(),this.map.has(d)}get(d){this.init();let T=this.map.get(d);return T?T[0]:null}getAll(d){return this.init(),this.map.get(d)||null}keys(){return this.init(),Array.from(this.map.keys())}append(d,T){return this.clone({param:d,value:T,op:"a"})}appendAll(d){let T=[];return Object.keys(d).forEach(f=>{let v=d[f];Array.isArray(v)?v.forEach(r=>{T.push({param:f,value:r,op:"a"})}):T.push({param:f,value:v,op:"a"})}),this.clone(T)}set(d,T){return this.clone({param:d,value:T,op:"s"})}delete(d,T){return this.clone({param:d,value:T,op:"d"})}toString(){return this.init(),this.keys().map(d=>{let T=this.encoder.encodeKey(d);return this.map.get(d).map(f=>T+"="+this.encoder.encodeValue(f)).join("&")}).filter(d=>d!=="").join("&")}clone(d){let T=new p({encoder:this.encoder});return T.cloneFrom=this.cloneFrom||this,T.updates=(this.updates||[]).concat(d),T}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(d=>this.map.set(d,this.cloneFrom.map.get(d))),this.updates.forEach(d=>{switch(d.op){case"a":case"s":let T=(d.op==="a"?this.map.get(d.param):void 0)||[];T.push(Zg(d.value)),this.map.set(d.param,T);break;case"d":if(d.value!==void 0){let f=this.map.get(d.param)||[],v=f.indexOf(Zg(d.value));v!==-1&&f.splice(v,1),f.length>0?this.map.set(d.param,f):this.map.delete(d.param)}else{this.map.delete(d.param);break}}}),this.cloneFrom=this.updates=null)}};var o0=class{constructor(){this.map=new Map}set(d,T){return this.map.set(d,T),this}get(d){return this.map.has(d)||this.map.set(d,d.defaultValue()),this.map.get(d)}delete(d){return this.map.delete(d),this}has(d){return this.map.has(d)}keys(){return this.map.keys()}};function gR(p){switch(p){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function lE(p){return typeof ArrayBuffer<"u"&&p instanceof ArrayBuffer}function cE(p){return typeof Blob<"u"&&p instanceof Blob}function uE(p){return typeof FormData<"u"&&p instanceof FormData}function _R(p){return typeof URLSearchParams<"u"&&p instanceof URLSearchParams}var Cf=class p{constructor(d,T,f,v){this.url=T,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=d.toUpperCase();let r;if(gR(this.method)||v?(this.body=f!==void 0?f:null,r=v):r=f,r&&(this.reportProgress=!!r.reportProgress,this.withCredentials=!!r.withCredentials,r.responseType&&(this.responseType=r.responseType),r.headers&&(this.headers=r.headers),r.context&&(this.context=r.context),r.params&&(this.params=r.params),this.transferCache=r.transferCache),this.headers??=new jd,this.context??=new o0,!this.params)this.params=new ru,this.urlWithParams=T;else{let k=this.params.toString();if(k.length===0)this.urlWithParams=T;else{let W=T.indexOf("?"),ee=W===-1?"?":W<T.length-1?"&":"";this.urlWithParams=T+ee+k}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||lE(this.body)||cE(this.body)||uE(this.body)||_R(this.body)?this.body:this.body instanceof ru?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||uE(this.body)?null:cE(this.body)?this.body.type||null:lE(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof ru?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(d={}){let T=d.method||this.method,f=d.url||this.url,v=d.responseType||this.responseType,r=d.transferCache??this.transferCache,k=d.body!==void 0?d.body:this.body,W=d.withCredentials??this.withCredentials,ee=d.reportProgress??this.reportProgress,de=d.headers||this.headers,Ie=d.params||this.params,Ne=d.context??this.context;return d.setHeaders!==void 0&&(de=Object.keys(d.setHeaders).reduce((lt,it)=>lt.set(it,d.setHeaders[it]),de)),d.setParams&&(Ie=Object.keys(d.setParams).reduce((lt,it)=>lt.set(it,d.setParams[it]),Ie)),new p(T,f,k,{params:Ie,headers:de,context:Ne,reportProgress:ee,responseType:v,withCredentials:W,transferCache:r})}},hE=function(p){return p[p.Sent=0]="Sent",p[p.UploadProgress=1]="UploadProgress",p[p.ResponseHeader=2]="ResponseHeader",p[p.DownloadProgress=3]="DownloadProgress",p[p.Response=4]="Response",p[p.User=5]="User",p}(hE||{}),s0=class{constructor(d,T=dE.Ok,f="OK"){this.headers=d.headers||new jd,this.status=d.status!==void 0?d.status:T,this.statusText=d.statusText||f,this.url=d.url||null,this.ok=this.status>=200&&this.status<300}};var a0=class p extends s0{constructor(d={}){super(d),this.type=hE.Response,this.body=d.body!==void 0?d.body:null}clone(d={}){return new p({body:d.body!==void 0?d.body:this.body,headers:d.headers||this.headers,status:d.status!==void 0?d.status:this.status,statusText:d.statusText||this.statusText,url:d.url||this.url||void 0})}};var dE=function(p){return p[p.Continue=100]="Continue",p[p.SwitchingProtocols=101]="SwitchingProtocols",p[p.Processing=102]="Processing",p[p.EarlyHints=103]="EarlyHints",p[p.Ok=200]="Ok",p[p.Created=201]="Created",p[p.Accepted=202]="Accepted",p[p.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",p[p.NoContent=204]="NoContent",p[p.ResetContent=205]="ResetContent",p[p.PartialContent=206]="PartialContent",p[p.MultiStatus=207]="MultiStatus",p[p.AlreadyReported=208]="AlreadyReported",p[p.ImUsed=226]="ImUsed",p[p.MultipleChoices=300]="MultipleChoices",p[p.MovedPermanently=301]="MovedPermanently",p[p.Found=302]="Found",p[p.SeeOther=303]="SeeOther",p[p.NotModified=304]="NotModified",p[p.UseProxy=305]="UseProxy",p[p.Unused=306]="Unused",p[p.TemporaryRedirect=307]="TemporaryRedirect",p[p.PermanentRedirect=308]="PermanentRedirect",p[p.BadRequest=400]="BadRequest",p[p.Unauthorized=401]="Unauthorized",p[p.PaymentRequired=402]="PaymentRequired",p[p.Forbidden=403]="Forbidden",p[p.NotFound=404]="NotFound",p[p.MethodNotAllowed=405]="MethodNotAllowed",p[p.NotAcceptable=406]="NotAcceptable",p[p.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",p[p.RequestTimeout=408]="RequestTimeout",p[p.Conflict=409]="Conflict",p[p.Gone=410]="Gone",p[p.LengthRequired=411]="LengthRequired",p[p.PreconditionFailed=412]="PreconditionFailed",p[p.PayloadTooLarge=413]="PayloadTooLarge",p[p.UriTooLong=414]="UriTooLong",p[p.UnsupportedMediaType=415]="UnsupportedMediaType",p[p.RangeNotSatisfiable=416]="RangeNotSatisfiable",p[p.ExpectationFailed=417]="ExpectationFailed",p[p.ImATeapot=418]="ImATeapot",p[p.MisdirectedRequest=421]="MisdirectedRequest",p[p.UnprocessableEntity=422]="UnprocessableEntity",p[p.Locked=423]="Locked",p[p.FailedDependency=424]="FailedDependency",p[p.TooEarly=425]="TooEarly",p[p.UpgradeRequired=426]="UpgradeRequired",p[p.PreconditionRequired=428]="PreconditionRequired",p[p.TooManyRequests=429]="TooManyRequests",p[p.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",p[p.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",p[p.InternalServerError=500]="InternalServerError",p[p.NotImplemented=501]="NotImplemented",p[p.BadGateway=502]="BadGateway",p[p.ServiceUnavailable=503]="ServiceUnavailable",p[p.GatewayTimeout=504]="GatewayTimeout",p[p.HttpVersionNotSupported=505]="HttpVersionNotSupported",p[p.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",p[p.InsufficientStorage=507]="InsufficientStorage",p[p.LoopDetected=508]="LoopDetected",p[p.NotExtended=510]="NotExtended",p[p.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",p}(dE||{});function i0(p,d){return{body:d,headers:p.headers,context:p.context,observe:p.observe,params:p.params,reportProgress:p.reportProgress,responseType:p.responseType,withCredentials:p.withCredentials,transferCache:p.transferCache}}var pE=(()=>{let d=class d{constructor(f){this.handler=f}request(f,v,r={}){let k;if(f instanceof Cf)k=f;else{let de;r.headers instanceof jd?de=r.headers:de=new jd(r.headers);let Ie;r.params&&(r.params instanceof ru?Ie=r.params:Ie=new ru({fromObject:r.params})),k=new Cf(f,v,r.body!==void 0?r.body:null,{headers:de,context:r.context,params:Ie,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials,transferCache:r.transferCache})}let W=_i(k).pipe(uh(de=>this.handler.handle(de)));if(f instanceof Cf||r.observe==="events")return W;let ee=W.pipe(lo(de=>de instanceof a0));switch(r.observe||"body"){case"body":switch(k.responseType){case"arraybuffer":return ee.pipe(qi(de=>{if(de.body!==null&&!(de.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return de.body}));case"blob":return ee.pipe(qi(de=>{if(de.body!==null&&!(de.body instanceof Blob))throw new Error("Response is not a Blob.");return de.body}));case"text":return ee.pipe(qi(de=>{if(de.body!==null&&typeof de.body!="string")throw new Error("Response is not a string.");return de.body}));case"json":default:return ee.pipe(qi(de=>de.body))}case"response":return ee;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(f,v={}){return this.request("DELETE",f,v)}get(f,v={}){return this.request("GET",f,v)}head(f,v={}){return this.request("HEAD",f,v)}jsonp(f,v){return this.request("JSONP",f,{params:new ru().append(v,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(f,v={}){return this.request("OPTIONS",f,v)}patch(f,v,r={}){return this.request("PATCH",f,i0(r,v))}post(f,v,r={}){return this.request("POST",f,i0(r,v))}put(f,v,r={}){return this.request("PUT",f,i0(r,v))}};d.\u0275fac=function(v){return new(v||d)(Jt(n0))},d.\u0275prov=Ti({token:d,factory:d.\u0275fac});let p=d;return p})();var u0=class extends tE{constructor(){super(...arguments),this.supportsDOMEvents=!0}},h0=class p extends u0{static makeCurrent(){eE(new p)}onAndCancel(d,T,f){return d.addEventListener(T,f),()=>{d.removeEventListener(T,f)}}dispatchEvent(d,T){d.dispatchEvent(T)}remove(d){d.parentNode&&d.parentNode.removeChild(d)}createElement(d,T){return T=T||this.getDefaultDocument(),T.createElement(d)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(d){return d.nodeType===Node.ELEMENT_NODE}isShadowRoot(d){return d instanceof DocumentFragment}getGlobalEventTarget(d,T){return T==="window"?window:T==="document"?d:T==="body"?d.body:null}getBaseHref(d){let T=bR();return T==null?null:xR(T)}resetBaseElement(){Af=null}getUserAgent(){return window.navigator.userAgent}getCookie(d){return iE(document.cookie,d)}},Af=null;function bR(){return Af=Af||document.querySelector("base"),Af?Af.getAttribute("href"):null}function xR(p){return new URL(p,document.baseURI).pathname}var wR=(()=>{let d=class d{build(){return new XMLHttpRequest}};d.\u0275fac=function(v){return new(v||d)},d.\u0275prov=Ti({token:d,factory:d.\u0275fac});let p=d;return p})(),d0=new en(""),_E=(()=>{let d=class d{constructor(f,v){this._zone=v,this._eventNameToPlugin=new Map,f.forEach(r=>{r.manager=this}),this._plugins=f.slice().reverse()}addEventListener(f,v,r){return this._findPluginFor(v).addEventListener(f,v,r)}getZone(){return this._zone}_findPluginFor(f){let v=this._eventNameToPlugin.get(f);if(v)return v;if(v=this._plugins.find(k=>k.supports(f)),!v)throw new mr(5101,!1);return this._eventNameToPlugin.set(f,v),v}};d.\u0275fac=function(v){return new(v||d)(Jt(d0),Jt(_n))},d.\u0275prov=Ti({token:d,factory:d.\u0275fac});let p=d;return p})(),Hg=class{constructor(d){this._doc=d}},l0="ng-app-id",yE=(()=>{let d=class d{constructor(f,v,r,k={}){this.doc=f,this.appId=v,this.nonce=r,this.platformId=k,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=Yv(k),this.resetHostNodes()}addStyles(f){for(let v of f)this.changeUsageCount(v,1)===1&&this.onStyleAdded(v)}removeStyles(f){for(let v of f)this.changeUsageCount(v,-1)<=0&&this.onStyleRemoved(v)}ngOnDestroy(){let f=this.styleNodesInDOM;f&&(f.forEach(v=>v.remove()),f.clear());for(let v of this.getAllStyles())this.onStyleRemoved(v);this.resetHostNodes()}addHost(f){this.hostNodes.add(f);for(let v of this.getAllStyles())this.addStyleToHost(f,v)}removeHost(f){this.hostNodes.delete(f)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(f){for(let v of this.hostNodes)this.addStyleToHost(v,f)}onStyleRemoved(f){let v=this.styleRef;v.get(f)?.elements?.forEach(r=>r.remove()),v.delete(f)}collectServerRenderedStyles(){let f=this.doc.head?.querySelectorAll(`style[${l0}="${this.appId}"]`);if(f?.length){let v=new Map;return f.forEach(r=>{r.textContent!=null&&v.set(r.textContent,r)}),v}return null}changeUsageCount(f,v){let r=this.styleRef;if(r.has(f)){let k=r.get(f);return k.usage+=v,k.usage}return r.set(f,{usage:v,elements:[]}),v}getStyleElement(f,v){let r=this.styleNodesInDOM,k=r?.get(v);if(k?.parentNode===f)return r.delete(v),k.removeAttribute(l0),k;{let W=this.doc.createElement("style");return this.nonce&&W.setAttribute("nonce",this.nonce),W.textContent=v,this.platformIsServer&&W.setAttribute(l0,this.appId),f.appendChild(W),W}}addStyleToHost(f,v){let r=this.getStyleElement(f,v),k=this.styleRef,W=k.get(v)?.elements;W?W.push(r):k.set(v,{elements:[r],usage:1})}resetHostNodes(){let f=this.hostNodes;f.clear(),f.add(this.doc.head)}};d.\u0275fac=function(v){return new(v||d)(Jt(zn),Jt(Vg),Jt(Ef,8),Jt(mh))},d.\u0275prov=Ti({token:d,factory:d.\u0275fac});let p=d;return p})(),c0={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},m0=/%COMP%/g,vE="%COMP%",TR=`_nghost-${vE}`,ER=`_ngcontent-${vE}`,IR=!0,SR=new en("",{providedIn:"root",factory:()=>IR});function MR(p){return ER.replace(m0,p)}function CR(p){return TR.replace(m0,p)}function bE(p,d){return d.map(T=>T.replace(m0,p))}var Qg=(()=>{let d=class d{constructor(f,v,r,k,W,ee,de,Ie=null){this.eventManager=f,this.sharedStylesHost=v,this.appId=r,this.removeStylesOnCompDestroy=k,this.doc=W,this.platformId=ee,this.ngZone=de,this.nonce=Ie,this.rendererByCompId=new Map,this.platformIsServer=Yv(ee),this.defaultRenderer=new Df(f,W,de,this.platformIsServer)}createRenderer(f,v){if(!f||!v)return this.defaultRenderer;this.platformIsServer&&v.encapsulation===xf.ShadowDom&&(v=fr(Vt({},v),{encapsulation:xf.Emulated}));let r=this.getOrCreateRenderer(f,v);return r instanceof Xg?r.applyToHost(f):r instanceof Rf&&r.applyStyles(),r}getOrCreateRenderer(f,v){let r=this.rendererByCompId,k=r.get(v.id);if(!k){let W=this.doc,ee=this.ngZone,de=this.eventManager,Ie=this.sharedStylesHost,Ne=this.removeStylesOnCompDestroy,lt=this.platformIsServer;switch(v.encapsulation){case xf.Emulated:k=new Xg(de,Ie,v,this.appId,Ne,W,ee,lt);break;case xf.ShadowDom:return new p0(de,Ie,f,v,W,ee,this.nonce,lt);default:k=new Rf(de,Ie,v,Ne,W,ee,lt);break}r.set(v.id,k)}return k}ngOnDestroy(){this.rendererByCompId.clear()}};d.\u0275fac=function(v){return new(v||d)(Jt(_E),Jt(yE),Jt(Vg),Jt(SR),Jt(zn),Jt(mh),Jt(_n),Jt(Ef))},d.\u0275prov=Ti({token:d,factory:d.\u0275fac});let p=d;return p})(),Df=class{constructor(d,T,f,v){this.eventManager=d,this.doc=T,this.ngZone=f,this.platformIsServer=v,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(d,T){return T?this.doc.createElementNS(c0[T]||T,d):this.doc.createElement(d)}createComment(d){return this.doc.createComment(d)}createText(d){return this.doc.createTextNode(d)}appendChild(d,T){(fE(d)?d.content:d).appendChild(T)}insertBefore(d,T,f){d&&(fE(d)?d.content:d).insertBefore(T,f)}removeChild(d,T){d&&d.removeChild(T)}selectRootElement(d,T){let f=typeof d=="string"?this.doc.querySelector(d):d;if(!f)throw new mr(-5104,!1);return T||(f.textContent=""),f}parentNode(d){return d.parentNode}nextSibling(d){return d.nextSibling}setAttribute(d,T,f,v){if(v){T=v+":"+T;let r=c0[v];r?d.setAttributeNS(r,T,f):d.setAttribute(T,f)}else d.setAttribute(T,f)}removeAttribute(d,T,f){if(f){let v=c0[f];v?d.removeAttributeNS(v,T):d.removeAttribute(`${f}:${T}`)}else d.removeAttribute(T)}addClass(d,T){d.classList.add(T)}removeClass(d,T){d.classList.remove(T)}setStyle(d,T,f,v){v&(If.DashCase|If.Important)?d.style.setProperty(T,f,v&If.Important?"important":""):d.style[T]=f}removeStyle(d,T,f){f&If.DashCase?d.style.removeProperty(T):d.style[T]=""}setProperty(d,T,f){d!=null&&(d[T]=f)}setValue(d,T){d.nodeValue=T}listen(d,T,f){if(typeof d=="string"&&(d=Vd().getGlobalEventTarget(this.doc,d),!d))throw new Error(`Unsupported event target ${d} for event ${T}`);return this.eventManager.addEventListener(d,T,this.decoratePreventDefault(f))}decoratePreventDefault(d){return T=>{if(T==="__ngUnwrap__")return d;(this.platformIsServer?this.ngZone.runGuarded(()=>d(T)):d(T))===!1&&T.preventDefault()}}};function fE(p){return p.tagName==="TEMPLATE"&&p.content!==void 0}var p0=class extends Df{constructor(d,T,f,v,r,k,W,ee){super(d,r,k,ee),this.sharedStylesHost=T,this.hostEl=f,this.shadowRoot=f.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let de=bE(v.id,v.styles);for(let Ie of de){let Ne=document.createElement("style");W&&Ne.setAttribute("nonce",W),Ne.textContent=Ie,this.shadowRoot.appendChild(Ne)}}nodeOrShadowRoot(d){return d===this.hostEl?this.shadowRoot:d}appendChild(d,T){return super.appendChild(this.nodeOrShadowRoot(d),T)}insertBefore(d,T,f){return super.insertBefore(this.nodeOrShadowRoot(d),T,f)}removeChild(d,T){return super.removeChild(this.nodeOrShadowRoot(d),T)}parentNode(d){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(d)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Rf=class extends Df{constructor(d,T,f,v,r,k,W,ee){super(d,r,k,W),this.sharedStylesHost=T,this.removeStylesOnCompDestroy=v,this.styles=ee?bE(ee,f.styles):f.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},Xg=class extends Rf{constructor(d,T,f,v,r,k,W,ee){let de=v+"-"+f.id;super(d,T,f,r,k,W,ee,de),this.contentAttr=MR(de),this.hostAttr=CR(de)}applyToHost(d){this.applyStyles(),this.setAttribute(d,this.hostAttr,"")}createElement(d,T){let f=super.createElement(d,T);return super.setAttribute(f,this.contentAttr,""),f}},AR=(()=>{let d=class d extends Hg{constructor(f){super(f)}supports(f){return!0}addEventListener(f,v,r){return f.addEventListener(v,r,!1),()=>this.removeEventListener(f,v,r)}removeEventListener(f,v,r){return f.removeEventListener(v,r)}};d.\u0275fac=function(v){return new(v||d)(Jt(zn))},d.\u0275prov=Ti({token:d,factory:d.\u0275fac});let p=d;return p})(),mE=["alt","control","meta","shift"],DR={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},RR={alt:p=>p.altKey,control:p=>p.ctrlKey,meta:p=>p.metaKey,shift:p=>p.shiftKey},PR=(()=>{let d=class d extends Hg{constructor(f){super(f)}supports(f){return d.parseEventName(f)!=null}addEventListener(f,v,r){let k=d.parseEventName(v),W=d.eventCallback(k.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Vd().onAndCancel(f,k.domEventName,W))}static parseEventName(f){let v=f.toLowerCase().split("."),r=v.shift();if(v.length===0||!(r==="keydown"||r==="keyup"))return null;let k=d._normalizeKey(v.pop()),W="",ee=v.indexOf("code");if(ee>-1&&(v.splice(ee,1),W="code."),mE.forEach(Ie=>{let Ne=v.indexOf(Ie);Ne>-1&&(v.splice(Ne,1),W+=Ie+".")}),W+=k,v.length!=0||k.length===0)return null;let de={};return de.domEventName=r,de.fullKey=W,de}static matchEventFullKeyCode(f,v){let r=DR[f.key]||f.key,k="";return v.indexOf("code.")>-1&&(r=f.code,k="code."),r==null||!r?!1:(r=r.toLowerCase(),r===" "?r="space":r==="."&&(r="dot"),mE.forEach(W=>{if(W!==r){let ee=RR[W];ee(f)&&(k+=W+".")}}),k+=r,k===v)}static eventCallback(f,v,r){return k=>{d.matchEventFullKeyCode(k,f)&&r.runGuarded(()=>v(k))}}static _normalizeKey(f){return f==="esc"?"escape":f}};d.\u0275fac=function(v){return new(v||d)(Jt(zn))},d.\u0275prov=Ti({token:d,factory:d.\u0275fac});let p=d;return p})();function xE(p,d){return JT(Vt({rootComponent:p},kR(d)))}function kR(p){return{appProviders:[...BR,...p?.providers??[]],platformProviders:zR}}function OR(){h0.makeCurrent()}function LR(){return new fh}function FR(){return AT(document),document}var zR=[{provide:mh,useValue:nE},{provide:DT,useValue:OR,multi:!0},{provide:zn,useFactory:FR,deps:[]}];var BR=[{provide:CT,useValue:"root"},{provide:fh,useFactory:LR,deps:[]},{provide:d0,useClass:AR,multi:!0,deps:[zn,_n,mh]},{provide:d0,useClass:PR,multi:!0,deps:[zn]},Qg,yE,_E,{provide:jg,useExisting:Qg},{provide:oE,useClass:wR,deps:[]},[]];var wE=(()=>{let d=class d{constructor(f){this._doc=f}getTitle(){return this._doc.title}setTitle(f){this._doc.title=f||""}};d.\u0275fac=function(v){return new(v||d)(Jt(zn))},d.\u0275prov=Ti({token:d,factory:d.\u0275fac,providedIn:"root"});let p=d;return p})();var g0=(()=>{let d=class d{};d.\u0275fac=function(v){return new(v||d)},d.\u0275prov=Ti({token:d,factory:function(v){let r=null;return v?r=new(v||d):r=Jt(NR),r},providedIn:"root"});let p=d;return p})(),NR=(()=>{let d=class d extends g0{constructor(f){super(),this._doc=f}sanitize(f,v){if(v==null)return null;switch(f){case Gs.NONE:return v;case Gs.HTML:return Bd(v,"HTML")?zd(v):zT(this._doc,String(v)).toString();case Gs.STYLE:return Bd(v,"Style")?zd(v):v;case Gs.SCRIPT:if(Bd(v,"Script"))return zd(v);throw new mr(5200,!1);case Gs.URL:return Bd(v,"URL")?zd(v):FT(String(v));case Gs.RESOURCE_URL:if(Bd(v,"ResourceURL"))return zd(v);throw new mr(5201,!1);default:throw new mr(5202,!1)}}bypassSecurityTrustHtml(f){return RT(f)}bypassSecurityTrustStyle(f){return PT(f)}bypassSecurityTrustScript(f){return kT(f)}bypassSecurityTrustUrl(f){return OT(f)}bypassSecurityTrustResourceUrl(f){return LT(f)}};d.\u0275fac=function(v){return new(v||d)(Jt(zn))},d.\u0275prov=Ti({token:d,factory:d.\u0275fac,providedIn:"root"});let p=d;return p})();var Yi="primary",Wf=Symbol("RouteTitle"),x0=class{constructor(d){this.params=d||{}}has(d){return Object.prototype.hasOwnProperty.call(this.params,d)}get(d){if(this.has(d)){let T=this.params[d];return Array.isArray(T)?T[0]:T}return null}getAll(d){if(this.has(d)){let T=this.params[d];return Array.isArray(T)?T:[T]}return[]}get keys(){return Object.keys(this.params)}};function Wd(p){return new x0(p)}function jR(p,d,T){let f=T.path.split("/");if(f.length>p.length||T.pathMatch==="full"&&(d.hasChildren()||f.length<p.length))return null;let v={};for(let r=0;r<f.length;r++){let k=f[r],W=p[r];if(k.startsWith(":"))v[k.substring(1)]=W;else if(k!==W.path)return null}return{consumed:p.slice(0,f.length),posParams:v}}function UR(p,d){if(p.length!==d.length)return!1;for(let T=0;T<p.length;++T)if(!Al(p[T],d[T]))return!1;return!0}function Al(p,d){let T=p?w0(p):void 0,f=d?w0(d):void 0;if(!T||!f||T.length!=f.length)return!1;let v;for(let r=0;r<T.length;r++)if(v=T[r],!AE(p[v],d[v]))return!1;return!0}function w0(p){return[...Object.keys(p),...Object.getOwnPropertySymbols(p)]}function AE(p,d){if(Array.isArray(p)&&Array.isArray(d)){if(p.length!==d.length)return!1;let T=[...p].sort(),f=[...d].sort();return T.every((v,r)=>f[r]===v)}else return p===d}function DE(p){return p.length>0?p[p.length-1]:null}function au(p){return Bv(p)?p:$g(p)?Ss(Promise.resolve(p)):_i(p)}var GR={exact:PE,subset:kE},RE={exact:qR,subset:$R,ignored:()=>!0};function EE(p,d,T){return GR[T.paths](p.root,d.root,T.matrixParams)&&RE[T.queryParams](p.queryParams,d.queryParams)&&!(T.fragment==="exact"&&p.fragment!==d.fragment)}function qR(p,d){return Al(p,d)}function PE(p,d,T){if(!bh(p.segments,d.segments)||!Jg(p.segments,d.segments,T)||p.numberOfChildren!==d.numberOfChildren)return!1;for(let f in d.children)if(!p.children[f]||!PE(p.children[f],d.children[f],T))return!1;return!0}function $R(p,d){return Object.keys(d).length<=Object.keys(p).length&&Object.keys(d).every(T=>AE(p[T],d[T]))}function kE(p,d,T){return OE(p,d,d.segments,T)}function OE(p,d,T,f){if(p.segments.length>T.length){let v=p.segments.slice(0,T.length);return!(!bh(v,T)||d.hasChildren()||!Jg(v,T,f))}else if(p.segments.length===T.length){if(!bh(p.segments,T)||!Jg(p.segments,T,f))return!1;for(let v in d.children)if(!p.children[v]||!kE(p.children[v],d.children[v],f))return!1;return!0}else{let v=T.slice(0,p.segments.length),r=T.slice(p.segments.length);return!bh(p.segments,v)||!Jg(p.segments,v,f)||!p.children[Yi]?!1:OE(p.children[Yi],d,r,f)}}function Jg(p,d,T){return d.every((f,v)=>RE[T](p[v].parameters,f.parameters))}var ou=class{constructor(d=new Vn([],{}),T={},f=null){this.root=d,this.queryParams=T,this.fragment=f}get queryParamMap(){return this._queryParamMap??=Wd(this.queryParams),this._queryParamMap}toString(){return HR.serialize(this)}},Vn=class{constructor(d,T){this.segments=d,this.children=T,this.parent=null,Object.values(T).forEach(f=>f.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return e_(this)}},vh=class{constructor(d,T){this.path=d,this.parameters=T}get parameterMap(){return this._parameterMap??=Wd(this.parameters),this._parameterMap}toString(){return FE(this)}};function WR(p,d){return bh(p,d)&&p.every((T,f)=>Al(T.parameters,d[f].parameters))}function bh(p,d){return p.length!==d.length?!1:p.every((T,f)=>T.path===d[f].path)}function ZR(p,d){let T=[];return Object.entries(p.children).forEach(([f,v])=>{f===Yi&&(T=T.concat(d(v,f)))}),Object.entries(p.children).forEach(([f,v])=>{f!==Yi&&(T=T.concat(d(v,f)))}),T}var H0=(()=>{let d=class d{};d.\u0275fac=function(v){return new(v||d)},d.\u0275prov=Ti({token:d,factory:()=>new i_,providedIn:"root"});let p=d;return p})(),i_=class{parse(d){let T=new E0(d);return new ou(T.parseRootSegment(),T.parseQueryParams(),T.parseFragment())}serialize(d){let T=`/${Pf(d.root,!0)}`,f=YR(d.queryParams),v=typeof d.fragment=="string"?`#${QR(d.fragment)}`:"";return`${T}${f}${v}`}},HR=new i_;function e_(p){return p.segments.map(d=>FE(d)).join("/")}function Pf(p,d){if(!p.hasChildren())return e_(p);if(d){let T=p.children[Yi]?Pf(p.children[Yi],!1):"",f=[];return Object.entries(p.children).forEach(([v,r])=>{v!==Yi&&f.push(`${v}:${Pf(r,!1)}`)}),f.length>0?`${T}(${f.join("//")})`:T}else{let T=ZR(p,(f,v)=>v===Yi?[Pf(p.children[Yi],!1)]:[`${v}:${Pf(f,!1)}`]);return Object.keys(p.children).length===1&&p.children[Yi]!=null?`${e_(p)}/${T[0]}`:`${e_(p)}/(${T.join("//")})`}}function LE(p){return encodeURIComponent(p).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Yg(p){return LE(p).replace(/%3B/gi,";")}function QR(p){return encodeURI(p)}function T0(p){return LE(p).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function t_(p){return decodeURIComponent(p)}function IE(p){return t_(p.replace(/\+/g,"%20"))}function FE(p){return`${T0(p.path)}${XR(p.parameters)}`}function XR(p){return Object.entries(p).map(([d,T])=>`;${T0(d)}=${T0(T)}`).join("")}function YR(p){let d=Object.entries(p).map(([T,f])=>Array.isArray(f)?f.map(v=>`${Yg(T)}=${Yg(v)}`).join("&"):`${Yg(T)}=${Yg(f)}`).filter(T=>T);return d.length?`?${d.join("&")}`:""}var KR=/^[^\/()?;#]+/;function _0(p){let d=p.match(KR);return d?d[0]:""}var JR=/^[^\/()?;=#]+/;function eP(p){let d=p.match(JR);return d?d[0]:""}var tP=/^[^=?&#]+/;function iP(p){let d=p.match(tP);return d?d[0]:""}var nP=/^[^&#]+/;function rP(p){let d=p.match(nP);return d?d[0]:""}var E0=class{constructor(d){this.url=d,this.remaining=d}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Vn([],{}):new Vn([],this.parseChildren())}parseQueryParams(){let d={};if(this.consumeOptional("?"))do this.parseQueryParam(d);while(this.consumeOptional("&"));return d}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let d=[];for(this.peekStartsWith("(")||d.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),d.push(this.parseSegment());let T={};this.peekStartsWith("/(")&&(this.capture("/"),T=this.parseParens(!0));let f={};return this.peekStartsWith("(")&&(f=this.parseParens(!1)),(d.length>0||Object.keys(T).length>0)&&(f[Yi]=new Vn(d,T)),f}parseSegment(){let d=_0(this.remaining);if(d===""&&this.peekStartsWith(";"))throw new mr(4009,!1);return this.capture(d),new vh(t_(d),this.parseMatrixParams())}parseMatrixParams(){let d={};for(;this.consumeOptional(";");)this.parseParam(d);return d}parseParam(d){let T=eP(this.remaining);if(!T)return;this.capture(T);let f="";if(this.consumeOptional("=")){let v=_0(this.remaining);v&&(f=v,this.capture(f))}d[t_(T)]=t_(f)}parseQueryParam(d){let T=iP(this.remaining);if(!T)return;this.capture(T);let f="";if(this.consumeOptional("=")){let k=rP(this.remaining);k&&(f=k,this.capture(f))}let v=IE(T),r=IE(f);if(d.hasOwnProperty(v)){let k=d[v];Array.isArray(k)||(k=[k],d[v]=k),k.push(r)}else d[v]=r}parseParens(d){let T={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let f=_0(this.remaining),v=this.remaining[f.length];if(v!=="/"&&v!==")"&&v!==";")throw new mr(4010,!1);let r;f.indexOf(":")>-1?(r=f.slice(0,f.indexOf(":")),this.capture(r),this.capture(":")):d&&(r=Yi);let k=this.parseChildren();T[r]=Object.keys(k).length===1?k[Yi]:new Vn([],k),this.consumeOptional("//")}return T}peekStartsWith(d){return this.remaining.startsWith(d)}consumeOptional(d){return this.peekStartsWith(d)?(this.remaining=this.remaining.substring(d.length),!0):!1}capture(d){if(!this.consumeOptional(d))throw new mr(4011,!1)}};function zE(p){return p.segments.length>0?new Vn([],{[Yi]:p}):p}function BE(p){let d={};for(let[f,v]of Object.entries(p.children)){let r=BE(v);if(f===Yi&&r.segments.length===0&&r.hasChildren())for(let[k,W]of Object.entries(r.children))d[k]=W;else(r.segments.length>0||r.hasChildren())&&(d[f]=r)}let T=new Vn(p.segments,d);return oP(T)}function oP(p){if(p.numberOfChildren===1&&p.children[Yi]){let d=p.children[Yi];return new Vn(p.segments.concat(d.segments),d.children)}return p}function Zd(p){return p instanceof ou}function sP(p,d,T=null,f=null){let v=NE(p);return VE(v,d,T,f)}function NE(p){let d;function T(r){let k={};for(let ee of r.children){let de=T(ee);k[ee.outlet]=de}let W=new Vn(r.url,k);return r===p&&(d=W),W}let f=T(p.root),v=zE(f);return d??v}function VE(p,d,T,f){let v=p;for(;v.parent;)v=v.parent;if(d.length===0)return y0(v,v,v,T,f);let r=aP(d);if(r.toRoot())return y0(v,v,new Vn([],{}),T,f);let k=lP(r,v,p),W=k.processChildren?Lf(k.segmentGroup,k.index,r.commands):UE(k.segmentGroup,k.index,r.commands);return y0(v,k.segmentGroup,W,T,f)}function n_(p){return typeof p=="object"&&p!=null&&!p.outlets&&!p.segmentPath}function Bf(p){return typeof p=="object"&&p!=null&&p.outlets}function y0(p,d,T,f,v){let r={};f&&Object.entries(f).forEach(([ee,de])=>{r[ee]=Array.isArray(de)?de.map(Ie=>`${Ie}`):`${de}`});let k;p===d?k=T:k=jE(p,d,T);let W=zE(BE(k));return new ou(W,r,v)}function jE(p,d,T){let f={};return Object.entries(p.children).forEach(([v,r])=>{r===d?f[v]=T:f[v]=jE(r,d,T)}),new Vn(p.segments,f)}var r_=class{constructor(d,T,f){if(this.isAbsolute=d,this.numberOfDoubleDots=T,this.commands=f,d&&f.length>0&&n_(f[0]))throw new mr(4003,!1);let v=f.find(Bf);if(v&&v!==DE(f))throw new mr(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function aP(p){if(typeof p[0]=="string"&&p.length===1&&p[0]==="/")return new r_(!0,0,p);let d=0,T=!1,f=p.reduce((v,r,k)=>{if(typeof r=="object"&&r!=null){if(r.outlets){let W={};return Object.entries(r.outlets).forEach(([ee,de])=>{W[ee]=typeof de=="string"?de.split("/"):de}),[...v,{outlets:W}]}if(r.segmentPath)return[...v,r.segmentPath]}return typeof r!="string"?[...v,r]:k===0?(r.split("/").forEach((W,ee)=>{ee==0&&W==="."||(ee==0&&W===""?T=!0:W===".."?d++:W!=""&&v.push(W))}),v):[...v,r]},[]);return new r_(T,d,f)}var qd=class{constructor(d,T,f){this.segmentGroup=d,this.processChildren=T,this.index=f}};function lP(p,d,T){if(p.isAbsolute)return new qd(d,!0,0);if(!T)return new qd(d,!1,NaN);if(T.parent===null)return new qd(T,!0,0);let f=n_(p.commands[0])?0:1,v=T.segments.length-1+f;return cP(T,v,p.numberOfDoubleDots)}function cP(p,d,T){let f=p,v=d,r=T;for(;r>v;){if(r-=v,f=f.parent,!f)throw new mr(4005,!1);v=f.segments.length}return new qd(f,!1,v-r)}function uP(p){return Bf(p[0])?p[0].outlets:{[Yi]:p}}function UE(p,d,T){if(p??=new Vn([],{}),p.segments.length===0&&p.hasChildren())return Lf(p,d,T);let f=hP(p,d,T),v=T.slice(f.commandIndex);if(f.match&&f.pathIndex<p.segments.length){let r=new Vn(p.segments.slice(0,f.pathIndex),{});return r.children[Yi]=new Vn(p.segments.slice(f.pathIndex),p.children),Lf(r,0,v)}else return f.match&&v.length===0?new Vn(p.segments,{}):f.match&&!p.hasChildren()?I0(p,d,T):f.match?Lf(p,0,v):I0(p,d,T)}function Lf(p,d,T){if(T.length===0)return new Vn(p.segments,{});{let f=uP(T),v={};if(Object.keys(f).some(r=>r!==Yi)&&p.children[Yi]&&p.numberOfChildren===1&&p.children[Yi].segments.length===0){let r=Lf(p.children[Yi],d,T);return new Vn(p.segments,r.children)}return Object.entries(f).forEach(([r,k])=>{typeof k=="string"&&(k=[k]),k!==null&&(v[r]=UE(p.children[r],d,k))}),Object.entries(p.children).forEach(([r,k])=>{f[r]===void 0&&(v[r]=k)}),new Vn(p.segments,v)}}function hP(p,d,T){let f=0,v=d,r={match:!1,pathIndex:0,commandIndex:0};for(;v<p.segments.length;){if(f>=T.length)return r;let k=p.segments[v],W=T[f];if(Bf(W))break;let ee=`${W}`,de=f<T.length-1?T[f+1]:null;if(v>0&&ee===void 0)break;if(ee&&de&&typeof de=="object"&&de.outlets===void 0){if(!ME(ee,de,k))return r;f+=2}else{if(!ME(ee,{},k))return r;f++}v++}return{match:!0,pathIndex:v,commandIndex:f}}function I0(p,d,T){let f=p.segments.slice(0,d),v=0;for(;v<T.length;){let r=T[v];if(Bf(r)){let ee=dP(r.outlets);return new Vn(f,ee)}if(v===0&&n_(T[0])){let ee=p.segments[d];f.push(new vh(ee.path,SE(T[0]))),v++;continue}let k=Bf(r)?r.outlets[Yi]:`${r}`,W=v<T.length-1?T[v+1]:null;k&&W&&n_(W)?(f.push(new vh(k,SE(W))),v+=2):(f.push(new vh(k,{})),v++)}return new Vn(f,{})}function dP(p){let d={};return Object.entries(p).forEach(([T,f])=>{typeof f=="string"&&(f=[f]),f!==null&&(d[T]=I0(new Vn([],{}),0,f))}),d}function SE(p){let d={};return Object.entries(p).forEach(([T,f])=>d[T]=`${f}`),d}function ME(p,d,T){return p==T.path&&Al(d,T.parameters)}var Ff="imperative",Eo=function(p){return p[p.NavigationStart=0]="NavigationStart",p[p.NavigationEnd=1]="NavigationEnd",p[p.NavigationCancel=2]="NavigationCancel",p[p.NavigationError=3]="NavigationError",p[p.RoutesRecognized=4]="RoutesRecognized",p[p.ResolveStart=5]="ResolveStart",p[p.ResolveEnd=6]="ResolveEnd",p[p.GuardsCheckStart=7]="GuardsCheckStart",p[p.GuardsCheckEnd=8]="GuardsCheckEnd",p[p.RouteConfigLoadStart=9]="RouteConfigLoadStart",p[p.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",p[p.ChildActivationStart=11]="ChildActivationStart",p[p.ChildActivationEnd=12]="ChildActivationEnd",p[p.ActivationStart=13]="ActivationStart",p[p.ActivationEnd=14]="ActivationEnd",p[p.Scroll=15]="Scroll",p[p.NavigationSkipped=16]="NavigationSkipped",p}(Eo||{}),Ea=class{constructor(d,T){this.id=d,this.url=T}},Nf=class extends Ea{constructor(d,T,f="imperative",v=null){super(d,T),this.type=Eo.NavigationStart,this.navigationTrigger=f,this.restoredState=v}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},xh=class extends Ea{constructor(d,T,f){super(d,T),this.urlAfterRedirects=f,this.type=Eo.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Qs=function(p){return p[p.Redirect=0]="Redirect",p[p.SupersededByNewNavigation=1]="SupersededByNewNavigation",p[p.NoDataFromResolver=2]="NoDataFromResolver",p[p.GuardRejected=3]="GuardRejected",p}(Qs||{}),S0=function(p){return p[p.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",p[p.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",p}(S0||{}),su=class extends Ea{constructor(d,T,f,v){super(d,T),this.reason=f,this.code=v,this.type=Eo.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},wh=class extends Ea{constructor(d,T,f,v){super(d,T),this.reason=f,this.code=v,this.type=Eo.NavigationSkipped}},Vf=class extends Ea{constructor(d,T,f,v){super(d,T),this.error=f,this.target=v,this.type=Eo.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},o_=class extends Ea{constructor(d,T,f,v){super(d,T),this.urlAfterRedirects=f,this.state=v,this.type=Eo.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},M0=class extends Ea{constructor(d,T,f,v){super(d,T),this.urlAfterRedirects=f,this.state=v,this.type=Eo.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},C0=class extends Ea{constructor(d,T,f,v,r){super(d,T),this.urlAfterRedirects=f,this.state=v,this.shouldActivate=r,this.type=Eo.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},A0=class extends Ea{constructor(d,T,f,v){super(d,T),this.urlAfterRedirects=f,this.state=v,this.type=Eo.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},D0=class extends Ea{constructor(d,T,f,v){super(d,T),this.urlAfterRedirects=f,this.state=v,this.type=Eo.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},R0=class{constructor(d){this.route=d,this.type=Eo.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},P0=class{constructor(d){this.route=d,this.type=Eo.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},k0=class{constructor(d){this.snapshot=d,this.type=Eo.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},O0=class{constructor(d){this.snapshot=d,this.type=Eo.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},L0=class{constructor(d){this.snapshot=d,this.type=Eo.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},F0=class{constructor(d){this.snapshot=d,this.type=Eo.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var jf=class{},Uf=class{constructor(d){this.url=d}};var z0=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new h_,this.attachRef=null}},h_=(()=>{let d=class d{constructor(){this.contexts=new Map}onChildOutletCreated(f,v){let r=this.getOrCreateContext(f);r.outlet=v,this.contexts.set(f,r)}onChildOutletDestroyed(f){let v=this.getContext(f);v&&(v.outlet=null,v.attachRef=null)}onOutletDeactivated(){let f=this.contexts;return this.contexts=new Map,f}onOutletReAttached(f){this.contexts=f}getOrCreateContext(f){let v=this.getContext(f);return v||(v=new z0,this.contexts.set(f,v)),v}getContext(f){return this.contexts.get(f)||null}};d.\u0275fac=function(v){return new(v||d)},d.\u0275prov=Ti({token:d,factory:d.\u0275fac,providedIn:"root"});let p=d;return p})(),s_=class{constructor(d){this._root=d}get root(){return this._root.value}parent(d){let T=this.pathFromRoot(d);return T.length>1?T[T.length-2]:null}children(d){let T=B0(d,this._root);return T?T.children.map(f=>f.value):[]}firstChild(d){let T=B0(d,this._root);return T&&T.children.length>0?T.children[0].value:null}siblings(d){let T=N0(d,this._root);return T.length<2?[]:T[T.length-2].children.map(v=>v.value).filter(v=>v!==d)}pathFromRoot(d){return N0(d,this._root).map(T=>T.value)}};function B0(p,d){if(p===d.value)return d;for(let T of d.children){let f=B0(p,T);if(f)return f}return null}function N0(p,d){if(p===d.value)return[d];for(let T of d.children){let f=N0(p,T);if(f.length)return f.unshift(d),f}return[]}var Hs=class{constructor(d,T){this.value=d,this.children=T}toString(){return`TreeNode(${this.value})`}};function Gd(p){let d={};return p&&p.children.forEach(T=>d[T.value.outlet]=T),d}var a_=class extends s_{constructor(d,T){super(d),this.snapshot=T,X0(this,d)}toString(){return this.snapshot.toString()}};function GE(p){let d=pP(p),T=new Is([new vh("",{})]),f=new Is({}),v=new Is({}),r=new Is({}),k=new Is(""),W=new Hd(T,f,r,k,v,Yi,p,d.root);return W.snapshot=d.root,new a_(new Hs(W,[]),d)}function pP(p){let d={},T={},f={},v="",r=new Gf([],d,f,v,T,Yi,p,null,{});return new l_("",new Hs(r,[]))}var Hd=class{constructor(d,T,f,v,r,k,W,ee){this.urlSubject=d,this.paramsSubject=T,this.queryParamsSubject=f,this.fragmentSubject=v,this.dataSubject=r,this.outlet=k,this.component=W,this._futureSnapshot=ee,this.title=this.dataSubject?.pipe(qi(de=>de[Wf]))??_i(void 0),this.url=d,this.params=T,this.queryParams=f,this.fragment=v,this.data=r}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(qi(d=>Wd(d))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(qi(d=>Wd(d))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Q0(p,d,T="emptyOnly"){let f,{routeConfig:v}=p;return d!==null&&(T==="always"||v?.path===""||!d.component&&!d.routeConfig?.loadComponent)?f={params:Vt(Vt({},d.params),p.params),data:Vt(Vt({},d.data),p.data),resolve:Vt(Vt(Vt(Vt({},p.data),d.data),v?.data),p._resolvedData)}:f={params:Vt({},p.params),data:Vt({},p.data),resolve:Vt(Vt({},p.data),p._resolvedData??{})},v&&$E(v)&&(f.resolve[Wf]=v.title),f}var Gf=class{get title(){return this.data?.[Wf]}constructor(d,T,f,v,r,k,W,ee,de){this.url=d,this.params=T,this.queryParams=f,this.fragment=v,this.data=r,this.outlet=k,this.component=W,this.routeConfig=ee,this._resolve=de}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Wd(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Wd(this.queryParams),this._queryParamMap}toString(){let d=this.url.map(f=>f.toString()).join("/"),T=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${d}', path:'${T}')`}},l_=class extends s_{constructor(d,T){super(T),this.url=d,X0(this,T)}toString(){return qE(this._root)}};function X0(p,d){d.value._routerState=p,d.children.forEach(T=>X0(p,T))}function qE(p){let d=p.children.length>0?` { ${p.children.map(qE).join(", ")} } `:"";return`${p.value}${d}`}function v0(p){if(p.snapshot){let d=p.snapshot,T=p._futureSnapshot;p.snapshot=T,Al(d.queryParams,T.queryParams)||p.queryParamsSubject.next(T.queryParams),d.fragment!==T.fragment&&p.fragmentSubject.next(T.fragment),Al(d.params,T.params)||p.paramsSubject.next(T.params),UR(d.url,T.url)||p.urlSubject.next(T.url),Al(d.data,T.data)||p.dataSubject.next(T.data)}else p.snapshot=p._futureSnapshot,p.dataSubject.next(p._futureSnapshot.data)}function V0(p,d){let T=Al(p.params,d.params)&&WR(p.url,d.url),f=!p.parent!=!d.parent;return T&&!f&&(!p.parent||V0(p.parent,d.parent))}function $E(p){return typeof p.title=="string"||p.title===null}var fP=(()=>{let d=class d{constructor(){this.activated=null,this._activatedRoute=null,this.name=Yi,this.activateEvents=new Or,this.deactivateEvents=new Or,this.attachEvents=new Or,this.detachEvents=new Or,this.parentContexts=ti(h_),this.location=ti(Zv),this.changeDetector=ti(Ms),this.environmentInjector=ti(Tf),this.inputBinder=ti(Y0,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(f){if(f.name){let{firstChange:v,previousValue:r}=f.name;if(v)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(f){return this.parentContexts.getContext(f)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let f=this.parentContexts.getContext(this.name);f?.route&&(f.attachRef?this.attach(f.attachRef,f.route):this.activateWith(f.route,f.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new mr(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new mr(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new mr(4012,!1);this.location.detach();let f=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(f.instance),f}attach(f,v){this.activated=f,this._activatedRoute=v,this.location.insert(f.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(f.instance)}deactivate(){if(this.activated){let f=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(f)}}activateWith(f,v){if(this.isActivated)throw new mr(4013,!1);this._activatedRoute=f;let r=this.location,W=f.snapshot.component,ee=this.parentContexts.getOrCreateContext(this.name).children,de=new j0(f,ee,r.injector);this.activated=r.createComponent(W,{index:r.length,injector:de,environmentInjector:v??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};d.\u0275fac=function(v){return new(v||d)},d.\u0275dir=uo({type:d,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Ld]});let p=d;return p})(),j0=class p{__ngOutletInjector(d){return new p(this.route,this.childContexts,d)}constructor(d,T,f){this.route=d,this.childContexts=T,this.parent=f}get(d,T){return d===Hd?this.route:d===h_?this.childContexts:this.parent.get(d,T)}},Y0=new en("");function mP(p,d,T){let f=qf(p,d._root,T?T._root:void 0);return new a_(f,d)}function qf(p,d,T){if(T&&p.shouldReuseRoute(d.value,T.value.snapshot)){let f=T.value;f._futureSnapshot=d.value;let v=gP(p,d,T);return new Hs(f,v)}else{if(p.shouldAttach(d.value)){let r=p.retrieve(d.value);if(r!==null){let k=r.route;return k.value._futureSnapshot=d.value,k.children=d.children.map(W=>qf(p,W)),k}}let f=_P(d.value),v=d.children.map(r=>qf(p,r));return new Hs(f,v)}}function gP(p,d,T){return d.children.map(f=>{for(let v of T.children)if(p.shouldReuseRoute(f.value,v.value.snapshot))return qf(p,f,v);return qf(p,f)})}function _P(p){return new Hd(new Is(p.url),new Is(p.params),new Is(p.queryParams),new Is(p.fragment),new Is(p.data),p.outlet,p.component,p)}var WE="ngNavigationCancelingError";function ZE(p,d){let{redirectTo:T,navigationBehaviorOptions:f}=Zd(d)?{redirectTo:d,navigationBehaviorOptions:void 0}:d,v=HE(!1,Qs.Redirect);return v.url=T,v.navigationBehaviorOptions=f,v}function HE(p,d){let T=new Error(`NavigationCancelingError: ${p||""}`);return T[WE]=!0,T.cancellationCode=d,T}function yP(p){return QE(p)&&Zd(p.url)}function QE(p){return!!p&&p[WE]}var vP=(()=>{let d=class d{};d.\u0275fac=function(v){return new(v||d)},d.\u0275cmp=Ar({type:d,selectors:[["ng-component"]],standalone:!0,features:[Dr],decls:1,vars:0,template:function(v,r){v&1&&Qn(0,"router-outlet")},dependencies:[fP],encapsulation:2});let p=d;return p})();function bP(p,d){return p.providers&&!p._injector&&(p._injector=UT(p.providers,d,`Route: ${p.path}`)),p._injector??d}function K0(p){let d=p.children&&p.children.map(K0),T=d?fr(Vt({},p),{children:d}):Vt({},p);return!T.component&&!T.loadComponent&&(d||T.loadChildren)&&T.outlet&&T.outlet!==Yi&&(T.component=vP),T}function Dl(p){return p.outlet||Yi}function xP(p,d){let T=p.filter(f=>Dl(f)===d);return T.push(...p.filter(f=>Dl(f)!==d)),T}function Zf(p){if(!p)return null;if(p.routeConfig?._injector)return p.routeConfig._injector;for(let d=p.parent;d;d=d.parent){let T=d.routeConfig;if(T?._loadedInjector)return T._loadedInjector;if(T?._injector)return T._injector}return null}var wP=(p,d,T,f)=>qi(v=>(new U0(d,v.targetRouterState,v.currentRouterState,T,f).activate(p),v)),U0=class{constructor(d,T,f,v,r){this.routeReuseStrategy=d,this.futureState=T,this.currState=f,this.forwardEvent=v,this.inputBindingEnabled=r}activate(d){let T=this.futureState._root,f=this.currState?this.currState._root:null;this.deactivateChildRoutes(T,f,d),v0(this.futureState.root),this.activateChildRoutes(T,f,d)}deactivateChildRoutes(d,T,f){let v=Gd(T);d.children.forEach(r=>{let k=r.value.outlet;this.deactivateRoutes(r,v[k],f),delete v[k]}),Object.values(v).forEach(r=>{this.deactivateRouteAndItsChildren(r,f)})}deactivateRoutes(d,T,f){let v=d.value,r=T?T.value:null;if(v===r)if(v.component){let k=f.getContext(v.outlet);k&&this.deactivateChildRoutes(d,T,k.children)}else this.deactivateChildRoutes(d,T,f);else r&&this.deactivateRouteAndItsChildren(T,f)}deactivateRouteAndItsChildren(d,T){d.value.component&&this.routeReuseStrategy.shouldDetach(d.value.snapshot)?this.detachAndStoreRouteSubtree(d,T):this.deactivateRouteAndOutlet(d,T)}detachAndStoreRouteSubtree(d,T){let f=T.getContext(d.value.outlet),v=f&&d.value.component?f.children:T,r=Gd(d);for(let k of Object.values(r))this.deactivateRouteAndItsChildren(k,v);if(f&&f.outlet){let k=f.outlet.detach(),W=f.children.onOutletDeactivated();this.routeReuseStrategy.store(d.value.snapshot,{componentRef:k,route:d,contexts:W})}}deactivateRouteAndOutlet(d,T){let f=T.getContext(d.value.outlet),v=f&&d.value.component?f.children:T,r=Gd(d);for(let k of Object.values(r))this.deactivateRouteAndItsChildren(k,v);f&&(f.outlet&&(f.outlet.deactivate(),f.children.onOutletDeactivated()),f.attachRef=null,f.route=null)}activateChildRoutes(d,T,f){let v=Gd(T);d.children.forEach(r=>{this.activateRoutes(r,v[r.value.outlet],f),this.forwardEvent(new F0(r.value.snapshot))}),d.children.length&&this.forwardEvent(new O0(d.value.snapshot))}activateRoutes(d,T,f){let v=d.value,r=T?T.value:null;if(v0(v),v===r)if(v.component){let k=f.getOrCreateContext(v.outlet);this.activateChildRoutes(d,T,k.children)}else this.activateChildRoutes(d,T,f);else if(v.component){let k=f.getOrCreateContext(v.outlet);if(this.routeReuseStrategy.shouldAttach(v.snapshot)){let W=this.routeReuseStrategy.retrieve(v.snapshot);this.routeReuseStrategy.store(v.snapshot,null),k.children.onOutletReAttached(W.contexts),k.attachRef=W.componentRef,k.route=W.route.value,k.outlet&&k.outlet.attach(W.componentRef,W.route.value),v0(W.route.value),this.activateChildRoutes(d,null,k.children)}else{let W=Zf(v.snapshot);k.attachRef=null,k.route=v,k.injector=W,k.outlet&&k.outlet.activateWith(v,k.injector),this.activateChildRoutes(d,null,k.children)}}else this.activateChildRoutes(d,null,f)}},c_=class{constructor(d){this.path=d,this.route=this.path[this.path.length-1]}},$d=class{constructor(d,T){this.component=d,this.route=T}};function TP(p,d,T){let f=p._root,v=d?d._root:null;return kf(f,v,T,[f.value])}function EP(p){let d=p.routeConfig?p.routeConfig.canActivateChild:null;return!d||d.length===0?null:{node:p,guards:d}}function Xd(p,d){let T=Symbol(),f=d.get(p,T);return f===T?typeof p=="function"&&!MT(p)?p:d.get(p):f}function kf(p,d,T,f,v={canDeactivateChecks:[],canActivateChecks:[]}){let r=Gd(d);return p.children.forEach(k=>{IP(k,r[k.value.outlet],T,f.concat([k.value]),v),delete r[k.value.outlet]}),Object.entries(r).forEach(([k,W])=>zf(W,T.getContext(k),v)),v}function IP(p,d,T,f,v={canDeactivateChecks:[],canActivateChecks:[]}){let r=p.value,k=d?d.value:null,W=T?T.getContext(p.value.outlet):null;if(k&&r.routeConfig===k.routeConfig){let ee=SP(k,r,r.routeConfig.runGuardsAndResolvers);ee?v.canActivateChecks.push(new c_(f)):(r.data=k.data,r._resolvedData=k._resolvedData),r.component?kf(p,d,W?W.children:null,f,v):kf(p,d,T,f,v),ee&&W&&W.outlet&&W.outlet.isActivated&&v.canDeactivateChecks.push(new $d(W.outlet.component,k))}else k&&zf(d,W,v),v.canActivateChecks.push(new c_(f)),r.component?kf(p,null,W?W.children:null,f,v):kf(p,null,T,f,v);return v}function SP(p,d,T){if(typeof T=="function")return T(p,d);switch(T){case"pathParamsChange":return!bh(p.url,d.url);case"pathParamsOrQueryParamsChange":return!bh(p.url,d.url)||!Al(p.queryParams,d.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!V0(p,d)||!Al(p.queryParams,d.queryParams);case"paramsChange":default:return!V0(p,d)}}function zf(p,d,T){let f=Gd(p),v=p.value;Object.entries(f).forEach(([r,k])=>{v.component?d?zf(k,d.children.getContext(r),T):zf(k,null,T):zf(k,d,T)}),v.component?d&&d.outlet&&d.outlet.isActivated?T.canDeactivateChecks.push(new $d(d.outlet.component,v)):T.canDeactivateChecks.push(new $d(null,v)):T.canDeactivateChecks.push(new $d(null,v))}function Hf(p){return typeof p=="function"}function MP(p){return typeof p=="boolean"}function CP(p){return p&&Hf(p.canLoad)}function AP(p){return p&&Hf(p.canActivate)}function DP(p){return p&&Hf(p.canActivateChild)}function RP(p){return p&&Hf(p.canDeactivate)}function PP(p){return p&&Hf(p.canMatch)}function XE(p){return p instanceof wT||p?.name==="EmptyError"}var Kg=Symbol("INITIAL_VALUE");function Qd(){return ba(p=>gf(p.map(d=>d.pipe(es(1),iu(Kg)))).pipe(qi(d=>{for(let T of d)if(T!==!0){if(T===Kg)return Kg;if(T===!1||T instanceof ou)return T}return!0}),lo(d=>d!==Kg),es(1)))}function kP(p,d){return va(T=>{let{targetSnapshot:f,currentSnapshot:v,guards:{canActivateChecks:r,canDeactivateChecks:k}}=T;return k.length===0&&r.length===0?_i(fr(Vt({},T),{guardsResult:!0})):OP(k,f,v,p).pipe(va(W=>W&&MP(W)?LP(f,r,p,d):_i(W)),qi(W=>fr(Vt({},T),{guardsResult:W})))})}function OP(p,d,T,f){return Ss(p).pipe(va(v=>VP(v.component,v.route,T,d,f)),tu(v=>v!==!0,!0))}function LP(p,d,T,f){return Ss(d).pipe(uh(v=>zg(zP(v.route.parent,f),FP(v.route,f),NP(p,v.path,T),BP(p,v.route,T))),tu(v=>v!==!0,!0))}function FP(p,d){return p!==null&&d&&d(new L0(p)),_i(!0)}function zP(p,d){return p!==null&&d&&d(new k0(p)),_i(!0)}function BP(p,d,T){let f=d.routeConfig?d.routeConfig.canActivate:null;if(!f||f.length===0)return _i(!0);let v=f.map(r=>Nv(()=>{let k=Zf(d)??T,W=Xd(r,k),ee=AP(W)?W.canActivate(d,p):ph(k,()=>W(d,p));return au(ee).pipe(tu())}));return _i(v).pipe(Qd())}function NP(p,d,T){let f=d[d.length-1],r=d.slice(0,d.length-1).reverse().map(k=>EP(k)).filter(k=>k!==null).map(k=>Nv(()=>{let W=k.guards.map(ee=>{let de=Zf(k.node)??T,Ie=Xd(ee,de),Ne=DP(Ie)?Ie.canActivateChild(f,p):ph(de,()=>Ie(f,p));return au(Ne).pipe(tu())});return _i(W).pipe(Qd())}));return _i(r).pipe(Qd())}function VP(p,d,T,f,v){let r=d&&d.routeConfig?d.routeConfig.canDeactivate:null;if(!r||r.length===0)return _i(!0);let k=r.map(W=>{let ee=Zf(d)??v,de=Xd(W,ee),Ie=RP(de)?de.canDeactivate(p,d,T,f):ph(ee,()=>de(p,d,T,f));return au(Ie).pipe(tu())});return _i(k).pipe(Qd())}function jP(p,d,T,f){let v=d.canLoad;if(v===void 0||v.length===0)return _i(!0);let r=v.map(k=>{let W=Xd(k,p),ee=CP(W)?W.canLoad(d,T):ph(p,()=>W(d,T));return au(ee)});return _i(r).pipe(Qd(),YE(f))}function YE(p){return xT(Cr(d=>{if(Zd(d))throw ZE(p,d)}),qi(d=>d===!0))}function UP(p,d,T,f){let v=d.canMatch;if(!v||v.length===0)return _i(!0);let r=v.map(k=>{let W=Xd(k,p),ee=PP(W)?W.canMatch(d,T):ph(p,()=>W(d,T));return au(ee)});return _i(r).pipe(Qd(),YE(f))}var $f=class{constructor(d){this.segmentGroup=d||null}},u_=class extends Error{constructor(d){super(),this.urlTree=d}};function Ud(p){return ch(new $f(p))}function GP(p){return ch(new mr(4e3,!1))}function qP(p){return ch(HE(!1,Qs.GuardRejected))}var G0=class{constructor(d,T){this.urlSerializer=d,this.urlTree=T}lineralizeSegments(d,T){let f=[],v=T.root;for(;;){if(f=f.concat(v.segments),v.numberOfChildren===0)return _i(f);if(v.numberOfChildren>1||!v.children[Yi])return GP(d.redirectTo);v=v.children[Yi]}}applyRedirectCommands(d,T,f){let v=this.applyRedirectCreateUrlTree(T,this.urlSerializer.parse(T),d,f);if(T.startsWith("/"))throw new u_(v);return v}applyRedirectCreateUrlTree(d,T,f,v){let r=this.createSegmentGroup(d,T.root,f,v);return new ou(r,this.createQueryParams(T.queryParams,this.urlTree.queryParams),T.fragment)}createQueryParams(d,T){let f={};return Object.entries(d).forEach(([v,r])=>{if(typeof r=="string"&&r.startsWith(":")){let W=r.substring(1);f[v]=T[W]}else f[v]=r}),f}createSegmentGroup(d,T,f,v){let r=this.createSegments(d,T.segments,f,v),k={};return Object.entries(T.children).forEach(([W,ee])=>{k[W]=this.createSegmentGroup(d,ee,f,v)}),new Vn(r,k)}createSegments(d,T,f,v){return T.map(r=>r.path.startsWith(":")?this.findPosParam(d,r,v):this.findOrReturn(r,f))}findPosParam(d,T,f){let v=f[T.path.substring(1)];if(!v)throw new mr(4001,!1);return v}findOrReturn(d,T){let f=0;for(let v of T){if(v.path===d.path)return T.splice(f),v;f++}return d}},q0={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function $P(p,d,T,f,v){let r=J0(p,d,T);return r.matched?(f=bP(d,f),UP(f,d,T,v).pipe(qi(k=>k===!0?r:Vt({},q0)))):_i(r)}function J0(p,d,T){if(d.path==="**")return WP(T);if(d.path==="")return d.pathMatch==="full"&&(p.hasChildren()||T.length>0)?Vt({},q0):{matched:!0,consumedSegments:[],remainingSegments:T,parameters:{},positionalParamSegments:{}};let v=(d.matcher||jR)(T,p,d);if(!v)return Vt({},q0);let r={};Object.entries(v.posParams??{}).forEach(([W,ee])=>{r[W]=ee.path});let k=v.consumed.length>0?Vt(Vt({},r),v.consumed[v.consumed.length-1].parameters):r;return{matched:!0,consumedSegments:v.consumed,remainingSegments:T.slice(v.consumed.length),parameters:k,positionalParamSegments:v.posParams??{}}}function WP(p){return{matched:!0,parameters:p.length>0?DE(p).parameters:{},consumedSegments:p,remainingSegments:[],positionalParamSegments:{}}}function CE(p,d,T,f){return T.length>0&&QP(p,T,f)?{segmentGroup:new Vn(d,HP(f,new Vn(T,p.children))),slicedSegments:[]}:T.length===0&&XP(p,T,f)?{segmentGroup:new Vn(p.segments,ZP(p,T,f,p.children)),slicedSegments:T}:{segmentGroup:new Vn(p.segments,p.children),slicedSegments:T}}function ZP(p,d,T,f){let v={};for(let r of T)if(d_(p,d,r)&&!f[Dl(r)]){let k=new Vn([],{});v[Dl(r)]=k}return Vt(Vt({},f),v)}function HP(p,d){let T={};T[Yi]=d;for(let f of p)if(f.path===""&&Dl(f)!==Yi){let v=new Vn([],{});T[Dl(f)]=v}return T}function QP(p,d,T){return T.some(f=>d_(p,d,f)&&Dl(f)!==Yi)}function XP(p,d,T){return T.some(f=>d_(p,d,f))}function d_(p,d,T){return(p.hasChildren()||d.length>0)&&T.pathMatch==="full"?!1:T.path===""}function YP(p,d,T,f){return Dl(p)!==f&&(f===Yi||!d_(d,T,p))?!1:J0(d,p,T).matched}function KP(p,d,T){return d.length===0&&!p.children[T]}var $0=class{};function JP(p,d,T,f,v,r,k="emptyOnly"){return new W0(p,d,T,f,v,k,r).recognize()}var ek=31,W0=class{constructor(d,T,f,v,r,k,W){this.injector=d,this.configLoader=T,this.rootComponentType=f,this.config=v,this.urlTree=r,this.paramsInheritanceStrategy=k,this.urlSerializer=W,this.applyRedirects=new G0(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(d){return new mr(4002,`'${d.segmentGroup}'`)}recognize(){let d=CE(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(d).pipe(qi(T=>{let f=new Gf([],Object.freeze({}),Object.freeze(Vt({},this.urlTree.queryParams)),this.urlTree.fragment,{},Yi,this.rootComponentType,null,{}),v=new Hs(f,T),r=new l_("",v),k=sP(f,[],this.urlTree.queryParams,this.urlTree.fragment);return k.queryParams=this.urlTree.queryParams,r.url=this.urlSerializer.serialize(k),this.inheritParamsAndData(r._root,null),{state:r,tree:k}}))}match(d){return this.processSegmentGroup(this.injector,this.config,d,Yi).pipe(eu(f=>{if(f instanceof u_)return this.urlTree=f.urlTree,this.match(f.urlTree.root);throw f instanceof $f?this.noMatchError(f):f}))}inheritParamsAndData(d,T){let f=d.value,v=Q0(f,T,this.paramsInheritanceStrategy);f.params=Object.freeze(v.params),f.data=Object.freeze(v.data),d.children.forEach(r=>this.inheritParamsAndData(r,f))}processSegmentGroup(d,T,f,v){return f.segments.length===0&&f.hasChildren()?this.processChildren(d,T,f):this.processSegment(d,T,f,f.segments,v,!0).pipe(qi(r=>r instanceof Hs?[r]:[]))}processChildren(d,T,f){let v=[];for(let r of Object.keys(f.children))r==="primary"?v.unshift(r):v.push(r);return Ss(v).pipe(uh(r=>{let k=f.children[r],W=xP(T,r);return this.processSegmentGroup(d,W,k,r)}),IT((r,k)=>(r.push(...k),r)),jv(null),ET(),va(r=>{if(r===null)return Ud(f);let k=KE(r);return tk(k),_i(k)}))}processSegment(d,T,f,v,r,k){return Ss(T).pipe(uh(W=>this.processSegmentAgainstRoute(W._injector??d,T,W,f,v,r,k).pipe(eu(ee=>{if(ee instanceof $f)return _i(null);throw ee}))),tu(W=>!!W),eu(W=>{if(XE(W))return KP(f,v,r)?_i(new $0):Ud(f);throw W}))}processSegmentAgainstRoute(d,T,f,v,r,k,W){return YP(f,v,r,k)?f.redirectTo===void 0?this.matchSegmentAgainstRoute(d,v,f,r,k):this.allowRedirects&&W?this.expandSegmentAgainstRouteUsingRedirect(d,v,T,f,r,k):Ud(v):Ud(v)}expandSegmentAgainstRouteUsingRedirect(d,T,f,v,r,k){let{matched:W,consumedSegments:ee,positionalParamSegments:de,remainingSegments:Ie}=J0(T,v,r);if(!W)return Ud(T);v.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>ek&&(this.allowRedirects=!1));let Ne=this.applyRedirects.applyRedirectCommands(ee,v.redirectTo,de);return this.applyRedirects.lineralizeSegments(v,Ne).pipe(va(lt=>this.processSegment(d,f,T,lt.concat(Ie),k,!1)))}matchSegmentAgainstRoute(d,T,f,v,r){let k=$P(T,f,v,d,this.urlSerializer);return f.path==="**"&&(T.children={}),k.pipe(ba(W=>W.matched?(d=f._injector??d,this.getChildConfig(d,f,v).pipe(ba(({routes:ee})=>{let de=f._loadedInjector??d,{consumedSegments:Ie,remainingSegments:Ne,parameters:lt}=W,it=new Gf(Ie,lt,Object.freeze(Vt({},this.urlTree.queryParams)),this.urlTree.fragment,nk(f),Dl(f),f.component??f._loadedComponent??null,f,rk(f)),{segmentGroup:Gt,slicedSegments:Ei}=CE(T,Ie,Ne,ee);if(Ei.length===0&&Gt.hasChildren())return this.processChildren(de,ee,Gt).pipe(qi(Xt=>Xt===null?null:new Hs(it,Xt)));if(ee.length===0&&Ei.length===0)return _i(new Hs(it,[]));let sn=Dl(f)===r;return this.processSegment(de,ee,Gt,Ei,sn?Yi:r,!0).pipe(qi(Xt=>new Hs(it,Xt instanceof Hs?[Xt]:[])))}))):Ud(T)))}getChildConfig(d,T,f){return T.children?_i({routes:T.children,injector:d}):T.loadChildren?T._loadedRoutes!==void 0?_i({routes:T._loadedRoutes,injector:T._loadedInjector}):jP(d,T,f,this.urlSerializer).pipe(va(v=>v?this.configLoader.loadChildren(d,T).pipe(Cr(r=>{T._loadedRoutes=r.routes,T._loadedInjector=r.injector})):qP(T))):_i({routes:[],injector:d})}};function tk(p){p.sort((d,T)=>d.value.outlet===Yi?-1:T.value.outlet===Yi?1:d.value.outlet.localeCompare(T.value.outlet))}function ik(p){let d=p.value.routeConfig;return d&&d.path===""}function KE(p){let d=[],T=new Set;for(let f of p){if(!ik(f)){d.push(f);continue}let v=d.find(r=>f.value.routeConfig===r.value.routeConfig);v!==void 0?(v.children.push(...f.children),T.add(v)):d.push(f)}for(let f of T){let v=KE(f.children);d.push(new Hs(f.value,v))}return d.filter(f=>!T.has(f))}function nk(p){return p.data||{}}function rk(p){return p.resolve||{}}function ok(p,d,T,f,v,r){return va(k=>JP(p,d,T,f,k.extractedUrl,v,r).pipe(qi(({state:W,tree:ee})=>fr(Vt({},k),{targetSnapshot:W,urlAfterRedirects:ee}))))}function sk(p,d){return va(T=>{let{targetSnapshot:f,guards:{canActivateChecks:v}}=T;if(!v.length)return _i(T);let r=new Set(v.map(ee=>ee.route)),k=new Set;for(let ee of r)if(!k.has(ee))for(let de of JE(ee))k.add(de);let W=0;return Ss(k).pipe(uh(ee=>r.has(ee)?ak(ee,f,p,d):(ee.data=Q0(ee,ee.parent,p).resolve,_i(void 0))),Cr(()=>W++),Uv(1),va(ee=>W===k.size?_i(T):Jc))})}function JE(p){let d=p.children.map(T=>JE(T)).flat();return[p,...d]}function ak(p,d,T,f){let v=p.routeConfig,r=p._resolve;return v?.title!==void 0&&!$E(v)&&(r[Wf]=v.title),lk(r,p,d,f).pipe(qi(k=>(p._resolvedData=k,p.data=Q0(p,p.parent,T).resolve,null)))}function lk(p,d,T,f){let v=w0(p);if(v.length===0)return _i({});let r={};return Ss(v).pipe(va(k=>ck(p[k],d,T,f).pipe(tu(),Cr(W=>{r[k]=W}))),Uv(1),vf(r),eu(k=>XE(k)?Jc:ch(k)))}function ck(p,d,T,f){let v=Zf(d)??f,r=Xd(p,v),k=r.resolve?r.resolve(d,T):ph(v,()=>r(d,T));return au(k)}function b0(p){return ba(d=>{let T=p(d);return T?Ss(T).pipe(qi(()=>d)):_i(d)})}var eI=(()=>{let d=class d{buildTitle(f){let v,r=f.root;for(;r!==void 0;)v=this.getResolvedTitleForRoute(r)??v,r=r.children.find(k=>k.outlet===Yi);return v}getResolvedTitleForRoute(f){return f.data[Wf]}};d.\u0275fac=function(v){return new(v||d)},d.\u0275prov=Ti({token:d,factory:()=>ti(uk),providedIn:"root"});let p=d;return p})(),uk=(()=>{let d=class d extends eI{constructor(f){super(),this.title=f}updateTitle(f){let v=this.buildTitle(f);v!==void 0&&this.title.setTitle(v)}};d.\u0275fac=function(v){return new(v||d)(Jt(wE))},d.\u0275prov=Ti({token:d,factory:d.\u0275fac,providedIn:"root"});let p=d;return p})(),eb=new en("",{providedIn:"root",factory:()=>({})}),tb=new en(""),hk=(()=>{let d=class d{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=ti(Qv)}loadComponent(f){if(this.componentLoaders.get(f))return this.componentLoaders.get(f);if(f._loadedComponent)return _i(f._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(f);let v=au(f.loadComponent()).pipe(qi(tI),Cr(k=>{this.onLoadEndListener&&this.onLoadEndListener(f),f._loadedComponent=k}),hh(()=>{this.componentLoaders.delete(f)})),r=new zv(v,()=>new ir).pipe(Fv());return this.componentLoaders.set(f,r),r}loadChildren(f,v){if(this.childrenLoaders.get(v))return this.childrenLoaders.get(v);if(v._loadedRoutes)return _i({routes:v._loadedRoutes,injector:v._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(v);let k=dk(v,this.compiler,f,this.onLoadEndListener).pipe(hh(()=>{this.childrenLoaders.delete(v)})),W=new zv(k,()=>new ir).pipe(Fv());return this.childrenLoaders.set(v,W),W}};d.\u0275fac=function(v){return new(v||d)},d.\u0275prov=Ti({token:d,factory:d.\u0275fac,providedIn:"root"});let p=d;return p})();function dk(p,d,T,f){return au(p.loadChildren()).pipe(qi(tI),va(v=>v instanceof jT||Array.isArray(v)?_i(v):Ss(d.compileModuleAsync(v))),qi(v=>{f&&f(p);let r,k,W=!1;return Array.isArray(v)?(k=v,W=!0):(r=v.create(T).injector,k=r.get(tb,[],{optional:!0,self:!0}).flat()),{routes:k.map(K0),injector:r}}))}function pk(p){return p&&typeof p=="object"&&"default"in p}function tI(p){return pk(p)?p.default:p}var ib=(()=>{let d=class d{};d.\u0275fac=function(v){return new(v||d)},d.\u0275prov=Ti({token:d,factory:()=>ti(fk),providedIn:"root"});let p=d;return p})(),fk=(()=>{let d=class d{shouldProcessUrl(f){return!0}extract(f){return f}merge(f,v){return f}};d.\u0275fac=function(v){return new(v||d)},d.\u0275prov=Ti({token:d,factory:d.\u0275fac,providedIn:"root"});let p=d;return p})(),mk=new en("");var gk=(()=>{let d=class d{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new ir,this.transitionAbortSubject=new ir,this.configLoader=ti(hk),this.environmentInjector=ti(Tf),this.urlSerializer=ti(H0),this.rootContexts=ti(h_),this.location=ti(Wg),this.inputBindingEnabled=ti(Y0,{optional:!0})!==null,this.titleStrategy=ti(eI),this.options=ti(eb,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=ti(ib),this.createViewTransition=ti(mk,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>_i(void 0),this.rootComponentType=null;let f=r=>this.events.next(new R0(r)),v=r=>this.events.next(new P0(r));this.configLoader.onLoadEndListener=v,this.configLoader.onLoadStartListener=f}complete(){this.transitions?.complete()}handleNavigationRequest(f){let v=++this.navigationId;this.transitions?.next(fr(Vt(Vt({},this.transitions.value),f),{id:v}))}setupNavigations(f,v,r){return this.transitions=new Is({id:0,currentUrlTree:v,currentRawUrl:v,extractedUrl:this.urlHandlingStrategy.extract(v),urlAfterRedirects:this.urlHandlingStrategy.extract(v),rawUrl:v,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Ff,restoredState:null,currentSnapshot:r.snapshot,targetSnapshot:null,currentRouterState:r,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(lo(k=>k.id!==0),qi(k=>fr(Vt({},k),{extractedUrl:this.urlHandlingStrategy.extract(k.rawUrl)})),ba(k=>{let W=!1,ee=!1;return _i(k).pipe(ba(de=>{if(this.navigationId>k.id)return this.cancelNavigationTransition(k,"",Qs.SupersededByNewNavigation),Jc;this.currentTransition=k,this.currentNavigation={id:de.id,initialUrl:de.rawUrl,extractedUrl:de.extractedUrl,trigger:de.source,extras:de.extras,previousNavigation:this.lastSuccessfulNavigation?fr(Vt({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let Ie=!f.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),Ne=de.extras.onSameUrlNavigation??f.onSameUrlNavigation;if(!Ie&&Ne!=="reload"){let lt="";return this.events.next(new wh(de.id,this.urlSerializer.serialize(de.rawUrl),lt,S0.IgnoredSameUrlNavigation)),de.resolve(null),Jc}if(this.urlHandlingStrategy.shouldProcessUrl(de.rawUrl))return _i(de).pipe(ba(lt=>{let it=this.transitions?.getValue();return this.events.next(new Nf(lt.id,this.urlSerializer.serialize(lt.extractedUrl),lt.source,lt.restoredState)),it!==this.transitions?.getValue()?Jc:Promise.resolve(lt)}),ok(this.environmentInjector,this.configLoader,this.rootComponentType,f.config,this.urlSerializer,this.paramsInheritanceStrategy),Cr(lt=>{k.targetSnapshot=lt.targetSnapshot,k.urlAfterRedirects=lt.urlAfterRedirects,this.currentNavigation=fr(Vt({},this.currentNavigation),{finalUrl:lt.urlAfterRedirects});let it=new o_(lt.id,this.urlSerializer.serialize(lt.extractedUrl),this.urlSerializer.serialize(lt.urlAfterRedirects),lt.targetSnapshot);this.events.next(it)}));if(Ie&&this.urlHandlingStrategy.shouldProcessUrl(de.currentRawUrl)){let{id:lt,extractedUrl:it,source:Gt,restoredState:Ei,extras:sn}=de,Xt=new Nf(lt,this.urlSerializer.serialize(it),Gt,Ei);this.events.next(Xt);let ni=GE(this.rootComponentType).snapshot;return this.currentTransition=k=fr(Vt({},de),{targetSnapshot:ni,urlAfterRedirects:it,extras:fr(Vt({},sn),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=it,_i(k)}else{let lt="";return this.events.next(new wh(de.id,this.urlSerializer.serialize(de.extractedUrl),lt,S0.IgnoredByUrlHandlingStrategy)),de.resolve(null),Jc}}),Cr(de=>{let Ie=new M0(de.id,this.urlSerializer.serialize(de.extractedUrl),this.urlSerializer.serialize(de.urlAfterRedirects),de.targetSnapshot);this.events.next(Ie)}),qi(de=>(this.currentTransition=k=fr(Vt({},de),{guards:TP(de.targetSnapshot,de.currentSnapshot,this.rootContexts)}),k)),kP(this.environmentInjector,de=>this.events.next(de)),Cr(de=>{if(k.guardsResult=de.guardsResult,Zd(de.guardsResult))throw ZE(this.urlSerializer,de.guardsResult);let Ie=new C0(de.id,this.urlSerializer.serialize(de.extractedUrl),this.urlSerializer.serialize(de.urlAfterRedirects),de.targetSnapshot,!!de.guardsResult);this.events.next(Ie)}),lo(de=>de.guardsResult?!0:(this.cancelNavigationTransition(de,"",Qs.GuardRejected),!1)),b0(de=>{if(de.guards.canActivateChecks.length)return _i(de).pipe(Cr(Ie=>{let Ne=new A0(Ie.id,this.urlSerializer.serialize(Ie.extractedUrl),this.urlSerializer.serialize(Ie.urlAfterRedirects),Ie.targetSnapshot);this.events.next(Ne)}),ba(Ie=>{let Ne=!1;return _i(Ie).pipe(sk(this.paramsInheritanceStrategy,this.environmentInjector),Cr({next:()=>Ne=!0,complete:()=>{Ne||this.cancelNavigationTransition(Ie,"",Qs.NoDataFromResolver)}}))}),Cr(Ie=>{let Ne=new D0(Ie.id,this.urlSerializer.serialize(Ie.extractedUrl),this.urlSerializer.serialize(Ie.urlAfterRedirects),Ie.targetSnapshot);this.events.next(Ne)}))}),b0(de=>{let Ie=Ne=>{let lt=[];Ne.routeConfig?.loadComponent&&!Ne.routeConfig._loadedComponent&&lt.push(this.configLoader.loadComponent(Ne.routeConfig).pipe(Cr(it=>{Ne.component=it}),qi(()=>{})));for(let it of Ne.children)lt.push(...Ie(it));return lt};return gf(Ie(de.targetSnapshot.root)).pipe(jv(null),es(1))}),b0(()=>this.afterPreactivation()),ba(()=>{let{currentSnapshot:de,targetSnapshot:Ie}=k,Ne=this.createViewTransition?.(this.environmentInjector,de.root,Ie.root);return Ne?Ss(Ne).pipe(qi(()=>k)):_i(k)}),qi(de=>{let Ie=mP(f.routeReuseStrategy,de.targetSnapshot,de.currentRouterState);return this.currentTransition=k=fr(Vt({},de),{targetRouterState:Ie}),this.currentNavigation.targetRouterState=Ie,k}),Cr(()=>{this.events.next(new jf)}),wP(this.rootContexts,f.routeReuseStrategy,de=>this.events.next(de),this.inputBindingEnabled),es(1),Cr({next:de=>{W=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new xh(de.id,this.urlSerializer.serialize(de.extractedUrl),this.urlSerializer.serialize(de.urlAfterRedirects))),this.titleStrategy?.updateTitle(de.targetRouterState.snapshot),de.resolve(!0)},complete:()=>{W=!0}}),co(this.transitionAbortSubject.pipe(Cr(de=>{throw de}))),hh(()=>{!W&&!ee&&this.cancelNavigationTransition(k,"",Qs.SupersededByNewNavigation),this.currentTransition?.id===k.id&&(this.currentNavigation=null,this.currentTransition=null)}),eu(de=>{if(ee=!0,QE(de))this.events.next(new su(k.id,this.urlSerializer.serialize(k.extractedUrl),de.message,de.cancellationCode)),yP(de)?this.events.next(new Uf(de.url)):k.resolve(!1);else{this.events.next(new Vf(k.id,this.urlSerializer.serialize(k.extractedUrl),de,k.targetSnapshot??void 0));try{k.resolve(f.errorHandler(de))}catch(Ie){this.options.resolveNavigationPromiseOnError?k.resolve(!1):k.reject(Ie)}}return Jc}))}))}cancelNavigationTransition(f,v,r){let k=new su(f.id,this.urlSerializer.serialize(f.extractedUrl),v,r);this.events.next(k),f.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};d.\u0275fac=function(v){return new(v||d)},d.\u0275prov=Ti({token:d,factory:d.\u0275fac,providedIn:"root"});let p=d;return p})();function _k(p){return p!==Ff}var yk=(()=>{let d=class d{};d.\u0275fac=function(v){return new(v||d)},d.\u0275prov=Ti({token:d,factory:()=>ti(vk),providedIn:"root"});let p=d;return p})(),Z0=class{shouldDetach(d){return!1}store(d,T){}shouldAttach(d){return!1}retrieve(d){return null}shouldReuseRoute(d,T){return d.routeConfig===T.routeConfig}},vk=(()=>{let d=class d extends Z0{};d.\u0275fac=(()=>{let f;return function(r){return(f||(f=Fd(d)))(r||d)}})(),d.\u0275prov=Ti({token:d,factory:d.\u0275fac,providedIn:"root"});let p=d;return p})(),iI=(()=>{let d=class d{};d.\u0275fac=function(v){return new(v||d)},d.\u0275prov=Ti({token:d,factory:()=>ti(bk),providedIn:"root"});let p=d;return p})(),bk=(()=>{let d=class d extends iI{constructor(){super(...arguments),this.location=ti(Wg),this.urlSerializer=ti(H0),this.options=ti(eb,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=ti(ib),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new ou,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=GE(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(f){return this.location.subscribe(v=>{v.type==="popstate"&&f(v.url,v.state)})}handleRouterEvent(f,v){if(f instanceof Nf)this.stateMemento=this.createStateMemento();else if(f instanceof wh)this.rawUrlTree=v.initialUrl;else if(f instanceof o_){if(this.urlUpdateStrategy==="eager"&&!v.extras.skipLocationChange){let r=this.urlHandlingStrategy.merge(v.finalUrl,v.initialUrl);this.setBrowserUrl(r,v)}}else f instanceof jf?(this.currentUrlTree=v.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(v.finalUrl,v.initialUrl),this.routerState=v.targetRouterState,this.urlUpdateStrategy==="deferred"&&(v.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,v))):f instanceof su&&(f.code===Qs.GuardRejected||f.code===Qs.NoDataFromResolver)?this.restoreHistory(v):f instanceof Vf?this.restoreHistory(v,!0):f instanceof xh&&(this.lastSuccessfulId=f.id,this.currentPageId=this.browserPageId)}setBrowserUrl(f,v){let r=this.urlSerializer.serialize(f);if(this.location.isCurrentPathEqualTo(r)||v.extras.replaceUrl){let k=this.browserPageId,W=Vt(Vt({},v.extras.state),this.generateNgRouterState(v.id,k));this.location.replaceState(r,"",W)}else{let k=Vt(Vt({},v.extras.state),this.generateNgRouterState(v.id,this.browserPageId+1));this.location.go(r,"",k)}}restoreHistory(f,v=!1){if(this.canceledNavigationResolution==="computed"){let r=this.browserPageId,k=this.currentPageId-r;k!==0?this.location.historyGo(k):this.currentUrlTree===f.finalUrl&&k===0&&(this.resetState(f),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(v&&this.resetState(f),this.resetUrlToCurrentUrlTree())}resetState(f){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,f.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(f,v){return this.canceledNavigationResolution==="computed"?{navigationId:f,\u0275routerPageId:v}:{navigationId:f}}};d.\u0275fac=(()=>{let f;return function(r){return(f||(f=Fd(d)))(r||d)}})(),d.\u0275prov=Ti({token:d,factory:d.\u0275fac,providedIn:"root"});let p=d;return p})(),Of=function(p){return p[p.COMPLETE=0]="COMPLETE",p[p.FAILED=1]="FAILED",p[p.REDIRECTING=2]="REDIRECTING",p}(Of||{});function xk(p,d){p.events.pipe(lo(T=>T instanceof xh||T instanceof su||T instanceof Vf||T instanceof wh),qi(T=>T instanceof xh||T instanceof wh?Of.COMPLETE:(T instanceof su?T.code===Qs.Redirect||T.code===Qs.SupersededByNewNavigation:!1)?Of.REDIRECTING:Of.FAILED),lo(T=>T!==Of.REDIRECTING),es(1)).subscribe(()=>{d()})}function wk(p){throw p}var Tk={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Ek={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},nI=(()=>{let d=class d{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=ti(qg),this.stateManager=ti(iI),this.options=ti(eb,{optional:!0})||{},this.pendingTasks=ti(GT),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=ti(gk),this.urlSerializer=ti(H0),this.location=ti(Wg),this.urlHandlingStrategy=ti(ib),this._events=new ir,this.errorHandler=this.options.errorHandler||wk,this.navigated=!1,this.routeReuseStrategy=ti(yk),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=ti(tb,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!ti(Y0,{optional:!0}),this.eventsSubscription=new kd,this.isNgZoneEnabled=ti(_n)instanceof _n&&_n.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:f=>{this.console.warn(f)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let f=this.navigationTransitions.events.subscribe(v=>{try{let r=this.navigationTransitions.currentTransition,k=this.navigationTransitions.currentNavigation;if(r!==null&&k!==null){if(this.stateManager.handleRouterEvent(v,k),v instanceof su&&v.code!==Qs.Redirect&&v.code!==Qs.SupersededByNewNavigation)this.navigated=!0;else if(v instanceof xh)this.navigated=!0;else if(v instanceof Uf){let W=this.urlHandlingStrategy.merge(v.url,r.currentRawUrl),ee={info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||_k(r.source)};this.scheduleNavigation(W,Ff,null,ee,{resolve:r.resolve,reject:r.reject,promise:r.promise})}}Sk(v)&&this._events.next(v)}catch(r){this.navigationTransitions.transitionAbortSubject.next(r)}});this.eventsSubscription.add(f)}resetRootComponentType(f){this.routerState.root.component=f,this.navigationTransitions.rootComponentType=f}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Ff,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((f,v)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(f,"popstate",v)},0)})}navigateToSyncWithBrowser(f,v,r){let k={replaceUrl:!0},W=r?.navigationId?r:null;if(r){let de=Vt({},r);delete de.navigationId,delete de.\u0275routerPageId,Object.keys(de).length!==0&&(k.state=de)}let ee=this.parseUrl(f);this.scheduleNavigation(ee,v,W,k)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(f){this.config=f.map(K0),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(f,v={}){let{relativeTo:r,queryParams:k,fragment:W,queryParamsHandling:ee,preserveFragment:de}=v,Ie=de?this.currentUrlTree.fragment:W,Ne=null;switch(ee){case"merge":Ne=Vt(Vt({},this.currentUrlTree.queryParams),k);break;case"preserve":Ne=this.currentUrlTree.queryParams;break;default:Ne=k||null}Ne!==null&&(Ne=this.removeEmptyProps(Ne));let lt;try{let it=r?r.snapshot:this.routerState.snapshot.root;lt=NE(it)}catch{(typeof f[0]!="string"||!f[0].startsWith("/"))&&(f=[]),lt=this.currentUrlTree.root}return VE(lt,f,Ne,Ie??null)}navigateByUrl(f,v={skipLocationChange:!1}){let r=Zd(f)?f:this.parseUrl(f),k=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(k,Ff,null,v)}navigate(f,v={skipLocationChange:!1}){return Ik(f),this.navigateByUrl(this.createUrlTree(f,v),v)}serializeUrl(f){return this.urlSerializer.serialize(f)}parseUrl(f){try{return this.urlSerializer.parse(f)}catch{return this.urlSerializer.parse("/")}}isActive(f,v){let r;if(v===!0?r=Vt({},Tk):v===!1?r=Vt({},Ek):r=v,Zd(f))return EE(this.currentUrlTree,f,r);let k=this.parseUrl(f);return EE(this.currentUrlTree,k,r)}removeEmptyProps(f){return Object.entries(f).reduce((v,[r,k])=>(k!=null&&(v[r]=k),v),{})}scheduleNavigation(f,v,r,k,W){if(this.disposed)return Promise.resolve(!1);let ee,de,Ie;W?(ee=W.resolve,de=W.reject,Ie=W.promise):Ie=new Promise((lt,it)=>{ee=lt,de=it});let Ne=this.pendingTasks.add();return xk(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(Ne))}),this.navigationTransitions.handleNavigationRequest({source:v,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:f,extras:k,resolve:ee,reject:de,promise:Ie,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),Ie.catch(lt=>Promise.reject(lt))}};d.\u0275fac=function(v){return new(v||d)},d.\u0275prov=Ti({token:d,factory:d.\u0275fac,providedIn:"root"});let p=d;return p})();function Ik(p){for(let d=0;d<p.length;d++)if(p[d]==null)throw new mr(4008,!1)}function Sk(p){return!(p instanceof jf)&&!(p instanceof Uf)}var Mk=new en("");function rI(p,...d){return wf([{provide:tb,multi:!0,useValue:p},[],{provide:Hd,useFactory:Ck,deps:[nI]},{provide:KT,multi:!0,useFactory:Ak},d.map(T=>T.\u0275providers)])}function Ck(p){return p.routerState.root}function Ak(){let p=ti($v);return d=>{let T=p.get(Hv);if(d!==T.components[0])return;let f=p.get(nI),v=p.get(Dk);p.get(Rk)===1&&f.initialNavigation(),p.get(Pk,null,Gv.Optional)?.setUpPreloading(),p.get(Mk,null,Gv.Optional)?.init(),f.resetRootComponentType(T.componentTypes[0]),v.closed||(v.next(),v.complete(),v.unsubscribe())}}var Dk=new en("",{factory:()=>new ir}),Rk=new en("",{providedIn:"root",factory:()=>1});var Pk=new en("");var oI=[];var kk="@",Ok=(()=>{let d=class d{constructor(f,v,r,k,W){this.doc=f,this.delegate=v,this.zone=r,this.animationType=k,this.moduleImpl=W,this._rendererFactoryPromise=null,this.scheduler=ti(BT,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-EWESJHTH.js")).catch(v=>{throw new mr(5300,!1)}).then(({\u0275createEngine:v,\u0275AnimationRendererFactory:r})=>{this._engine=v(this.animationType,this.doc,this.scheduler);let k=new r(this.delegate,this._engine,this.zone);return this.delegate=k,k})}createRenderer(f,v){let r=this.delegate.createRenderer(f,v);if(r.\u0275type===0)return r;typeof r.throwOnSyntheticProps=="boolean"&&(r.throwOnSyntheticProps=!1);let k=new nb(r);return v?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(W=>{let ee=W.createRenderer(f,v);k.use(ee)}).catch(W=>{k.use(r)}),k}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};d.\u0275fac=function(v){Sf()},d.\u0275prov=Ti({token:d,factory:d.\u0275fac});let p=d;return p})(),nb=class{constructor(d){this.delegate=d,this.replay=[],this.\u0275type=1}use(d){if(this.delegate=d,this.replay!==null){for(let T of this.replay)T(d);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(d,T){return this.delegate.createElement(d,T)}createComment(d){return this.delegate.createComment(d)}createText(d){return this.delegate.createText(d)}get destroyNode(){return this.delegate.destroyNode}appendChild(d,T){this.delegate.appendChild(d,T)}insertBefore(d,T,f,v){this.delegate.insertBefore(d,T,f,v)}removeChild(d,T,f){this.delegate.removeChild(d,T,f)}selectRootElement(d,T){return this.delegate.selectRootElement(d,T)}parentNode(d){return this.delegate.parentNode(d)}nextSibling(d){return this.delegate.nextSibling(d)}setAttribute(d,T,f,v){this.delegate.setAttribute(d,T,f,v)}removeAttribute(d,T,f){this.delegate.removeAttribute(d,T,f)}addClass(d,T){this.delegate.addClass(d,T)}removeClass(d,T){this.delegate.removeClass(d,T)}setStyle(d,T,f,v){this.delegate.setStyle(d,T,f,v)}removeStyle(d,T,f){this.delegate.removeStyle(d,T,f)}setProperty(d,T,f){this.shouldReplay(T)&&this.replay.push(v=>v.setProperty(d,T,f)),this.delegate.setProperty(d,T,f)}setValue(d,T){this.delegate.setValue(d,T)}listen(d,T,f){return this.shouldReplay(T)&&this.replay.push(v=>v.listen(d,T,f)),this.delegate.listen(d,T,f)}shouldReplay(d){return this.replay!==null&&d.startsWith(kk)}};function sI(p="animations"){return NT("NgAsyncAnimations"),wf([{provide:jg,useFactory:(d,T,f)=>new Ok(d,T,f,p),deps:[zn,Qg,_n]},{provide:xa,useValue:p==="noop"?"NoopAnimations":"BrowserAnimations"}])}var aI={providers:[rI(oI),sI()]};var mI=(()=>{let d=class d{constructor(f,v){this._renderer=f,this._elementRef=v,this.onChange=r=>{},this.onTouched=()=>{}}setProperty(f,v){this._renderer.setProperty(this._elementRef.nativeElement,f,v)}registerOnTouched(f){this.onTouched=f}registerOnChange(f){this.onChange=f}setDisabledState(f){this.setProperty("disabled",f)}};d.\u0275fac=function(v){return new(v||d)(zt(Ug),zt(nr))},d.\u0275dir=uo({type:d});let p=d;return p})(),Lk=(()=>{let d=class d extends mI{};d.\u0275fac=(()=>{let f;return function(r){return(f||(f=Fd(d)))(r||d)}})(),d.\u0275dir=uo({type:d,features:[wa]});let p=d;return p})(),g_=new en("");var Fk={provide:g_,useExisting:dh(()=>__),multi:!0};function zk(){let p=Vd()?Vd().getUserAgent():"";return/android (\d+)/.test(p.toLowerCase())}var Bk=new en(""),__=(()=>{let d=class d extends mI{constructor(f,v,r){super(f,v),this._compositionMode=r,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!zk())}writeValue(f){let v=f??"";this.setProperty("value",v)}_handleInput(f){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(f)}_compositionStart(){this._composing=!0}_compositionEnd(f){this._composing=!1,this._compositionMode&&this.onChange(f)}};d.\u0275fac=function(v){return new(v||d)(zt(Ug),zt(nr),zt(Bk,8))},d.\u0275dir=uo({type:d,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(v,r){v&1&&ts("input",function(W){return r._handleInput(W.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(W){return r._compositionEnd(W.target.value)})},features:[Zs([Fk]),wa]});let p=d;return p})();var Nk=new en(""),Vk=new en("");function gI(p){return p!=null}function _I(p){return $g(p)?Ss(p):p}function yI(p){let d={};return p.forEach(T=>{d=T!=null?Vt(Vt({},d),T):d}),Object.keys(d).length===0?null:d}function vI(p,d){return d.map(T=>T(p))}function jk(p){return!p.validate}function bI(p){return p.map(d=>jk(d)?d:T=>d.validate(T))}function Uk(p){if(!p)return null;let d=p.filter(gI);return d.length==0?null:function(T){return yI(vI(T,d))}}function xI(p){return p!=null?Uk(bI(p)):null}function Gk(p){if(!p)return null;let d=p.filter(gI);return d.length==0?null:function(T){let f=vI(T,d).map(_I);return Bg(f).pipe(qi(yI))}}function wI(p){return p!=null?Gk(bI(p)):null}function lI(p,d){return p===null?[d]:Array.isArray(p)?[...p,d]:[p,d]}function qk(p){return p._rawValidators}function $k(p){return p._rawAsyncValidators}function rb(p){return p?Array.isArray(p)?p:[p]:[]}function f_(p,d){return Array.isArray(p)?p.includes(d):p===d}function cI(p,d){let T=rb(d);return rb(p).forEach(v=>{f_(T,v)||T.push(v)}),T}function uI(p,d){return rb(d).filter(T=>!f_(p,T))}var m_=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(d){this._rawValidators=d||[],this._composedValidatorFn=xI(this._rawValidators)}_setAsyncValidators(d){this._rawAsyncValidators=d||[],this._composedAsyncValidatorFn=wI(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(d){this._onDestroyCallbacks.push(d)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(d=>d()),this._onDestroyCallbacks=[]}reset(d=void 0){this.control&&this.control.reset(d)}hasError(d,T){return this.control?this.control.hasError(d,T):!1}getError(d,T){return this.control?this.control.getError(d,T):null}},ob=class extends m_{get formDirective(){return null}get path(){return null}},Yf=class extends m_{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},sb=class{constructor(d){this._cd=d}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},Wk={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},L3=fr(Vt({},Wk),{"[class.ng-submitted]":"isSubmitted"}),TI=(()=>{let d=class d extends sb{constructor(f){super(f)}};d.\u0275fac=function(v){return new(v||d)(zt(Yf,2))},d.\u0275dir=uo({type:d,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(v,r){v&2&&po("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},features:[wa]});let p=d;return p})();var Qf="VALID",p_="INVALID",Yd="PENDING",Xf="DISABLED";function Zk(p){return(y_(p)?p.validators:p)||null}function Hk(p){return Array.isArray(p)?xI(p):p||null}function Qk(p,d){return(y_(d)?d.asyncValidators:p)||null}function Xk(p){return Array.isArray(p)?wI(p):p||null}function y_(p){return p!=null&&!Array.isArray(p)&&typeof p=="object"}var ab=class{constructor(d,T){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(d),this._assignAsyncValidators(T)}get validator(){return this._composedValidatorFn}set validator(d){this._rawValidators=this._composedValidatorFn=d}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(d){this._rawAsyncValidators=this._composedAsyncValidatorFn=d}get parent(){return this._parent}get valid(){return this.status===Qf}get invalid(){return this.status===p_}get pending(){return this.status==Yd}get disabled(){return this.status===Xf}get enabled(){return this.status!==Xf}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(d){this._assignValidators(d)}setAsyncValidators(d){this._assignAsyncValidators(d)}addValidators(d){this.setValidators(cI(d,this._rawValidators))}addAsyncValidators(d){this.setAsyncValidators(cI(d,this._rawAsyncValidators))}removeValidators(d){this.setValidators(uI(d,this._rawValidators))}removeAsyncValidators(d){this.setAsyncValidators(uI(d,this._rawAsyncValidators))}hasValidator(d){return f_(this._rawValidators,d)}hasAsyncValidator(d){return f_(this._rawAsyncValidators,d)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(d={}){this.touched=!0,this._parent&&!d.onlySelf&&this._parent.markAsTouched(d)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(d=>d.markAllAsTouched())}markAsUntouched(d={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(T=>{T.markAsUntouched({onlySelf:!0})}),this._parent&&!d.onlySelf&&this._parent._updateTouched(d)}markAsDirty(d={}){this.pristine=!1,this._parent&&!d.onlySelf&&this._parent.markAsDirty(d)}markAsPristine(d={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(T=>{T.markAsPristine({onlySelf:!0})}),this._parent&&!d.onlySelf&&this._parent._updatePristine(d)}markAsPending(d={}){this.status=Yd,d.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!d.onlySelf&&this._parent.markAsPending(d)}disable(d={}){let T=this._parentMarkedDirty(d.onlySelf);this.status=Xf,this.errors=null,this._forEachChild(f=>{f.disable(fr(Vt({},d),{onlySelf:!0}))}),this._updateValue(),d.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(fr(Vt({},d),{skipPristineCheck:T})),this._onDisabledChange.forEach(f=>f(!0))}enable(d={}){let T=this._parentMarkedDirty(d.onlySelf);this.status=Qf,this._forEachChild(f=>{f.enable(fr(Vt({},d),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:d.emitEvent}),this._updateAncestors(fr(Vt({},d),{skipPristineCheck:T})),this._onDisabledChange.forEach(f=>f(!1))}_updateAncestors(d){this._parent&&!d.onlySelf&&(this._parent.updateValueAndValidity(d),d.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(d){this._parent=d}getRawValue(){return this.value}updateValueAndValidity(d={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Qf||this.status===Yd)&&this._runAsyncValidator(d.emitEvent)),d.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!d.onlySelf&&this._parent.updateValueAndValidity(d)}_updateTreeValidity(d={emitEvent:!0}){this._forEachChild(T=>T._updateTreeValidity(d)),this.updateValueAndValidity({onlySelf:!0,emitEvent:d.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Xf:Qf}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(d){if(this.asyncValidator){this.status=Yd,this._hasOwnPendingAsyncValidator=!0;let T=_I(this.asyncValidator(this));this._asyncValidationSubscription=T.subscribe(f=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(f,{emitEvent:d})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(d,T={}){this.errors=d,this._updateControlsErrors(T.emitEvent!==!1)}get(d){let T=d;return T==null||(Array.isArray(T)||(T=T.split(".")),T.length===0)?null:T.reduce((f,v)=>f&&f._find(v),this)}getError(d,T){let f=T?this.get(T):this;return f&&f.errors?f.errors[d]:null}hasError(d,T){return!!this.getError(d,T)}get root(){let d=this;for(;d._parent;)d=d._parent;return d}_updateControlsErrors(d){this.status=this._calculateStatus(),d&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(d)}_initObservables(){this.valueChanges=new Or,this.statusChanges=new Or}_calculateStatus(){return this._allControlsDisabled()?Xf:this.errors?p_:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Yd)?Yd:this._anyControlsHaveStatus(p_)?p_:Qf}_anyControlsHaveStatus(d){return this._anyControls(T=>T.status===d)}_anyControlsDirty(){return this._anyControls(d=>d.dirty)}_anyControlsTouched(){return this._anyControls(d=>d.touched)}_updatePristine(d={}){this.pristine=!this._anyControlsDirty(),this._parent&&!d.onlySelf&&this._parent._updatePristine(d)}_updateTouched(d={}){this.touched=this._anyControlsTouched(),this._parent&&!d.onlySelf&&this._parent._updateTouched(d)}_registerOnCollectionChange(d){this._onCollectionChange=d}_setUpdateStrategy(d){y_(d)&&d.updateOn!=null&&(this._updateOn=d.updateOn)}_parentMarkedDirty(d){let T=this._parent&&this._parent.dirty;return!d&&!!T&&!this._parent._anyControlsDirty()}_find(d){return null}_assignValidators(d){this._rawValidators=Array.isArray(d)?d.slice():d,this._composedValidatorFn=Hk(this._rawValidators)}_assignAsyncValidators(d){this._rawAsyncValidators=Array.isArray(d)?d.slice():d,this._composedAsyncValidatorFn=Xk(this._rawAsyncValidators)}};var EI=new en("CallSetDisabledState",{providedIn:"root",factory:()=>lb}),lb="always";function Yk(p,d){return[...d.path,p]}function Kk(p,d,T=lb){eO(p,d),d.valueAccessor.writeValue(p.value),(p.disabled||T==="always")&&d.valueAccessor.setDisabledState?.(p.disabled),tO(p,d),nO(p,d),iO(p,d),Jk(p,d)}function hI(p,d){p.forEach(T=>{T.registerOnValidatorChange&&T.registerOnValidatorChange(d)})}function Jk(p,d){if(d.valueAccessor.setDisabledState){let T=f=>{d.valueAccessor.setDisabledState(f)};p.registerOnDisabledChange(T),d._registerOnDestroy(()=>{p._unregisterOnDisabledChange(T)})}}function eO(p,d){let T=qk(p);d.validator!==null?p.setValidators(lI(T,d.validator)):typeof T=="function"&&p.setValidators([T]);let f=$k(p);d.asyncValidator!==null?p.setAsyncValidators(lI(f,d.asyncValidator)):typeof f=="function"&&p.setAsyncValidators([f]);let v=()=>p.updateValueAndValidity();hI(d._rawValidators,v),hI(d._rawAsyncValidators,v)}function tO(p,d){d.valueAccessor.registerOnChange(T=>{p._pendingValue=T,p._pendingChange=!0,p._pendingDirty=!0,p.updateOn==="change"&&II(p,d)})}function iO(p,d){d.valueAccessor.registerOnTouched(()=>{p._pendingTouched=!0,p.updateOn==="blur"&&p._pendingChange&&II(p,d),p.updateOn!=="submit"&&p.markAsTouched()})}function II(p,d){p._pendingDirty&&p.markAsDirty(),p.setValue(p._pendingValue,{emitModelToViewChange:!1}),d.viewToModelUpdate(p._pendingValue),p._pendingChange=!1}function nO(p,d){let T=(f,v)=>{d.valueAccessor.writeValue(f),v&&d.viewToModelUpdate(f)};p.registerOnChange(T),d._registerOnDestroy(()=>{p._unregisterOnChange(T)})}function rO(p,d){if(!p.hasOwnProperty("model"))return!1;let T=p.model;return T.isFirstChange()?!0:!Object.is(d,T.currentValue)}function oO(p){return Object.getPrototypeOf(p.constructor)===Lk}function sO(p,d){if(!d)return null;Array.isArray(d);let T,f,v;return d.forEach(r=>{r.constructor===__?T=r:oO(r)?f=r:v=r}),v||f||T||null}function dI(p,d){let T=p.indexOf(d);T>-1&&p.splice(T,1)}function pI(p){return typeof p=="object"&&p!==null&&Object.keys(p).length===2&&"value"in p&&"disabled"in p}var aO=class extends ab{constructor(d=null,T,f){super(Zk(T),Qk(f,T)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(d),this._setUpdateStrategy(T),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),y_(T)&&(T.nonNullable||T.initialValueIsDefault)&&(pI(d)?this.defaultValue=d.value:this.defaultValue=d)}setValue(d,T={}){this.value=this._pendingValue=d,this._onChange.length&&T.emitModelToViewChange!==!1&&this._onChange.forEach(f=>f(this.value,T.emitViewToModelChange!==!1)),this.updateValueAndValidity(T)}patchValue(d,T={}){this.setValue(d,T)}reset(d=this.defaultValue,T={}){this._applyFormState(d),this.markAsPristine(T),this.markAsUntouched(T),this.setValue(this.value,T),this._pendingChange=!1}_updateValue(){}_anyControls(d){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(d){this._onChange.push(d)}_unregisterOnChange(d){dI(this._onChange,d)}registerOnDisabledChange(d){this._onDisabledChange.push(d)}_unregisterOnDisabledChange(d){dI(this._onDisabledChange,d)}_forEachChild(d){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(d){pI(d)?(this.value=this._pendingValue=d.value,d.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=d}};var lO={provide:Yf,useExisting:dh(()=>cb)},fI=Promise.resolve(),cb=(()=>{let d=class d extends Yf{constructor(f,v,r,k,W,ee){super(),this._changeDetectorRef=W,this.callSetDisabledState=ee,this.control=new aO,this._registered=!1,this.name="",this.update=new Or,this._parent=f,this._setValidators(v),this._setAsyncValidators(r),this.valueAccessor=sO(this,k)}ngOnChanges(f){if(this._checkForErrors(),!this._registered||"name"in f){if(this._registered&&(this._checkName(),this.formDirective)){let v=f.name.previousValue;this.formDirective.removeControl({name:v,path:this._getPath(v)})}this._setUpControl()}"isDisabled"in f&&this._updateDisabled(f),rO(f,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(f){this.viewModel=f,this.update.emit(f)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){Kk(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(f){fI.then(()=>{this.control.setValue(f,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(f){let v=f.isDisabled.currentValue,r=v!==0&&io(v);fI.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(f){return this._parent?Yk(f,this._parent):[f]}};d.\u0275fac=function(v){return new(v||d)(zt(ob,9),zt(Nk,10),zt(Vk,10),zt(g_,10),zt(Ms,8),zt(EI,8))},d.\u0275dir=uo({type:d,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[An.None,"disabled","isDisabled"],model:[An.None,"ngModel","model"],options:[An.None,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Zs([lO]),wa,Ld]});let p=d;return p})();var cO=(()=>{let d=class d{};d.\u0275fac=function(v){return new(v||d)},d.\u0275mod=_r({type:d}),d.\u0275inj=gr({});let p=d;return p})();var v_=(()=>{let d=class d{static withConfig(f){return{ngModule:d,providers:[{provide:EI,useValue:f.callSetDisabledState??lb}]}}};d.\u0275fac=function(v){return new(v||d)},d.\u0275mod=_r({type:d}),d.\u0275inj=gr({imports:[cO]});let p=d;return p})();var ub={mapbox:{accessToken:"pk.eyJ1IjoibWFyb29uZWRpb25lIiwiYSI6ImNqdmp0MzB1azBpcDAzem1naHZwMjNndGIifQ.65nvvRg9QeFUV2c6b9W4Vw"}};var DM=Lv(SI()),RM=Lv(MM()),C_=Lv(AM());var A_=(()=>{let d=class d{constructor(){this.poligonHeight=0,this.selectedFeatureIds=[],this.mapStyles={Standart:"mapbox://styles/mapbox/standard",Streets:"mapbox://styles/mapbox/streets-v11",Outdoors:"mapbox://styles/mapbox/outdoors-v11",Light:"mapbox://styles/mapbox/light-v10",Dark:"mapbox://styles/mapbox/dark-v10",Satellite:"mapbox://styles/mapbox/satellite-v9","Satellite Streets":"mapbox://styles/mapbox/satellite-streets-v11"},this.selectedStyle="Streets"}createMap(f){this.map=new C_.default.Map({accessToken:ub.mapbox.accessToken,container:f.nativeElement,center:[37.618423,55.751244],doubleClickZoom:!0,zoom:17}),this.addMapListeners()}addMapListeners(){this.map.on("load",()=>{this.initializeTools(),this.initializePolygons(),this.loadPolygonsFromLocalStorage()}),this.map.on("draw.create",this.updatePolygonLayer.bind(this)),this.map.on("draw.update",this.updatePolygonLayer.bind(this)),this.map.on("draw.selectionchange",this.onSelectionChange.bind(this))}initializeTools(){this.draw=new DM.default({displayControlsDefault:!1}),this.map.addControl(this.draw),this.map.addControl(new C_.default.NavigationControl,"top-right"),this.map.addControl(new RM.default({accessToken:ub.mapbox.accessToken,mapboxgl:C_.default}),"top-left")}initializePolygons(){this.map.addSource("polygons",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.map.addLayer({id:"polygons-layer",type:"fill-extrusion",source:"polygons",paint:{"fill-extrusion-color":"#888","fill-extrusion-height":["get","height"],"fill-extrusion-base":0,"fill-extrusion-opacity":.6}})}loadPolygonsFromLocalStorage(){let f=localStorage.getItem("drawData");f&&this.saveDrawData(JSON.parse(f),!1)}setExtrudeHeight(f){let v=this.draw.getAll();v.features.length&&this.selectedFeatureIds.length&&(v.features.forEach(r=>{this.selectedFeatureIds.includes(r.id)&&(r.properties=r.properties||{},r.properties.height=f)}),this.saveDrawData(v))}onSelectionChange(f){f.features.length>0?this.selectedFeatureIds=f.features.map(v=>v.id):this.selectedFeatureIds=[]}updatePolygonLayer(){let f=this.draw.getAll();this.saveDrawData(f)}saveDrawData(f,v=!0){this.draw.set(f),this.map.getSource("polygons").setData(f),v&&localStorage.setItem("drawData",JSON.stringify(f))}};d.\u0275fac=function(v){return new(v||d)},d.\u0275prov=Ti({token:d,factory:d.\u0275fac,providedIn:"root"});let p=d;return p})();var HL=["mapElement"],kM=(()=>{let d=class d{constructor(f){this.mapService=f,this.poligonHeight=0,this.selectedFeatureIds=[]}ngAfterViewInit(){this.mapService.createMap(this.mapElement)}};d.\u0275fac=function(v){return new(v||d)(zt(A_))},d.\u0275cmp=Ar({type:d,selectors:[["app-map"]],viewQuery:function(v,r){if(v&1&&Ws(HL,5),v&2){let k;fo(k=mo())&&(r.mapElement=k.first)}},standalone:!0,features:[Dr],decls:2,vars:0,consts:[["mapElement",""],["id","map",1,"map"]],template:function(v,r){v&1&&Qn(0,"div",1,0)},dependencies:[Xv,v_],styles:[".map[_ngcontent-%COMP%]{width:100%;height:100vh;background-color:#00000020}"],changeDetection:0});let p=d;return p})();var Pb;try{Pb=typeof Intl<"u"&&Intl.v8BreakIterator}catch{Pb=!1}var lr=(()=>{let d=class d{constructor(f){this._platformId=f,this.isBrowser=this._platformId?rE(this._platformId):typeof document=="object"&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!!(window.chrome||Pb)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}};d.\u0275fac=function(v){return new(v||d)(Jt(mh))},d.\u0275prov=Ti({token:d,factory:d.\u0275fac,providedIn:"root"});let p=d;return p})();var tm;function QL(){if(tm==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>tm=!0}))}finally{tm=tm||!1}return tm}function tp(p){return QL()?p:!!p.capture}var nl=function(p){return p[p.NORMAL=0]="NORMAL",p[p.NEGATED=1]="NEGATED",p[p.INVERTED=2]="INVERTED",p}(nl||{}),D_,Sh;function OM(){if(Sh==null){if(typeof document!="object"||!document||typeof Element!="function"||!Element)return Sh=!1,Sh;if("scrollBehavior"in document.documentElement.style)Sh=!0;else{let p=Element.prototype.scrollTo;p?Sh=!/\{\s*\[native code\]\s*\}/.test(p.toString()):Sh=!1}}return Sh}function ip(){if(typeof document!="object"||!document)return nl.NORMAL;if(D_==null){let p=document.createElement("div"),d=p.style;p.dir="rtl",d.width="1px",d.overflow="auto",d.visibility="hidden",d.pointerEvents="none",d.position="absolute";let T=document.createElement("div"),f=T.style;f.width="2px",f.height="1px",p.appendChild(T),document.body.appendChild(p),D_=nl.NORMAL,p.scrollLeft===0&&(p.scrollLeft=1,D_=p.scrollLeft===0?nl.NEGATED:nl.INVERTED),p.remove()}return D_}var Rb;function XL(){if(Rb==null){let p=typeof document<"u"?document.head:null;Rb=!!(p&&(p.createShadowRoot||p.attachShadow))}return Rb}function LM(p){if(XL()){let d=p.getRootNode?p.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&d instanceof ShadowRoot)return d}return null}function hu(p){return p.composedPath?p.composedPath()[0]:p.target}function FM(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function zM(p,...d){return d.length?d.some(T=>p[T]):p.altKey||p.shiftKey||p.ctrlKey||p.metaKey}function Mh(p){return p!=null&&`${p}`!="false"}function kb(p){return Array.isArray(p)?p:[p]}function ac(p){return p instanceof nr?p.nativeElement:p}var BM=new Set,Ch,YL=(()=>{let d=class d{constructor(f,v){this._platform=f,this._nonce=v,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):JL}matchMedia(f){return(this._platform.WEBKIT||this._platform.BLINK)&&KL(f,this._nonce),this._matchMedia(f)}};d.\u0275fac=function(v){return new(v||d)(Jt(lr),Jt(Ef,8))},d.\u0275prov=Ti({token:d,factory:d.\u0275fac,providedIn:"root"});let p=d;return p})();function KL(p,d){if(!BM.has(p))try{Ch||(Ch=document.createElement("style"),d&&Ch.setAttribute("nonce",d),Ch.setAttribute("type","text/css"),document.head.appendChild(Ch)),Ch.sheet&&(Ch.sheet.insertRule(`@media ${p} {body{ }}`,0),BM.add(p))}catch(T){console.error(T)}}function JL(p){return{matches:p==="all"||p==="",media:p,addListener:()=>{},removeListener:()=>{}}}var VM=(()=>{let d=class d{constructor(f,v){this._mediaMatcher=f,this._zone=v,this._queries=new Map,this._destroySubject=new ir}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(f){return NM(kb(f)).some(r=>this._registerQuery(r).mql.matches)}observe(f){let r=NM(kb(f)).map(W=>this._registerQuery(W).observable),k=gf(r);return k=zg(k.pipe(es(1)),k.pipe(Ng(1),yf(0))),k.pipe(qi(W=>{let ee={matches:!1,breakpoints:{}};return W.forEach(({matches:de,query:Ie})=>{ee.matches=ee.matches||de,ee.breakpoints[Ie]=de}),ee}))}_registerQuery(f){if(this._queries.has(f))return this._queries.get(f);let v=this._mediaMatcher.matchMedia(f),k={observable:new Od(W=>{let ee=de=>this._zone.run(()=>W.next(de));return v.addListener(ee),()=>{v.removeListener(ee)}}).pipe(iu(v),qi(({matches:W})=>({query:f,matches:W})),co(this._destroySubject)),mql:v};return this._queries.set(f,k),k}};d.\u0275fac=function(v){return new(v||d)(Jt(YL),Jt(_n))},d.\u0275prov=Ti({token:d,factory:d.\u0275fac,providedIn:"root"});let p=d;return p})();function NM(p){return p.map(d=>d.split(",")).reduce((d,T)=>d.concat(T)).map(d=>d.trim())}var Fb=(()=>{let d=class d{constructor(f){this._platform=f}isDisabled(f){return f.hasAttribute("disabled")}isVisible(f){return tF(f)&&getComputedStyle(f).visibility==="visible"}isTabbable(f){if(!this._platform.isBrowser)return!1;let v=eF(cF(f));if(v&&(jM(v)===-1||!this.isVisible(v)))return!1;let r=f.nodeName.toLowerCase(),k=jM(f);return f.hasAttribute("contenteditable")?k!==-1:r==="iframe"||r==="object"||this._platform.WEBKIT&&this._platform.IOS&&!aF(f)?!1:r==="audio"?f.hasAttribute("controls")?k!==-1:!1:r==="video"?k===-1?!1:k!==null?!0:this._platform.FIREFOX||f.hasAttribute("controls"):f.tabIndex>=0}isFocusable(f,v){return lF(f)&&!this.isDisabled(f)&&(v?.ignoreVisibility||this.isVisible(f))}};d.\u0275fac=function(v){return new(v||d)(Jt(lr))},d.\u0275prov=Ti({token:d,factory:d.\u0275fac,providedIn:"root"});let p=d;return p})();function eF(p){try{return p.frameElement}catch{return null}}function tF(p){return!!(p.offsetWidth||p.offsetHeight||typeof p.getClientRects=="function"&&p.getClientRects().length)}function iF(p){let d=p.nodeName.toLowerCase();return d==="input"||d==="select"||d==="button"||d==="textarea"}function nF(p){return oF(p)&&p.type=="hidden"}function rF(p){return sF(p)&&p.hasAttribute("href")}function oF(p){return p.nodeName.toLowerCase()=="input"}function sF(p){return p.nodeName.toLowerCase()=="a"}function qM(p){if(!p.hasAttribute("tabindex")||p.tabIndex===void 0)return!1;let d=p.getAttribute("tabindex");return!!(d&&!isNaN(parseInt(d,10)))}function jM(p){if(!qM(p))return null;let d=parseInt(p.getAttribute("tabindex")||"",10);return isNaN(d)?-1:d}function aF(p){let d=p.nodeName.toLowerCase(),T=d==="input"&&p.type;return T==="text"||T==="password"||d==="select"||d==="textarea"}function lF(p){return nF(p)?!1:iF(p)||rF(p)||p.hasAttribute("contenteditable")||qM(p)}function cF(p){return p.ownerDocument&&p.ownerDocument.defaultView||window}var Lb=class{get enabled(){return this._enabled}set enabled(d){this._enabled=d,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(d,this._startAnchor),this._toggleAnchorTabIndex(d,this._endAnchor))}constructor(d,T,f,v,r=!1){this._element=d,this._checker=T,this._ngZone=f,this._document=v,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,r||this.attachAnchors()}destroy(){let d=this._startAnchor,T=this._endAnchor;d&&(d.removeEventListener("focus",this.startAnchorListener),d.remove()),T&&(T.removeEventListener("focus",this.endAnchorListener),T.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return this._hasAttached?!0:(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(d){return new Promise(T=>{this._executeOnStable(()=>T(this.focusInitialElement(d)))})}focusFirstTabbableElementWhenReady(d){return new Promise(T=>{this._executeOnStable(()=>T(this.focusFirstTabbableElement(d)))})}focusLastTabbableElementWhenReady(d){return new Promise(T=>{this._executeOnStable(()=>T(this.focusLastTabbableElement(d)))})}_getRegionBoundary(d){let T=this._element.querySelectorAll(`[cdk-focus-region-${d}], [cdkFocusRegion${d}], [cdk-focus-${d}]`);return d=="start"?T.length?T[0]:this._getFirstTabbableElement(this._element):T.length?T[T.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(d){let T=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(T){if(!this._checker.isFocusable(T)){let f=this._getFirstTabbableElement(T);return f?.focus(d),!!f}return T.focus(d),!0}return this.focusFirstTabbableElement(d)}focusFirstTabbableElement(d){let T=this._getRegionBoundary("start");return T&&T.focus(d),!!T}focusLastTabbableElement(d){let T=this._getRegionBoundary("end");return T&&T.focus(d),!!T}hasAttached(){return this._hasAttached}_getFirstTabbableElement(d){if(this._checker.isFocusable(d)&&this._checker.isTabbable(d))return d;let T=d.children;for(let f=0;f<T.length;f++){let v=T[f].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(T[f]):null;if(v)return v}return null}_getLastTabbableElement(d){if(this._checker.isFocusable(d)&&this._checker.isTabbable(d))return d;let T=d.children;for(let f=T.length-1;f>=0;f--){let v=T[f].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(T[f]):null;if(v)return v}return null}_createAnchor(){let d=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,d),d.classList.add("cdk-visually-hidden"),d.classList.add("cdk-focus-trap-anchor"),d.setAttribute("aria-hidden","true"),d}_toggleAnchorTabIndex(d,T){d?T.setAttribute("tabindex","0"):T.removeAttribute("tabindex")}toggleAnchors(d){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(d,this._startAnchor),this._toggleAnchorTabIndex(d,this._endAnchor))}_executeOnStable(d){this._ngZone.isStable?d():this._ngZone.onStable.pipe(es(1)).subscribe(d)}},$M=(()=>{let d=class d{constructor(f,v,r){this._checker=f,this._ngZone=v,this._document=r}create(f,v=!1){return new Lb(f,this._checker,this._ngZone,this._document,v)}};d.\u0275fac=function(v){return new(v||d)(Jt(Fb),Jt(_n),Jt(zn))},d.\u0275prov=Ti({token:d,factory:d.\u0275fac,providedIn:"root"});let p=d;return p})();function zb(p){return p.buttons===0||p.detail===0}function Bb(p){let d=p.touches&&p.touches[0]||p.changedTouches&&p.changedTouches[0];return!!d&&d.identifier===-1&&(d.radiusX==null||d.radiusX===1)&&(d.radiusY==null||d.radiusY===1)}var uF=new en("cdk-input-modality-detector-options"),hF={ignoreKeys:[18,17,224,91,16]},WM=650,rp=tp({passive:!0,capture:!0}),dF=(()=>{let d=class d{get mostRecentModality(){return this._modality.value}constructor(f,v,r,k){this._platform=f,this._mostRecentTarget=null,this._modality=new Is(null),this._lastTouchMs=0,this._onKeydown=W=>{this._options?.ignoreKeys?.some(ee=>ee===W.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=hu(W))},this._onMousedown=W=>{Date.now()-this._lastTouchMs<WM||(this._modality.next(zb(W)?"keyboard":"mouse"),this._mostRecentTarget=hu(W))},this._onTouchstart=W=>{if(Bb(W)){this._modality.next("keyboard");return}this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=hu(W)},this._options=Vt(Vt({},hF),k),this.modalityDetected=this._modality.pipe(Ng(1)),this.modalityChanged=this.modalityDetected.pipe(bf()),f.isBrowser&&v.runOutsideAngular(()=>{r.addEventListener("keydown",this._onKeydown,rp),r.addEventListener("mousedown",this._onMousedown,rp),r.addEventListener("touchstart",this._onTouchstart,rp)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,rp),document.removeEventListener("mousedown",this._onMousedown,rp),document.removeEventListener("touchstart",this._onTouchstart,rp))}};d.\u0275fac=function(v){return new(v||d)(Jt(lr),Jt(_n),Jt(zn),Jt(uF,8))},d.\u0275prov=Ti({token:d,factory:d.\u0275fac,providedIn:"root"});let p=d;return p})();var P_=function(p){return p[p.IMMEDIATE=0]="IMMEDIATE",p[p.EVENTUAL=1]="EVENTUAL",p}(P_||{}),pF=new en("cdk-focus-monitor-default-options"),R_=tp({passive:!0,capture:!0}),k_=(()=>{let d=class d{constructor(f,v,r,k,W){this._ngZone=f,this._platform=v,this._inputModalityDetector=r,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new ir,this._rootNodeFocusAndBlurListener=ee=>{let de=hu(ee);for(let Ie=de;Ie;Ie=Ie.parentElement)ee.type==="focus"?this._onFocus(ee,Ie):this._onBlur(ee,Ie)},this._document=k,this._detectionMode=W?.detectionMode||P_.IMMEDIATE}monitor(f,v=!1){let r=ac(f);if(!this._platform.isBrowser||r.nodeType!==1)return _i();let k=LM(r)||this._getDocument(),W=this._elementInfo.get(r);if(W)return v&&(W.checkChildren=!0),W.subject;let ee={checkChildren:v,subject:new ir,rootNode:k};return this._elementInfo.set(r,ee),this._registerGlobalListeners(ee),ee.subject}stopMonitoring(f){let v=ac(f),r=this._elementInfo.get(v);r&&(r.subject.complete(),this._setClasses(v),this._elementInfo.delete(v),this._removeGlobalListeners(r))}focusVia(f,v,r){let k=ac(f),W=this._getDocument().activeElement;k===W?this._getClosestElementsInfo(k).forEach(([ee,de])=>this._originChanged(ee,v,de)):(this._setOrigin(v),typeof k.focus=="function"&&k.focus(r))}ngOnDestroy(){this._elementInfo.forEach((f,v)=>this.stopMonitoring(v))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(f){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(f)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:f&&this._isLastInteractionFromInputLabel(f)?"mouse":"program"}_shouldBeAttributedToTouch(f){return this._detectionMode===P_.EVENTUAL||!!f?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(f,v){f.classList.toggle("cdk-focused",!!v),f.classList.toggle("cdk-touch-focused",v==="touch"),f.classList.toggle("cdk-keyboard-focused",v==="keyboard"),f.classList.toggle("cdk-mouse-focused",v==="mouse"),f.classList.toggle("cdk-program-focused",v==="program")}_setOrigin(f,v=!1){this._ngZone.runOutsideAngular(()=>{if(this._origin=f,this._originFromTouchInteraction=f==="touch"&&v,this._detectionMode===P_.IMMEDIATE){clearTimeout(this._originTimeoutId);let r=this._originFromTouchInteraction?WM:1;this._originTimeoutId=setTimeout(()=>this._origin=null,r)}})}_onFocus(f,v){let r=this._elementInfo.get(v),k=hu(f);!r||!r.checkChildren&&v!==k||this._originChanged(v,this._getFocusOrigin(k),r)}_onBlur(f,v){let r=this._elementInfo.get(v);!r||r.checkChildren&&f.relatedTarget instanceof Node&&v.contains(f.relatedTarget)||(this._setClasses(v),this._emitOrigin(r,null))}_emitOrigin(f,v){f.subject.observers.length&&this._ngZone.run(()=>f.subject.next(v))}_registerGlobalListeners(f){if(!this._platform.isBrowser)return;let v=f.rootNode,r=this._rootNodeFocusListenerCount.get(v)||0;r||this._ngZone.runOutsideAngular(()=>{v.addEventListener("focus",this._rootNodeFocusAndBlurListener,R_),v.addEventListener("blur",this._rootNodeFocusAndBlurListener,R_)}),this._rootNodeFocusListenerCount.set(v,r+1),++this._monitoredElementCount===1&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(co(this._stopInputModalityDetector)).subscribe(k=>{this._setOrigin(k,!0)}))}_removeGlobalListeners(f){let v=f.rootNode;if(this._rootNodeFocusListenerCount.has(v)){let r=this._rootNodeFocusListenerCount.get(v);r>1?this._rootNodeFocusListenerCount.set(v,r-1):(v.removeEventListener("focus",this._rootNodeFocusAndBlurListener,R_),v.removeEventListener("blur",this._rootNodeFocusAndBlurListener,R_),this._rootNodeFocusListenerCount.delete(v))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(f,v,r){this._setClasses(f,v),this._emitOrigin(r,v),this._lastFocusOrigin=v}_getClosestElementsInfo(f){let v=[];return this._elementInfo.forEach((r,k)=>{(k===f||r.checkChildren&&k.contains(f))&&v.push([k,r])}),v}_isLastInteractionFromInputLabel(f){let{_mostRecentTarget:v,mostRecentModality:r}=this._inputModalityDetector;if(r!=="mouse"||!v||v===f||f.nodeName!=="INPUT"&&f.nodeName!=="TEXTAREA"||f.disabled)return!1;let k=f.labels;if(k){for(let W=0;W<k.length;W++)if(k[W].contains(v))return!0}return!1}};d.\u0275fac=function(v){return new(v||d)(Jt(_n),Jt(lr),Jt(dF),Jt(zn,8),Jt(pF,8))},d.\u0275prov=Ti({token:d,factory:d.\u0275fac,providedIn:"root"});let p=d;return p})();var Ah=function(p){return p[p.NONE=0]="NONE",p[p.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",p[p.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",p}(Ah||{}),UM="cdk-high-contrast-black-on-white",GM="cdk-high-contrast-white-on-black",Ob="cdk-high-contrast-active",ZM=(()=>{let d=class d{constructor(f,v){this._platform=f,this._document=v,this._breakpointSubscription=ti(VM).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return Ah.NONE;let f=this._document.createElement("div");f.style.backgroundColor="rgb(1,2,3)",f.style.position="absolute",this._document.body.appendChild(f);let v=this._document.defaultView||window,r=v&&v.getComputedStyle?v.getComputedStyle(f):null,k=(r&&r.backgroundColor||"").replace(/ /g,"");switch(f.remove(),k){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return Ah.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return Ah.BLACK_ON_WHITE}return Ah.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let f=this._document.body.classList;f.remove(Ob,UM,GM),this._hasCheckedHighContrastMode=!0;let v=this.getHighContrastMode();v===Ah.BLACK_ON_WHITE?f.add(Ob,UM):v===Ah.WHITE_ON_BLACK&&f.add(Ob,GM)}}};d.\u0275fac=function(v){return new(v||d)(Jt(lr),Jt(zn))},d.\u0275prov=Ti({token:d,factory:d.\u0275fac,providedIn:"root"});let p=d;return p})();var fF=new en("cdk-dir-doc",{providedIn:"root",factory:mF});function mF(){return ti(zn)}var gF=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function _F(p){let d=p?.toLowerCase()||"";return d==="auto"&&typeof navigator<"u"&&navigator?.language?gF.test(navigator.language)?"rtl":"ltr":d==="rtl"?"rtl":"ltr"}var op=(()=>{let d=class d{constructor(f){if(this.value="ltr",this.change=new Or,f){let v=f.body?f.body.dir:null,r=f.documentElement?f.documentElement.dir:null;this.value=_F(v||r||"ltr")}}ngOnDestroy(){this.change.complete()}};d.\u0275fac=function(v){return new(v||d)(Jt(fF,8))},d.\u0275prov=Ti({token:d,factory:d.\u0275fac,providedIn:"root"});let p=d;return p})();var Nb=(()=>{let d=class d{};d.\u0275fac=function(v){return new(v||d)},d.\u0275mod=_r({type:d}),d.\u0275inj=gr({});let p=d;return p})();function yF(){return!0}var vF=new en("mat-sanity-checks",{providedIn:"root",factory:yF}),Xs=(()=>{let d=class d{constructor(f,v,r){this._sanityChecks=v,this._document=r,this._hasDoneGlobalChecks=!1,f._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(f){return FM()?!1:typeof this._sanityChecks=="boolean"?this._sanityChecks:!!this._sanityChecks[f]}};d.\u0275fac=function(v){return new(v||d)(Jt(ZM),Jt(vF,8),Jt(zn))},d.\u0275mod=_r({type:d}),d.\u0275inj=gr({imports:[Nb,Nb]});let p=d;return p})();var ns=function(p){return p[p.FADING_IN=0]="FADING_IN",p[p.VISIBLE=1]="VISIBLE",p[p.FADING_OUT=2]="FADING_OUT",p[p.HIDDEN=3]="HIDDEN",p}(ns||{}),Gb=class{constructor(d,T,f,v=!1){this._renderer=d,this.element=T,this.config=f,this._animationForciblyDisabledThroughCss=v,this.state=ns.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}},QM=tp({passive:!0,capture:!0}),qb=class{constructor(){this._events=new Map,this._delegateEventHandler=d=>{let T=hu(d);T&&this._events.get(d.type)?.forEach((f,v)=>{(v===T||v.contains(T))&&f.forEach(r=>r.handleEvent(d))})}}addHandler(d,T,f,v){let r=this._events.get(T);if(r){let k=r.get(f);k?k.add(v):r.set(f,new Set([v]))}else this._events.set(T,new Map([[f,new Set([v])]])),d.runOutsideAngular(()=>{document.addEventListener(T,this._delegateEventHandler,QM)})}removeHandler(d,T,f){let v=this._events.get(d);if(!v)return;let r=v.get(T);r&&(r.delete(f),r.size===0&&v.delete(T),v.size===0&&(this._events.delete(d),document.removeEventListener(d,this._delegateEventHandler,QM)))}},XM={enterDuration:225,exitDuration:150},bF=800,YM=tp({passive:!0,capture:!0}),KM=["mousedown","touchstart"],JM=["mouseup","mouseleave","touchend","touchcancel"],im=class im{constructor(d,T,f,v){this._target=d,this._ngZone=T,this._platform=v,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,v.isBrowser&&(this._containerElement=ac(f))}fadeInRipple(d,T,f={}){let v=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),r=Vt(Vt({},XM),f.animation);f.centered&&(d=v.left+v.width/2,T=v.top+v.height/2);let k=f.radius||xF(d,T,v),W=d-v.left,ee=T-v.top,de=r.enterDuration,Ie=document.createElement("div");Ie.classList.add("mat-ripple-element"),Ie.style.left=`${W-k}px`,Ie.style.top=`${ee-k}px`,Ie.style.height=`${k*2}px`,Ie.style.width=`${k*2}px`,f.color!=null&&(Ie.style.backgroundColor=f.color),Ie.style.transitionDuration=`${de}ms`,this._containerElement.appendChild(Ie);let Ne=window.getComputedStyle(Ie),lt=Ne.transitionProperty,it=Ne.transitionDuration,Gt=lt==="none"||it==="0s"||it==="0s, 0s"||v.width===0&&v.height===0,Ei=new Gb(this,Ie,f,Gt);Ie.style.transform="scale3d(1, 1, 1)",Ei.state=ns.FADING_IN,f.persistent||(this._mostRecentTransientRipple=Ei);let sn=null;return!Gt&&(de||r.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let Xt=()=>this._finishRippleTransition(Ei),ni=()=>this._destroyRipple(Ei);Ie.addEventListener("transitionend",Xt),Ie.addEventListener("transitioncancel",ni),sn={onTransitionEnd:Xt,onTransitionCancel:ni}}),this._activeRipples.set(Ei,sn),(Gt||!de)&&this._finishRippleTransition(Ei),Ei}fadeOutRipple(d){if(d.state===ns.FADING_OUT||d.state===ns.HIDDEN)return;let T=d.element,f=Vt(Vt({},XM),d.config.animation);T.style.transitionDuration=`${f.exitDuration}ms`,T.style.opacity="0",d.state=ns.FADING_OUT,(d._animationForciblyDisabledThroughCss||!f.exitDuration)&&this._finishRippleTransition(d)}fadeOutAll(){this._getActiveRipples().forEach(d=>d.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(d=>{d.config.persistent||d.fadeOut()})}setupTriggerEvents(d){let T=ac(d);!this._platform.isBrowser||!T||T===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=T,KM.forEach(f=>{im._eventManager.addHandler(this._ngZone,f,T,this)}))}handleEvent(d){d.type==="mousedown"?this._onMousedown(d):d.type==="touchstart"?this._onTouchStart(d):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{JM.forEach(T=>{this._triggerElement.addEventListener(T,this,YM)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(d){d.state===ns.FADING_IN?this._startFadeOutTransition(d):d.state===ns.FADING_OUT&&this._destroyRipple(d)}_startFadeOutTransition(d){let T=d===this._mostRecentTransientRipple,{persistent:f}=d.config;d.state=ns.VISIBLE,!f&&(!T||!this._isPointerDown)&&d.fadeOut()}_destroyRipple(d){let T=this._activeRipples.get(d)??null;this._activeRipples.delete(d),this._activeRipples.size||(this._containerRect=null),d===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),d.state=ns.HIDDEN,T!==null&&(d.element.removeEventListener("transitionend",T.onTransitionEnd),d.element.removeEventListener("transitioncancel",T.onTransitionCancel)),d.element.remove()}_onMousedown(d){let T=zb(d),f=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+bF;!this._target.rippleDisabled&&!T&&!f&&(this._isPointerDown=!0,this.fadeInRipple(d.clientX,d.clientY,this._target.rippleConfig))}_onTouchStart(d){if(!this._target.rippleDisabled&&!Bb(d)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let T=d.changedTouches;if(T)for(let f=0;f<T.length;f++)this.fadeInRipple(T[f].clientX,T[f].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(d=>{let T=d.state===ns.VISIBLE||d.config.terminateOnPointerUp&&d.state===ns.FADING_IN;!d.config.persistent&&T&&d.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let d=this._triggerElement;d&&(KM.forEach(T=>im._eventManager.removeHandler(T,d,this)),this._pointerUpEventsRegistered&&(JM.forEach(T=>d.removeEventListener(T,this,YM)),this._pointerUpEventsRegistered=!1))}};im._eventManager=new qb;var $b=im;function xF(p,d,T){let f=Math.max(Math.abs(p-T.left),Math.abs(p-T.right)),v=Math.max(Math.abs(d-T.top),Math.abs(d-T.bottom));return Math.sqrt(f*f+v*v)}var L_=new en("mat-ripple-global-options"),F_=(()=>{let d=class d{get disabled(){return this._disabled}set disabled(f){f&&this.fadeOutAllNonPersistent(),this._disabled=f,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(f){this._trigger=f,this._setupTriggerEventsIfEnabled()}constructor(f,v,r,k,W){this._elementRef=f,this._animationMode=W,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=k||{},this._rippleRenderer=new $b(this,v,f,r)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:Vt(Vt(Vt({},this._globalOptions.animation),this._animationMode==="NoopAnimations"?{enterDuration:0,exitDuration:0}:{}),this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(f,v=0,r){return typeof f=="number"?this._rippleRenderer.fadeInRipple(f,v,Vt(Vt({},this.rippleConfig),r)):this._rippleRenderer.fadeInRipple(0,0,Vt(Vt({},this.rippleConfig),f))}};d.\u0275fac=function(v){return new(v||d)(zt(nr),zt(_n),zt(lr),zt(L_,8),zt(xa,8))},d.\u0275dir=uo({type:d,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(v,r){v&2&&po("mat-ripple-unbounded",r.unbounded)},inputs:{color:[An.None,"matRippleColor","color"],unbounded:[An.None,"matRippleUnbounded","unbounded"],centered:[An.None,"matRippleCentered","centered"],radius:[An.None,"matRippleRadius","radius"],animation:[An.None,"matRippleAnimation","animation"],disabled:[An.None,"matRippleDisabled","disabled"],trigger:[An.None,"matRippleTrigger","trigger"]},exportAs:["matRipple"],standalone:!0});let p=d;return p})(),z_=(()=>{let d=class d{};d.\u0275fac=function(v){return new(v||d)},d.\u0275mod=_r({type:d}),d.\u0275inj=gr({imports:[Xs,Xs]});let p=d;return p})();var eC={capture:!0},tC=["focus","click","mouseenter","touchstart"],jb="mat-ripple-loader-uninitialized",Ub="mat-ripple-loader-class-name",iC="mat-ripple-loader-centered",O_="mat-ripple-loader-disabled",rC=(()=>{let d=class d{constructor(){this._document=ti(zn,{optional:!0}),this._animationMode=ti(xa,{optional:!0}),this._globalRippleOptions=ti(L_,{optional:!0}),this._platform=ti(lr),this._ngZone=ti(_n),this._hosts=new Map,this._onInteraction=f=>{if(!(f.target instanceof HTMLElement))return;let r=f.target.closest(`[${jb}]`);r&&this._createRipple(r)},this._ngZone.runOutsideAngular(()=>{for(let f of tC)this._document?.addEventListener(f,this._onInteraction,eC)})}ngOnDestroy(){let f=this._hosts.keys();for(let v of f)this.destroyRipple(v);for(let v of tC)this._document?.removeEventListener(v,this._onInteraction,eC)}configureRipple(f,v){f.setAttribute(jb,""),(v.className||!f.hasAttribute(Ub))&&f.setAttribute(Ub,v.className||""),v.centered&&f.setAttribute(iC,""),v.disabled&&f.setAttribute(O_,"")}getRipple(f){return this._hosts.get(f)||this._createRipple(f)}setDisabled(f,v){let r=this._hosts.get(f);if(r){r.disabled=v;return}v?f.setAttribute(O_,""):f.removeAttribute(O_)}_createRipple(f){if(!this._document)return;let v=this._hosts.get(f);if(v)return v;f.querySelector(".mat-ripple")?.remove();let r=this._document.createElement("span");r.classList.add("mat-ripple",f.getAttribute(Ub)),f.append(r);let k=new F_(new nr(r),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return k._isInitialized=!0,k.trigger=f,k.centered=f.hasAttribute(iC),k.disabled=f.hasAttribute(O_),this.attachRipple(f,k),k}attachRipple(f,v){f.removeAttribute(jb),this._hosts.set(f,v)}destroyRipple(f){let v=this._hosts.get(f);v&&(v.ngOnDestroy(),this._hosts.delete(f))}};d.\u0275fac=function(v){return new(v||d)},d.\u0275prov=Ti({token:d,factory:d.\u0275fac,providedIn:"root"});let p=d;return p})();var wF=["*"],B_;function TF(){if(B_===void 0&&(B_=null,typeof window<"u")){let p=window;p.trustedTypes!==void 0&&(B_=p.trustedTypes.createPolicy("angular#components",{createHTML:d=>d}))}return B_}function nm(p){return TF()?.createHTML(p)||p}function oC(p){return Error(`Unable to find icon with the name "${p}"`)}function EF(){return Error("Could not find HttpClient provider for use with Angular Material icons. Please include the HttpClientModule from @angular/common/http in your app imports.")}function sC(p){return Error(`The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${p}".`)}function aC(p){return Error(`The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${p}".`)}var lc=class{constructor(d,T,f){this.url=d,this.svgText=T,this.options=f}},IF=(()=>{let d=class d{constructor(f,v,r,k){this._httpClient=f,this._sanitizer=v,this._errorHandler=k,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._resolvers=[],this._defaultFontSetClass=["material-icons","mat-ligature-font"],this._document=r}addSvgIcon(f,v,r){return this.addSvgIconInNamespace("",f,v,r)}addSvgIconLiteral(f,v,r){return this.addSvgIconLiteralInNamespace("",f,v,r)}addSvgIconInNamespace(f,v,r,k){return this._addSvgIconConfig(f,v,new lc(r,null,k))}addSvgIconResolver(f){return this._resolvers.push(f),this}addSvgIconLiteralInNamespace(f,v,r,k){let W=this._sanitizer.sanitize(Gs.HTML,r);if(!W)throw aC(r);let ee=nm(W);return this._addSvgIconConfig(f,v,new lc("",ee,k))}addSvgIconSet(f,v){return this.addSvgIconSetInNamespace("",f,v)}addSvgIconSetLiteral(f,v){return this.addSvgIconSetLiteralInNamespace("",f,v)}addSvgIconSetInNamespace(f,v,r){return this._addSvgIconSetConfig(f,new lc(v,null,r))}addSvgIconSetLiteralInNamespace(f,v,r){let k=this._sanitizer.sanitize(Gs.HTML,v);if(!k)throw aC(v);let W=nm(k);return this._addSvgIconSetConfig(f,new lc("",W,r))}registerFontClassAlias(f,v=f){return this._fontCssClassesByAlias.set(f,v),this}classNameForFontAlias(f){return this._fontCssClassesByAlias.get(f)||f}setDefaultFontSetClass(...f){return this._defaultFontSetClass=f,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(f){let v=this._sanitizer.sanitize(Gs.RESOURCE_URL,f);if(!v)throw sC(f);let r=this._cachedIconsByUrl.get(v);return r?_i(N_(r)):this._loadSvgIconFromConfig(new lc(f,null)).pipe(Cr(k=>this._cachedIconsByUrl.set(v,k)),qi(k=>N_(k)))}getNamedSvgIcon(f,v=""){let r=lC(v,f),k=this._svgIconConfigs.get(r);if(k)return this._getSvgFromConfig(k);if(k=this._getIconConfigFromResolvers(v,f),k)return this._svgIconConfigs.set(r,k),this._getSvgFromConfig(k);let W=this._iconSetConfigs.get(v);return W?this._getSvgFromIconSetConfigs(f,W):ch(oC(r))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(f){return f.svgText?_i(N_(this._svgElementFromConfig(f))):this._loadSvgIconFromConfig(f).pipe(qi(v=>N_(v)))}_getSvgFromIconSetConfigs(f,v){let r=this._extractIconWithNameFromAnySet(f,v);if(r)return _i(r);let k=v.filter(W=>!W.svgText).map(W=>this._loadSvgIconSetFromConfig(W).pipe(eu(ee=>{let Ie=`Loading icon set URL: ${this._sanitizer.sanitize(Gs.RESOURCE_URL,W.url)} failed: ${ee.message}`;return this._errorHandler.handleError(new Error(Ie)),_i(null)})));return Bg(k).pipe(qi(()=>{let W=this._extractIconWithNameFromAnySet(f,v);if(!W)throw oC(f);return W}))}_extractIconWithNameFromAnySet(f,v){for(let r=v.length-1;r>=0;r--){let k=v[r];if(k.svgText&&k.svgText.toString().indexOf(f)>-1){let W=this._svgElementFromConfig(k),ee=this._extractSvgIconFromSet(W,f,k.options);if(ee)return ee}}return null}_loadSvgIconFromConfig(f){return this._fetchIcon(f).pipe(Cr(v=>f.svgText=v),qi(()=>this._svgElementFromConfig(f)))}_loadSvgIconSetFromConfig(f){return f.svgText?_i(null):this._fetchIcon(f).pipe(Cr(v=>f.svgText=v))}_extractSvgIconFromSet(f,v,r){let k=f.querySelector(`[id="${v}"]`);if(!k)return null;let W=k.cloneNode(!0);if(W.removeAttribute("id"),W.nodeName.toLowerCase()==="svg")return this._setSvgAttributes(W,r);if(W.nodeName.toLowerCase()==="symbol")return this._setSvgAttributes(this._toSvgElement(W),r);let ee=this._svgElementFromString(nm("<svg></svg>"));return ee.appendChild(W),this._setSvgAttributes(ee,r)}_svgElementFromString(f){let v=this._document.createElement("DIV");v.innerHTML=f;let r=v.querySelector("svg");if(!r)throw Error("<svg> tag not found");return r}_toSvgElement(f){let v=this._svgElementFromString(nm("<svg></svg>")),r=f.attributes;for(let k=0;k<r.length;k++){let{name:W,value:ee}=r[k];W!=="id"&&v.setAttribute(W,ee)}for(let k=0;k<f.childNodes.length;k++)f.childNodes[k].nodeType===this._document.ELEMENT_NODE&&v.appendChild(f.childNodes[k].cloneNode(!0));return v}_setSvgAttributes(f,v){return f.setAttribute("fit",""),f.setAttribute("height","100%"),f.setAttribute("width","100%"),f.setAttribute("preserveAspectRatio","xMidYMid meet"),f.setAttribute("focusable","false"),v&&v.viewBox&&f.setAttribute("viewBox",v.viewBox),f}_fetchIcon(f){let{url:v,options:r}=f,k=r?.withCredentials??!1;if(!this._httpClient)throw EF();if(v==null)throw Error(`Cannot fetch icon from URL "${v}".`);let W=this._sanitizer.sanitize(Gs.RESOURCE_URL,v);if(!W)throw sC(v);let ee=this._inProgressUrlFetches.get(W);if(ee)return ee;let de=this._httpClient.get(W,{responseType:"text",withCredentials:k}).pipe(qi(Ie=>nm(Ie)),hh(()=>this._inProgressUrlFetches.delete(W)),ST());return this._inProgressUrlFetches.set(W,de),de}_addSvgIconConfig(f,v,r){return this._svgIconConfigs.set(lC(f,v),r),this}_addSvgIconSetConfig(f,v){let r=this._iconSetConfigs.get(f);return r?r.push(v):this._iconSetConfigs.set(f,[v]),this}_svgElementFromConfig(f){if(!f.svgElement){let v=this._svgElementFromString(f.svgText);this._setSvgAttributes(v,f.options),f.svgElement=v}return f.svgElement}_getIconConfigFromResolvers(f,v){for(let r=0;r<this._resolvers.length;r++){let k=this._resolvers[r](v,f);if(k)return SF(k)?new lc(k.url,null,k.options):new lc(k,null)}}};d.\u0275fac=function(v){return new(v||d)(Jt(pE,8),Jt(g0),Jt(zn,8),Jt(fh))},d.\u0275prov=Ti({token:d,factory:d.\u0275fac,providedIn:"root"});let p=d;return p})();function N_(p){return p.cloneNode(!0)}function lC(p,d){return p+":"+d}function SF(p){return!!(p.url&&p.options)}var MF=new en("MAT_ICON_DEFAULT_OPTIONS"),CF=new en("mat-icon-location",{providedIn:"root",factory:AF});function AF(){let p=ti(zn),d=p?p.location:null;return{getPathname:()=>d?d.pathname+d.search:""}}var cC=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],DF=cC.map(p=>`[${p}]`).join(", "),RF=/^url\(['"]?#(.*?)['"]?\)$/,V_=(()=>{let d=class d{get color(){return this._color||this._defaultColor}set color(f){this._color=f}get svgIcon(){return this._svgIcon}set svgIcon(f){f!==this._svgIcon&&(f?this._updateSvgIcon(f):this._svgIcon&&this._clearSvgElement(),this._svgIcon=f)}get fontSet(){return this._fontSet}set fontSet(f){let v=this._cleanupFontValue(f);v!==this._fontSet&&(this._fontSet=v,this._updateFontIconClasses())}get fontIcon(){return this._fontIcon}set fontIcon(f){let v=this._cleanupFontValue(f);v!==this._fontIcon&&(this._fontIcon=v,this._updateFontIconClasses())}constructor(f,v,r,k,W,ee){this._elementRef=f,this._iconRegistry=v,this._location=k,this._errorHandler=W,this.inline=!1,this._previousFontSetClass=[],this._currentIconFetch=kd.EMPTY,ee&&(ee.color&&(this.color=this._defaultColor=ee.color),ee.fontSet&&(this.fontSet=ee.fontSet)),r||f.nativeElement.setAttribute("aria-hidden","true")}_splitIconName(f){if(!f)return["",""];let v=f.split(":");switch(v.length){case 1:return["",v[0]];case 2:return v;default:throw Error(`Invalid icon name: "${f}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){let f=this._elementsWithExternalReferences;if(f&&f.size){let v=this._location.getPathname();v!==this._previousPath&&(this._previousPath=v,this._prependPathToReferences(v))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(f){this._clearSvgElement();let v=this._location.getPathname();this._previousPath=v,this._cacheChildrenWithExternalReferences(f),this._prependPathToReferences(v),this._elementRef.nativeElement.appendChild(f)}_clearSvgElement(){let f=this._elementRef.nativeElement,v=f.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();v--;){let r=f.childNodes[v];(r.nodeType!==1||r.nodeName.toLowerCase()==="svg")&&r.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;let f=this._elementRef.nativeElement,v=(this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet).split(/ +/):this._iconRegistry.getDefaultFontSetClass()).filter(r=>r.length>0);this._previousFontSetClass.forEach(r=>f.classList.remove(r)),v.forEach(r=>f.classList.add(r)),this._previousFontSetClass=v,this.fontIcon!==this._previousFontIconClass&&!v.includes("mat-ligature-font")&&(this._previousFontIconClass&&f.classList.remove(this._previousFontIconClass),this.fontIcon&&f.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(f){return typeof f=="string"?f.trim().split(" ")[0]:f}_prependPathToReferences(f){let v=this._elementsWithExternalReferences;v&&v.forEach((r,k)=>{r.forEach(W=>{k.setAttribute(W.name,`url('${f}#${W.value}')`)})})}_cacheChildrenWithExternalReferences(f){let v=f.querySelectorAll(DF),r=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let k=0;k<v.length;k++)cC.forEach(W=>{let ee=v[k],de=ee.getAttribute(W),Ie=de?de.match(RF):null;if(Ie){let Ne=r.get(ee);Ne||(Ne=[],r.set(ee,Ne)),Ne.push({name:W,value:Ie[1]})}})}_updateSvgIcon(f){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),f){let[v,r]=this._splitIconName(f);v&&(this._svgNamespace=v),r&&(this._svgName=r),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(r,v).pipe(es(1)).subscribe(k=>this._setSvgElement(k),k=>{let W=`Error retrieving icon ${v}:${r}! ${k.message}`;this._errorHandler.handleError(new Error(W))})}}};d.\u0275fac=function(v){return new(v||d)(zt(nr),zt(IF),qv("aria-hidden"),zt(CF),zt(fh),zt(MF,8))},d.\u0275cmp=Ar({type:d,selectors:[["mat-icon"]],hostAttrs:["role","img",1,"mat-icon","notranslate"],hostVars:10,hostBindings:function(v,r){v&2&&(qs("data-mat-icon-type",r._usingFontIcon()?"font":"svg")("data-mat-icon-name",r._svgName||r.fontIcon)("data-mat-icon-namespace",r._svgNamespace||r.fontSet)("fontIcon",r._usingFontIcon()?r.fontIcon:null),nu(r.color?"mat-"+r.color:""),po("mat-icon-inline",r.inline)("mat-icon-no-color",r.color!=="primary"&&r.color!=="accent"&&r.color!=="warn"))},inputs:{color:"color",inline:[An.HasDecoratorInputTransform,"inline","inline",io],svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["matIcon"],standalone:!0,features:[Ta,Dr],ngContentSelectors:wF,decls:1,vars:0,template:function(v,r){v&1&&($s(),to(0))},styles:["mat-icon,mat-icon.mat-primary,mat-icon.mat-accent,mat-icon.mat-warn{color:var(--mat-icon-color)}.mat-icon{-webkit-user-select:none;user-select:none;background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px;overflow:hidden}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}.mat-icon.mat-ligature-font[fontIcon]::before{content:attr(fontIcon)}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}"],encapsulation:2,changeDetection:0});let p=d;return p})(),j_=(()=>{let d=class d{};d.\u0275fac=function(v){return new(v||d)},d.\u0275mod=_r({type:d}),d.\u0275inj=gr({imports:[Xs,Xs]});let p=d;return p})();var PF=["mat-button",""],dC=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],pC=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"];var kF=["mat-fab",""];var OF=new en("MAT_BUTTON_CONFIG");var LF=[{attribute:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{attribute:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{attribute:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{attribute:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{attribute:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab"]},{attribute:"mat-mini-fab",mdcClasses:["mdc-fab","mdc-fab--mini","mat-mdc-mini-fab"]},{attribute:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}],fC=(()=>{let d=class d{get ripple(){return this._rippleLoader?.getRipple(this._elementRef.nativeElement)}set ripple(f){this._rippleLoader?.attachRipple(this._elementRef.nativeElement,f)}get disableRipple(){return this._disableRipple}set disableRipple(f){this._disableRipple=f,this._updateRippleDisabled()}get disabled(){return this._disabled}set disabled(f){this._disabled=f,this._updateRippleDisabled()}constructor(f,v,r,k){this._elementRef=f,this._platform=v,this._ngZone=r,this._animationMode=k,this._focusMonitor=ti(k_),this._rippleLoader=ti(rC),this._isFab=!1,this._disableRipple=!1,this._disabled=!1;let W=ti(OF,{optional:!0}),ee=f.nativeElement,de=ee.classList;this.disabledInteractive=W?.disabledInteractive??!1,this._rippleLoader?.configureRipple(ee,{className:"mat-mdc-button-ripple"});for(let{attribute:Ie,mdcClasses:Ne}of LF)ee.hasAttribute(Ie)&&de.add(...Ne)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(f="program",v){f?this._focusMonitor.focusVia(this._elementRef.nativeElement,f,v):this._elementRef.nativeElement.focus(v)}_getAriaDisabled(){return this.ariaDisabled!=null?this.ariaDisabled:this.disabled&&this.disabledInteractive?!0:null}_getDisabledAttribute(){return this.disabledInteractive||!this.disabled?null:!0}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}};d.\u0275fac=function(v){Sf()},d.\u0275dir=uo({type:d,inputs:{color:"color",disableRipple:[An.HasDecoratorInputTransform,"disableRipple","disableRipple",io],disabled:[An.HasDecoratorInputTransform,"disabled","disabled",io],ariaDisabled:[An.HasDecoratorInputTransform,"aria-disabled","ariaDisabled",io],disabledInteractive:[An.HasDecoratorInputTransform,"disabledInteractive","disabledInteractive",io]},features:[Ta]});let p=d;return p})();var mC=(()=>{let d=class d extends fC{constructor(f,v,r,k){super(f,v,r,k)}};d.\u0275fac=function(v){return new(v||d)(zt(nr),zt(lr),zt(_n),zt(xa,8))},d.\u0275cmp=Ar({type:d,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:14,hostBindings:function(v,r){v&2&&(qs("disabled",r._getDisabledAttribute())("aria-disabled",r._getAriaDisabled()),nu(r.color?"mat-"+r.color:""),po("mat-mdc-button-disabled",r.disabled)("mat-mdc-button-disabled-interactive",r.disabledInteractive)("_mat-animation-noopable",r._animationMode==="NoopAnimations")("mat-unthemed",!r.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[wa,Dr],attrs:PF,ngContentSelectors:pC,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(v,r){v&1&&($s(dC),Qn(0,"span",0),to(1),rr(2,"span",1),to(3,1),ar(),to(4,2),Qn(5,"span",2)(6,"span",3)),v&2&&po("mdc-button__ripple",!r._isFab)("mdc-fab__ripple",r._isFab)},styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button{position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;user-select:none;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0)}.mdc-button .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top}[dir=rtl] .mdc-button .mdc-button__icon,.mdc-button .mdc-button__icon[dir=rtl]{margin-left:8px;margin-right:0}.mdc-button .mdc-button__progress-indicator{font-size:0;position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;line-height:initial}.mdc-button .mdc-button__label{position:relative}.mdc-button .mdc-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px);display:none}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring{border-color:CanvasText}}.mdc-button .mdc-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring::after{border-color:CanvasText}}@media screen and (forced-colors: active){.mdc-button.mdc-ripple-upgraded--background-focused .mdc-button__focus-ring,.mdc-button:not(.mdc-ripple-upgraded):focus .mdc-button__focus-ring{display:block}}.mdc-button .mdc-button__touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mdc-button__label+.mdc-button__icon{margin-left:8px;margin-right:0}[dir=rtl] .mdc-button__label+.mdc-button__icon,.mdc-button__label+.mdc-button__icon[dir=rtl]{margin-left:0;margin-right:8px}svg.mdc-button__icon{fill:currentColor}.mdc-button--touch{margin-top:6px;margin-bottom:6px}.mdc-button{padding:0 8px 0 8px}.mdc-button--unelevated{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--unelevated.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--unelevated.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--raised{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--raised.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--raised.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--outlined{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button--outlined .mdc-button__ripple{border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button{font-family:var(--mdc-text-button-label-text-font);font-size:var(--mdc-text-button-label-text-size);letter-spacing:var(--mdc-text-button-label-text-tracking);font-weight:var(--mdc-text-button-label-text-weight);text-transform:var(--mdc-text-button-label-text-transform);height:var(--mdc-text-button-container-height);border-radius:var(--mdc-text-button-container-shape);padding:0 var(--mat-text-button-horizontal-padding, 8px)}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color)}.mat-mdc-button:disabled{color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape)}.mat-mdc-button:has(.material-icons,mat-icon,[matButtonIcon]){padding:0 var(--mat-text-button-with-icon-horizontal-padding, 8px)}.mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}[dir=rtl] .mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}.mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-text-button-ripple-color)}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-state-layer-color)}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-disabled-state-layer-color)}.mat-mdc-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-hover-state-layer-opacity)}.mat-mdc-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-focus-state-layer-opacity)}.mat-mdc-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-pressed-state-layer-opacity)}.mat-mdc-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-text-button-touch-target-display)}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-unelevated-button{font-family:var(--mdc-filled-button-label-text-font);font-size:var(--mdc-filled-button-label-text-size);letter-spacing:var(--mdc-filled-button-label-text-tracking);font-weight:var(--mdc-filled-button-label-text-weight);text-transform:var(--mdc-filled-button-label-text-transform);height:var(--mdc-filled-button-container-height);border-radius:var(--mdc-filled-button-container-shape);padding:0 var(--mat-filled-button-horizontal-padding, 16px)}.mat-mdc-unelevated-button:not(:disabled){background-color:var(--mdc-filled-button-container-color)}.mat-mdc-unelevated-button:disabled{background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color)}.mat-mdc-unelevated-button:disabled{color:var(--mdc-filled-button-disabled-label-text-color)}.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape)}.mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-filled-button-ripple-color)}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-state-layer-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-disabled-state-layer-color)}.mat-mdc-unelevated-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-hover-state-layer-opacity)}.mat-mdc-unelevated-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-focus-state-layer-opacity)}.mat-mdc-unelevated-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-pressed-state-layer-opacity)}.mat-mdc-unelevated-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-filled-button-touch-target-display)}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-filled-button-disabled-label-text-color);background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{font-family:var(--mdc-protected-button-label-text-font);font-size:var(--mdc-protected-button-label-text-size);letter-spacing:var(--mdc-protected-button-label-text-tracking);font-weight:var(--mdc-protected-button-label-text-weight);text-transform:var(--mdc-protected-button-label-text-transform);height:var(--mdc-protected-button-container-height);border-radius:var(--mdc-protected-button-container-shape);padding:0 var(--mat-protected-button-horizontal-padding, 16px);box-shadow:var(--mdc-protected-button-container-elevation-shadow)}.mat-mdc-raised-button:not(:disabled){background-color:var(--mdc-protected-button-container-color)}.mat-mdc-raised-button:disabled{background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color)}.mat-mdc-raised-button:disabled{color:var(--mdc-protected-button-disabled-label-text-color)}.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape)}.mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}.mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-protected-button-ripple-color)}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-state-layer-color)}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-disabled-state-layer-color)}.mat-mdc-raised-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-hover-state-layer-opacity)}.mat-mdc-raised-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-focus-state-layer-opacity)}.mat-mdc-raised-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-pressed-state-layer-opacity)}.mat-mdc-raised-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-protected-button-touch-target-display)}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation-shadow)}.mat-mdc-raised-button:focus{box-shadow:var(--mdc-protected-button-focus-container-elevation-shadow)}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mdc-protected-button-pressed-container-elevation-shadow)}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-protected-button-disabled-label-text-color);background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation-shadow)}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{font-family:var(--mdc-outlined-button-label-text-font);font-size:var(--mdc-outlined-button-label-text-size);letter-spacing:var(--mdc-outlined-button-label-text-tracking);font-weight:var(--mdc-outlined-button-label-text-weight);text-transform:var(--mdc-outlined-button-label-text-transform);height:var(--mdc-outlined-button-container-height);border-radius:var(--mdc-outlined-button-container-shape);padding:0 15px 0 15px;border-width:var(--mdc-outlined-button-outline-width);padding:0 var(--mat-outlined-button-horizontal-padding, 15px)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color)}.mat-mdc-outlined-button:disabled{color:var(--mdc-outlined-button-disabled-label-text-color)}.mat-mdc-outlined-button .mdc-button__ripple{border-radius:var(--mdc-outlined-button-container-shape)}.mat-mdc-outlined-button:not(:disabled){border-color:var(--mdc-outlined-button-outline-color)}.mat-mdc-outlined-button:disabled{border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mdc-button--icon-trailing{padding:0 11px 0 15px}.mat-mdc-outlined-button.mdc-button--icon-leading{padding:0 15px 0 11px}.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:var(--mdc-outlined-button-outline-width)}.mat-mdc-outlined-button .mdc-button__touch{left:calc(-1 * var(--mdc-outlined-button-outline-width));width:calc(100% + 2 * var(--mdc-outlined-button-outline-width))}.mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-outlined-button-ripple-color)}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-state-layer-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-disabled-state-layer-color)}.mat-mdc-outlined-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-hover-state-layer-opacity)}.mat-mdc-outlined-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-focus-state-layer-opacity)}.mat-mdc-outlined-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-pressed-state-layer-opacity)}.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-outlined-button-touch-target-display)}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-outlined-button-disabled-label-text-color);border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-button-base{text-decoration:none}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-outlined-button .mdc-button__label{z-index:1}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px)*-1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0});let p=d;return p})();var FF=new en("mat-mdc-fab-default-options",{providedIn:"root",factory:gC});function gC(){return{color:"accent"}}var hC=gC(),_C=(()=>{let d=class d extends fC{constructor(f,v,r,k,W){super(f,v,r,k),this._options=W,this._isFab=!0,this._options=this._options||hC,this.color=this._options.color||hC.color}};d.\u0275fac=function(v){return new(v||d)(zt(nr),zt(lr),zt(_n),zt(xa,8),zt(FF,8))},d.\u0275cmp=Ar({type:d,selectors:[["button","mat-fab",""]],hostVars:18,hostBindings:function(v,r){v&2&&(qs("disabled",r._getDisabledAttribute())("aria-disabled",r._getAriaDisabled()),nu(r.color?"mat-"+r.color:""),po("mat-mdc-button-disabled",r.disabled)("mat-mdc-button-disabled-interactive",r.disabledInteractive)("_mat-animation-noopable",r._animationMode==="NoopAnimations")("mat-unthemed",!r.color)("mat-mdc-button-base",!0)("mdc-fab--extended",r.extended)("mat-mdc-extended-fab",r.extended))},inputs:{extended:[An.HasDecoratorInputTransform,"extended","extended",io]},exportAs:["matButton"],standalone:!0,features:[Ta,wa,Dr],attrs:kF,ngContentSelectors:pC,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(v,r){v&1&&($s(dC),Qn(0,"span",0),to(1),rr(2,"span",1),to(3,1),ar(),to(4,2),Qn(5,"span",2)(6,"span",3)),v&2&&po("mdc-button__ripple",!r._isFab)("mdc-fab__ripple",r._isFab)},styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-fab{position:relative;display:inline-flex;position:relative;align-items:center;justify-content:center;box-sizing:border-box;width:56px;height:56px;padding:0;border:none;fill:currentColor;text-decoration:none;cursor:pointer;user-select:none;-moz-appearance:none;-webkit-appearance:none;overflow:visible;transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1),opacity 15ms linear 30ms,transform 270ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-fab .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-fab[hidden]{display:none}.mdc-fab::-moz-focus-inner{padding:0;border:0}.mdc-fab .mdc-fab__focus-ring{position:absolute}.mdc-fab.mdc-ripple-upgraded--background-focused .mdc-fab__focus-ring,.mdc-fab:not(.mdc-ripple-upgraded):focus .mdc-fab__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-fab.mdc-ripple-upgraded--background-focused .mdc-fab__focus-ring,.mdc-fab:not(.mdc-ripple-upgraded):focus .mdc-fab__focus-ring{border-color:CanvasText}}.mdc-fab.mdc-ripple-upgraded--background-focused .mdc-fab__focus-ring::after,.mdc-fab:not(.mdc-ripple-upgraded):focus .mdc-fab__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-fab.mdc-ripple-upgraded--background-focused .mdc-fab__focus-ring::after,.mdc-fab:not(.mdc-ripple-upgraded):focus .mdc-fab__focus-ring::after{border-color:CanvasText}}.mdc-fab:active,.mdc-fab:focus{outline:none}.mdc-fab:hover{cursor:pointer}.mdc-fab>svg{width:100%}.mdc-fab--mini{width:40px;height:40px}.mdc-fab--extended{border-radius:24px;padding-left:20px;padding-right:20px;width:auto;max-width:100%;height:48px;line-height:normal}.mdc-fab--extended .mdc-fab__ripple{border-radius:24px}.mdc-fab--extended .mdc-fab__icon{margin-left:calc(12px - 20px);margin-right:12px}[dir=rtl] .mdc-fab--extended .mdc-fab__icon,.mdc-fab--extended .mdc-fab__icon[dir=rtl]{margin-left:12px;margin-right:calc(12px - 20px)}.mdc-fab--extended .mdc-fab__label+.mdc-fab__icon{margin-left:12px;margin-right:calc(12px - 20px)}[dir=rtl] .mdc-fab--extended .mdc-fab__label+.mdc-fab__icon,.mdc-fab--extended .mdc-fab__label+.mdc-fab__icon[dir=rtl]{margin-left:calc(12px - 20px);margin-right:12px}.mdc-fab--touch{margin-top:4px;margin-bottom:4px;margin-right:4px;margin-left:4px}.mdc-fab--touch .mdc-fab__touch{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%)}.mdc-fab::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-fab::before{border-color:CanvasText}}.mdc-fab__label{justify-content:flex-start;text-overflow:ellipsis;white-space:nowrap;overflow-x:hidden;overflow-y:visible}.mdc-fab__icon{transition:transform 180ms 90ms cubic-bezier(0, 0, 0.2, 1);fill:currentColor;will-change:transform}.mdc-fab .mdc-fab__icon{display:inline-flex;align-items:center;justify-content:center}.mdc-fab--exited{transform:scale(0);opacity:0;transition:opacity 15ms linear 150ms,transform 180ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-fab--exited .mdc-fab__icon{transform:scale(0);transition:transform 135ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mat-mdc-fab{background-color:var(--mdc-fab-container-color)}.mat-mdc-fab .mdc-fab__icon{width:var(--mdc-fab-icon-size);height:var(--mdc-fab-icon-size);font-size:var(--mdc-fab-icon-size)}.mat-mdc-fab:not(.mdc-fab--extended){border-radius:var(--mdc-fab-container-shape)}.mat-mdc-fab:not(.mdc-fab--extended) .mdc-fab__ripple{border-radius:var(--mdc-fab-container-shape)}.mat-mdc-mini-fab{background-color:var(--mdc-fab-small-container-color)}.mat-mdc-mini-fab .mdc-fab__icon{width:var(--mdc-fab-small-icon-size);height:var(--mdc-fab-small-icon-size);font-size:var(--mdc-fab-small-icon-size)}.mat-mdc-mini-fab:not(.mdc-fab--extended){border-radius:var(--mdc-fab-small-container-shape)}.mat-mdc-mini-fab:not(.mdc-fab--extended) .mdc-fab__ripple{border-radius:var(--mdc-fab-small-container-shape)}.mat-mdc-extended-fab{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;height:var(--mdc-extended-fab-container-height);border-radius:var(--mdc-extended-fab-container-shape);font-family:var(--mdc-extended-fab-label-text-font);font-size:var(--mdc-extended-fab-label-text-size);font-weight:var(--mdc-extended-fab-label-text-weight);letter-spacing:var(--mdc-extended-fab-label-text-tracking)}.mat-mdc-extended-fab .mdc-fab__ripple{border-radius:var(--mdc-extended-fab-container-shape)}.mat-mdc-fab,.mat-mdc-mini-fab{-webkit-tap-highlight-color:rgba(0,0,0,0);flex-shrink:0}.mat-mdc-fab .mat-mdc-button-ripple,.mat-mdc-fab .mat-mdc-button-persistent-ripple,.mat-mdc-fab .mat-mdc-button-persistent-ripple::before,.mat-mdc-mini-fab .mat-mdc-button-ripple,.mat-mdc-mini-fab .mat-mdc-button-persistent-ripple,.mat-mdc-mini-fab .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-fab .mat-mdc-button-ripple,.mat-mdc-mini-fab .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-fab .mat-mdc-button-persistent-ripple::before,.mat-mdc-mini-fab .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-fab .mdc-button__label,.mat-mdc-mini-fab .mdc-button__label{z-index:1}.mat-mdc-fab .mat-mdc-focus-indicator,.mat-mdc-mini-fab .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-fab:focus .mat-mdc-focus-indicator::before,.mat-mdc-mini-fab:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-fab._mat-animation-noopable,.mat-mdc-mini-fab._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-fab:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-mini-fab:not(.mdc-ripple-upgraded):focus::before{background:rgba(0,0,0,0);opacity:1}.mat-mdc-fab .mat-icon,.mat-mdc-fab .material-icons,.mat-mdc-mini-fab .mat-icon,.mat-mdc-mini-fab .material-icons{transition:transform 180ms 90ms cubic-bezier(0, 0, 0.2, 1);fill:currentColor;will-change:transform}.mat-mdc-fab .mat-mdc-focus-indicator::before,.mat-mdc-mini-fab .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-fab[disabled],.mat-mdc-fab.mat-mdc-button-disabled,.mat-mdc-mini-fab[disabled],.mat-mdc-mini-fab.mat-mdc-button-disabled{cursor:default;pointer-events:none}.mat-mdc-fab[disabled],.mat-mdc-fab[disabled]:focus,.mat-mdc-fab.mat-mdc-button-disabled,.mat-mdc-fab.mat-mdc-button-disabled:focus,.mat-mdc-mini-fab[disabled],.mat-mdc-mini-fab[disabled]:focus,.mat-mdc-mini-fab.mat-mdc-button-disabled,.mat-mdc-mini-fab.mat-mdc-button-disabled:focus{box-shadow:none}.mat-mdc-fab.mat-mdc-button-disabled-interactive,.mat-mdc-mini-fab.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-fab{color:var(--mat-fab-foreground-color, inherit);box-shadow:var(--mdc-fab-container-elevation-shadow)}.mat-mdc-fab .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%);display:var(--mat-fab-touch-target-display)}.mat-mdc-fab .mat-ripple-element{background-color:var(--mat-fab-ripple-color)}.mat-mdc-fab .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-fab-state-layer-color)}.mat-mdc-fab.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-fab-disabled-state-layer-color)}.mat-mdc-fab:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-fab-hover-state-layer-opacity)}.mat-mdc-fab.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-fab.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-fab.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-fab-focus-state-layer-opacity)}.mat-mdc-fab:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-fab-pressed-state-layer-opacity)}.mat-mdc-fab:hover{box-shadow:var(--mdc-fab-hover-container-elevation-shadow)}.mat-mdc-fab:focus{box-shadow:var(--mdc-fab-focus-container-elevation-shadow)}.mat-mdc-fab:active,.mat-mdc-fab:focus:active{box-shadow:var(--mdc-fab-pressed-container-elevation-shadow)}.mat-mdc-fab[disabled],.mat-mdc-fab.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mat-fab-disabled-state-foreground-color);background-color:var(--mat-fab-disabled-state-container-color)}.mat-mdc-fab.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-mini-fab{color:var(--mat-fab-small-foreground-color, inherit);box-shadow:var(--mdc-fab-small-container-elevation-shadow)}.mat-mdc-mini-fab .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%);display:var(--mat-fab-small-touch-target-display)}.mat-mdc-mini-fab .mat-ripple-element{background-color:var(--mat-fab-small-ripple-color)}.mat-mdc-mini-fab .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-fab-small-state-layer-color)}.mat-mdc-mini-fab.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-fab-small-disabled-state-layer-color)}.mat-mdc-mini-fab:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-fab-small-hover-state-layer-opacity)}.mat-mdc-mini-fab.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-mini-fab.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-mini-fab.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-fab-small-focus-state-layer-opacity)}.mat-mdc-mini-fab:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-fab-small-pressed-state-layer-opacity)}.mat-mdc-mini-fab:hover{box-shadow:var(--mdc-fab-small-hover-container-elevation-shadow)}.mat-mdc-mini-fab:focus{box-shadow:var(--mdc-fab-small-focus-container-elevation-shadow)}.mat-mdc-mini-fab:active,.mat-mdc-mini-fab:focus:active{box-shadow:var(--mdc-fab-small-pressed-container-elevation-shadow)}.mat-mdc-mini-fab[disabled],.mat-mdc-mini-fab.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mat-fab-small-disabled-state-foreground-color);background-color:var(--mat-fab-small-disabled-state-container-color)}.mat-mdc-mini-fab.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-extended-fab{box-shadow:var(--mdc-extended-fab-container-elevation-shadow)}.mat-mdc-extended-fab:hover{box-shadow:var(--mdc-extended-fab-hover-container-elevation-shadow)}.mat-mdc-extended-fab:focus{box-shadow:var(--mdc-extended-fab-focus-container-elevation-shadow)}.mat-mdc-extended-fab:active,.mat-mdc-extended-fab:focus:active{box-shadow:var(--mdc-extended-fab-pressed-container-elevation-shadow)}.mat-mdc-extended-fab[disabled],.mat-mdc-extended-fab.mat-mdc-button-disabled{cursor:default;pointer-events:none}.mat-mdc-extended-fab[disabled],.mat-mdc-extended-fab[disabled]:focus,.mat-mdc-extended-fab.mat-mdc-button-disabled,.mat-mdc-extended-fab.mat-mdc-button-disabled:focus{box-shadow:none}.mat-mdc-extended-fab.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-extended-fab>.mat-icon,.mat-mdc-extended-fab>.material-icons{margin-left:calc(12px - 20px);margin-right:12px}[dir=rtl] .mat-mdc-extended-fab>.mat-icon,[dir=rtl] .mat-mdc-extended-fab>.material-icons,.mat-mdc-extended-fab>.mat-icon[dir=rtl],.mat-mdc-extended-fab>.material-icons[dir=rtl]{margin-left:12px;margin-right:calc(12px - 20px)}.mat-mdc-extended-fab .mat-mdc-button-touch-target{width:100%}.mat-mdc-extended-fab .mdc-button__label+.mat-icon,.mat-mdc-extended-fab .mdc-button__label+.material-icons{margin-left:12px;margin-right:calc(12px - 20px)}[dir=rtl] .mat-mdc-extended-fab .mdc-button__label+.mat-icon,[dir=rtl] .mat-mdc-extended-fab .mdc-button__label+.material-icons,.mat-mdc-extended-fab .mdc-button__label+.mat-icon[dir=rtl],.mat-mdc-extended-fab .mdc-button__label+.material-icons[dir=rtl]{margin-left:calc(12px - 20px);margin-right:12px}'],encapsulation:2,changeDetection:0});let p=d;return p})();var U_=(()=>{let d=class d{};d.\u0275fac=function(v){return new(v||d)},d.\u0275mod=_r({type:d}),d.\u0275inj=gr({imports:[Xs,z_,Xs]});let p=d;return p})();var zF=20,Wb=(()=>{let d=class d{constructor(f,v,r){this._ngZone=f,this._platform=v,this._scrolled=new ir,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=r}register(f){this.scrollContainers.has(f)||this.scrollContainers.set(f,f.elementScrolled().subscribe(()=>this._scrolled.next(f)))}deregister(f){let v=this.scrollContainers.get(f);v&&(v.unsubscribe(),this.scrollContainers.delete(f))}scrolled(f=zF){return this._platform.isBrowser?new Od(v=>{this._globalSubscription||this._addGlobalListener();let r=f>0?this._scrolled.pipe(Vv(f)).subscribe(v):this._scrolled.subscribe(v);return this._scrolledCount++,()=>{r.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):_i()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((f,v)=>this.deregister(v)),this._scrolled.complete()}ancestorScrolled(f,v){let r=this.getAncestorScrollContainers(f);return this.scrolled(v).pipe(lo(k=>!k||r.indexOf(k)>-1))}getAncestorScrollContainers(f){let v=[];return this.scrollContainers.forEach((r,k)=>{this._scrollableContainsElement(k,f)&&v.push(k)}),v}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(f,v){let r=ac(v),k=f.getElementRef().nativeElement;do if(r==k)return!0;while(r=r.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>{let f=this._getWindow();return _f(f.document,"scroll").subscribe(()=>this._scrolled.next())})}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}};d.\u0275fac=function(v){return new(v||d)(Jt(_n),Jt(lr),Jt(zn,8))},d.\u0275prov=Ti({token:d,factory:d.\u0275fac,providedIn:"root"});let p=d;return p})(),G_=(()=>{let d=class d{constructor(f,v,r,k){this.elementRef=f,this.scrollDispatcher=v,this.ngZone=r,this.dir=k,this._destroyed=new ir,this._elementScrolled=new Od(W=>this.ngZone.runOutsideAngular(()=>_f(this.elementRef.nativeElement,"scroll").pipe(co(this._destroyed)).subscribe(W)))}ngOnInit(){this.scrollDispatcher.register(this)}ngOnDestroy(){this.scrollDispatcher.deregister(this),this._destroyed.next(),this._destroyed.complete()}elementScrolled(){return this._elementScrolled}getElementRef(){return this.elementRef}scrollTo(f){let v=this.elementRef.nativeElement,r=this.dir&&this.dir.value=="rtl";f.left==null&&(f.left=r?f.end:f.start),f.right==null&&(f.right=r?f.start:f.end),f.bottom!=null&&(f.top=v.scrollHeight-v.clientHeight-f.bottom),r&&ip()!=nl.NORMAL?(f.left!=null&&(f.right=v.scrollWidth-v.clientWidth-f.left),ip()==nl.INVERTED?f.left=f.right:ip()==nl.NEGATED&&(f.left=f.right?-f.right:f.right)):f.right!=null&&(f.left=v.scrollWidth-v.clientWidth-f.right),this._applyScrollToOptions(f)}_applyScrollToOptions(f){let v=this.elementRef.nativeElement;OM()?v.scrollTo(f):(f.top!=null&&(v.scrollTop=f.top),f.left!=null&&(v.scrollLeft=f.left))}measureScrollOffset(f){let v="left",r="right",k=this.elementRef.nativeElement;if(f=="top")return k.scrollTop;if(f=="bottom")return k.scrollHeight-k.clientHeight-k.scrollTop;let W=this.dir&&this.dir.value=="rtl";return f=="start"?f=W?r:v:f=="end"&&(f=W?v:r),W&&ip()==nl.INVERTED?f==v?k.scrollWidth-k.clientWidth-k.scrollLeft:k.scrollLeft:W&&ip()==nl.NEGATED?f==v?k.scrollLeft+k.scrollWidth-k.clientWidth:-k.scrollLeft:f==v?k.scrollLeft:k.scrollWidth-k.clientWidth-k.scrollLeft}};d.\u0275fac=function(v){return new(v||d)(zt(nr),zt(Wb),zt(_n),zt(op,8))},d.\u0275dir=uo({type:d,selectors:[["","cdk-scrollable",""],["","cdkScrollable",""]],standalone:!0});let p=d;return p})(),BF=20,vC=(()=>{let d=class d{constructor(f,v,r){this._platform=f,this._change=new ir,this._changeListener=k=>{this._change.next(k)},this._document=r,v.runOutsideAngular(()=>{if(f.isBrowser){let k=this._getWindow();k.addEventListener("resize",this._changeListener),k.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){let f=this._getWindow();f.removeEventListener("resize",this._changeListener),f.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let f={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),f}getViewportRect(){let f=this.getViewportScrollPosition(),{width:v,height:r}=this.getViewportSize();return{top:f.top,left:f.left,bottom:f.top+r,right:f.left+v,height:r,width:v}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let f=this._document,v=this._getWindow(),r=f.documentElement,k=r.getBoundingClientRect(),W=-k.top||f.body.scrollTop||v.scrollY||r.scrollTop||0,ee=-k.left||f.body.scrollLeft||v.scrollX||r.scrollLeft||0;return{top:W,left:ee}}change(f=BF){return f>0?this._change.pipe(Vv(f)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let f=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:f.innerWidth,height:f.innerHeight}:{width:0,height:0}}};d.\u0275fac=function(v){return new(v||d)(Jt(lr),Jt(_n),Jt(zn,8))},d.\u0275prov=Ti({token:d,factory:d.\u0275fac,providedIn:"root"});let p=d;return p})();var Zb=(()=>{let d=class d{};d.\u0275fac=function(v){return new(v||d)},d.\u0275mod=_r({type:d}),d.\u0275inj=gr({});let p=d;return p})();var bC=["*"],jF=["content"],UF=[[["mat-drawer"]],[["mat-drawer-content"]],"*"],GF=["mat-drawer","mat-drawer-content","*"];function qF(p,d){if(p&1){let T=Nd();rr(0,"div",1),ts("click",function(){El(T);let v=Sl();return Il(v._onBackdropClicked())}),ar()}if(p&2){let T=Sl();po("mat-drawer-shown",T._isShowingBackdrop())}}function $F(p,d){p&1&&(rr(0,"mat-drawer-content"),to(1,2),ar())}var WF={transformDrawer:sE("transform",[e0("open, open-instant",Jv({transform:"none",visibility:"visible"})),e0("void",Jv({"box-shadow":"none",visibility:"hidden"})),t0("void => open-instant",Kv("0ms")),t0("void <=> open, open-instant => void",Kv("400ms cubic-bezier(0.25, 0.8, 0.25, 1)"))])};var ZF=new en("MAT_DRAWER_DEFAULT_AUTOSIZE",{providedIn:"root",factory:HF}),xC=new en("MAT_DRAWER_CONTAINER");function HF(){return!1}var Hb=(()=>{let d=class d extends G_{constructor(f,v,r,k,W){super(r,k,W),this._changeDetectorRef=f,this._container=v}ngAfterContentInit(){this._container._contentMarginChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})}};d.\u0275fac=function(v){return new(v||d)(zt(Ms),zt(dh(()=>Xb)),zt(nr),zt(Wb),zt(_n))},d.\u0275cmp=Ar({type:d,selectors:[["mat-drawer-content"]],hostAttrs:[1,"mat-drawer-content"],hostVars:4,hostBindings:function(v,r){v&2&&_h("margin-left",r._container._contentMargins.left,"px")("margin-right",r._container._contentMargins.right,"px")},standalone:!0,features:[Zs([{provide:G_,useExisting:d}]),wa,Dr],ngContentSelectors:bC,decls:1,vars:0,template:function(v,r){v&1&&($s(),to(0))},encapsulation:2,changeDetection:0});let p=d;return p})(),Qb=(()=>{let d=class d{get position(){return this._position}set position(f){f=f==="end"?"end":"start",f!==this._position&&(this._isAttached&&this._updatePositionInParent(f),this._position=f,this.onPositionChanged.emit())}get mode(){return this._mode}set mode(f){this._mode=f,this._updateFocusTrapState(),this._modeChanged.next()}get disableClose(){return this._disableClose}set disableClose(f){this._disableClose=Mh(f)}get autoFocus(){let f=this._autoFocus;return f??(this.mode==="side"?"dialog":"first-tabbable")}set autoFocus(f){(f==="true"||f==="false"||f==null)&&(f=Mh(f)),this._autoFocus=f}get opened(){return this._opened}set opened(f){this.toggle(Mh(f))}constructor(f,v,r,k,W,ee,de,Ie){this._elementRef=f,this._focusTrapFactory=v,this._focusMonitor=r,this._platform=k,this._ngZone=W,this._interactivityChecker=ee,this._doc=de,this._container=Ie,this._focusTrap=null,this._elementFocusedBeforeDrawerWasOpened=null,this._enableAnimations=!1,this._position="start",this._mode="over",this._disableClose=!1,this._opened=!1,this._animationStarted=new ir,this._animationEnd=new ir,this._animationState="void",this.openedChange=new Or(!0),this._openedStream=this.openedChange.pipe(lo(Ne=>Ne),qi(()=>{})),this.openedStart=this._animationStarted.pipe(lo(Ne=>Ne.fromState!==Ne.toState&&Ne.toState.indexOf("open")===0),vf(void 0)),this._closedStream=this.openedChange.pipe(lo(Ne=>!Ne),qi(()=>{})),this.closedStart=this._animationStarted.pipe(lo(Ne=>Ne.fromState!==Ne.toState&&Ne.toState==="void"),vf(void 0)),this._destroyed=new ir,this.onPositionChanged=new Or,this._modeChanged=new ir,this.openedChange.subscribe(Ne=>{Ne?(this._doc&&(this._elementFocusedBeforeDrawerWasOpened=this._doc.activeElement),this._takeFocus()):this._isFocusWithinDrawer()&&this._restoreFocus(this._openedVia||"program")}),this._ngZone.runOutsideAngular(()=>{_f(this._elementRef.nativeElement,"keydown").pipe(lo(Ne=>Ne.keyCode===27&&!this.disableClose&&!zM(Ne)),co(this._destroyed)).subscribe(Ne=>this._ngZone.run(()=>{this.close(),Ne.stopPropagation(),Ne.preventDefault()}))}),this._animationEnd.pipe(bf((Ne,lt)=>Ne.fromState===lt.fromState&&Ne.toState===lt.toState)).subscribe(Ne=>{let{fromState:lt,toState:it}=Ne;(it.indexOf("open")===0&&lt==="void"||it==="void"&&lt.indexOf("open")===0)&&this.openedChange.emit(this._opened)})}_forceFocus(f,v){this._interactivityChecker.isFocusable(f)||(f.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{let r=()=>{f.removeEventListener("blur",r),f.removeEventListener("mousedown",r),f.removeAttribute("tabindex")};f.addEventListener("blur",r),f.addEventListener("mousedown",r)})),f.focus(v)}_focusByCssSelector(f,v){let r=this._elementRef.nativeElement.querySelector(f);r&&this._forceFocus(r,v)}_takeFocus(){if(!this._focusTrap)return;let f=this._elementRef.nativeElement;switch(this.autoFocus){case!1:case"dialog":return;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(v=>{!v&&typeof this._elementRef.nativeElement.focus=="function"&&f.focus()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this.autoFocus);break}}_restoreFocus(f){this.autoFocus!=="dialog"&&(this._elementFocusedBeforeDrawerWasOpened?this._focusMonitor.focusVia(this._elementFocusedBeforeDrawerWasOpened,f):this._elementRef.nativeElement.blur(),this._elementFocusedBeforeDrawerWasOpened=null)}_isFocusWithinDrawer(){let f=this._doc.activeElement;return!!f&&this._elementRef.nativeElement.contains(f)}ngAfterViewInit(){this._isAttached=!0,this._position==="end"&&this._updatePositionInParent("end"),this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._updateFocusTrapState())}ngAfterContentChecked(){this._platform.isBrowser&&(this._enableAnimations=!0)}ngOnDestroy(){this._focusTrap?.destroy(),this._anchor?.remove(),this._anchor=null,this._animationStarted.complete(),this._animationEnd.complete(),this._modeChanged.complete(),this._destroyed.next(),this._destroyed.complete()}open(f){return this.toggle(!0,f)}close(){return this.toggle(!1)}_closeViaBackdropClick(){return this._setOpen(!1,!0,"mouse")}toggle(f=!this.opened,v){f&&v&&(this._openedVia=v);let r=this._setOpen(f,!f&&this._isFocusWithinDrawer(),this._openedVia||"program");return f||(this._openedVia=null),r}_setOpen(f,v,r){return this._opened=f,f?this._animationState=this._enableAnimations?"open":"open-instant":(this._animationState="void",v&&this._restoreFocus(r)),this._updateFocusTrapState(),new Promise(k=>{this.openedChange.pipe(es(1)).subscribe(W=>k(W?"open":"close"))})}_getWidth(){return this._elementRef.nativeElement&&this._elementRef.nativeElement.offsetWidth||0}_updateFocusTrapState(){this._focusTrap&&(this._focusTrap.enabled=!!this._container?.hasBackdrop)}_updatePositionInParent(f){if(!this._platform.isBrowser)return;let v=this._elementRef.nativeElement,r=v.parentNode;f==="end"?(this._anchor||(this._anchor=this._doc.createComment("mat-drawer-anchor"),r.insertBefore(this._anchor,v)),r.appendChild(v)):this._anchor&&this._anchor.parentNode.insertBefore(v,this._anchor)}};d.\u0275fac=function(v){return new(v||d)(zt(nr),zt($M),zt(k_),zt(lr),zt(_n),zt(Fb),zt(zn,8),zt(xC,8))},d.\u0275cmp=Ar({type:d,selectors:[["mat-drawer"]],viewQuery:function(v,r){if(v&1&&Ws(jF,5),v&2){let k;fo(k=mo())&&(r._content=k.first)}},hostAttrs:["tabIndex","-1",1,"mat-drawer"],hostVars:12,hostBindings:function(v,r){v&1&&HT("@transform.start",function(W){return r._animationStarted.next(W)})("@transform.done",function(W){return r._animationEnd.next(W)}),v&2&&(ZT("@transform",r._animationState),qs("align",null),po("mat-drawer-end",r.position==="end")("mat-drawer-over",r.mode==="over")("mat-drawer-push",r.mode==="push")("mat-drawer-side",r.mode==="side")("mat-drawer-opened",r.opened))},inputs:{position:"position",mode:"mode",disableClose:"disableClose",autoFocus:"autoFocus",opened:"opened"},outputs:{openedChange:"openedChange",_openedStream:"opened",openedStart:"openedStart",_closedStream:"closed",closedStart:"closedStart",onPositionChanged:"positionChanged"},exportAs:["matDrawer"],standalone:!0,features:[Dr],ngContentSelectors:bC,decls:3,vars:0,consts:[["content",""],["cdkScrollable","",1,"mat-drawer-inner-container"]],template:function(v,r){v&1&&($s(),rr(0,"div",1,0),to(2),ar())},dependencies:[G_],encapsulation:2,data:{animation:[WF.transformDrawer]},changeDetection:0});let p=d;return p})(),Xb=(()=>{let d=class d{get start(){return this._start}get end(){return this._end}get autosize(){return this._autosize}set autosize(f){this._autosize=Mh(f)}get hasBackdrop(){return this._drawerHasBackdrop(this._start)||this._drawerHasBackdrop(this._end)}set hasBackdrop(f){this._backdropOverride=f==null?null:Mh(f)}get scrollable(){return this._userContent||this._content}constructor(f,v,r,k,W,ee=!1,de){this._dir=f,this._element=v,this._ngZone=r,this._changeDetectorRef=k,this._animationMode=de,this._drawers=new Wv,this.backdropClick=new Or,this._destroyed=new ir,this._doCheckSubject=new ir,this._contentMargins={left:null,right:null},this._contentMarginChanges=new ir,f&&f.change.pipe(co(this._destroyed)).subscribe(()=>{this._validateDrawers(),this.updateContentMargins()}),W.change().pipe(co(this._destroyed)).subscribe(()=>this.updateContentMargins()),this._autosize=ee}ngAfterContentInit(){this._allDrawers.changes.pipe(iu(this._allDrawers),co(this._destroyed)).subscribe(f=>{this._drawers.reset(f.filter(v=>!v._container||v._container===this)),this._drawers.notifyOnChanges()}),this._drawers.changes.pipe(iu(null)).subscribe(()=>{this._validateDrawers(),this._drawers.forEach(f=>{this._watchDrawerToggle(f),this._watchDrawerPosition(f),this._watchDrawerMode(f)}),(!this._drawers.length||this._isDrawerOpen(this._start)||this._isDrawerOpen(this._end))&&this.updateContentMargins(),this._changeDetectorRef.markForCheck()}),this._ngZone.runOutsideAngular(()=>{this._doCheckSubject.pipe(yf(10),co(this._destroyed)).subscribe(()=>this.updateContentMargins())})}ngOnDestroy(){this._contentMarginChanges.complete(),this._doCheckSubject.complete(),this._drawers.destroy(),this._destroyed.next(),this._destroyed.complete()}open(){this._drawers.forEach(f=>f.open())}close(){this._drawers.forEach(f=>f.close())}updateContentMargins(){let f=0,v=0;if(this._left&&this._left.opened){if(this._left.mode=="side")f+=this._left._getWidth();else if(this._left.mode=="push"){let r=this._left._getWidth();f+=r,v-=r}}if(this._right&&this._right.opened){if(this._right.mode=="side")v+=this._right._getWidth();else if(this._right.mode=="push"){let r=this._right._getWidth();v+=r,f-=r}}f=f||null,v=v||null,(f!==this._contentMargins.left||v!==this._contentMargins.right)&&(this._contentMargins={left:f,right:v},this._ngZone.run(()=>this._contentMarginChanges.next(this._contentMargins)))}ngDoCheck(){this._autosize&&this._isPushed()&&this._ngZone.runOutsideAngular(()=>this._doCheckSubject.next())}_watchDrawerToggle(f){f._animationStarted.pipe(lo(v=>v.fromState!==v.toState),co(this._drawers.changes)).subscribe(v=>{v.toState!=="open-instant"&&this._animationMode!=="NoopAnimations"&&this._element.nativeElement.classList.add("mat-drawer-transition"),this.updateContentMargins(),this._changeDetectorRef.markForCheck()}),f.mode!=="side"&&f.openedChange.pipe(co(this._drawers.changes)).subscribe(()=>this._setContainerClass(f.opened))}_watchDrawerPosition(f){f&&f.onPositionChanged.pipe(co(this._drawers.changes)).subscribe(()=>{this._ngZone.onMicrotaskEmpty.pipe(es(1)).subscribe(()=>{this._validateDrawers()})})}_watchDrawerMode(f){f&&f._modeChanged.pipe(co(TT(this._drawers.changes,this._destroyed))).subscribe(()=>{this.updateContentMargins(),this._changeDetectorRef.markForCheck()})}_setContainerClass(f){let v=this._element.nativeElement.classList,r="mat-drawer-container-has-open";f?v.add(r):v.remove(r)}_validateDrawers(){this._start=this._end=null,this._drawers.forEach(f=>{f.position=="end"?(this._end!=null,this._end=f):(this._start!=null,this._start=f)}),this._right=this._left=null,this._dir&&this._dir.value==="rtl"?(this._left=this._end,this._right=this._start):(this._left=this._start,this._right=this._end)}_isPushed(){return this._isDrawerOpen(this._start)&&this._start.mode!="over"||this._isDrawerOpen(this._end)&&this._end.mode!="over"}_onBackdropClicked(){this.backdropClick.emit(),this._closeModalDrawersViaBackdrop()}_closeModalDrawersViaBackdrop(){[this._start,this._end].filter(f=>f&&!f.disableClose&&this._drawerHasBackdrop(f)).forEach(f=>f._closeViaBackdropClick())}_isShowingBackdrop(){return this._isDrawerOpen(this._start)&&this._drawerHasBackdrop(this._start)||this._isDrawerOpen(this._end)&&this._drawerHasBackdrop(this._end)}_isDrawerOpen(f){return f!=null&&f.opened}_drawerHasBackdrop(f){return this._backdropOverride==null?!!f&&f.mode!=="side":this._backdropOverride}};d.\u0275fac=function(v){return new(v||d)(zt(op,8),zt(nr),zt(_n),zt(Ms),zt(vC),zt(ZF),zt(xa,8))},d.\u0275cmp=Ar({type:d,selectors:[["mat-drawer-container"]],contentQueries:function(v,r,k){if(v&1&&(yh(k,Hb,5),yh(k,Qb,5)),v&2){let W;fo(W=mo())&&(r._content=W.first),fo(W=mo())&&(r._allDrawers=W)}},viewQuery:function(v,r){if(v&1&&Ws(Hb,5),v&2){let k;fo(k=mo())&&(r._userContent=k.first)}},hostAttrs:[1,"mat-drawer-container"],hostVars:2,hostBindings:function(v,r){v&2&&po("mat-drawer-container-explicit-backdrop",r._backdropOverride)},inputs:{autosize:"autosize",hasBackdrop:"hasBackdrop"},outputs:{backdropClick:"backdropClick"},exportAs:["matDrawerContainer"],standalone:!0,features:[Zs([{provide:xC,useExisting:d}]),Dr],ngContentSelectors:GF,decls:4,vars:2,consts:[[1,"mat-drawer-backdrop",3,"mat-drawer-shown"],[1,"mat-drawer-backdrop",3,"click"]],template:function(v,r){v&1&&($s(UF),tl(0,qF,1,2,"div",0),to(1),to(2,1),tl(3,$F,2,0,"mat-drawer-content")),v&2&&(il(0,r.hasBackdrop?0:-1),ho(3),il(3,r._content?-1:3))},dependencies:[Hb],styles:['.mat-drawer-container{position:relative;z-index:1;color:var(--mat-sidenav-content-text-color);background-color:var(--mat-sidenav-content-background-color);box-sizing:border-box;-webkit-overflow-scrolling:touch;display:block;overflow:hidden}.mat-drawer-container[fullscreen]{top:0;left:0;right:0;bottom:0;position:absolute}.mat-drawer-container[fullscreen].mat-drawer-container-has-open{overflow:hidden}.mat-drawer-container.mat-drawer-container-explicit-backdrop .mat-drawer-side{z-index:3}.mat-drawer-container.ng-animate-disabled .mat-drawer-backdrop,.mat-drawer-container.ng-animate-disabled .mat-drawer-content,.ng-animate-disabled .mat-drawer-container .mat-drawer-backdrop,.ng-animate-disabled .mat-drawer-container .mat-drawer-content{transition:none}.mat-drawer-backdrop{top:0;left:0;right:0;bottom:0;position:absolute;display:block;z-index:3;visibility:hidden}.mat-drawer-backdrop.mat-drawer-shown{visibility:visible;background-color:var(--mat-sidenav-scrim-color)}.mat-drawer-transition .mat-drawer-backdrop{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:background-color,visibility}.cdk-high-contrast-active .mat-drawer-backdrop{opacity:.5}.mat-drawer-content{position:relative;z-index:1;display:block;height:100%;overflow:auto}.mat-drawer-transition .mat-drawer-content{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:transform,margin-left,margin-right}.mat-drawer{position:relative;z-index:4;color:var(--mat-sidenav-container-text-color);box-shadow:var(--mat-sidenav-container-elevation-shadow);background-color:var(--mat-sidenav-container-background-color);border-top-right-radius:var(--mat-sidenav-container-shape);border-bottom-right-radius:var(--mat-sidenav-container-shape);width:var(--mat-sidenav-container-width);display:block;position:absolute;top:0;bottom:0;z-index:3;outline:0;box-sizing:border-box;overflow-y:auto;transform:translate3d(-100%, 0, 0)}.cdk-high-contrast-active .mat-drawer,.cdk-high-contrast-active [dir=rtl] .mat-drawer.mat-drawer-end{border-right:solid 1px currentColor}.cdk-high-contrast-active [dir=rtl] .mat-drawer,.cdk-high-contrast-active .mat-drawer.mat-drawer-end{border-left:solid 1px currentColor;border-right:none}.mat-drawer.mat-drawer-side{z-index:2}.mat-drawer.mat-drawer-end{right:0;transform:translate3d(100%, 0, 0);border-top-left-radius:var(--mat-sidenav-container-shape);border-bottom-left-radius:var(--mat-sidenav-container-shape);border-top-right-radius:0;border-bottom-right-radius:0}[dir=rtl] .mat-drawer{border-top-left-radius:var(--mat-sidenav-container-shape);border-bottom-left-radius:var(--mat-sidenav-container-shape);border-top-right-radius:0;border-bottom-right-radius:0;transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer.mat-drawer-end{border-top-right-radius:var(--mat-sidenav-container-shape);border-bottom-right-radius:var(--mat-sidenav-container-shape);border-top-left-radius:0;border-bottom-left-radius:0;left:0;right:auto;transform:translate3d(-100%, 0, 0)}.mat-drawer[style*="visibility: hidden"]{display:none}.mat-drawer-side{box-shadow:none;border-right-color:var(--mat-sidenav-container-divider-color);border-right-width:1px;border-right-style:solid}.mat-drawer-side.mat-drawer-end{border-left-color:var(--mat-sidenav-container-divider-color);border-left-width:1px;border-left-style:solid;border-right:none}[dir=rtl] .mat-drawer-side{border-left-color:var(--mat-sidenav-container-divider-color);border-left-width:1px;border-left-style:solid;border-right:none}[dir=rtl] .mat-drawer-side.mat-drawer-end{border-right-color:var(--mat-sidenav-container-divider-color);border-right-width:1px;border-right-style:solid;border-left:none}.mat-drawer-inner-container{width:100%;height:100%;overflow:auto;-webkit-overflow-scrolling:touch}.mat-sidenav-fixed{position:fixed}'],encapsulation:2,changeDetection:0});let p=d;return p})();var wC=(()=>{let d=class d{};d.\u0275fac=function(v){return new(v||d)},d.\u0275mod=_r({type:d}),d.\u0275inj=gr({imports:[Xs,Zb,Zb,Xs]});let p=d;return p})();var XF=["knob"],YF=["valueIndicatorContainer"];function KF(p,d){if(p&1&&(rr(0,"div",2,1)(2,"div",5)(3,"span",6),Ml(4),ar()()()),p&2){let T=Sl();ho(4),Gg(T.valueIndicatorText)}}var JF=["trackActive"],ez=["*"];function tz(p,d){if(p&1&&Qn(0,"div"),p&2){let T=d.$implicit,f=d.$index,v=Sl(3);nu(T===0?"mdc-slider__tick-mark--active":"mdc-slider__tick-mark--inactive"),_h("transform",v._calcTickMarkTransform(f))}}function iz(p,d){if(p&1&&$T(0,tz,1,4,"div",8,qT),p&2){let T=Sl(2);WT(T._tickMarks)}}function nz(p,d){if(p&1&&(rr(0,"div",6,1),tl(2,iz,2,0),ar()),p&2){let T=Sl();ho(2),il(2,T._cachedWidth?2:-1)}}function rz(p,d){if(p&1&&Qn(0,"mat-slider-visual-thumb",7),p&2){let T=Sl();gh("discrete",T.discrete)("thumbPosition",1)("valueIndicatorText",T.startValueIndicatorText)}}var $i=function(p){return p[p.START=1]="START",p[p.END=2]="END",p}($i||{}),sp=function(p){return p[p.ACTIVE=0]="ACTIVE",p[p.INACTIVE=1]="INACTIVE",p}(sp||{}),Yb=new en("_MatSlider"),TC=new en("_MatSliderThumb"),oz=new en("_MatSliderRangeThumb"),EC=new en("_MatSliderVisualThumb");var sz=(()=>{let d=class d{constructor(f,v,r,k){this._cdr=f,this._ngZone=v,this._slider=k,this._isHovered=!1,this._isActive=!1,this._isValueIndicatorVisible=!1,this._platform=ti(lr),this._onPointerMove=W=>{if(this._sliderInput._isFocused)return;let ee=this._hostElement.getBoundingClientRect(),de=this._slider._isCursorOnSliderThumb(W,ee);this._isHovered=de,de?this._showHoverRipple():this._hideRipple(this._hoverRippleRef)},this._onMouseLeave=()=>{this._isHovered=!1,this._hideRipple(this._hoverRippleRef)},this._onFocus=()=>{this._hideRipple(this._hoverRippleRef),this._showFocusRipple(),this._hostElement.classList.add("mdc-slider__thumb--focused")},this._onBlur=()=>{this._isActive||this._hideRipple(this._focusRippleRef),this._isHovered&&this._showHoverRipple(),this._hostElement.classList.remove("mdc-slider__thumb--focused")},this._onDragStart=W=>{W.button===0&&(this._isActive=!0,this._showActiveRipple())},this._onDragEnd=()=>{this._isActive=!1,this._hideRipple(this._activeRippleRef),this._sliderInput._isFocused||this._hideRipple(this._focusRippleRef),this._platform.SAFARI&&this._showHoverRipple()},this._hostElement=r.nativeElement}ngAfterViewInit(){this._ripple.radius=24,this._sliderInput=this._slider._getInput(this.thumbPosition),this._sliderInputEl=this._sliderInput._hostElement;let f=this._sliderInputEl;this._ngZone.runOutsideAngular(()=>{f.addEventListener("pointermove",this._onPointerMove),f.addEventListener("pointerdown",this._onDragStart),f.addEventListener("pointerup",this._onDragEnd),f.addEventListener("pointerleave",this._onMouseLeave),f.addEventListener("focus",this._onFocus),f.addEventListener("blur",this._onBlur)})}ngOnDestroy(){let f=this._sliderInputEl;f&&(f.removeEventListener("pointermove",this._onPointerMove),f.removeEventListener("pointerdown",this._onDragStart),f.removeEventListener("pointerup",this._onDragEnd),f.removeEventListener("pointerleave",this._onMouseLeave),f.removeEventListener("focus",this._onFocus),f.removeEventListener("blur",this._onBlur))}_showHoverRipple(){this._isShowingRipple(this._hoverRippleRef)||(this._hoverRippleRef=this._showRipple({enterDuration:0,exitDuration:0}),this._hoverRippleRef?.element.classList.add("mat-mdc-slider-hover-ripple"))}_showFocusRipple(){this._isShowingRipple(this._focusRippleRef)||(this._focusRippleRef=this._showRipple({enterDuration:0,exitDuration:0},!0),this._focusRippleRef?.element.classList.add("mat-mdc-slider-focus-ripple"))}_showActiveRipple(){this._isShowingRipple(this._activeRippleRef)||(this._activeRippleRef=this._showRipple({enterDuration:225,exitDuration:400}),this._activeRippleRef?.element.classList.add("mat-mdc-slider-active-ripple"))}_isShowingRipple(f){return f?.state===ns.FADING_IN||f?.state===ns.VISIBLE}_showRipple(f,v){if(!this._slider.disabled&&(this._showValueIndicator(),this._slider._isRange&&this._slider._getThumb(this.thumbPosition===$i.START?$i.END:$i.START)._showValueIndicator(),!(this._slider._globalRippleOptions?.disabled&&!v)))return this._ripple.launch({animation:this._slider._noopAnimations?{enterDuration:0,exitDuration:0}:f,centered:!0,persistent:!0})}_hideRipple(f){if(f?.fadeOut(),this._isShowingAnyRipple())return;this._slider._isRange||this._hideValueIndicator();let v=this._getSibling();v._isShowingAnyRipple()||(this._hideValueIndicator(),v._hideValueIndicator())}_showValueIndicator(){this._hostElement.classList.add("mdc-slider__thumb--with-indicator")}_hideValueIndicator(){this._hostElement.classList.remove("mdc-slider__thumb--with-indicator")}_getSibling(){return this._slider._getThumb(this.thumbPosition===$i.START?$i.END:$i.START)}_getValueIndicatorContainer(){return this._valueIndicatorContainer?.nativeElement}_getKnob(){return this._knob.nativeElement}_isShowingAnyRipple(){return this._isShowingRipple(this._hoverRippleRef)||this._isShowingRipple(this._focusRippleRef)||this._isShowingRipple(this._activeRippleRef)}};d.\u0275fac=function(v){return new(v||d)(zt(Ms),zt(_n),zt(nr),zt(Yb))},d.\u0275cmp=Ar({type:d,selectors:[["mat-slider-visual-thumb"]],viewQuery:function(v,r){if(v&1&&(Ws(F_,5),Ws(XF,5),Ws(YF,5)),v&2){let k;fo(k=mo())&&(r._ripple=k.first),fo(k=mo())&&(r._knob=k.first),fo(k=mo())&&(r._valueIndicatorContainer=k.first)}},hostAttrs:[1,"mdc-slider__thumb","mat-mdc-slider-visual-thumb"],inputs:{discrete:"discrete",thumbPosition:"thumbPosition",valueIndicatorText:"valueIndicatorText"},standalone:!0,features:[Zs([{provide:EC,useExisting:d}]),Dr],decls:4,vars:2,consts:[["knob",""],["valueIndicatorContainer",""],[1,"mdc-slider__value-indicator-container"],[1,"mdc-slider__thumb-knob"],["matRipple","",1,"mat-mdc-focus-indicator",3,"matRippleDisabled"],[1,"mdc-slider__value-indicator"],[1,"mdc-slider__value-indicator-text"]],template:function(v,r){v&1&&(tl(0,KF,5,1,"div",2),Qn(1,"div",3,0)(3,"div",4)),v&2&&(il(0,r.discrete?0:-1),ho(3),gh("matRippleDisabled",!0))},dependencies:[F_],styles:[".mat-mdc-slider-visual-thumb .mat-ripple{height:100%;width:100%}.mat-mdc-slider .mdc-slider__tick-marks{justify-content:start}.mat-mdc-slider .mdc-slider__tick-marks .mdc-slider__tick-mark--active,.mat-mdc-slider .mdc-slider__tick-marks .mdc-slider__tick-mark--inactive{position:absolute;left:2px}"],encapsulation:2,changeDetection:0});let p=d;return p})(),IC=(()=>{let d=class d{get disabled(){return this._disabled}set disabled(f){this._disabled=f;let v=this._getInput($i.END),r=this._getInput($i.START);v&&(v.disabled=this._disabled),r&&(r.disabled=this._disabled)}get discrete(){return this._discrete}set discrete(f){this._discrete=f,this._updateValueIndicatorUIs()}get min(){return this._min}set min(f){let v=isNaN(f)?this._min:f;this._min!==v&&this._updateMin(v)}_updateMin(f){let v=this._min;this._min=f,this._isRange?this._updateMinRange({old:v,new:f}):this._updateMinNonRange(f),this._onMinMaxOrStepChange()}_updateMinRange(f){let v=this._getInput($i.END),r=this._getInput($i.START),k=v.value,W=r.value;r.min=f.new,v.min=Math.max(f.new,r.value),r.max=Math.min(v.max,v.value),r._updateWidthInactive(),v._updateWidthInactive(),f.new<f.old?this._onTranslateXChangeBySideEffect(v,r):this._onTranslateXChangeBySideEffect(r,v),k!==v.value&&this._onValueChange(v),W!==r.value&&this._onValueChange(r)}_updateMinNonRange(f){let v=this._getInput($i.END);if(v){let r=v.value;v.min=f,v._updateThumbUIByValue(),this._updateTrackUI(v),r!==v.value&&this._onValueChange(v)}}get max(){return this._max}set max(f){let v=isNaN(f)?this._max:f;this._max!==v&&this._updateMax(v)}_updateMax(f){let v=this._max;this._max=f,this._isRange?this._updateMaxRange({old:v,new:f}):this._updateMaxNonRange(f),this._onMinMaxOrStepChange()}_updateMaxRange(f){let v=this._getInput($i.END),r=this._getInput($i.START),k=v.value,W=r.value;v.max=f.new,r.max=Math.min(f.new,v.value),v.min=r.value,v._updateWidthInactive(),r._updateWidthInactive(),f.new>f.old?this._onTranslateXChangeBySideEffect(r,v):this._onTranslateXChangeBySideEffect(v,r),k!==v.value&&this._onValueChange(v),W!==r.value&&this._onValueChange(r)}_updateMaxNonRange(f){let v=this._getInput($i.END);if(v){let r=v.value;v.max=f,v._updateThumbUIByValue(),this._updateTrackUI(v),r!==v.value&&this._onValueChange(v)}}get step(){return this._step}set step(f){let v=isNaN(f)?this._step:f;this._step!==v&&this._updateStep(v)}_updateStep(f){this._step=f,this._isRange?this._updateStepRange():this._updateStepNonRange(),this._onMinMaxOrStepChange()}_updateStepRange(){let f=this._getInput($i.END),v=this._getInput($i.START),r=f.value,k=v.value,W=v.value;f.min=this._min,v.max=this._max,f.step=this._step,v.step=this._step,this._platform.SAFARI&&(f.value=f.value,v.value=v.value),f.min=Math.max(this._min,v.value),v.max=Math.min(this._max,f.value),v._updateWidthInactive(),f._updateWidthInactive(),f.value<W?this._onTranslateXChangeBySideEffect(v,f):this._onTranslateXChangeBySideEffect(f,v),r!==f.value&&this._onValueChange(f),k!==v.value&&this._onValueChange(v)}_updateStepNonRange(){let f=this._getInput($i.END);if(f){let v=f.value;f.step=this._step,this._platform.SAFARI&&(f.value=f.value),f._updateThumbUIByValue(),v!==f.value&&this._onValueChange(f)}}constructor(f,v,r,k,W,ee){this._ngZone=f,this._cdr=v,this._elementRef=r,this._dir=k,this._globalRippleOptions=W,this._disabled=!1,this._discrete=!1,this.showTickMarks=!1,this._min=0,this.disableRipple=!1,this._max=100,this._step=1,this.displayWith=de=>`${de}`,this._rippleRadius=24,this.startValueIndicatorText="",this.endValueIndicatorText="",this._isRange=!1,this._isRtl=!1,this._hasViewInitialized=!1,this._tickMarkTrackWidth=0,this._hasAnimation=!1,this._resizeTimer=null,this._platform=ti(lr),this._knobRadius=8,this._thumbsOverlap=!1,this._noopAnimations=ee==="NoopAnimations",this._dirChangeSubscription=this._dir.change.subscribe(()=>this._onDirChange()),this._isRtl=this._dir.value==="rtl"}ngAfterViewInit(){this._platform.isBrowser&&this._updateDimensions();let f=this._getInput($i.END),v=this._getInput($i.START);this._isRange=!!f&&!!v,this._cdr.detectChanges();let r=this._getThumb($i.END);this._rippleRadius=r._ripple.radius,this._inputPadding=this._rippleRadius-this._knobRadius,this._isRange?this._initUIRange(f,v):this._initUINonRange(f),this._updateTrackUI(f),this._updateTickMarkUI(),this._updateTickMarkTrackUI(),this._observeHostResize(),this._cdr.detectChanges()}_initUINonRange(f){f.initProps(),f.initUI(),this._updateValueIndicatorUI(f),this._hasViewInitialized=!0,f._updateThumbUIByValue()}_initUIRange(f,v){f.initProps(),f.initUI(),v.initProps(),v.initUI(),f._updateMinMax(),v._updateMinMax(),f._updateStaticStyles(),v._updateStaticStyles(),this._updateValueIndicatorUIs(),this._hasViewInitialized=!0,f._updateThumbUIByValue(),v._updateThumbUIByValue()}ngOnDestroy(){this._dirChangeSubscription.unsubscribe(),this._resizeObserver?.disconnect(),this._resizeObserver=null}_onDirChange(){this._isRtl=this._dir.value==="rtl",this._isRange?this._onDirChangeRange():this._onDirChangeNonRange(),this._updateTickMarkUI()}_onDirChangeRange(){let f=this._getInput($i.END),v=this._getInput($i.START);f._setIsLeftThumb(),v._setIsLeftThumb(),f.translateX=f._calcTranslateXByValue(),v.translateX=v._calcTranslateXByValue(),f._updateStaticStyles(),v._updateStaticStyles(),f._updateWidthInactive(),v._updateWidthInactive(),f._updateThumbUIByValue(),v._updateThumbUIByValue()}_onDirChangeNonRange(){this._getInput($i.END)._updateThumbUIByValue()}_observeHostResize(){typeof ResizeObserver>"u"||!ResizeObserver||this._ngZone.runOutsideAngular(()=>{this._resizeObserver=new ResizeObserver(()=>{this._isActive()||(this._resizeTimer&&clearTimeout(this._resizeTimer),this._onResize())}),this._resizeObserver.observe(this._elementRef.nativeElement)})}_isActive(){return this._getThumb($i.START)._isActive||this._getThumb($i.END)._isActive}_getValue(f=$i.END){let v=this._getInput(f);return v?v.value:this.min}_skipUpdate(){return!!(this._getInput($i.START)?._skipUIUpdate||this._getInput($i.END)?._skipUIUpdate)}_updateDimensions(){this._cachedWidth=this._elementRef.nativeElement.offsetWidth,this._cachedLeft=this._elementRef.nativeElement.getBoundingClientRect().left}_setTrackActiveStyles(f){let v=this._trackActive.nativeElement.style;v.left=f.left,v.right=f.right,v.transformOrigin=f.transformOrigin,v.transform=f.transform}_calcTickMarkTransform(f){return`translateX(${f*(this._tickMarkTrackWidth/(this._tickMarks.length-1))}px`}_onTranslateXChange(f){this._hasViewInitialized&&(this._updateThumbUI(f),this._updateTrackUI(f),this._updateOverlappingThumbUI(f))}_onTranslateXChangeBySideEffect(f,v){this._hasViewInitialized&&(f._updateThumbUIByValue(),v._updateThumbUIByValue())}_onValueChange(f){this._hasViewInitialized&&(this._updateValueIndicatorUI(f),this._updateTickMarkUI(),this._cdr.detectChanges())}_onMinMaxOrStepChange(){this._hasViewInitialized&&(this._updateTickMarkUI(),this._updateTickMarkTrackUI(),this._cdr.markForCheck())}_onResize(){if(this._hasViewInitialized){if(this._updateDimensions(),this._isRange){let f=this._getInput($i.END),v=this._getInput($i.START);f._updateThumbUIByValue(),v._updateThumbUIByValue(),f._updateStaticStyles(),v._updateStaticStyles(),f._updateMinMax(),v._updateMinMax(),f._updateWidthInactive(),v._updateWidthInactive()}else{let f=this._getInput($i.END);f&&f._updateThumbUIByValue()}this._updateTickMarkUI(),this._updateTickMarkTrackUI(),this._cdr.detectChanges()}}_areThumbsOverlapping(){let f=this._getInput($i.START),v=this._getInput($i.END);return!f||!v?!1:v.translateX-f.translateX<20}_updateOverlappingThumbClassNames(f){let v=f.getSibling(),r=this._getThumb(f.thumbPosition);this._getThumb(v.thumbPosition)._hostElement.classList.remove("mdc-slider__thumb--top"),r._hostElement.classList.toggle("mdc-slider__thumb--top",this._thumbsOverlap)}_updateOverlappingThumbUI(f){!this._isRange||this._skipUpdate()||this._thumbsOverlap!==this._areThumbsOverlapping()&&(this._thumbsOverlap=!this._thumbsOverlap,this._updateOverlappingThumbClassNames(f))}_updateThumbUI(f){if(this._skipUpdate())return;let v=this._getThumb(f.thumbPosition===$i.END?$i.END:$i.START);v._hostElement.style.transform=`translateX(${f.translateX}px)`}_updateValueIndicatorUI(f){if(this._skipUpdate())return;let v=this.displayWith(f.value);if(this._hasViewInitialized?f._valuetext.set(v):f._hostElement.setAttribute("aria-valuetext",v),this.discrete){f.thumbPosition===$i.START?this.startValueIndicatorText=v:this.endValueIndicatorText=v;let r=this._getThumb(f.thumbPosition);v.length<3?r._hostElement.classList.add("mdc-slider__thumb--short-value"):r._hostElement.classList.remove("mdc-slider__thumb--short-value")}}_updateValueIndicatorUIs(){let f=this._getInput($i.END),v=this._getInput($i.START);f&&this._updateValueIndicatorUI(f),v&&this._updateValueIndicatorUI(v)}_updateTickMarkTrackUI(){if(!this.showTickMarks||this._skipUpdate())return;let f=this._step&&this._step>0?this._step:1,r=(Math.floor(this.max/f)*f-this.min)/(this.max-this.min);this._tickMarkTrackWidth=this._cachedWidth*r-6}_updateTrackUI(f){this._skipUpdate()||(this._isRange?this._updateTrackUIRange(f):this._updateTrackUINonRange(f))}_updateTrackUIRange(f){let v=f.getSibling();if(!v||!this._cachedWidth)return;let r=Math.abs(v.translateX-f.translateX)/this._cachedWidth;f._isLeftThumb&&this._cachedWidth?this._setTrackActiveStyles({left:"auto",right:`${this._cachedWidth-v.translateX}px`,transformOrigin:"right",transform:`scaleX(${r})`}):this._setTrackActiveStyles({left:`${v.translateX}px`,right:"auto",transformOrigin:"left",transform:`scaleX(${r})`})}_updateTrackUINonRange(f){this._isRtl?this._setTrackActiveStyles({left:"auto",right:"0px",transformOrigin:"right",transform:`scaleX(${1-f.fillPercentage})`}):this._setTrackActiveStyles({left:"0px",right:"auto",transformOrigin:"left",transform:`scaleX(${f.fillPercentage})`})}_updateTickMarkUI(){if(!this.showTickMarks||this.step===void 0||this.min===void 0||this.max===void 0)return;let f=this.step>0?this.step:1;this._isRange?this._updateTickMarkUIRange(f):this._updateTickMarkUINonRange(f),this._isRtl&&this._tickMarks.reverse()}_updateTickMarkUINonRange(f){let v=this._getValue(),r=Math.max(Math.floor((v-this.min)/f),0),k=Math.max(Math.floor((this.max-v)/f),0);this._isRtl?r++:k++,this._tickMarks=Array(r).fill(sp.ACTIVE).concat(Array(k).fill(sp.INACTIVE))}_updateTickMarkUIRange(f){let v=this._getValue(),r=this._getValue($i.START),k=Math.max(Math.floor((r-this.min)/f),0),W=Math.max(Math.floor((v-r)/f)+1,0),ee=Math.max(Math.floor((this.max-v)/f),0);this._tickMarks=Array(k).fill(sp.INACTIVE).concat(Array(W).fill(sp.ACTIVE),Array(ee).fill(sp.INACTIVE))}_getInput(f){if(f===$i.END&&this._input)return this._input;if(this._inputs?.length)return f===$i.START?this._inputs.first:this._inputs.last}_getThumb(f){return f===$i.END?this._thumbs?.last:this._thumbs?.first}_setTransition(f){this._hasAnimation=!this._platform.IOS&&f&&!this._noopAnimations,this._elementRef.nativeElement.classList.toggle("mat-mdc-slider-with-animation",this._hasAnimation)}_isCursorOnSliderThumb(f,v){let r=v.width/2,k=v.x+r,W=v.y+r,ee=f.clientX-k,de=f.clientY-W;return Math.pow(ee,2)+Math.pow(de,2)<Math.pow(r,2)}};d.\u0275fac=function(v){return new(v||d)(zt(_n),zt(Ms),zt(nr),zt(op,8),zt(L_,8),zt(xa,8))},d.\u0275cmp=Ar({type:d,selectors:[["mat-slider"]],contentQueries:function(v,r,k){if(v&1&&(yh(k,TC,5),yh(k,oz,4)),v&2){let W;fo(W=mo())&&(r._input=W.first),fo(W=mo())&&(r._inputs=W)}},viewQuery:function(v,r){if(v&1&&(Ws(JF,5),Ws(EC,5)),v&2){let k;fo(k=mo())&&(r._trackActive=k.first),fo(k=mo())&&(r._thumbs=k)}},hostAttrs:[1,"mat-mdc-slider","mdc-slider"],hostVars:12,hostBindings:function(v,r){v&2&&(nu("mat-"+(r.color||"primary")),po("mdc-slider--range",r._isRange)("mdc-slider--disabled",r.disabled)("mdc-slider--discrete",r.discrete)("mdc-slider--tick-marks",r.showTickMarks)("_mat-animation-noopable",r._noopAnimations))},inputs:{disabled:[An.HasDecoratorInputTransform,"disabled","disabled",io],discrete:[An.HasDecoratorInputTransform,"discrete","discrete",io],showTickMarks:[An.HasDecoratorInputTransform,"showTickMarks","showTickMarks",io],min:[An.HasDecoratorInputTransform,"min","min",Cl],color:"color",disableRipple:[An.HasDecoratorInputTransform,"disableRipple","disableRipple",io],max:[An.HasDecoratorInputTransform,"max","max",Cl],step:[An.HasDecoratorInputTransform,"step","step",Cl],displayWith:"displayWith"},exportAs:["matSlider"],standalone:!0,features:[Zs([{provide:Yb,useExisting:d}]),Ta,Dr],ngContentSelectors:ez,decls:9,vars:5,consts:[["trackActive",""],["tickMarkContainer",""],[1,"mdc-slider__track"],[1,"mdc-slider__track--inactive"],[1,"mdc-slider__track--active"],[1,"mdc-slider__track--active_fill"],[1,"mdc-slider__tick-marks"],[3,"discrete","thumbPosition","valueIndicatorText"],[3,"class","transform"]],template:function(v,r){v&1&&($s(),to(0),rr(1,"div",2),Qn(2,"div",3),rr(3,"div",4),Qn(4,"div",5,0),ar(),tl(6,nz,3,1,"div",6),ar(),tl(7,rz,1,3,"mat-slider-visual-thumb",7),Qn(8,"mat-slider-visual-thumb",7)),v&2&&(ho(6),il(6,r.showTickMarks?6:-1),ho(),il(7,r._isRange?7:-1),ho(),gh("discrete",r.discrete)("thumbPosition",2)("valueIndicatorText",r.endValueIndicatorText))},dependencies:[sz],styles:['.mdc-slider{cursor:pointer;height:48px;margin:0 24px;position:relative;touch-action:pan-y}.mdc-slider .mdc-slider__track{position:absolute;top:50%;transform:translateY(-50%);width:100%}.mdc-slider .mdc-slider__track--active,.mdc-slider .mdc-slider__track--inactive{display:flex;height:100%;position:absolute;width:100%}.mdc-slider .mdc-slider__track--active{overflow:hidden}.mdc-slider .mdc-slider__track--active_fill{border-top-style:solid;box-sizing:border-box;height:100%;width:100%;position:relative;-webkit-transform-origin:left;transform-origin:left}[dir=rtl] .mdc-slider .mdc-slider__track--active_fill,.mdc-slider .mdc-slider__track--active_fill[dir=rtl]{-webkit-transform-origin:right;transform-origin:right}.mdc-slider .mdc-slider__track--inactive{left:0;top:0}.mdc-slider .mdc-slider__track--inactive::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-slider .mdc-slider__track--inactive::before{border-color:CanvasText}}.mdc-slider .mdc-slider__value-indicator-container{bottom:44px;left:50%;left:var(--slider-value-indicator-container-left, 50%);pointer-events:none;position:absolute;right:var(--slider-value-indicator-container-right);transform:translateX(-50%);transform:var(--slider-value-indicator-container-transform, translateX(-50%))}.mdc-slider .mdc-slider__value-indicator{transition:transform 100ms 0ms cubic-bezier(0.4, 0, 1, 1);align-items:center;border-radius:4px;display:flex;height:32px;padding:0 12px;transform:scale(0);transform-origin:bottom}.mdc-slider .mdc-slider__value-indicator::before{border-left:6px solid rgba(0,0,0,0);border-right:6px solid rgba(0,0,0,0);border-top:6px solid;bottom:-5px;content:"";height:0;left:50%;left:var(--slider-value-indicator-caret-left, 50%);position:absolute;right:var(--slider-value-indicator-caret-right);transform:translateX(-50%);transform:var(--slider-value-indicator-caret-transform, translateX(-50%));width:0}.mdc-slider .mdc-slider__value-indicator::after{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-slider .mdc-slider__value-indicator::after{border-color:CanvasText}}.mdc-slider .mdc-slider__thumb--with-indicator .mdc-slider__value-indicator-container{pointer-events:auto}.mdc-slider .mdc-slider__thumb--with-indicator .mdc-slider__value-indicator{transition:transform 100ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:scale(1)}@media(prefers-reduced-motion){.mdc-slider .mdc-slider__value-indicator,.mdc-slider .mdc-slider__thumb--with-indicator .mdc-slider__value-indicator{transition:none}}.mdc-slider .mdc-slider__thumb{display:flex;left:-24px;outline:none;position:absolute;user-select:none;height:48px;width:48px}.mdc-slider .mdc-slider__thumb--top{z-index:1}.mdc-slider .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mdc-slider .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mdc-slider .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-style:solid;border-width:1px;box-sizing:content-box}.mdc-slider .mdc-slider__thumb-knob{box-sizing:border-box;left:50%;position:absolute;top:50%;transform:translate(-50%, -50%)}.mdc-slider .mdc-slider__tick-marks{align-items:center;box-sizing:border-box;display:flex;height:100%;justify-content:space-between;padding:0 1px;position:absolute;width:100%}.mdc-slider--discrete .mdc-slider__thumb,.mdc-slider--discrete .mdc-slider__track--active_fill{transition:transform 80ms ease}@media(prefers-reduced-motion){.mdc-slider--discrete .mdc-slider__thumb,.mdc-slider--discrete .mdc-slider__track--active_fill{transition:none}}.mdc-slider--disabled{cursor:auto}.mdc-slider--disabled .mdc-slider__thumb{pointer-events:none}.mdc-slider__input{cursor:pointer;left:2px;margin:0;height:44px;opacity:0;pointer-events:none;position:absolute;top:2px;width:44px}.mat-mdc-slider{display:inline-block;box-sizing:border-box;outline:none;vertical-align:middle;margin-left:8px;margin-right:8px;width:auto;min-width:112px;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-slider .mdc-slider__thumb-knob{background-color:var(--mdc-slider-handle-color);border-color:var(--mdc-slider-handle-color)}.mat-mdc-slider .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-color:#fff}.mat-mdc-slider.mdc-slider--disabled .mdc-slider__thumb-knob{background-color:var(--mdc-slider-disabled-handle-color);border-color:var(--mdc-slider-disabled-handle-color)}.mat-mdc-slider.mdc-slider--disabled .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mat-mdc-slider.mdc-slider--disabled .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mat-mdc-slider.mdc-slider--disabled .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-color:#fff}.mat-mdc-slider .mdc-slider__thumb::before,.mat-mdc-slider .mdc-slider__thumb::after{background-color:var(--mdc-slider-handle-color)}.mat-mdc-slider .mdc-slider__thumb:hover::before,.mat-mdc-slider .mdc-slider__thumb.mdc-ripple-surface--hover::before{opacity:var(--mdc-ripple-hover-opacity)}.mat-mdc-slider .mdc-slider__thumb.mdc-ripple-upgraded--background-focused::before,.mat-mdc-slider .mdc-slider__thumb:not(.mdc-ripple-upgraded):focus::before{transition-duration:75ms;opacity:var(--mdc-ripple-focus-opacity)}.mat-mdc-slider .mdc-slider__thumb:not(.mdc-ripple-upgraded)::after{transition:opacity 150ms linear}.mat-mdc-slider .mdc-slider__thumb:not(.mdc-ripple-upgraded):active::after{transition-duration:75ms;opacity:var(--mdc-ripple-press-opacity)}.mat-mdc-slider .mdc-slider__thumb.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-ripple-press-opacity)}.mat-mdc-slider .mdc-slider__track--active_fill{border-color:var(--mdc-slider-active-track-color)}.mat-mdc-slider.mdc-slider--disabled .mdc-slider__track--active_fill{border-color:var(--mdc-slider-disabled-active-track-color)}.mat-mdc-slider .mdc-slider__track--inactive{background-color:var(--mdc-slider-inactive-track-color);opacity:.24}.mat-mdc-slider.mdc-slider--disabled .mdc-slider__track--inactive{background-color:var(--mdc-slider-disabled-inactive-track-color);opacity:.24}.mat-mdc-slider .mdc-slider__tick-mark--active{background-color:var(--mdc-slider-with-tick-marks-active-container-color);opacity:var(--mdc-slider-with-tick-marks-active-container-opacity)}.mat-mdc-slider.mdc-slider--disabled .mdc-slider__tick-mark--active{background-color:var(--mdc-slider-with-tick-marks-active-container-color);opacity:var(--mdc-slider-with-tick-marks-active-container-opacity)}.mat-mdc-slider .mdc-slider__tick-mark--inactive{background-color:var(--mdc-slider-with-tick-marks-inactive-container-color);opacity:var(--mdc-slider-with-tick-marks-inactive-container-opacity)}.mat-mdc-slider.mdc-slider--disabled .mdc-slider__tick-mark--inactive{background-color:var(--mdc-slider-with-tick-marks-disabled-container-color);opacity:var(--mdc-slider-with-tick-marks-inactive-container-opacity)}.mat-mdc-slider .mdc-slider__value-indicator{background-color:var(--mdc-slider-label-container-color);opacity:1}.mat-mdc-slider .mdc-slider__value-indicator::before{border-top-color:var(--mdc-slider-label-container-color)}.mat-mdc-slider .mdc-slider__value-indicator{color:var(--mdc-slider-label-label-text-color)}.mat-mdc-slider .mdc-slider__track{height:var(--mdc-slider-inactive-track-height)}.mat-mdc-slider .mdc-slider__track--active{height:var(--mdc-slider-active-track-height);top:calc((var(--mdc-slider-inactive-track-height) - var(--mdc-slider-active-track-height)) / 2)}.mat-mdc-slider .mdc-slider__track--active_fill{border-top-width:var(--mdc-slider-active-track-height)}.mat-mdc-slider .mdc-slider__track--inactive{height:var(--mdc-slider-inactive-track-height)}.mat-mdc-slider .mdc-slider__tick-mark--active,.mat-mdc-slider .mdc-slider__tick-mark--inactive{height:var(--mdc-slider-with-tick-marks-container-size);width:var(--mdc-slider-with-tick-marks-container-size)}.mat-mdc-slider.mdc-slider--disabled{opacity:0.38}.mat-mdc-slider .mdc-slider__value-indicator-text{letter-spacing:var(--mdc-slider-label-label-text-tracking);font-size:var(--mdc-slider-label-label-text-size);font-family:var(--mdc-slider-label-label-text-font);font-weight:var(--mdc-slider-label-label-text-weight);line-height:var(--mdc-slider-label-label-text-line-height)}.mat-mdc-slider .mdc-slider__track--active{border-radius:var(--mdc-slider-active-track-shape)}.mat-mdc-slider .mdc-slider__track--inactive{border-radius:var(--mdc-slider-inactive-track-shape)}.mat-mdc-slider .mdc-slider__thumb-knob{border-radius:var(--mdc-slider-handle-shape);width:var(--mdc-slider-handle-width);height:var(--mdc-slider-handle-height);border-style:solid;border-width:calc(var(--mdc-slider-handle-height) / 2) calc(var(--mdc-slider-handle-width) / 2)}.mat-mdc-slider .mdc-slider__tick-mark--active,.mat-mdc-slider .mdc-slider__tick-mark--inactive{border-radius:var(--mdc-slider-with-tick-marks-container-shape)}.mat-mdc-slider .mdc-slider__thumb:hover .mdc-slider__thumb-knob{background-color:var(--mdc-slider-hover-handle-color);border-color:var(--mdc-slider-hover-handle-color)}.mat-mdc-slider .mdc-slider__thumb:hover .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb:hover .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb:hover .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-color:#fff}.mat-mdc-slider .mdc-slider__thumb--focused .mdc-slider__thumb-knob{background-color:var(--mdc-slider-focus-handle-color);border-color:var(--mdc-slider-focus-handle-color)}.mat-mdc-slider .mdc-slider__thumb--focused .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb--focused .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb--focused .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-color:#fff}.mat-mdc-slider .mdc-slider__thumb:not(:disabled):active .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb:not(:disabled):active .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb:not(:disabled):active .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-color:#fff}.mat-mdc-slider .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-color:var(--mdc-slider-with-overlap-handle-outline-color);border-width:var(--mdc-slider-with-overlap-handle-outline-width)}.mat-mdc-slider .mdc-slider__thumb-knob{box-shadow:var(--mdc-slider-handle-elevation)}.mat-mdc-slider .mdc-slider__input{box-sizing:content-box;pointer-events:auto}.mat-mdc-slider .mdc-slider__input.mat-mdc-slider-input-no-pointer-events{pointer-events:none}.mat-mdc-slider .mdc-slider__input.mat-slider__right-input{left:auto;right:0}.mat-mdc-slider .mdc-slider__thumb,.mat-mdc-slider .mdc-slider__track--active_fill{transition-duration:0ms}.mat-mdc-slider.mat-mdc-slider-with-animation .mdc-slider__thumb,.mat-mdc-slider.mat-mdc-slider-with-animation .mdc-slider__track--active_fill{transition-duration:80ms}.mat-mdc-slider.mdc-slider--discrete .mdc-slider__thumb,.mat-mdc-slider.mdc-slider--discrete .mdc-slider__track--active_fill{transition-duration:0ms}.mat-mdc-slider.mat-mdc-slider-with-animation .mdc-slider__thumb,.mat-mdc-slider.mat-mdc-slider-with-animation .mdc-slider__track--active_fill{transition-duration:80ms}.mat-mdc-slider .mdc-slider__track,.mat-mdc-slider .mdc-slider__thumb{pointer-events:none}.mat-mdc-slider .mdc-slider__value-indicator-container{transform:var(--mat-slider-value-indicator-container-transform)}.mat-mdc-slider .mdc-slider__value-indicator{width:var(--mat-slider-value-indicator-width);height:var(--mat-slider-value-indicator-height);padding:var(--mat-slider-value-indicator-padding);opacity:var(--mat-slider-value-indicator-opacity);border-radius:var(--mat-slider-value-indicator-border-radius)}.mat-mdc-slider .mdc-slider__value-indicator::before{display:var(--mat-slider-value-indicator-caret-display)}.mat-mdc-slider .mdc-slider__value-indicator-text{width:var(--mat-slider-value-indicator-width);transform:var(--mat-slider-value-indicator-text-transform)}.mat-mdc-slider .mat-ripple .mat-ripple-element{background-color:var(--mat-slider-ripple-color)}.mat-mdc-slider .mat-ripple .mat-mdc-slider-hover-ripple{background-color:var(--mat-slider-hover-state-layer-color)}.mat-mdc-slider .mat-ripple .mat-mdc-slider-focus-ripple,.mat-mdc-slider .mat-ripple .mat-mdc-slider-active-ripple{background-color:var(--mat-slider-focus-state-layer-color)}.mat-mdc-slider._mat-animation-noopable.mdc-slider--discrete .mdc-slider__thumb,.mat-mdc-slider._mat-animation-noopable.mdc-slider--discrete .mdc-slider__track--active_fill,.mat-mdc-slider._mat-animation-noopable .mdc-slider__value-indicator{transition:none}.mat-mdc-slider .mat-mdc-focus-indicator::before{border-radius:50%}.mat-mdc-slider .mdc-slider__value-indicator{word-break:normal}.mat-mdc-slider .mdc-slider__value-indicator-text{text-align:center}.mdc-slider__thumb--focused .mat-mdc-focus-indicator::before{content:""}'],encapsulation:2,changeDetection:0});let p=d;return p})();var az={provide:g_,useExisting:dh(()=>Kb),multi:!0};var Kb=(()=>{let d=class d{get value(){return Cl(this._hostElement.value,0)}set value(f){f=isNaN(f)?0:f;let v=f+"";if(!this._hasSetInitialValue){this._initialValue=v;return}this._isActive||this._setValue(v)}_setValue(f){this._hostElement.value=f,this._updateThumbUIByValue(),this._slider._onValueChange(this),this._cdr.detectChanges(),this._slider._cdr.markForCheck()}get translateX(){return this._slider.min>=this._slider.max?(this._translateX=this._tickMarkOffset,this._translateX):(this._translateX===void 0&&(this._translateX=this._calcTranslateXByValue()),this._translateX)}set translateX(f){this._translateX=f}get min(){return Cl(this._hostElement.min,0)}set min(f){this._hostElement.min=f+"",this._cdr.detectChanges()}get max(){return Cl(this._hostElement.max,0)}set max(f){this._hostElement.max=f+"",this._cdr.detectChanges()}get step(){return Cl(this._hostElement.step,0)}set step(f){this._hostElement.step=f+"",this._cdr.detectChanges()}get disabled(){return io(this._hostElement.disabled)}set disabled(f){this._hostElement.disabled=f,this._cdr.detectChanges(),this._slider.disabled!==this.disabled&&(this._slider.disabled=this.disabled)}get percentage(){return this._slider.min>=this._slider.max?this._slider._isRtl?1:0:(this.value-this._slider.min)/(this._slider.max-this._slider.min)}get fillPercentage(){return this._slider._cachedWidth?this._translateX===0?0:this.translateX/this._slider._cachedWidth:this._slider._isRtl?1:0}_setIsFocused(f){this._isFocused=f}constructor(f,v,r,k){this._ngZone=f,this._elementRef=v,this._cdr=r,this._slider=k,this.valueChange=new Or,this.dragStart=new Or,this.dragEnd=new Or,this.thumbPosition=$i.END,this._valuetext=VT(""),this._knobRadius=8,this._tickMarkOffset=3,this._isActive=!1,this._isFocused=!1,this._hasSetInitialValue=!1,this._destroyed=new ir,this._skipUIUpdate=!1,this._onTouchedFn=()=>{},this._isControlInitialized=!1,this._platform=ti(lr),this._hostElement=v.nativeElement,this._ngZone.runOutsideAngular(()=>{this._hostElement.addEventListener("pointerdown",this._onPointerDown.bind(this)),this._hostElement.addEventListener("pointermove",this._onPointerMove.bind(this)),this._hostElement.addEventListener("pointerup",this._onPointerUp.bind(this))})}ngOnDestroy(){this._hostElement.removeEventListener("pointerdown",this._onPointerDown),this._hostElement.removeEventListener("pointermove",this._onPointerMove),this._hostElement.removeEventListener("pointerup",this._onPointerUp),this._destroyed.next(),this._destroyed.complete(),this.dragStart.complete(),this.dragEnd.complete()}initProps(){this._updateWidthInactive(),this.disabled!==this._slider.disabled&&(this._slider.disabled=!0),this.step=this._slider.step,this.min=this._slider.min,this.max=this._slider.max,this._initValue()}initUI(){this._updateThumbUIByValue()}_initValue(){this._hasSetInitialValue=!0,this._initialValue===void 0?this.value=this._getDefaultValue():(this._hostElement.value=this._initialValue,this._updateThumbUIByValue(),this._slider._onValueChange(this),this._cdr.detectChanges())}_getDefaultValue(){return this.min}_onBlur(){this._setIsFocused(!1),this._onTouchedFn()}_onFocus(){this._slider._setTransition(!1),this._slider._updateTrackUI(this),this._setIsFocused(!0)}_onChange(){this.valueChange.emit(this.value),this._isActive&&this._updateThumbUIByValue({withAnimation:!0})}_onInput(){this._onChangeFn?.(this.value),(this._slider.step||!this._isActive)&&this._updateThumbUIByValue({withAnimation:!0}),this._slider._onValueChange(this)}_onNgControlValueChange(){(!this._isActive||!this._isFocused)&&(this._slider._onValueChange(this),this._updateThumbUIByValue()),this._slider.disabled=this._formControl.disabled}_onPointerDown(f){if(!(this.disabled||f.button!==0)){if(this._platform.IOS){let v=this._slider._isCursorOnSliderThumb(f,this._slider._getThumb(this.thumbPosition)._hostElement.getBoundingClientRect());this._isActive=v,this._updateWidthActive(),this._slider._updateDimensions();return}this._isActive=!0,this._setIsFocused(!0),this._updateWidthActive(),this._slider._updateDimensions(),this._slider.step||this._updateThumbUIByPointerEvent(f,{withAnimation:!0}),this.disabled||(this._handleValueCorrection(f),this.dragStart.emit({source:this,parent:this._slider,value:this.value}))}}_handleValueCorrection(f){this._skipUIUpdate=!0,setTimeout(()=>{this._skipUIUpdate=!1,this._fixValue(f)},0)}_fixValue(f){let v=f.clientX-this._slider._cachedLeft,r=this._slider._cachedWidth,k=this._slider.step===0?1:this._slider.step,W=Math.floor((this._slider.max-this._slider.min)/k),ee=this._slider._isRtl?1-v/r:v/r,Ie=Math.round(ee*W)/W*(this._slider.max-this._slider.min)+this._slider.min,Ne=Math.round(Ie/k)*k,lt=this.value;if(Ne===lt){this._slider._onValueChange(this),this._slider.step>0?this._updateThumbUIByValue():this._updateThumbUIByPointerEvent(f,{withAnimation:this._slider._hasAnimation});return}this.value=Ne,this.valueChange.emit(this.value),this._onChangeFn?.(this.value),this._slider._onValueChange(this),this._slider.step>0?this._updateThumbUIByValue():this._updateThumbUIByPointerEvent(f,{withAnimation:this._slider._hasAnimation})}_onPointerMove(f){!this._slider.step&&this._isActive&&this._updateThumbUIByPointerEvent(f)}_onPointerUp(){this._isActive&&(this._isActive=!1,this._platform.SAFARI&&this._setIsFocused(!1),this.dragEnd.emit({source:this,parent:this._slider,value:this.value}),setTimeout(()=>this._updateWidthInactive(),this._platform.IOS?10:0))}_clamp(f){let v=this._tickMarkOffset,r=this._slider._cachedWidth-this._tickMarkOffset;return Math.max(Math.min(f,r),v)}_calcTranslateXByValue(){return this._slider._isRtl?(1-this.percentage)*(this._slider._cachedWidth-this._tickMarkOffset*2)+this._tickMarkOffset:this.percentage*(this._slider._cachedWidth-this._tickMarkOffset*2)+this._tickMarkOffset}_calcTranslateXByPointerEvent(f){return f.clientX-this._slider._cachedLeft}_updateWidthActive(){}_updateWidthInactive(){this._hostElement.style.padding=`0 ${this._slider._inputPadding}px`,this._hostElement.style.width=`calc(100% + ${this._slider._inputPadding-this._tickMarkOffset*2}px)`,this._hostElement.style.left=`-${this._slider._rippleRadius-this._tickMarkOffset}px`}_updateThumbUIByValue(f){this.translateX=this._clamp(this._calcTranslateXByValue()),this._updateThumbUI(f)}_updateThumbUIByPointerEvent(f,v){this.translateX=this._clamp(this._calcTranslateXByPointerEvent(f)),this._updateThumbUI(v)}_updateThumbUI(f){this._slider._setTransition(!!f?.withAnimation),this._slider._onTranslateXChange(this)}writeValue(f){(this._isControlInitialized||f!==null)&&(this.value=f)}registerOnChange(f){this._onChangeFn=f,this._isControlInitialized=!0}registerOnTouched(f){this._onTouchedFn=f}setDisabledState(f){this.disabled=f}focus(){this._hostElement.focus()}blur(){this._hostElement.blur()}};d.\u0275fac=function(v){return new(v||d)(zt(_n),zt(nr),zt(Ms),zt(Yb))},d.\u0275dir=uo({type:d,selectors:[["input","matSliderThumb",""]],hostAttrs:["type","range",1,"mdc-slider__input"],hostVars:1,hostBindings:function(v,r){v&1&&ts("change",function(){return r._onChange()})("input",function(){return r._onInput()})("blur",function(){return r._onBlur()})("focus",function(){return r._onFocus()}),v&2&&qs("aria-valuetext",r._valuetext())},inputs:{value:[An.HasDecoratorInputTransform,"value","value",Cl]},outputs:{valueChange:"valueChange",dragStart:"dragStart",dragEnd:"dragEnd"},exportAs:["matSliderThumb"],standalone:!0,features:[Zs([az,{provide:TC,useExisting:d}]),Ta]});let p=d;return p})();var SC=(()=>{let d=class d{};d.\u0275fac=function(v){return new(v||d)},d.\u0275mod=_r({type:d}),d.\u0275inj=gr({imports:[Xs,z_]});let p=d;return p})();var MC=(()=>{let d=class d{constructor(f){this.mapService=f,this.poligonHeight=0}setDrawMode(f){this.mapService.draw.changeMode(f)}deleteDraw(){this.mapService.draw.delete(this.mapService.selectedFeatureIds),this.mapService.updatePolygonLayer()}deleteDrawAll(){this.mapService.draw.getAll().features.length>0&&(this.mapService.draw.deleteAll(),this.mapService.updatePolygonLayer())}setHeight(){this.mapService.setExtrudeHeight(this.poligonHeight)}};d.\u0275fac=function(v){return new(v||d)(zt(A_))},d.\u0275cmp=Ar({type:d,selectors:[["app-toolbar"]],standalone:!0,features:[Dr],decls:21,vars:9,consts:[["slider",""],[1,"toolbar"],["mat-button","",3,"click"],["fontIcon","draw"],["fontIcon","delete"],["fontIcon","delete_forever"],[1,"polygon-slider-height"],[1,"psh__title"],["id","example-name-label",1,"example-name-label"],[1,"example-value-label"],[1,"psh__slider",3,"max","min","step","discrete","showTickMarks"],["matSliderThumb","",3,"ngModelChange","input","ngModel"]],template:function(v,r){if(v&1){let k=Nd();rr(0,"div",1)(1,"h2"),Ml(2,"Nakiki Map"),ar(),rr(3,"button",2),ts("click",function(){return El(k),Il(r.setDrawMode("draw_polygon"))}),Qn(4,"mat-icon",3),Ml(5," \u041F\u043E\u043B\u0438\u0433\u043E\u043D "),ar(),rr(6,"button",2),ts("click",function(){return El(k),Il(r.deleteDraw())}),Qn(7,"mat-icon",4),Ml(8," \u0423\u0434\u0430\u043B\u0438\u0442\u044C "),ar(),rr(9,"button",2),ts("click",function(){return El(k),Il(r.deleteDrawAll())}),Qn(10,"mat-icon",5),Ml(11," \u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0432\u0441\u0435 "),ar(),rr(12,"div",6)(13,"div",7)(14,"label",8),Ml(15,"\u0412\u044B\u0441\u043E\u0442\u0430 \u0444\u0438\u0433\u0443\u0440\u044B: "),ar(),rr(16,"label",9),Ml(17),ar()(),rr(18,"mat-slider",10)(19,"input",11,0),YT("ngModelChange",function(ee){return El(k),XT(r.poligonHeight,ee)||(r.poligonHeight=ee),Il(ee)}),ts("input",function(){return El(k),Il(r.setHeight())}),ar()()()()}if(v&2){let k=Mf(20);ho(),_h("text-align","center"),ho(16),Gg(k.value),ho(),gh("max",50)("min",0)("step",1)("discrete",!1)("showTickMarks",!1),ho(),QT("ngModel",r.poligonHeight)}},dependencies:[v_,__,TI,cb,U_,mC,j_,V_,SC,IC,Kb],styles:[".toolbar[_ngcontent-%COMP%]{max-width:250px;padding:30px 10px;display:flex;flex-direction:column;gap:5px;overflow:hidden}.toolbar[_ngcontent-%COMP%]   .mat-mdc-button[_ngcontent-%COMP%]{justify-content:flex-start!important;text-align:left}.toolbar[_ngcontent-%COMP%]   .polygon-slider-height[_ngcontent-%COMP%]{margin-top:30px}.toolbar[_ngcontent-%COMP%]   .polygon-slider-height[_ngcontent-%COMP%]   .psh__title[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.toolbar[_ngcontent-%COMP%]   .polygon-slider-height[_ngcontent-%COMP%]   .psh__slider[_ngcontent-%COMP%]{width:88%}"],changeDetection:0});let p=d;return p})();function cz(p,d){p&1&&Qn(0,"mat-icon",5)}function uz(p,d){p&1&&Qn(0,"mat-icon",6)}var CC=(()=>{let d=class d{};d.\u0275fac=function(v){return new(v||d)},d.\u0275cmp=Ar({type:d,selectors:[["app-root"]],standalone:!0,features:[Dr],decls:9,vars:1,consts:[["drawer",""],["autosize","",1,"main-container"],["mode","side",1,"sidebar"],[1,"content"],["mat-fab","","type","button","color","primary",1,"sidebar-toggle-btn",3,"click"],["fontIcon","chevron_left"],["fontIcon","chevron_right"]],template:function(v,r){if(v&1){let k=Nd();rr(0,"mat-drawer-container",1)(1,"mat-drawer",2,0),Qn(3,"app-toolbar"),ar(),rr(4,"div",3),Qn(5,"app-map"),rr(6,"button",4),ts("click",function(){El(k);let ee=Mf(2);return Il(ee.toggle())}),tl(7,cz,1,0,"mat-icon",5)(8,uz,1,0),ar()()()}if(v&2){let k=Mf(2);ho(7),il(7,k.opened?7:8)}},dependencies:[kM,MC,U_,_C,wC,Qb,Xb,j_,V_],styles:[".main-container[_ngcontent-%COMP%]{height:100vh;position:relative}.sidebar-toggle-btn[_ngcontent-%COMP%]{position:absolute;bottom:30px;left:10px}"]});let p=d;return p})();xE(CC,aI).catch(p=>console.error(p));
